<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><title>Hexo</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.1.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">John Doe</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">188</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">24</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">22</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Hexo</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="site-info"><div id="site-title">Hexo</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/15/DevOp/2017-04-03-awk/">DevOp/2017-04-03-awk</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-15</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/DevOps/">DevOps</a></span><div class="content"><p>ref from: <a href="https://coolshell.cn/articles/9070.html" target="_blank" rel="noopener">https://coolshell.cn/articles/9070.html</a></p>
<p>我从netstat命令中提取了如下信息作为用例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`$ ``cat` `netstat``.txt``Proto Recv-Q Send-Q Local-Address          Foreign-Address             State``tcp        0      0 0.0.0.0:3306           0.0.0.0:*                   LISTEN``tcp        0      0 0.0.0.0:80             0.0.0.0:*                   LISTEN``tcp        0      0 127.0.0.1:9000         0.0.0.0:*                   LISTEN``tcp        0      0 coolshell.cn:80        124.205.5.146:18245         TIME_WAIT``tcp        0      0 coolshell.cn:80        61.140.101.185:37538        FIN_WAIT2``tcp        0      0 coolshell.cn:80        110.194.134.189:1032        ESTABLISHED``tcp        0      0 coolshell.cn:80        123.169.124.111:49809       ESTABLISHED``tcp        0      0 coolshell.cn:80        116.234.127.77:11502        FIN_WAIT2``tcp        0      0 coolshell.cn:80        123.169.124.111:49829       ESTABLISHED``tcp        0      0 coolshell.cn:80        183.60.215.36:36970         TIME_WAIT``tcp        0   4166 coolshell.cn:80        61.148.242.38:30901         ESTABLISHED``tcp        0      1 coolshell.cn:80        124.152.181.209:26825       FIN_WAIT1``tcp        0      0 coolshell.cn:80        110.194.134.189:4796        ESTABLISHED``tcp        0      0 coolshell.cn:80        183.60.212.163:51082        TIME_WAIT``tcp        0      1 coolshell.cn:80        208.115.113.92:50601        LAST_ACK``tcp        0      0 coolshell.cn:80        123.169.124.111:49840       ESTABLISHED``tcp        0      0 coolshell.cn:80        117.136.20.85:50025         FIN_WAIT2``tcp        0      0 :::22                  :::*                        LISTEN`</span><br></pre></td></tr></table></figure>

<p>下面是最简单最常用的awk示例，其输出第1列和第4例，</p>
<ul>
<li>其中单引号中的被大括号括着的就是awk的语句，注意，其只能被单引号包含。</li>
<li>其中的$1..$n表示第几例。注：$0表示整个行。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`$ ``awk` `<span class="string">'&#123;print $1, $4&#125;'</span>` `netstat``.txt``Proto Local-Address``tcp 0.0.0.0:3306``tcp 0.0.0.0:80``tcp 127.0.0.1:9000``tcp coolshell.cn:80``tcp coolshell.cn:80``tcp coolshell.cn:80``tcp coolshell.cn:80``tcp coolshell.cn:80``tcp coolshell.cn:80``tcp coolshell.cn:80``tcp coolshell.cn:80``tcp coolshell.cn:80``tcp coolshell.cn:80``tcp coolshell.cn:80``tcp coolshell.cn:80``tcp coolshell.cn:80``tcp coolshell.cn:80``tcp :::22`</span><br></pre></td></tr></table></figure>

<p>我们再来看看awk的格式化输出，和C语言的printf没什么两样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$ &#96;&#96;awk&#96; &#96;&#39;&#123;printf &quot;%-8s %-8s %-8s %-18s %-22s %-15s\n&quot;,$1,$2,$3,$4,$5,$6&#125;&#39;&#96; &#96;netstat&#96;&#96;.txt&#96;&#96;Proto    Recv-Q   Send-Q   Local-Address      Foreign-Address        State&#96;&#96;tcp      0        0        0.0.0.0:3306       0.0.0.0:*              LISTEN&#96;&#96;tcp      0        0        0.0.0.0:80         0.0.0.0:*              LISTEN&#96;&#96;tcp      0        0        127.0.0.1:9000     0.0.0.0:*              LISTEN&#96;&#96;tcp      0        0        coolshell.cn:80    124.205.5.146:18245    TIME_WAIT&#96;&#96;tcp      0        0        coolshell.cn:80    61.140.101.185:37538   FIN_WAIT2&#96;&#96;tcp      0        0        coolshell.cn:80    110.194.134.189:1032   ESTABLISHED&#96;&#96;tcp      0        0        coolshell.cn:80    123.169.124.111:49809  ESTABLISHED&#96;&#96;tcp      0        0        coolshell.cn:80    116.234.127.77:11502   FIN_WAIT2&#96;&#96;tcp      0        0        coolshell.cn:80    123.169.124.111:49829  ESTABLISHED&#96;&#96;tcp      0        0        coolshell.cn:80    183.60.215.36:36970    TIME_WAIT&#96;&#96;tcp      0        4166     coolshell.cn:80    61.148.242.38:30901    ESTABLISHED&#96;&#96;tcp      0        1        coolshell.cn:80    124.152.181.209:26825  FIN_WAIT1&#96;&#96;tcp      0        0        coolshell.cn:80    110.194.134.189:4796   ESTABLISHED&#96;&#96;tcp      0        0        coolshell.cn:80    183.60.212.163:51082   TIME_WAIT&#96;&#96;tcp      0        1        coolshell.cn:80    208.115.113.92:50601   LAST_ACK&#96;&#96;tcp      0        0        coolshell.cn:80    123.169.124.111:49840  ESTABLISHED&#96;&#96;tcp      0        0        coolshell.cn:80    117.136.20.85:50025    FIN_WAIT2&#96;&#96;tcp      0        0        :::22              :::*                   LISTEN&#96;</span><br></pre></td></tr></table></figure>

<h4 id="脱掉外套"><a href="#脱掉外套" class="headerlink" title="脱掉外套"></a>脱掉外套</h4><h5 id="过滤记录"><a href="#过滤记录" class="headerlink" title="过滤记录"></a>过滤记录</h5><p>我们再来看看如何过滤记录（下面过滤条件为：第三列的值为0 &amp;&amp; 第6列的值为LISTEN）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$ &#96;&#96;awk&#96; &#96;&#39;$3&#x3D;&#x3D;0 &amp;&amp; $6&#x3D;&#x3D;&quot;LISTEN&quot; &#39;&#96; &#96;netstat&#96;&#96;.txt&#96;&#96;tcp        0      0 0.0.0.0:3306               0.0.0.0:*              LISTEN&#96;&#96;tcp        0      0 0.0.0.0:80                 0.0.0.0:*              LISTEN&#96;&#96;tcp        0      0 127.0.0.1:9000             0.0.0.0:*              LISTEN&#96;&#96;tcp        0      0 :::22                      :::*                   LISTEN&#96;</span><br></pre></td></tr></table></figure>

<p>其中的“==”为比较运算符。其他比较运算符：!=, &gt;, &lt;, &gt;=, &lt;=</p>
<p>我们来看看各种过滤记录的方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$ &#96;&#96;awk&#96; &#96;&#39; $3&gt;0 &#123;print $0&#125;&#39;&#96; &#96;netstat&#96;&#96;.txt&#96;&#96;Proto Recv-Q Send-Q Local-Address          Foreign-Address             State&#96;&#96;tcp        0   4166 coolshell.cn:80        61.148.242.38:30901         ESTABLISHED&#96;&#96;tcp        0      1 coolshell.cn:80        124.152.181.209:26825       FIN_WAIT1&#96;&#96;tcp        0      1 coolshell.cn:80        208.115.113.92:50601        LAST_ACK&#96;</span><br></pre></td></tr></table></figure>

<p>如果我们需要表头的话，我们可以引入内建变量NR：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$ &#96;&#96;awk&#96; &#96;&#39;$3&#x3D;&#x3D;0 &amp;&amp; $6&#x3D;&#x3D;&quot;LISTEN&quot; || NR&#x3D;&#x3D;1 &#39;&#96; &#96;netstat&#96;&#96;.txt&#96;&#96;Proto Recv-Q Send-Q Local-Address          Foreign-Address             State&#96;&#96;tcp        0      0 0.0.0.0:3306           0.0.0.0:*                   LISTEN&#96;&#96;tcp        0      0 0.0.0.0:80             0.0.0.0:*                   LISTEN&#96;&#96;tcp        0      0 127.0.0.1:9000         0.0.0.0:*                   LISTEN&#96;&#96;tcp        0      0 :::22                  :::*                        LISTEN&#96;</span><br></pre></td></tr></table></figure>

<p>再加上格式化输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$ &#96;&#96;awk&#96; &#96;&#39;$3&#x3D;&#x3D;0 &amp;&amp; $6&#x3D;&#x3D;&quot;LISTEN&quot; || NR&#x3D;&#x3D;1 &#123;printf &quot;%-20s %-20s %s\n&quot;,$4,$5,$6&#125;&#39;&#96; &#96;netstat&#96;&#96;.txt&#96;&#96;Local-Address        Foreign-Address      State&#96;&#96;0.0.0.0:3306         0.0.0.0:*            LISTEN&#96;&#96;0.0.0.0:80           0.0.0.0:*            LISTEN&#96;&#96;127.0.0.1:9000       0.0.0.0:*            LISTEN&#96;&#96;:::22                :::*                 LISTEN&#96;</span><br></pre></td></tr></table></figure>

<h5 id="内建变量"><a href="#内建变量" class="headerlink" title="内建变量"></a><strong>内建变量</strong></h5><p>说到了内建变量，我们可以来看看awk的一些内建变量：</p>
<table>
<thead>
<tr>
<th>$0</th>
<th>当前记录（这个变量中存放着整个行的内容）</th>
</tr>
</thead>
<tbody><tr>
<td>$1~$n</td>
<td>当前记录的第n个字段，字段间由FS分隔</td>
</tr>
<tr>
<td>FS</td>
<td>输入字段分隔符 默认是空格或Tab</td>
</tr>
<tr>
<td>NF</td>
<td>当前记录中的字段个数，就是有多少列</td>
</tr>
<tr>
<td>NR</td>
<td>已经读出的记录数，就是行号，从1开始，如果有多个文件话，这个值也是不断累加中。</td>
</tr>
<tr>
<td>FNR</td>
<td>当前记录数，与NR不同的是，这个值会是各个文件自己的行号</td>
</tr>
<tr>
<td>RS</td>
<td>输入的记录分隔符， 默认为换行符</td>
</tr>
<tr>
<td>OFS</td>
<td>输出字段分隔符， 默认也是空格</td>
</tr>
<tr>
<td>ORS</td>
<td>输出的记录分隔符，默认为换行符</td>
</tr>
<tr>
<td>FILENAME</td>
<td>当前输入文件的名字</td>
</tr>
</tbody></table>
<p>怎么使用呢，比如：我们如果要输出行号：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$ &#96;&#96;awk&#96; &#96;&#39;$3&#x3D;&#x3D;0 &amp;&amp; $6&#x3D;&#x3D;&quot;ESTABLISHED&quot; || NR&#x3D;&#x3D;1 &#123;printf &quot;%02s %s %-20s %-20s %s\n&quot;,NR, FNR, $4,$5,$6&#125;&#39;&#96; &#96;netstat&#96;&#96;.txt&#96;&#96;01 1 Local-Address        Foreign-Address      State&#96;&#96;07 7 coolshell.cn:80      110.194.134.189:1032 ESTABLISHED&#96;&#96;08 8 coolshell.cn:80      123.169.124.111:49809 ESTABLISHED&#96;&#96;10 10 coolshell.cn:80      123.169.124.111:49829 ESTABLISHED&#96;&#96;14 14 coolshell.cn:80      110.194.134.189:4796 ESTABLISHED&#96;&#96;17 17 coolshell.cn:80      123.169.124.111:49840 ESTABLISHED&#96;</span><br></pre></td></tr></table></figure>

<h5 id="指定分隔符"><a href="#指定分隔符" class="headerlink" title="指定分隔符"></a><strong>指定分隔符</strong></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$  &#96;&#96;awk&#96;  &#96;&#39;BEGIN&#123;FS&#x3D;&quot;:&quot;&#125; &#123;print $1,$3,$6&#125;&#39;&#96; &#96;&#x2F;etc&#x2F;passwd&#96;&#96;root 0 &#96;&#96;&#x2F;root&#96;&#96;bin 1 &#96;&#96;&#x2F;bin&#96;&#96;daemon 2 &#96;&#96;&#x2F;sbin&#96;&#96;adm 3 &#96;&#96;&#x2F;var&#x2F;adm&#96;&#96;lp 4 &#96;&#96;&#x2F;var&#x2F;spool&#x2F;lpd&#96;&#96;sync&#96; &#96;5 &#96;&#96;&#x2F;sbin&#96;&#96;shutdown&#96; &#96;6 &#96;&#96;&#x2F;sbin&#96;&#96;halt 7 &#96;&#96;&#x2F;sbin&#96;</span><br></pre></td></tr></table></figure>

<p>上面的命令也等价于：（-F的意思就是指定分隔符）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$ &#96;&#96;awk&#96;  &#96;-F: &#96;&#96;&#39;&#123;print $1,$3,$6&#125;&#39;&#96; &#96;&#x2F;etc&#x2F;passwd&#96;</span><br></pre></td></tr></table></figure>

<p>注：如果你要指定多个分隔符，你可以这样来：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;awk&#96; &#96;-F &#96;&#96;&#39;[;:]&#39;&#96;</span><br></pre></td></tr></table></figure>

<p>再来看一个以\t作为分隔符输出的例子（下面使用了/etc/passwd文件，这个文件是以:分隔的）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$ &#96;&#96;awk&#96;  &#96;-F: &#96;&#96;&#39;&#123;print $1,$3,$6&#125;&#39;&#96; &#96;OFS&#x3D;&#96;&#96;&quot;\t&quot;&#96; &#96;&#x2F;etc&#x2F;passwd&#96;&#96;root    0       &#96;&#96;&#x2F;root&#96;&#96;bin     1       &#96;&#96;&#x2F;bin&#96;&#96;daemon  2       &#96;&#96;&#x2F;sbin&#96;&#96;adm     3       &#96;&#96;&#x2F;var&#x2F;adm&#96;&#96;lp      4       &#96;&#96;&#x2F;var&#x2F;spool&#x2F;lpd&#96;&#96;sync&#96;    &#96;5       &#96;&#96;&#x2F;sbin&#96;</span><br></pre></td></tr></table></figure>

<h4 id="脱掉衬衫"><a href="#脱掉衬衫" class="headerlink" title="脱掉衬衫"></a>脱掉衬衫</h4><h5 id="字符串匹配"><a href="#字符串匹配" class="headerlink" title="字符串匹配"></a>字符串匹配</h5><p>我们再来看几个字符串匹配的示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$ &#96;&#96;awk&#96; &#96;&#39;$6 ~ &#x2F;FIN&#x2F; || NR&#x3D;&#x3D;1 &#123;print NR,$4,$5,$6&#125;&#39;&#96; &#96;OFS&#x3D;&#96;&#96;&quot;\t&quot;&#96; &#96;netstat&#96;&#96;.txt&#96;&#96;1       Local-Address   Foreign-Address State&#96;&#96;6       coolshell.cn:80 61.140.101.185:37538    FIN_WAIT2&#96;&#96;9       coolshell.cn:80 116.234.127.77:11502    FIN_WAIT2&#96;&#96;13      coolshell.cn:80 124.152.181.209:26825   FIN_WAIT1&#96;&#96;18      coolshell.cn:80 117.136.20.85:50025     FIN_WAIT2&#96; &#96;$ $ &#96;&#96;awk&#96; &#96;&#39;$6 ~ &#x2F;WAIT&#x2F; || NR&#x3D;&#x3D;1 &#123;print NR,$4,$5,$6&#125;&#39;&#96; &#96;OFS&#x3D;&#96;&#96;&quot;\t&quot;&#96; &#96;netstat&#96;&#96;.txt&#96;&#96;1       Local-Address   Foreign-Address State&#96;&#96;5       coolshell.cn:80 124.205.5.146:18245     TIME_WAIT&#96;&#96;6       coolshell.cn:80 61.140.101.185:37538    FIN_WAIT2&#96;&#96;9       coolshell.cn:80 116.234.127.77:11502    FIN_WAIT2&#96;&#96;11      coolshell.cn:80 183.60.215.36:36970     TIME_WAIT&#96;&#96;13      coolshell.cn:80 124.152.181.209:26825   FIN_WAIT1&#96;&#96;15      coolshell.cn:80 183.60.212.163:51082    TIME_WAIT&#96;&#96;18      coolshell.cn:80 117.136.20.85:50025     FIN_WAIT2&#96;</span><br></pre></td></tr></table></figure>

<p>上面的第一个示例匹配FIN状态， 第二个示例匹配WAIT字样的状态。其实 ~ 表示模式开始。/ /中是模式。这就是一个正则表达式的匹配。</p>
<p>其实awk可以像grep一样的去匹配第一行，就像这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$ &#96;&#96;awk&#96; &#96;&#39;&#x2F;LISTEN&#x2F;&#39;&#96; &#96;netstat&#96;&#96;.txt&#96;&#96;tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN&#96;&#96;tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN&#96;&#96;tcp        0      0 127.0.0.1:9000          0.0.0.0:*               LISTEN&#96;&#96;tcp        0      0 :::22                   :::*                    LISTEN&#96;</span><br></pre></td></tr></table></figure>

<p>我们可以使用 “/FIN|TIME/” 来匹配 FIN 或者 TIME :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$ &#96;&#96;awk&#96; &#96;&#39;$6 ~ &#x2F;FIN|TIME&#x2F; || NR&#x3D;&#x3D;1 &#123;print NR,$4,$5,$6&#125;&#39;&#96; &#96;OFS&#x3D;&#96;&#96;&quot;\t&quot;&#96; &#96;netstat&#96;&#96;.txt&#96;&#96;1       Local-Address   Foreign-Address State&#96;&#96;5       coolshell.cn:80 124.205.5.146:18245     TIME_WAIT&#96;&#96;6       coolshell.cn:80 61.140.101.185:37538    FIN_WAIT2&#96;&#96;9       coolshell.cn:80 116.234.127.77:11502    FIN_WAIT2&#96;&#96;11      coolshell.cn:80 183.60.215.36:36970     TIME_WAIT&#96;&#96;13      coolshell.cn:80 124.152.181.209:26825   FIN_WAIT1&#96;&#96;15      coolshell.cn:80 183.60.212.163:51082    TIME_WAIT&#96;&#96;18      coolshell.cn:80 117.136.20.85:50025     FIN_WAIT2&#96;</span><br></pre></td></tr></table></figure>

<p>再来看看模式取反的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$ &#96;&#96;awk&#96; &#96;&#39;$6 !~ &#x2F;WAIT&#x2F; || NR&#x3D;&#x3D;1 &#123;print NR,$4,$5,$6&#125;&#39;&#96; &#96;OFS&#x3D;&#96;&#96;&quot;\t&quot;&#96; &#96;netstat&#96;&#96;.txt&#96;&#96;1       Local-Address   Foreign-Address State&#96;&#96;2       0.0.0.0:3306    0.0.0.0:*       LISTEN&#96;&#96;3       0.0.0.0:80      0.0.0.0:*       LISTEN&#96;&#96;4       127.0.0.1:9000  0.0.0.0:*       LISTEN&#96;&#96;7       coolshell.cn:80 110.194.134.189:1032    ESTABLISHED&#96;&#96;8       coolshell.cn:80 123.169.124.111:49809   ESTABLISHED&#96;&#96;10      coolshell.cn:80 123.169.124.111:49829   ESTABLISHED&#96;&#96;12      coolshell.cn:80 61.148.242.38:30901     ESTABLISHED&#96;&#96;14      coolshell.cn:80 110.194.134.189:4796    ESTABLISHED&#96;&#96;16      coolshell.cn:80 208.115.113.92:50601    LAST_ACK&#96;&#96;17      coolshell.cn:80 123.169.124.111:49840   ESTABLISHED&#96;&#96;19      :::22   :::*    LISTEN&#96;</span><br></pre></td></tr></table></figure>

<p>或是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;awk&#96; &#96;&#39;!&#x2F;WAIT&#x2F;&#39;&#96; &#96;netstat&#96;&#96;.txt&#96;</span><br></pre></td></tr></table></figure>

<p><strong>折分文件</strong></p>
<p>awk拆分文件很简单，使用重定向就好了。下面这个例子，是按第6例分隔文件，相当的简单（其中的NR!=1表示不处理表头）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$ &#96;&#96;awk&#96; &#96;&#39;NR!&#x3D;1&#123;print &gt; $6&#125;&#39;&#96; &#96;netstat&#96;&#96;.txt&#96; &#96;$ &#96;&#96;ls&#96;&#96;ESTABLISHED  FIN_WAIT1  FIN_WAIT2  LAST_ACK  LISTEN  &#96;&#96;netstat&#96;&#96;.txt  TIME_WAIT&#96; &#96;$ &#96;&#96;cat&#96; &#96;ESTABLISHED&#96;&#96;tcp        0      0 coolshell.cn:80        110.194.134.189:1032        ESTABLISHED&#96;&#96;tcp        0      0 coolshell.cn:80        123.169.124.111:49809       ESTABLISHED&#96;&#96;tcp        0      0 coolshell.cn:80        123.169.124.111:49829       ESTABLISHED&#96;&#96;tcp        0   4166 coolshell.cn:80        61.148.242.38:30901         ESTABLISHED&#96;&#96;tcp        0      0 coolshell.cn:80        110.194.134.189:4796        ESTABLISHED&#96;&#96;tcp        0      0 coolshell.cn:80        123.169.124.111:49840       ESTABLISHED&#96; &#96;$ &#96;&#96;cat&#96; &#96;FIN_WAIT1&#96;&#96;tcp        0      1 coolshell.cn:80        124.152.181.209:26825       FIN_WAIT1&#96; &#96;$ &#96;&#96;cat&#96; &#96;FIN_WAIT2&#96;&#96;tcp        0      0 coolshell.cn:80        61.140.101.185:37538        FIN_WAIT2&#96;&#96;tcp        0      0 coolshell.cn:80        116.234.127.77:11502        FIN_WAIT2&#96;&#96;tcp        0      0 coolshell.cn:80        117.136.20.85:50025         FIN_WAIT2&#96; &#96;$ &#96;&#96;cat&#96; &#96;LAST_ACK&#96;&#96;tcp        0      1 coolshell.cn:80        208.115.113.92:50601        LAST_ACK&#96; &#96;$ &#96;&#96;cat&#96; &#96;LISTEN&#96;&#96;tcp        0      0 0.0.0.0:3306           0.0.0.0:*                   LISTEN&#96;&#96;tcp        0      0 0.0.0.0:80             0.0.0.0:*                   LISTEN&#96;&#96;tcp        0      0 127.0.0.1:9000         0.0.0.0:*                   LISTEN&#96;&#96;tcp        0      0 :::22                  :::*                        LISTEN&#96; &#96;$ &#96;&#96;cat&#96; &#96;TIME_WAIT&#96;&#96;tcp        0      0 coolshell.cn:80        124.205.5.146:18245         TIME_WAIT&#96;&#96;tcp        0      0 coolshell.cn:80        183.60.215.36:36970         TIME_WAIT&#96;&#96;tcp        0      0 coolshell.cn:80        183.60.212.163:51082        TIME_WAIT&#96;</span><br></pre></td></tr></table></figure>

<p>你也可以把指定的列输出到文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;awk&#96; &#96;&#39;NR!&#x3D;1&#123;print $4,$5 &gt; $6&#125;&#39;&#96; &#96;netstat&#96;&#96;.txt&#96;</span><br></pre></td></tr></table></figure>

<p>再复杂一点：（注意其中的if-else-if语句，可见awk其实是个脚本解释器）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$ &#96;&#96;awk&#96; &#96;&#39;NR!&#x3D;1&#123;&#96;&#96;if&#96;&#96;($6 ~ &#96;&#96;&#x2F;TIME&#96;&#96;|ESTABLISHED&#x2F;) print &gt; &#96;&#96;&quot;1.txt&quot;&#96;&#96;;&#96;&#96;else&#96; &#96;if&#96;&#96;($6 ~ &#96;&#96;&#x2F;LISTEN&#x2F;&#96;&#96;) print &gt; &#96;&#96;&quot;2.txt&quot;&#96;&#96;;&#96;&#96;else&#96; &#96;print &gt; &#96;&#96;&quot;3.txt&quot;&#96; &#96;&#125;&#39; &#96;&#96;netstat&#96;&#96;.txt&#96; &#96;$ &#96;&#96;ls&#96; &#96;?.txt&#96;&#96;1.txt  2.txt  3.txt&#96; &#96;$ &#96;&#96;cat&#96; &#96;1.txt&#96;&#96;tcp        0      0 coolshell.cn:80        124.205.5.146:18245         TIME_WAIT&#96;&#96;tcp        0      0 coolshell.cn:80        110.194.134.189:1032        ESTABLISHED&#96;&#96;tcp        0      0 coolshell.cn:80        123.169.124.111:49809       ESTABLISHED&#96;&#96;tcp        0      0 coolshell.cn:80        123.169.124.111:49829       ESTABLISHED&#96;&#96;tcp        0      0 coolshell.cn:80        183.60.215.36:36970         TIME_WAIT&#96;&#96;tcp        0   4166 coolshell.cn:80        61.148.242.38:30901         ESTABLISHED&#96;&#96;tcp        0      0 coolshell.cn:80        110.194.134.189:4796        ESTABLISHED&#96;&#96;tcp        0      0 coolshell.cn:80        183.60.212.163:51082        TIME_WAIT&#96;&#96;tcp        0      0 coolshell.cn:80        123.169.124.111:49840       ESTABLISHED&#96; &#96;$ &#96;&#96;cat&#96; &#96;2.txt&#96;&#96;tcp        0      0 0.0.0.0:3306           0.0.0.0:*                   LISTEN&#96;&#96;tcp        0      0 0.0.0.0:80             0.0.0.0:*                   LISTEN&#96;&#96;tcp        0      0 127.0.0.1:9000         0.0.0.0:*                   LISTEN&#96;&#96;tcp        0      0 :::22                  :::*                        LISTEN&#96; &#96;$ &#96;&#96;cat&#96; &#96;3.txt&#96;&#96;tcp        0      0 coolshell.cn:80        61.140.101.185:37538        FIN_WAIT2&#96;&#96;tcp        0      0 coolshell.cn:80        116.234.127.77:11502        FIN_WAIT2&#96;&#96;tcp        0      1 coolshell.cn:80        124.152.181.209:26825       FIN_WAIT1&#96;&#96;tcp        0      1 coolshell.cn:80        208.115.113.92:50601        LAST_ACK&#96;&#96;tcp        0      0 coolshell.cn:80        117.136.20.85:50025         FIN_WAIT2&#96;</span><br></pre></td></tr></table></figure>

<h5 id="统计"><a href="#统计" class="headerlink" title="统计"></a>统计</h5><p>下面的命令计算所有的C文件，CPP文件和H文件的文件大小总和。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$ &#96;&#96;ls&#96; &#96;-l  *.cpp *.c *.h | &#96;&#96;awk&#96; &#96;&#39;&#123;sum+&#x3D;$5&#125; END &#123;print sum&#125;&#39;&#96;&#96;2511401&#96;</span><br></pre></td></tr></table></figure>

<p>我们再来看一个统计各个connection状态的用法：（我们可以看到一些编程的影子了，大家都是程序员我就不解释了。注意其中的数组的用法）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$ &#96;&#96;awk&#96; &#96;&#39;NR!&#x3D;1&#123;a[$6]++;&#125; END &#123;for (i in a) print i &quot;, &quot; a[i];&#125;&#39;&#96; &#96;netstat&#96;&#96;.txt&#96;&#96;TIME_WAIT, 3&#96;&#96;FIN_WAIT1, 1&#96;&#96;ESTABLISHED, 6&#96;&#96;FIN_WAIT2, 3&#96;&#96;LAST_ACK, 1&#96;&#96;LISTEN, 4&#96;</span><br></pre></td></tr></table></figure>

<p>再来看看统计每个用户的进程的占了多少内存（注：sum的RSS那一列）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$ &#96;&#96;ps&#96; &#96;aux | &#96;&#96;awk&#96; &#96;&#39;NR!&#x3D;1&#123;a[$1]+&#x3D;$6;&#125; END &#123; for(i in a) print i &quot;, &quot; a[i]&quot;KB&quot;;&#125;&#39;&#96;&#96;dbus, 540KB&#96;&#96;mysql, 99928KB&#96;&#96;www, 3264924KB&#96;&#96;root, 63644KB&#96;&#96;hchen, 6020KB&#96;</span><br></pre></td></tr></table></figure>

<h4 id="脱掉内衣"><a href="#脱掉内衣" class="headerlink" title="脱掉内衣"></a>脱掉内衣</h4><h5 id="awk脚本"><a href="#awk脚本" class="headerlink" title="awk脚本"></a>awk脚本</h5><p>在上面我们可以看到一个END关键字。END的意思是“处理完所有的行的标识”，即然说到了END就有必要介绍一下BEGIN，这两个关键字意味着执行前和执行后的意思，语法如下：</p>
<ul>
<li>BEGIN{ 这里面放的是执行前的语句 }</li>
<li>END {这里面放的是处理完所有的行后要执行的语句 }</li>
<li>{这里面放的是处理每一行时要执行的语句}</li>
</ul>
<p>为了说清楚这个事，我们来看看下面的示例：</p>
<p>假设有这么一个文件（学生成绩表）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$ &#96;&#96;cat&#96; &#96;score.txt&#96;&#96;Marry   2143 78 84 77&#96;&#96;Jack    2321 66 78 45&#96;&#96;Tom     2122 48 77 71&#96;&#96;Mike    2537 87 97 95&#96;&#96;Bob     2415 40 57 62&#96;</span><br></pre></td></tr></table></figure>

<p>我们的awk脚本如下（我没有写有命令行上是因为命令行上不易读，另外也在介绍另一种用法）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$ &#96;&#96;cat&#96; &#96;cal&#96;&#96;.&#96;&#96;awk&#96;&#96;#!&#x2F;bin&#x2F;awk -f&#96;&#96;#运行前&#96;&#96;BEGIN &#123;&#96;&#96;    &#96;&#96;math &#x3D; 0&#96;&#96;    &#96;&#96;english &#x3D; 0&#96;&#96;    &#96;&#96;computer &#x3D; 0&#96; &#96;    &#96;&#96;printf&#96; &#96;&quot;NAME    NO.   MATH  ENGLISH  COMPUTER   TOTAL\n&quot;&#96;&#96;    &#96;&#96;printf&#96; &#96;&quot;---------------------------------------------\n&quot;&#96;&#96;&#125;&#96;&#96;#运行中&#96;&#96;&#123;&#96;&#96;    &#96;&#96;math+&#x3D;$3&#96;&#96;    &#96;&#96;english+&#x3D;$4&#96;&#96;    &#96;&#96;computer+&#x3D;$5&#96;&#96;    &#96;&#96;printf&#96; &#96;&quot;%-6s %-6s %4d %8d %8d %8d\n&quot;&#96;&#96;, $1, $2, $3,$4,$5, $3+$4+$5&#96;&#96;&#125;&#96;&#96;#运行后&#96;&#96;END &#123;&#96;&#96;    &#96;&#96;printf&#96; &#96;&quot;---------------------------------------------\n&quot;&#96;&#96;    &#96;&#96;printf&#96; &#96;&quot;  TOTAL:%10d %8d %8d \n&quot;&#96;&#96;, math, english, computer&#96;&#96;    &#96;&#96;printf&#96; &#96;&quot;AVERAGE:%10.2f %8.2f %8.2f\n&quot;&#96;&#96;, math&#96;&#96;&#x2F;NR&#96;&#96;, english&#96;&#96;&#x2F;NR&#96;&#96;, computer&#96;&#96;&#x2F;NR&#96;&#96;&#125;&#96;</span><br></pre></td></tr></table></figure>

<p>我们来看一下执行结果：（也可以这样运行 ./cal.awk score.txt）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`$ ``awk` `-f ``cal``.``awk` `score.txt``NAME    NO.   MATH  ENGLISH  COMPUTER   TOTAL``---------------------------------------------``Marry  2143     78       84       77      239``Jack   2321     66       78       45      189``Tom    2122     48       77       71      196``Mike   2537     87       97       95      279``Bob    2415     40       57       62      159``---------------------------------------------``  ``TOTAL:       319      393      350``AVERAGE:     63.80    78.60    70.00`</span><br></pre></td></tr></table></figure>

<h5 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h5><p>即然说到了脚本，我们来看看怎么和环境变量交互：（使用-v参数和ENVIRON，使用ENVIRON的环境变量需要export）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`$ x=5` `$ y=10``$ ``<span class="built_in">export</span>` `y` `$ ``<span class="built_in">echo</span>` `<span class="variable">$x</span> <span class="variable">$y</span>``5 10` `$ ``awk` `-``v` `val=<span class="variable">$x</span> ``<span class="string">'&#123;print $1, $2, $3, $4+val, $5+ENVIRON["y"]&#125;'</span>` `OFS=``<span class="string">"\t"</span>` `score.txt``Marry   2143    78      89      87``Jack    2321    66      83      55``Tom     2122    48      82      81``Mike    2537    87      102     105``Bob     2415    40      62      72`</span><br></pre></td></tr></table></figure>

<h4 id="几个花活"><a href="#几个花活" class="headerlink" title="几个花活"></a>几个花活</h4><p>最后，我们再来看几个小例子：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`<span class="comment">#从file文件中找出长度大于80的行``awk` `'length&gt;80'` `file` `#按连接数查看客户端IP``netstat` `-ntu | ``awk` `'&#123;print $5&#125;'` `| ``cut` `-d: -f1 | ``sort` `| ``uniq` `-c | ``sort` `-nr` `#打印99乘法表``seq` `9 | ``sed` `'H;g'` `| ``awk` `-``v` `RS=``''` `'&#123;for(i=1;i&lt;=NF;i++)printf("%dx%d=%d%s", i, NR, i*NR, i==NR?"\n":"\t")&#125;'`</span></span><br></pre></td></tr></table></figure>

<h4 id="自己撸吧"><a href="#自己撸吧" class="headerlink" title="自己撸吧"></a>自己撸吧</h4><p>关于其中的一些知识点可以参看<a href="http://www.gnu.org/software/gawk/manual/gawk.html" target="_blank" rel="noopener">gawk的手册</a>：</p>
<ul>
<li>内建变量，参看：<a href="http://www.gnu.org/software/gawk/manual/gawk.html#Built_002din-Variables" target="_blank" rel="noopener">http://www.gnu.org/software/gawk/manual/gawk.html#Built_002din-Variables</a></li>
<li>流控方面，参看：<a href="http://www.gnu.org/software/gawk/manual/gawk.html#Statements" target="_blank" rel="noopener">http://www.gnu.org/software/gawk/manual/gawk.html#Statements</a></li>
<li>内建函数，参看：<a href="http://www.gnu.org/software/gawk/manual/gawk.html#Built_002din" target="_blank" rel="noopener">http://www.gnu.org/software/gawk/manual/gawk.html#Built_002din</a></li>
<li>正则表达式，参看：<a href="http://www.gnu.org/software/gawk/manual/gawk.html#Regexp" target="_blank" rel="noopener">http://www.gnu.org/software/gawk/manual/gawk.html#Regexp</a></li>
</ul>
<p>（全文完）</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/15/DevOp/2019-08-02-Docker-w-Pycharm/">DevOp/2019-08-02-Docker-w-Pycharm</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-15</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/DevOps/">DevOps</a></span><div class="content"><h3 id="docker-ssh配置"><a href="#docker-ssh配置" class="headerlink" title="docker ssh配置"></a>docker ssh配置</h3><h5 id="Concept"><a href="#Concept" class="headerlink" title="Concept"></a>Concept</h5><p>进行实验时用挂载的，让本地跟docker内的文件夹一样</p>
<p>#####新建docker container</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nvidia-docker run -it -p [host_port]:[container_port](<span class="keyword">do</span> not use 8888) --name:[container_name] [image_name] -v [container_path]:[host_path] /bin/bash</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nvidia-docker run -p 5592:5592 -p 5593:5593 -p 8022:22 --name=<span class="string">"liuzhen_tf"</span> -v ~/workspace/liuzhen/remote_workspace:/workspace/liuzhen/remote_workspace -it tensorflow/tensorflow:latest-gpu /bin/bash</span><br></pre></td></tr></table></figure>

<h5 id="配置ssh服务"><a href="#配置ssh服务" class="headerlink" title="配置ssh服务"></a>配置ssh服务</h5><p>在新建的容器内配置ssh，安装openssh-server</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ apt update</span><br><span class="line">$ apt install -y openssh-server</span><br></pre></td></tr></table></figure>

<p>设置ssh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir /var/run/sshd</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'root:passwd'</span> | chpasswd</span><br><span class="line"><span class="comment"># 这里使用你自己想设置的用户名和密码，passwd是此处设置的密码</span></span><br><span class="line">$ sed -i <span class="string">'s/PermitRootLogin prohibit-password/PermitRootLogin yes/'</span> /etc/ssh/sshd_config</span><br><span class="line">$ sed <span class="string">'s@session\s*required\s*pam_loginuid.so@session optional pam_loginuid.so@g'</span> -i /etc/pam.d/sshd</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"export VISIBLE=now"</span> &gt;&gt; /etc/profile</span><br></pre></td></tr></table></figure>

<h5 id="重启ssh激活配置"><a href="#重启ssh激活配置" class="headerlink" title="重启ssh激活配置"></a>重启ssh激活配置</h5><p>(<u>最常见的问题</u>就是docker容器停了以后里面的SSH服务也会相应停止，因此当你发现自己某一天连不上的时候，记得去docker里重启一下ssh服务：)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ service ssh restart</span><br></pre></td></tr></table></figure>

<p>在服务器（宿主机）上（不是服务器的docker里）测试刚刚新建docker容器中哪个端口转发到了服务器的22端口：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker port [your_container_name] 22</span><br><span class="line"><span class="comment"># 如果前面的配置生效了，你会看到如下输出</span></span><br><span class="line"><span class="comment"># 0.0.0.0:8022</span></span><br></pre></td></tr></table></figure>

<p>最后测试能否用SSH连接到远程docker：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ssh root@[your_host_ip] -p 8022</span><br><span class="line"><span class="comment"># 密码是你前面自己设置的</span></span><br></pre></td></tr></table></figure>

<h3 id="pycharm配置"><a href="#pycharm配置" class="headerlink" title="pycharm配置"></a>pycharm配置</h3><h5 id="打开本地代码"><a href="#打开本地代码" class="headerlink" title="打开本地代码"></a>打开本地代码</h5><p>打开PyCharm<code>Tools &gt; Deployment &gt; Configuration</code></p>
<p>#####新建服务器SFTP</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6gtkcxaeaj315r0u03zh.jpg" alt="image-20190828175349739"></p>
<p>输入如下图配置，注意这里的端口是你刚刚设置的映射到容器22端口的宿主机中的端口，我这里使用的是8022，账号密码是你刚刚自己设置的，这里的Root Path设置一个远程docker容器里的路径。</p>
<p>在Mappings中配置路径，这里的路径是你本地存放代码的路径，与刚刚配置的<em>Root Path</em>相互映射（意思是Mapping里本机的路径映射到远程的Root Path）<em>，</em>方便以后在本地和远程docker中进行代码和其他文件同步。</p>
<p>#####配置远程解释器</p>
<p>打开PyCharm<code>Preferences &gt; Project Interpreter</code></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6gtlykktsj317a0u0q4w.jpg" alt="image-20190828190716498"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6gtrxo163j307705et8o.jpg" alt=""></p>
<p>新建ssh Interpreter</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6gtml7aj1j31d30u0aam.jpg" alt="image-20190828191025481"></p>
<h5 id="配置运行环境变量"><a href="#配置运行环境变量" class="headerlink" title="配置运行环境变量"></a>配置运行环境变量</h5><p><code>run &gt; edit confuriguration</code></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6gtmztm35j30r80sk758.jpg" alt="image-20190828191253964"></p>
<h3 id="docker-jupyter使用"><a href="#docker-jupyter使用" class="headerlink" title="docker jupyter使用"></a>docker jupyter使用</h3><p>jupyter-notebook的默认端口号是8888，映射几个外部端口，如前面的5592</p>
<p>更新apt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br></pre></td></tr></table></figure>

<p>安装jupyter</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install jupyter</span><br></pre></td></tr></table></figure>

<p>(注意pip install jupyter notebook==5.7.5，高版本有bug)</p>
<p>配置jupyter</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">生成jupyter配置文件，这个会生成配置文件.jupyter/jupyter_notebook_config.py</span></span><br><span class="line">jupyter notebook --generate-config</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">使用ipython生成密码</span></span><br><span class="line">In [1]: from notebook.auth import passwd</span><br><span class="line">In [2]: passwd()</span><br><span class="line">Enter password: </span><br><span class="line">Verify password: </span><br><span class="line">Out[2]: 'sha1:38a5ecdf288b:c82dace8d3c7a212ec0bd49bbb99c9af3bae076e'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">去配置文件.jupyter/jupyter_notebook_config.py中修改以下参数</span></span><br><span class="line">c.NotebookApp.ip='*'                          #绑定所有地址</span><br><span class="line">c.NotebookApp.password = u'sha1:38a5ecdf288b:c82dace8d3c7a212ec0bd49bbb99c9af3bae076e'</span><br><span class="line">c.NotebookApp.open_browser = False            #启动后是否在浏览器中自动打开</span><br><span class="line">c.NotebookApp.port =5592                      #指定一个访问端口，默认8888，注意和映射的docker端口对应</span><br><span class="line">c.NotebookApp.allow_remote_access = True</span><br><span class="line">c.NotebookApp.allow_root = True               #allow the user to run the notebook as root</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> jupyter notebook</span></span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/15/DevOp/2018-11-23-C++%20ReArrange/">DevOp/2018-11-23-C++ ReArrange</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-15</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/C/">C++</a></span><div class="content"><h3 id="1-cout-of-char"><a href="#1-cout-of-char" class="headerlink" title="1.  cout of char*"></a>1.  cout of <code>char*</code></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *str = <span class="string">"hellogogo"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *pstr = str;</span><br><span class="line">  <span class="built_in">cout</span> <span class="string">"The address of pstr is: "</span> &lt;&lt; pstr &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------</span><br><span class="line"> <span class="string">"The address of pstr is: hellogogo"</span></span><br></pre></td></tr></table></figure>



<h3 id="2-compiled-by-c-or-c"><a href="#2-compiled-by-c-or-c" class="headerlink" title="2. compiled by c or c++"></a>2. compiled by c or c++</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cpluscplu</span></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"cpp"</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">	print(<span class="string">"c"</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>



<h4 id="3-compiled-time-OP-symbol"><a href="#3-compiled-time-OP-symbol" class="headerlink" title="3. compiled time OP symbol"></a>3. compiled time OP symbol</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> id[<span class="keyword">sizeof</span>(<span class="keyword">unsigned</span> <span class="keyword">long</span>)];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Compiled OK, cuz sizeof is COMPILING time symbol, which is determined in compile, regarded as machine-dependent constant.</span></span><br></pre></td></tr></table></figure>



<h3 id="4"><a href="#4" class="headerlink" title="4."></a>4.</h3></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/15/DevOp/2015-05-14-pdb/">DevOp/2015-05-14-pdb</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-15</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/DevOps/">DevOps</a></span><div class="content"><h3 id="pdb"><a href="#pdb" class="headerlink" title="pdb"></a>pdb</h3><h4 id="Conditional-Break-Point"><a href="#Conditional-Break-Point" class="headerlink" title="Conditional Break Point"></a>Conditional Break Point</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(Pdb) b  <span class="number">3</span>,  ii==<span class="number">3</span></span><br><span class="line">Breakpoint <span class="number">3</span> at /mnt/raid3/home/huangjiancong/test.py:<span class="number">3</span></span><br><span class="line">(Pdb) l</span><br><span class="line">[EOF]</span><br><span class="line">(Pdb) l <span class="number">3</span></span><br><span class="line">  <span class="number">1</span></span><br><span class="line">  2  -&gt; for ii, val in enumerate(range(10)):</span><br><span class="line">  <span class="number">3</span> B           print(ii)</span><br><span class="line">[EOF]</span><br></pre></td></tr></table></figure>

<p><a href="https://www.wandouip.com/t5i100987/#jekyll_33" target="_blank" rel="noopener">https://www.wandouip.com/t5i100987/#jekyll_33</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/15/DevOp/2018-05-04-tmux/">DevOp/2018-05-04-tmux</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-15</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/DevOps/">DevOps</a></span><div class="content"><h3 id="tmux"><a href="#tmux" class="headerlink" title="tmux"></a>tmux</h3><h3 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h3><p>前置键: ctrl-b</p>
<p><code>C-</code> 指的是 Ctrl + 某個鍵一起按 <code>M-</code> 則是 <code>Alt</code> 或 <code>Option</code>和某個鍵一起按。</p>
<p>水平切割則是 <code>C-b &quot;</code></p>
<p>移动所在视窗使用 <code>C-b</code> 搭配方向鍵</p>
<h3 id="Main-Manipulations-within-Session"><a href="#Main-Manipulations-within-Session" class="headerlink" title="Main Manipulations within Session"></a>Main Manipulations within Session</h3><p>關閉視窗區塊只需要使用 <code>C-d</code> (注意，這不是detach，而是直接真的關了)</p>
<ul>
<li><code>C-b c</code> 建立一個新視窗</li>
<li><code>C-b p</code> 上一個視窗</li>
<li><code>C-b n</code> 下一個視窗</li>
<li><code>C-b &lt;number&gt;</code> 依照編號直接切換（編號顯示於狀態列）</li>
</ul>
<h3 id="Detach-amp-Attach"><a href="#Detach-amp-Attach" class="headerlink" title="Detach &amp; Attach"></a>Detach &amp; Attach</h3><p>如果完成工作，要 detach 只需要 <code>C-b d</code>，又或者 <code>C-b D</code> 可以選擇要從那個 <code>session</code> 離開。</p>
<ul>
<li>tmux attach -t 0</li>
</ul>
<p>賦予每個 session 一個有意義的名稱</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tmux new -s database</span></span><br></pre></td></tr></table></figure>

<p>修改名稱</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tmux rename-session -t 0 database</span></span><br></pre></td></tr></table></figure>

<p>之後當我們要在重新連回該 session 時，只要使用該名稱即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux attach -t database</span><br></pre></td></tr></table></figure>



<p>優點：</p>
<p>點出幾個 <code>tmux</code> 的優點：</p>
<ul>
<li>session 的保留：attach 和 detach 協助我們在不同情境和遠端連線的情況下切換。</li>
<li>跨平台：我們可以在 Mac 底下使用，也可以在 Linux 環境下使用，甚至遠端伺服器或 Raspberry Pi，BeagleBones 等等都可以使用一樣的東西。</li>
<li>客製化：我們可以去自訂 tmux 的環境設定並且可以和不同平台環境同步</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新增</span></span><br><span class="line">$ tmux</span><br><span class="line"><span class="comment"># OR</span></span><br><span class="line">$ tmux new -s &lt;your_session_name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># session 列表</span></span><br><span class="line">$ tmux ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新連線 session</span></span><br><span class="line">$ tmux a -t 0</span><br><span class="line"><span class="comment"># OR</span></span><br><span class="line">$ tmux a -t &lt;session_name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 刪除 session</span></span><br><span class="line">$ tmux <span class="built_in">kill</span>-session -t 0</span><br><span class="line"><span class="comment"># OR</span></span><br><span class="line">$ tmux <span class="built_in">kill</span>-session -t &lt;session_name&gt;</span><br><span class="line"><span class="comment"># OR</span></span><br><span class="line">$ tmux <span class="built_in">kill</span>-session -a <span class="comment"># 全部</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 刪除 tmux server</span></span><br><span class="line">$ tmux <span class="built_in">kill</span>-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新命名 session</span></span><br><span class="line">$ tmux rename-session -t 0 &lt;new_session_name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 快捷鍵/視窗管理</span></span><br><span class="line"><span class="comment"># C-b ? Help</span></span><br><span class="line"><span class="comment"># C-b c 新增視窗</span></span><br><span class="line"><span class="comment"># C-b， 視窗命名</span></span><br><span class="line"><span class="comment"># C-b w 視窗列表</span></span><br><span class="line"><span class="comment"># C-b f 尋找視窗</span></span><br><span class="line"><span class="comment"># C-b &amp; 刪除視窗</span></span><br><span class="line"><span class="comment"># C-b % 垂直分割區塊</span></span><br><span class="line"><span class="comment"># C-b “ 水平分割區塊</span></span><br><span class="line"><span class="comment"># C-b &lt;方向鍵&gt;</span></span><br><span class="line"><span class="comment"># C-b p 上一個視窗</span></span><br><span class="line"><span class="comment"># C-b n 下一個視窗</span></span><br><span class="line"><span class="comment"># C-b &lt;number&gt; 依照編號直接切換（編號顯示於狀態列）</span></span><br><span class="line"><span class="comment"># C-b d 離開 session</span></span><br><span class="line"><span class="comment"># C-b x 關閉 Pane</span></span><br><span class="line"><span class="comment"># C-d   關閉 Pane</span></span><br><span class="line"><span class="comment"># C-b z 讓一個 Pane 變成全螢幕，在輸入一次則回到剛剛的尺寸</span></span><br></pre></td></tr></table></figure>



<h3 id="參考資源"><a href="#參考資源" class="headerlink" title="參考資源:"></a>參考資源:</h3><p><a href="https://www.hamvocke.com/blog/a-quick-and-easy-guide-to-tmux/" target="_blank" rel="noopener">A Quick and Easy Guide to tmux</a></p>
<p><a href="https://andyyou.github.io/2017/11/27/tmux-notes/" target="_blank" rel="noopener">tmux 快速入門筆記</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/15/hello-world/">Hello World</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-15</time><div class="content"><p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/07/07/Front-End/2019-07-07-front-end%20rendering/">Front-End Rendering!</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-07-07</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Front-End-Rendering/">Front-End-Rendering</a></span><div class="content"><h3 id="Front-End-Rendering"><a href="#Front-End-Rendering" class="headerlink" title="Front-End Rendering"></a>Front-End Rendering</h3><ul>
<li>图片：裁剪，模糊，亮度，对比度，阴影，灰度，色相旋转，反转，透明度，饱和度，褐色<br><a href="https://www.runoob.com/cssref/css3-pr-filter.html" target="_blank" rel="noopener">https://www.runoob.com/cssref/css3-pr-filter.html</a><br><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6nijqvpwvj31410kzgxe.jpg" alt="image-20190904152108270"></li>
</ul>
<ul>
<li><p>文字：模糊，阴影，透明度，发光，渐变</p>
<p><a href="https://codepen.io/wuyeguangming/pen/jONaWXr" target="_blank" rel="noopener">https://codepen.io/wuyeguangming/pen/jONaWXr</a></p>
</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6nibg1wusj31kz0u0aua.jpg" alt=""></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6nij8edvlj31kc0u0nb7.jpg" alt="image-20190904152348021"></p>
<ul>
<li><p>动效：位移，缩放，旋转，渐变<br><a href="https://animejs.com/" target="_blank" rel="noopener">https://animejs.com/</a></p>
</li>
<li><p>物理引擎：重力、碰撞、摩擦、阻力、惯性等<br><a href="http://brm.io/matter-js/" target="_blank" rel="noopener">http://brm.io/matter-js/</a></p>
</li>
<li><p>视差效果引擎：近大远小<br><a href="http://matthew.wagerfield.com/parallax/" target="_blank" rel="noopener">http://matthew.wagerfield.com/parallax/</a></p>
</li>
<li><p>3d<br><a href="https://threejs.org/examples/#webgl_animation_multiple" target="_blank" rel="noopener">https://threejs.org/examples/#webgl_animation_multiple</a></p>
</li>
<li><p>建模<br><a href="https://www.mixamo.com/#/" target="_blank" rel="noopener">https://www.mixamo.com/#/</a></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6nijxu7ahj31l00u04qp.jpg" alt="image-20190904151945987"></p>
</li>
</ul>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://animejs.com/" target="_blank" rel="noopener">https://animejs.com/</a><br><a href="http://svgjs.com/" target="_blank" rel="noopener">http://svgjs.com</a><br><a href="https://daneden.github.io/animate.css/" target="_blank" rel="noopener">https://daneden.github.io/animate.css/</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/06/25/FFmpeg/2019-06-25-ffmpeg-cmds/">ffmpeg_cmds!</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-06-25</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ffmpeg/">ffmpeg</a></span><div class="content"><h2 id="rm-black-sides"><a href="#rm-black-sides" class="headerlink" title="rm black sides"></a>rm black sides</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">╰─○ ffplay -i vn_hflip.mp4 -t 5 -vf cropdetect</span><br><span class="line">╰─○ ffplay -i vn_hflip.mp4 -t 5 -vf crop=1280:528:0:96</span><br></pre></td></tr></table></figure>

<h2 id="save-to-json"><a href="#save-to-json" class="headerlink" title="save to json"></a>save to json</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffprobe -hide_banner -print_format json -show_streams -i vn_hflip.mp4 &gt; vn_json_streams.log</span><br></pre></td></tr></table></figure>

<h2 id="check-error"><a href="#check-error" class="headerlink" title="check error"></a>check error</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffprobe -show_frames vn_hflip.mp4 &gt; vn_show_frames.log</span><br></pre></td></tr></table></figure>

<h2 id="video-to-pics"><a href="#video-to-pics" class="headerlink" title="video to pics"></a>video to pics</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i vn_hflip.mp4 -r 40 -f image2         -t 1 my%d.jpg        <span class="comment">## 跟下一行比會多了幾張重覆的，因為比來的video就25fps而已</span></span><br><span class="line"><span class="string">""</span><span class="string">"2938"</span><span class="string">""</span>  ffmpeg -i vn_hflip.mp4 -r 25 -f image2 -t 1 my25_%d.jpg <span class="comment">## 跟上一行几乎一样，就是正常的25 rate</span></span><br><span class="line">ffmpeg -i vn_hflip.mp4 -vcodec mjpeg -ss 0:0:2 -t 0:0:1 0m%04d.jpg  <span class="comment">## 跟上面比主要就是从第二秒开始</span></span><br><span class="line"></span><br><span class="line">2937  ffmpeg -i vn_hflip.mp4 -r 40 -f image2 -t 1 my25_%d.jpg</span><br><span class="line">★★★ -r, -ss, -t  本来的video要变成的rate，开始、抓多久</span><br><span class="line"></span><br><span class="line">ffmpeg -i vn_hflip.mp4 -ss 00:00:14.435 -vframes 1 out.png</span><br><span class="line">★★★ -vframes 抓几张</span><br></pre></td></tr></table></figure>

<h2 id="pics-to-video"><a href="#pics-to-video" class="headerlink" title="pics to video"></a>pics to video</h2><p>把多个图像文件使用h264编码封装成avi文件，如有my0.jpg, my1.jpg … my99.jpg</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i my%d.jpg  -vcodec h264 my.avi</span><br></pre></td></tr></table></figure>



<h2 id="video-to-gif"><a href="#video-to-gif" class="headerlink" title="video to gif"></a>video to gif</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i vn_hflip.mp4 -ss 0 -r 1 -vframes 6 vn.gif</span><br><span class="line">ffmpeg -i vn_hflip.mp4 -ss 0 -vf fps=1 -vframes 6 vn_fps.gif <span class="comment"># 这个似乎比上面的好一些</span></span><br></pre></td></tr></table></figure>




<p>##EXTRACTION !!!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> 2999  ffmpeg -i ../vn_hflip.mp4 -ss 00:00:00 -t 10 -vf fps=1 fps1_%d.png</span><br><span class="line">(joe_py36) ┌─[joe@JoeMBP2] - [~/Movies/exp/tmp] - [3003]</span><br><span class="line">└─[$] <span class="built_in">history</span> | grep r1                                                                                                                                                                           [22:06:04]</span><br><span class="line"> 2975  ffmpeg -i ../vn_hflip.mp4 -r 1 r1_%d.png</span><br><span class="line"> 2977  ffmpeg -i ../vn_hflip.mp4 -r 1 -vframes 6 r1_vframes_%d.png</span><br></pre></td></tr></table></figure>



<h2 id="add-logo"><a href="#add-logo" class="headerlink" title="add logo"></a>add logo</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i vn_hflip.mp4 -i ~/Pictures/Sackboy_0.jpeg -filter_complex overlay=W-w:H-h vn_logo.avi</span><br><span class="line">    如右下角: ffmpeg -i God.rm -i logo.png -filter_complex overlay=W-w:H-h my.avi</span><br><span class="line">    如居中:  ffmpeg -i God.rm -i logo.png -filter_complex overlay=W/2-w/2:H/2-h/2 my.avi</span><br></pre></td></tr></table></figure>



</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/18/">&lt;i class&#x3D;&quot;fa fa-chevron-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><span class="page-number current">19</span></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2019 By John Doe</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>