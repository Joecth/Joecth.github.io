<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="Joe Huang"><meta name="copyright" content="Joe Huang"><title>Awaken Desparado</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.1.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Joe Huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">210</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">24</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">26</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Awaken Desparado</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Awaken Desparado</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/30/LC/2019-09-30-LC-790%20Domino&amp;Tromino%20Tiling/">LC/2019-09-30-LC-790 Domino&amp;Tromino Tiling</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-30</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/LC-DP/">LC-DP</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/TODO/">TODO</a></span><div class="content"><p>Problem: 2x1 XX</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">numTilings</span><span class="params">(self, N)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type N: int</span></span><br><span class="line"><span class="string">        :rtype: int</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> N &lt; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        N += <span class="number">1</span></span><br><span class="line">        module = pow(<span class="number">10</span>, <span class="number">9</span>)+<span class="number">7</span>   </span><br><span class="line">        dp = [[<span class="number">0</span>, <span class="number">0</span>]*N <span class="keyword">for</span> _ <span class="keyword">in</span> range(N)]</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>], dp[<span class="number">1</span>][<span class="number">0</span>], dp[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, N):</span><br><span class="line">            dp[i][<span class="number">0</span>] = dp[i<span class="number">-1</span>][<span class="number">0</span>] + dp[i<span class="number">-2</span>][<span class="number">0</span>] + dp[i<span class="number">-2</span>][<span class="number">1</span>]</span><br><span class="line">            dp[i][<span class="number">1</span>] = dp[i<span class="number">-1</span>][<span class="number">0</span>]*<span class="number">2</span> + dp[i<span class="number">-1</span>][<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> dp[N<span class="number">-1</span>][<span class="number">0</span>] % module</span><br></pre></td></tr></table></figure>

<p>Ref:</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7iv5nfkjdj31hl0u01ds.jpg" alt="image-20191001181252686"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7ivtlhge4j31580katgw.jpg" alt="image-20191001183553311"></p>
<p>Ref: <a href="https://www.jianshu.com/p/2104df9de5d5" target="_blank" rel="noopener">https://www.jianshu.com/p/2104df9de5d5</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/25/FFmpeg/2019-09-25-ffmepg-cmd-3-I-frame-extraction/">FFmpeg/2019-09-25-ffmepg-cmd-3-I-frame-extraction</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-25</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ffmpeg/">ffmpeg</a></span><div class="content"><h3 id="I-frame-extraction"><a href="#I-frame-extraction" class="headerlink" title="I-frame extraction"></a>I-frame extraction</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i vn_hflip.mp4 -vf select=<span class="string">'eq(pict_type\,I)'</span> -vsync 2 -s 1280*720 -f image2 keyframe-%03d.jpeg</span><br></pre></td></tr></table></figure>

<p>-vf:是一个命令行，表示过滤图形的描述。选择过滤器select会选择帧进行输出：pict_type和对应的类型:PICT_TYPE_I 表示是I帧，即关键帧；<br>-vsync 2:阻止每个关键帧产生多余的拷贝；<br>-f image2 name_%02d.jpeg:将视频帧写入到图片中，样式的格式一般是: “%d” 或者 “%0Nd”</p>
<h3 id="Index-of-I-frame"><a href="#Index-of-I-frame" class="headerlink" title="Index of I-frame"></a>Index of I-frame</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffprobe -i vn_hflip.mp4 -select_streams v -show_frames -show_entries frame=pict_type -of csv | grep -n I | cut -d <span class="string">':'</span> -f 1 &gt; frame_index.txt</span><br></pre></td></tr></table></figure>



<h3 id="Relates-the-twos"><a href="#Relates-the-twos" class="headerlink" title="Relates the twos"></a>Relates the twos</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -1 keyframe*.jpeg &gt; keyframe.txt</span><br><span class="line">paste frame_index.txt  keyframe.txt&gt; result.txt</span><br></pre></td></tr></table></figure>

<p>(joe_py36)<br>~/workspace/exp/FFmpeg_<br>☺  more result.txt<br>☺  more result.txt<br>1       keyframe-01.jpeg<br>3       keyframe-02.jpeg<br>16      keyframe-03.jpeg<br>25      keyframe-04.jpeg<br>30      keyframe-05.jpeg<br>46      keyframe-06.jpeg<br>55      keyframe-07.jpeg<br>59      keyframe-08.jpeg<br>70      keyframe-09.jpeg<br>83      keyframe-10.jpeg<br>100     keyframe-11.jpeg<br>116     keyframe-12.jpeg</p>
<h3 id="翻译ffmpeg-all文档（40），多媒体滤镜"><a href="#翻译ffmpeg-all文档（40），多媒体滤镜" class="headerlink" title="翻译ffmpeg-all文档（40），多媒体滤镜"></a><a href="http://blog.chinaunix.net/uid-10062010-id-5137275.html" target="_blank" rel="noopener">翻译ffmpeg-all文档（40），多媒体滤镜</a></h3><p><a href="http://blog.chinaunix.net/uid-10062010-id-5137275.html" target="_blank" rel="noopener">http://blog.chinaunix.net/uid-10062010-id-5137275.html</a></p>
<p>Ref: <a href="https://superuser.com/questions/885452/extracting-the-index-of-key-frames-from-a-video-using-ffmpeg" target="_blank" rel="noopener">https://superuser.com/questions/885452/extracting-the-index-of-key-frames-from-a-video-using-ffmpeg</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/11/OpenGL/2019-09-11-OpenGL%20-%20shader%202&amp;3&amp;4&amp;5/">OpenGL/2019-09-11-OpenGL - shader 2&amp;3&amp;4&amp;5</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-11</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/OpenGL/">OpenGL</a></span><div class="content"><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="OpenGL-shader-2"><a href="#OpenGL-shader-2" class="headerlink" title="OpenGL - shader 2"></a>OpenGL - shader 2</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7fb0l120zj312k0fdgzh.jpg" alt="image-20190928161919955"></p>
<p>![image-20190928162048236](/Users/joe/Library/Application Support/typora-user-images/image-20190928162048236.png)</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7fb7mqsisj30qe097tgb.jpg" alt="image-20190928162610910"></p>
<h3 id="OpenGL-shader3"><a href="#OpenGL-shader3" class="headerlink" title="OpenGL - shader3"></a>OpenGL - shader3</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7gev3sadrj30of0pqk4p.jpg" alt="image-20190929151757208"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7gevyp1egj30ij0ojwj6.jpg" alt="image-20190929151855171"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7gex435gtj30g60nan19.jpg" alt="image-20190929152001763"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7gf2uiqehj30gw02g74y.jpg" alt="image-20190929152532403"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7gfamm1epj30nx02tmy4.jpg" alt="image-20190929153106469"></p>
<h3 id="OpenGL-Shader4-FileStream"><a href="#OpenGL-Shader4-FileStream" class="headerlink" title="OpenGL - Shader4 FileStream"></a>OpenGL - Shader4 FileStream</h3><p>Disk - Sector &gt; Track</p>
<p>Sector as unit to return to memory, </p>
<h4 id="FileBuffer-for-CPU-to-handle"><a href="#FileBuffer-for-CPU-to-handle" class="headerlink" title="FileBuffer for CPU to handle"></a>FileBuffer for CPU to handle</h4><h4 id="StringBuffer-to-intepret-FileB"><a href="#StringBuffer-to-intepret-FileB" class="headerlink" title="StringBuffer to intepret FileB"></a>StringBuffer to intepret FileB</h4><h4 id="CPU-to-read-char"><a href="#CPU-to-read-char" class="headerlink" title="CPU to read char*"></a>CPU to read char*</h4><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7gfgkdj9dj30mo0diq78.jpg" alt="image-20190929153841303"></p>
<h3 id="Coding"><a href="#Coding" class="headerlink" title="Coding"></a>Coding</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7gfkbettaj30h40fcdl2.jpg" alt="image-20190929154217227"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7q3asksbgj30me0m47gn.jpg" alt="image-20191008001345211"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/11/OpenGL/2019-09-11-OpenGL%201/">OpenGL/2019-09-11-OpenGL 1</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-11</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/OpenGL/">OpenGL</a></span><div class="content"><h3 id="GLSL"><a href="#GLSL" class="headerlink" title="GLSL"></a>GLSL</h3><p>让程式码知道时间的概念</p>
<p>CPU用uniform去处理时间概念</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7bvl5xl9cj30wm0jnds2.jpg" alt="image-20190925170858998"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7bvmvkicgj30lu046abv.jpg" alt="image-20190925171031074"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7bvx90nunj30l309k78m.jpg" alt="image-20190925172036044"></p>
<p>↓</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7bvy23gurj30m70ex0zf.jpg" alt="image-20190925172119986"></p>
<h3 id="Uniform"><a href="#Uniform" class="headerlink" title="Uniform"></a>Uniform</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7bw7nkgf8j30nz045q6o.jpg" alt="image-20190925173034574"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/11/OpenGL/2019-09-11-OpenGL-Triangle-EBO/">OpenGL/2019-09-11-OpenGL-Triangle-EBO</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-11</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/OpenGL/">OpenGL</a></span><div class="content"><h3 id="背面踢除"><a href="#背面踢除" class="headerlink" title="背面踢除"></a>背面踢除</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7btwuvdvpj309r0223yz.jpg" alt="image-20190925161101020"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7btx9xsrzj30y40jo7ak.jpg" alt="image-20190925161121840"></p>
<h3 id="EBO"><a href="#EBO" class="headerlink" title="EBO"></a>EBO</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7bu6gox5dj30b104o75p.jpg" alt="image-20190925162013328"></p>
<p> GPU会一直吐VBO　context can only handle one VAO &amp; one VBO at the same time.</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7bujn9557j30va0inajy.jpg" alt="image-20190925163255470"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7bumora4sj30r009i449.jpg" alt="image-20190925163550327"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7buqh4g25j30ov0fitg6.jpg" alt="image-20190925163929372"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7bv0iuyicj30t90tn43f.jpg" alt="image-20190925164908733"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/10/OpenGL/2019-09-10-OpenGL-3D-Triangle-VBO-VAO/">OpenGL/2019-09-10-OpenGL-3D-Triangle-VBO-VAO</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-10</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/OpenGL/">OpenGL</a></span><div class="content"><h3 id="3D-2D"><a href="#3D-2D" class="headerlink" title="3D 2D"></a>3D 2D</h3><p>All 3D space concepts in OpenGL.</p>
<p>3D coordinates (camera) –&gt; 2D plane –&gt; colored pixels.</p>
<p><strong><em>2D坐标和像素也是不同的，2D坐标精确表示一个点在2D空间中的位置，而2D像素是这个点的近似值，2D像素受到你的屏幕/窗口分辨率的限制。</em></strong></p>
<h3 id="Shader"><a href="#Shader" class="headerlink" title="Shader"></a>Shader</h3><p>– program that GPU runs</p>
<p>有些着色器允许开发者自己配置，这就允许我们用自己写的着色器来替换默认的。这样我们就可以更细致地控制图形渲染管线中的特定部分了，而且因为它们运行在GPU上，所以它们可以给我们节约宝贵的CPU时间。OpenGL着色器是用OpenGL着色器语言(OpenGL Shading Language, GLSL)写成的，在下一节中我们再花更多时间研究它。</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g72v7ypj0gj30uk0ian1n.jpg" alt="image-20190917220604821"></p>
<p>CPU –&gt; GPU</p>
<p>必用的 ：Vertex Shader, Fragment Shader</p>
<h4 id="Geometry-Shader"><a href="#Geometry-Shader" class="headerlink" title="Geometry Shader"></a>Geometry Shader</h4><p>可以偷補插點</p>
<h4 id="Vertex"><a href="#Vertex" class="headerlink" title="Vertex"></a>Vertex</h4><p>我们以数组的形式传递3个3D坐标作为图形渲染管线的输入，用来表示一个三角形，这个数组叫做顶点数据(Vertex Data)；顶点数据是一系列顶点的集合。一个顶点(Vertex)是一个3D坐标的数据的集合。而顶点数据是用顶点属性(Vertex Attribute)表示的，它可以包含任何我们想用的数据，但是简单起见，我们还是假定每个顶点只由一个3D位置和一些颜色值、UV组成。</p>
<p><strong><em>为了让OpenGL知道我们的坐标和颜色值构成的到底是什么，OpenGL需要你去指定这些数据所表示的渲染类型。我们是希望把这些数据渲染成一系列的点？一系列的三角形？还是仅仅是一个长长的线？做出的这些提示叫做图元(Primitive)，任何一个绘制指令的调用都将把图元传递给OpenGL。这是其中的几个：GL_POINTS、GL_TRIANGLES、GL_LINE_STRIP。</em></strong></p>
<h3 id="———"><a href="#———" class="headerlink" title="———"></a>———</h3><p>VertexShader -&gt; Rasterization -&gt; FragmentShader</p>
<h3 id="Normalized-Device-Coordinates-NDC"><a href="#Normalized-Device-Coordinates-NDC" class="headerlink" title="Normalized Device Coordinates (NDC)"></a>Normalized Device Coordinates (NDC)</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g74lnj2v91j30wq0i0dv3.jpg" alt="image-20190919100557092"></p>
<h3 id="Vertex-Data"><a href="#Vertex-Data" class="headerlink" title="Vertex Data"></a>Vertex Data</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g74m3bcwprj30uq0f4gss.jpg" alt="image-20190919102118610"></p>
<p>f: means 法向量</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g74m6drrucj31b30u0wyu.jpg" alt="image-20190919102416139">   (in Blender)</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g74m5tdw1hj30xi0j2jzt.jpg" alt="image-20190919102343448"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g74m7xnz39j31c40q4dp7.jpg" alt="image-20190919102545255"></p>
<p>三角化</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g74m927ogwj30kk0diwfb.jpg" alt="image-20190919102640344"></p>
<h3 id="VBO-amp-VAO"><a href="#VBO-amp-VAO" class="headerlink" title="VBO &amp; VAO"></a>VBO &amp; VAO</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g74v9xvqztj30x60hedpb.jpg" alt="image-20190919153900923"></p>
<h3 id="UV"><a href="#UV" class="headerlink" title="UV"></a>UV</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g74vebr40mj30h80c2447.jpg" alt="image-20190919154317764"></p>
<h3 id="———–"><a href="#———–" class="headerlink" title="———–"></a>———–</h3><h3 id="EBO"><a href="#EBO" class="headerlink" title="EBO"></a>EBO</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g74vtx1bshj30w60i4mzf.jpg" alt="image-20190919155433545"></p>
<h3 id="VAO"><a href="#VAO" class="headerlink" title="VAO"></a>VAO</h3><p>一個物件一個VAO</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> VAO;</span><br><span class="line">glGenVertexArrays(<span class="number">1</span>, &amp;VAO);</span><br><span class="line"></span><br><span class="line">--------P.S.--------------------</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> VAO[<span class="number">10</span>]; <span class="comment">//  一次可造多個 array</span></span><br><span class="line">glGenVertexArrays(<span class="number">10</span>, VAO);</span><br><span class="line">--------P.S.--------------------</span><br><span class="line">  </span><br><span class="line">glBindVertexArray(VAO);</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> VBO;</span><br><span class="line">glBindBuffer(GL_ARRAY_BUFFER, VBO);</span><br><span class="line">glBufferData(GL_ARRAY_BUFFER, <span class="keyword">sizeof</span>(vertices), vertices, GL_STATIC_DRAW);</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g74wk2zb4dj30i304j41v.jpg" alt="image-20190919162325003"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/06/CV%20notes/2019-09-06-Face-Keypoint-Detection/">CV notes/2019-09-06-Face-Keypoint-Detection</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-06</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Deep-Learning/">Deep-Learning</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Deep-Learning/AI/">AI</a></span><div class="content"><p>Ref from: <a href="https://niuyuanyuanna.github.io/2018/11/08/computer_version/face-keypoint-detection/" target="_blank" rel="noopener">https://niuyuanyuanna.github.io/2018/11/08/computer_version/face-keypoint-detection/</a></p>
<h1 id="人脸关键点检测"><a href="#人脸关键点检测" class="headerlink" title="人脸关键点检测"></a>人脸关键点检测</h1><p>关于人脸识别和表情分类的一些<a href="https://zhuanlan.zhihu.com/p/31638581" target="_blank" rel="noopener">论文</a></p>
<h2 id="人脸关键点检测介绍"><a href="#人脸关键点检测介绍" class="headerlink" title="人脸关键点检测介绍"></a>人脸关键点检测介绍</h2><p>人脸关键点检测也称为人脸关键点检测、定位或者人脸对齐，是指给定人脸图像，定位出人脸面部的关键区域位置，包括眉毛、眼睛、鼻子、嘴巴、脸部轮廓等。</p>
<p>关键点的集合称作形状(shape)，形状包含了关键点的位置信息，而这个位置信息一般可以用两种形式表示，第一种是关键点的位置相对于整张图像，第二种是关键点的位置相对于人脸框(标识出人脸在整个图像中的位置)。把第一种形状称作绝对形状，它的取值一般介于 [0∼h][0∼h]或[0∼w][0∼w]，第二种形状我们称作相对形状，它的取值一般介于 0 到 1。这两种形状可以通过人脸框转换。</p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p>人脸关键点检测分为三种：</p>
<ul>
<li>基于ASM(Active Shape Model)和AAM (Active Appearnce Model) 的传统方法、参数化方法</li>
<li>基于CSR(Cascaded Shape Regression)的方法、非参数化方法</li>
<li>基于深度学习、非参数化方法</li>
</ul>
<p>基于参数化形状模型的方法可依据其外观模型的不同，可进一步分为，基于局部的方法和基于全局的方法；对于非参数化进一步可分为基于样例的方法、基于图模型的方法、基于级联回归的方法和基于深度学习的方法。</p>
<h3 id="人脸关键点评价标准"><a href="#人脸关键点评价标准" class="headerlink" title="人脸关键点评价标准"></a>人脸关键点评价标准</h3><p>目前主要的衡量标准是算法所获取的关键点位置与真实关键点位置之间的偏差。在评价偏差时，由于不同人脸图像的实际大小难免会有所差异，为便于在同样的尺度下比较算法性能，需要采用一定的数据归一化策略。 目前主流的方法是基于两眼间的距离进行人脸大小的标准化：<br>$$<br>ex=∣∣x^−xGT∣∣DIODex=DIOD∣∣x^−xGT∣∣<br>$$<br>其中分子DIODDIOD表示估计值与真实值的欧式距离，分母∣∣x^−xGT∣∣∣∣x^−xGT∣∣表示双眼距离，即两眼中心的欧式距离。也有采用边界框对角线作为归一化因子来评价偏差。</p>
<h3 id="人脸常用数据库"><a href="#人脸常用数据库" class="headerlink" title="人脸常用数据库"></a>人脸常用数据库</h3><p>数据库可以分为两类：主动式捕获的数据和被动式捕获的数据。主动式捕获的数据是在实验室里，对光照变化、遮挡、头部姿态和面部表情可控的情况下，对固定人员进行照片采集。被动式捕获的数据则是在社交网站等一些环境不可控的条件下采集而得。</p>
<ul>
<li>主动式数据</li>
</ul>
<ol>
<li>CMU Multi-PIE：在2004年10月至2005年3月的四次会议中收集的，支持在姿态、光照和表情变化条件下识别人脸的算法的开发。 该数据库包含337个主题和超过750,000个305GB数据的图像。 共记录了六种不同的表情：中性，微笑，惊奇，斜视，厌恶和尖叫。 在15个视图和19个不同照明条件下记录受试者，这个数据库的一个子集被标记为68点或39点。</li>
<li>XM2VTS：收集了295人的2360个彩色图像，声音文件和3D人脸模型，这2360个彩色图像标有68个关键点。</li>
<li>AR：包含超过4000个彩色图像，对应126人（70名男性和56名女性）的脸部。图像是在可控的条件下，以不同的面部表情，光照条件和遮挡（太阳镜和围巾）拍摄的。Ding and Martinez手动为每张脸部图像标注了130个关键点。</li>
<li>IMM：包含240张40个人的彩色图像（7名女性和33名男性）。 每张图像都对眉毛、眼睛、鼻子、嘴巴和下巴进行标注，共计58个标记点。</li>
<li>MUCT：由276个人的3755张图像组成，每张图像有76个关键点。 这个数据库中的面孔在不同的光照、不同的年龄和不同的种族的条件下拍摄。</li>
<li>PUT：采集了部分光照条件可控的100个人，且沿着俯仰角和偏航角旋转的9971张高分辨率图像（2048×1536），每张图像都标有30个关键点。</li>
</ol>
<ul>
<li>被动式数据</li>
</ul>
<ol>
<li>BioID：记录在室内实验室环境中，但使用“真实世界”的条件。 该数据库包含23个主题的1521个灰度人脸图像，每张图像标记20个关键点。</li>
<li>LFW：包含从网上收集的5724个人的13,233幅面部图像，其中1680人在数据集中有两张或更多的照片。虽然，这个数据库没有提供标记点，但可以从其余网站上获取。</li>
<li>AFLW(Annotated Facial Landmarks in the Wild) ：是一个大规模、多视角和真实环境下的人脸数据库。图像是从图片分享网站Flickr上收集，该数据库共包含25,993张图像，每张图像标有21个关键点。</li>
<li>LFPW(Labeled Face Parts in the Wild)：由1400个面部图像（1100作为训练集，其他300个图像作为测试集）组成。所有数据均从google, Flickr和Yahoo上获取，每张图像标记35个关键点，但在文献中，通常采用29个关键点。</li>
<li>AFW(Annotated Faces in the Wild)：包含205个图像，特点是：背景高度混乱，人脸比例和姿势都有很大的变化，每张图像均有6个关键点和边界框。</li>
<li>300-W(300 Faces in-the-Wild Challenge)：一个混合数据库，由多个已发布数据库（LFPW，Helen，AFW和XM2VTS）的面部图像和一个新收集的数据库IBUG组成。 所有这些图像都重新标注了68个关键点。</li>
</ol>
<h3 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h3><h4 id="ASM检测方法"><a href="#ASM检测方法" class="headerlink" title="ASM检测方法"></a>ASM检测方法</h4><p>ASM(Active Shape Model)是由Cootes于1995年提出的经典的人脸关键点检测算法，主动形状模型即通过形状模型对目标物体进行抽象，ASM是一种基于点分布模型（Point Distribution Model, PDM）的算法。在PDM中，外形相似的物体，例如人脸、人手、心脏、肺部等的几何形状可以通过若干关键点（landmarks）的坐标依次串联形成一个形状向量来表示。ASM算法需要通过人工标定的方法先标定训练集，经过训练获得形状模型，再通过关键点的匹配实现特定物体的匹配。</p>
<p>其检测过程主要分为两步：</p>
<ul>
<li>训练<ul>
<li>图像预处理：<ul>
<li>搜集n个训练样本（n=400）， 手动标记脸部关键点；</li>
<li>将训练集中关键点的坐标串成特征向量</li>
<li>对形状进行归一化和对齐（对齐采用Procrustes方法）</li>
<li>对齐后的形状特征做PCA处理</li>
</ul>
</li>
<li>为关键点构建局部特征（在每次迭代搜索过程中每个关键点可以寻找新的位置）：<ul>
<li>局部特征一般用梯度特征，以防光照变化</li>
<li>有的方法沿着边缘的法线方向提取，有的方法在关键点附近的矩形区域提取</li>
</ul>
</li>
</ul>
</li>
<li>搜索<ul>
<li>计算眼睛（或者眼睛和嘴巴）的位置，做简单的尺度和旋转变化，对齐人脸</li>
<li>在对齐后的各个点附近搜索，匹配每个局部关键点（常采用马氏距离），得到初步形状</li>
<li>用平均人脸（形状模型）修正匹配结果</li>
<li>迭代直到收敛</li>
</ul>
</li>
</ul>
<p>优点：模型简单直接，架构清晰明确，易于理解和应用，而且对轮廓形状有着较强的约束</p>
<p>缺点：其近似于穷举搜索的关键点定位方式在一定程度上限制了其运算效率</p>
<h4 id="AAM"><a href="#AAM" class="headerlink" title="AAM"></a>AAM</h4><p>AAM（Active Appearance Models）。1998年，Cootes对ASM进行改进，不仅采用形状约束，而且又加入整个脸部区域的纹理特征，提出了AAM算法[2]。AAM于ASM一样，主要分为两个阶段，模型建立阶段和模型匹配阶段。其中模型建立阶段包括对训练样本分别建立形状模型(Shape Model)和纹理模型(Texture Model)，然后将两个模型进行结合，形成AAM模型。</p>
<h4 id="CPR"><a href="#CPR" class="headerlink" title="CPR"></a>CPR</h4><p>2010年，Dollar提出CPR（Cascaded Pose Regression, 级联姿势回归），CPR通过一系列回归器将一个指定的初始预测值逐步细化，每一个回归器都依靠前一个回归器的输出来执行简单的图像操作，整个系统可自动的从训练样本中学习。<br>人脸关键点检测的目的是估计向量</p>
<p>S=(x1,x2,⋅⋅⋅,xk,⋅⋅⋅,xK)∈R2KS=(x1,x2,⋅⋅⋅,xk,⋅⋅⋅,xK)∈R2K</p>
<p>其中K表示关键点的个数，由于每个关键点有横纵两个坐标，所以S的长度为2K。CPR检测一共有T个阶段，在每个阶段中首先进行特征提取，得到</p>
<p>ft=ϕ(I,St)ft=ϕ(I,St)</p>
<p>这里特征使用的是shape-indexed features，也可以使用诸如HOG、SIFT等人工设计的特征，或者其他可学习特征（learning based features），然后通过训练得到的回归器rtrt来估计增量ΔSΔS( update vector)</p>
<p>ΔS=rt(ϕ(I,St))ΔS=rt(ϕ(I,St))</p>
<p>把ΔSΔS加到前一个阶段的SS上得到新的SS，这样通过不断的迭代即可以得到最终的S(shape)。</p>
<p>St+1=St+ΔSSt+1=St+ΔS</p>
<h4 id="DCNN"><a href="#DCNN" class="headerlink" title="DCNN"></a>DCNN</h4><p>2013 年，Sun 等人 首次将 CNN 应用到人脸关键点检测，提出一种级联的 CNN（拥有三个层级）——DCNN(Deep Convolutional Network)，此种方法属于级联回归方法。作者通过精心设计拥有三个层级的级联卷积神经网络，不仅改善初始不当导致陷入局部最优的问题，而且借助于 CNN 强大的特征提取能力，获得更为精准的关键点检测。</p>
<p><a href="https://github.com/niuyuanyuanna/BlogImages/raw/master/computerVersion/06230452.png" target="_blank" rel="noopener"><img src="https://github.com/niuyuanyuanna/BlogImages/raw/master/computerVersion/06230452.png" alt="img"></a></p>
<p>如上图所示，DCNN由三个level构成。level-1是3个CNN网络；level-2是10个CNN块构成，每个关键点采用两个CNN；level-3结构类似于level-2，都为10个CNN。</p>
<p>Level-1的三个CNN分别为 F1（Face 1）、EN1（Eye，Nose）、NM1（Nose，Mouth）。F1 输入尺寸为 39<em>39，输出 5 个关键点的坐标；EN1 输入尺寸为 39</em>31，输出是 3 个关键点的坐标；NM11 输入尺寸为 39*31，输出是 3 个关键点；Level-1 的输出为三个 CNN 输出取平均。</p>
<p>Level-2，由 10 个 CNN 构成，输入尺寸均为 15*15，每两个组成一对，一对 CNN 对一个关键点进行预测，预测结果同样是采取平均。</p>
<p>Level-3 与 Level-2 一样，由 10 个 CNN 构成，输入尺寸均为 15*15，每两个组成一对。Level-2 和 Level-3 是对 Level-1 得到的粗定位进行微调，得到精细的关键点定位。</p>
<p>Level-1 之所以比 Level-2 和 Level-3 的输入要大，是因为作者认为，由于人脸检测器的原因，边界框的相对位置可能会在大范围内变化，再加上面部姿态的变化，最终导致输入图像的多样性，因此在 Level-1 应该需要有足够大的输入尺寸。Level-1 与 Level-2 和 Level-3 还有一点不同之处在于，Level-1 采用的是局部权值共享（Lcally Sharing Weights），作者认为传统的全局权值共享是考虑到，某一特征可能在图像中任何位置出现，所以采用全局权值共享。然而，对于类似人脸这样具有固定空间结构的图像而言，全局权值共享就不奏效了。因为眼睛就是在上面，鼻子就是在中间，嘴巴就是在下面的。所以作者采用局部权值共享，通过实验证明了局部权值共享给网络带来性能提升。</p>
<p>DCNN 采用级联回归的思想，从粗到精的逐步得到精确的关键点位置，不仅设计了三级级联的卷积神经网络，还引入局部权值共享机制，从而提升网络的定位性能。最终在数据集 BioID 和 LFPW 上均获得当时最优结果。速度方面，采用 3.3GHz 的 CPU，每 0.12 秒检测一张图片的 5 个关键点。</p>
<h4 id="Face-DCNN"><a href="#Face-DCNN" class="headerlink" title="Face++ DCNN"></a>Face++ DCNN</h4><p>2013 年，Face++在 DCNN 模型上进行改进，提出从粗到精的人脸关键点检测算法，实现了 68 个人脸关键点的高精度定位。该算法将人脸关键点分为内部关键点和轮廓关键点，内部关键点包含眉毛、眼睛、鼻子、嘴巴共计 51 个关键点，轮廓关键点包含 17 个关键点。</p>
<p>针对内部关键点和外部关键点，该算法并行的采用两个级联的 CNN 进行关键点检测，网络结构如图所示：</p>
<p><a href="https://github.com/niuyuanyuanna/BlogImages/raw/master/computerVersion/92897228.jpg" target="_blank" rel="noopener"><img src="https://github.com/niuyuanyuanna/BlogImages/raw/master/computerVersion/92897228.jpg" alt="img"></a></p>
<p>针对内部 51 个关键点，采用四个层级的级联网络进行检测。其中，Level-1 主要作用是获得面部器官的边界框；Level-2 的输出是 51 个关键点预测位置，这里起到一个粗定位作用，目的是为了给 Level-3 进行初始化；Level-3 会依据不同器官进行从粗到精的定位；Level-4 的输入是将 Level-3 的输出进行一定的旋转，最终将 51 个关键点的位置进行输出。针对外部 17 个关键点，仅采用两个层级的级联网络进行检测。Level-1 与内部关键点检测的作用一样，主要是获得轮廓的 bounding box；Level-2 直接预测 17 个关键点，没有从粗到精定位的过程，因为轮廓关键点的区域较大，若加上 Level-3 和 Level-4，会比较耗时间。最终面部 68 个关键点由两个级联 CNN 的输出进行叠加得到。</p>
<p>算法创新点：</p>
<ol>
<li>把人脸的关键点定位问题，划分为内部关键点和轮廓关键点分开预测，有效的避免了 loss 不均衡问题</li>
<li>在内部关键点检测部分，并采用 DCNN 的方法，将每个关键点采用两个 CNN 进行预测，而是每个器官采用一个 CNN 进行预测，从而减少计算量</li>
<li>相比于 DCNN，没有直接采用人脸检测器返回的结果作为输入，而是增加一个边界框检测层（Level-1），可以大大提高关键点粗定位网络的精度。</li>
</ol>
<h4 id="TCDNN"><a href="#TCDNN" class="headerlink" title="TCDNN"></a>TCDNN</h4><p>2014 年，Zhang 等人将 MTL（Multi-Task Learning）应用到人脸关键点检测中，提出 TCDCN（Tasks-Constrained Deep Convolutional Network）。作者认为，在进行人脸关键点检测任务时，结合一些辅助信息可以帮助更好的定位关键点，这些信息如，性别、是否带眼镜、是否微笑和脸部的姿势等等。作者将人脸关键点检测（5 个关键点）与性别、是否带眼镜、是否微笑及脸部的姿势这四个子任务结合起来构成一个多任务学习模型，模型框架如图所示。</p>
<p><a href="https://github.com/niuyuanyuanna/BlogImages/raw/master/computerVersion/15813947.jpg" target="_blank" rel="noopener"><img src="https://github.com/niuyuanyuanna/BlogImages/raw/master/computerVersion/15813947.jpg" alt="img"></a></p>
<p>网络输入为40×40的灰度图，通过CNN后得到2×2×64的特征图，再通过一层含有100个神经元的全连接层输出最终提取到的共享特征。该特征为所有任务共享，对于关键点检测问题，就采用线性回归模型；对于分类问题，就采用逻辑回归。</p>
<p>在传统 MLT 中，各任务重要程度是一致的，其目标方程如下：</p>
<p>arg⁡min⁡∑t−1T∑i=1Nℓ(yit,f(xit;wt))+Φ(wt){wt}argmint−1∑Ti=1∑Nℓ(yit,f(xit;wt))+Φ(wt){wt}t=1T</p>
<p>其中，</p>
<ul>
<li>f(xit;wt)f(xit;wt)表示输入矩阵xitxit与权值矩阵$ \mathbf{w}^t$运算后得到的输出</li>
<li>ℓ(.)ℓ(.)表示损失函数</li>
<li>Φ(wt)Φ(wt)表示正则化</li>
</ul>
<p>对于各任务 t 而言，其重要性是相同的，但是在多任务学习中，往往不同任务的学习难易程度不同，若采用相同的损失权重，会导致学习任务难以收敛。文章针对多任务学习中，不同学习难度问题进行了优化，提出带权值的目标函数：</p>
<p>wr,{wa}  ∑i=1Nℓ(yit,f(xit;wt))+∑i=1N∑a∈Aλaℓ(yia,f(xia;wa))argminwr,{wa}a∈A  i=1∑Nℓ(yit,f(xit;wt))+i=1∑Na∈A∑λaℓ(yia,f(xia;wa))</p>
<p>式中前一项为人脸关键点检测的损失函数，第二项表示其他任务的损失函数，λaλa为任务aa的重要程度。在论文中，四个子任务分别为：性别、是否带眼镜、微笑、脸部姿势，因此，优化目标函数为：</p>
<p>wr,{wa}  12∑i=1N∥(yit,f(xit;wt)∥2+∑i=1N∑a∈Aλayialog⁡(p(yia∣xia;wa))+∑t=1T∥wa∥22argminwr,{wa}a∈A  21i=1∑N∥(yit,f(xit;wt)∥2+i=1∑Na∈A∑λayialog(p(yia∣xia;wa))+t=1∑T∥wa∥22</p>
<p>分类任务采用交叉熵损失函数。</p>
<p>针对多任务学习的另外一个问题——各任务收敛速度不同，本文提出一种新的提前停止（Early Stopping）方法。当某个子任务达到最好表现以后，这个子任务就对主任务已经没有帮助，就可以停止这个任务。</p>
<p>TCDCN 采用多任务学习方法对人脸关键点进行检测，针对多任务学习在人脸关键点检测任务中的两个主要问题：不同任务学习难易程度不同以及不同任务收敛速度不同，分别提出了新目标函数和提前停止策略加以改进，最终在 AFLW 和 AFW 数据集上获得领先的结果。同时对比于级联 CNN 方法，在 Intel Core i5 cpu 上，级联 CNN 需要 0.12s，而 TCDCN 仅需要 17ms，速度提升七倍有余。</p>
<h4 id="MTCNN"><a href="#MTCNN" class="headerlink" title="MTCNN"></a>MTCNN</h4><p>2016 年，Zhang 等人提出一种多任务级联卷积神经网络（MTCNN, Multi-task Cascaded Convolutional Networks）用以同时处理人脸检测和人脸关键点定位问题。作者认为人脸检测和人脸关键点检测两个任务之间往往存在着潜在的联系，然而大多数方法都未将两个任务有效的结合起来，本文为了充分利用两任务之间潜在的联系，提出一种多任务级联的人脸检测框架，将人脸检测和人脸关键点检测同时进行。</p>
<p>MTCNN 包含三个级联的多任务卷积神经网络，分别是 Proposal Network (P-Net)、Refine Network (R-Net)、Output Network (O-Net)，每个多任务卷积神经网络均有三个学习任务，分别是人脸分类、边框回归和关键点定位。网络结构如图所示：</p>
<p><a href="https://github.com/niuyuanyuanna/BlogImages/raw/master/computerVersion/14009657.jpg" target="_blank" rel="noopener"><img src="https://github.com/niuyuanyuanna/BlogImages/raw/master/computerVersion/14009657.jpg" alt="img"></a></p>
<p>MTCNN 实现人脸检测和关键点定位分为三个阶段。首先由 P-Net 获得了人脸区域的候选窗口和边界框的回归向量，并用该边界框做回归，对候选窗口进行校准，然后通过非极大值抑制（NMS）来合并高度重叠的候选框。然后将 P-Net 得出的候选框作为输入，输入到 R-Net，R-Net 同样通过边界框回归和 NMS 来去掉那些 false-positive 区域，得到更为准确的候选框；最后，利用 O-Net 输出 5 个关键点的位置。</p>
<p>在具体训练过程中，作者就多任务学习的损失函数计算方式进行相应改进。在多任务学习中，当不同类型的训练图像输入到网络时，有些任务是不进行学习的，因此相应的损失应为 0。例如，当训练图像为背景（Non-face）时，边界框和关键点的 loss 应为 0，文中提供计算公式自动确定 loss 的选取，公式为：</p>
<p>min⁡∑i=1N∑j∈{det,box,landmark}αjβijLijmini=1∑Nj∈{det,box,landmark}∑αjβijLij</p>
<p>其中</p>
<ul>
<li>αjαj表示第jj个任务的重要程度，在P-Net中，αdet=1αdet=1，αbox=0.5αbox=0.5，αlandmark=0.5αlandmark=0.5；在R-Net中αdet=1αdet=1，αbox=0.5αbox=0.5，αlandmark=1αlandmark=1。在R-Net中将$\alpha_{landmark} $增大，因为需要对关键点进行检测，所以相应增大任务重要性</li>
<li>βij∈(0,1)βij∈(0,1)作为样本类型指示器</li>
</ul>
<p>为了提升网络性能，需要挑选出困难样本（Hard Sample），传统方法是通过研究训练好的模型进行挑选，而本文提出一种能在训练过程在线挑选困难样本的方法。在 mini-batch 中，对每个样本的损失进行排序，挑选前 70% 较大的损失对应的样本作为困难样本，同时在反向传播时，忽略那 30% 的样本，因为那 30% 样本对更新作用不大。</p>
<h4 id="TCNN"><a href="#TCNN" class="headerlink" title="TCNN"></a>TCNN</h4><p>TCNN（Tweaked Convolutional Neural Networks）2016 年，Wu 等人研究了 CNN 在人脸关键点定位任务中到底学习到的是什么样的特征，在采用 GMM（Gaussian Mixture Model, 混合高斯模型）对不同层的特征进行聚类分析，发现网络进行的是层次的，由粗到精的特征定位，越深层提取到的特征越能反应出人脸关键点的位置。针对这一发现，提出了 TCNN（Tweaked Convolutional Neural Networks），其网络结构如图所示：</p>
<p><a href="https://github.com/niuyuanyuanna/BlogImages/raw/master/computerVersion/89918024.jpg" target="_blank" rel="noopener"><img src="https://github.com/niuyuanyuanna/BlogImages/raw/master/computerVersion/89918024.jpg" alt="img"></a></p>
<p>左边为Vanilla CNN，针对 FC5FC5得到的特征进行 K 个类别聚类，将训练图像按照所分类别进行划分，用以训练所对应的 FC6KFC6K。测试时，图片首先经过 Vanilla CNN 提取特征，即 FC5FC5的输出。将 FC5FC5输出的特征与 K 个聚类中心进行比较，将 FC5FC5输出的特征划分至相应的类别中，然后选择与之相应的 FC6FC6进行连接，最终得到输出。</p>
<p>作者对 Vanilla CNN 中间各层特征进行聚类分析，并统计出关键点在各层之间的变化程度。越深层提取到的特征越紧密，因此越深层提取到的特征越能反应出人脸关键点的位置。作者在采用 K=64 时，对所划分簇的样本进行平均后绘图如下：</p>
<p><a href="https://github.com/niuyuanyuanna/BlogImages/raw/master/computerVersion/62921355.jpg" target="_blank" rel="noopener"><img src="https://github.com/niuyuanyuanna/BlogImages/raw/master/computerVersion/62921355.jpg" alt="img"></a></p>
<p>从图上可发现，每一个簇的样本反应了头部的某种姿态，甚至出现了表情和性别的差异。因此可推知，人脸关键点的位置常常和人脸的属性相关联。因此为了得到更准确的关键点定位，作者使用具有相似特征的图片训练对应的回归器，最终在人脸关键点检测数据集 AFLW,AFW 和 300W 上均获得当时最佳效果。</p>
<h2 id="DAN"><a href="#DAN" class="headerlink" title="DAN"></a>DAN</h2><h3 id="主要内容"><a href="#主要内容" class="headerlink" title="主要内容"></a>主要内容</h3><p>DAN是一种人脸对齐的方法，采用级联神经网络结构，充分利用人脸的全局信息，而不是局部信息，避免局部最小化。</p>
<ol>
<li>参考CSR框架，通过前向传播提取特征，训练前向传播的backbone网络得到关键点位的偏差，替代CSR中的回归器</li>
<li>用级联结构来实现CSR中的迭代</li>
<li>利用人脸所有信息T(I)T(I)、H(I)H(I)、F(I)F(I)作为输入，得到关键点偏差</li>
<li>构造级联网络结构</li>
<li>分级训练网络，每一级网络loss不收敛后再训练下一级网络</li>
</ol>
<h3 id="网络结构"><a href="#网络结构" class="headerlink" title="网络结构"></a>网络结构</h3><p>2017 年，Kowalski 等人提出一种新的级联深度神经网络——DAN（Deep Alignment Network），以往级联神经网络输入的是图像的某一部分，与以往不同，DAN 各阶段网络的输入均为整张图片。当网络均采用整张图片作为输入时，DAN 可以有效的克服头部姿态以及初始化带来的问题，从而得到更好的检测效果。之所以 DAN 能将整张图片作为输入，是因为其加入了关键点热图（Landmark Heatmaps），关键点热图的使用是本文的主要创新点。DAN 基本框架如图所示：</p>
<p><a href="https://github.com/niuyuanyuanna/BlogImages/raw/master/computerVersion/55049944.jpg" target="_blank" rel="noopener"><img src="https://github.com/niuyuanyuanna/BlogImages/raw/master/computerVersion/55049944.jpg" alt="img"></a></p>
<p>DAN 包含多个阶段，每一个阶段含三个输入和一个输出，输入分别是被矫正过的图片、关键点热图和由全连接层生成的特征图，输出是面部形状（Face Shape）。其中，CONNECTION LAYER 的作用是将本阶段得输出进行一系列变换，生成下一阶段所需要的三个输入，具体操作如下图所示：</p>
<p><a href="https://github.com/niuyuanyuanna/BlogImages/raw/master/computerVersion/83789038.jpg" target="_blank" rel="noopener"><img src="https://github.com/niuyuanyuanna/BlogImages/raw/master/computerVersion/83789038.jpg" alt="img"></a></p>
<p>第一阶段的输入仅有原始图片和 S0S0。面部关键点的初始化即为 S0S0，是由所有关键点取平均得到，第一阶段输出 S1S1。对于第二阶段， S1S1经第一阶段的 CONNECTION LAYERS 进行转换，分别得到转换后图片 T2(I)T2(I)、 S1S1所对应的热图 H2H2和第一阶段 fc1fc1层输出，这三个正是第二阶段的输入。如此周而复始，直到最后一个阶段输出 SNSN。</p>
<p>DAN 要做的“IMAGE TRANSFORM“，就是图片矫正， DAN 对姿态变换具有很好的适应能力，或许就得益于这个“IMAGE TRANSFORM“。StSt公式为：</p>
<p>St=Tt−1(Tt(St−1)+ΔSt)St=Tt−1(Tt(St−1)+ΔSt)</p>
<p>Feed forward NN网络参数为：</p>
<table>
<thead>
<tr>
<th align="center">Name</th>
<th align="center">Shape-in</th>
<th align="center">Shape-out</th>
<th align="center">Kernel</th>
</tr>
</thead>
<tbody><tr>
<td align="center">conv1a</td>
<td align="center">112×112×1</td>
<td align="center">112×112×64</td>
<td align="center">3×3×1,1</td>
</tr>
<tr>
<td align="center">conv1b</td>
<td align="center">112×112×64</td>
<td align="center">112×112×64</td>
<td align="center">3×3×64,1</td>
</tr>
<tr>
<td align="center">pool1</td>
<td align="center">112×112×64</td>
<td align="center">56×56×64</td>
<td align="center">2×2×1,2</td>
</tr>
<tr>
<td align="center">conv2a</td>
<td align="center">56×56×64</td>
<td align="center">56×56×128</td>
<td align="center">3×3×64,1</td>
</tr>
<tr>
<td align="center">conv2b</td>
<td align="center">56×56×128</td>
<td align="center">56×56×128</td>
<td align="center">3×3×128,1</td>
</tr>
<tr>
<td align="center">pool2</td>
<td align="center">56×56×128</td>
<td align="center">28×28×128</td>
<td align="center">2×2×1,2</td>
</tr>
<tr>
<td align="center">conv3a</td>
<td align="center">28×28×128</td>
<td align="center">28×28×256</td>
<td align="center">3×3×128,1</td>
</tr>
<tr>
<td align="center">conv3b</td>
<td align="center">28×28×256</td>
<td align="center">28×28×256</td>
<td align="center">3×3×256,1</td>
</tr>
<tr>
<td align="center">pool3</td>
<td align="center">28×28×256</td>
<td align="center">14×14×256</td>
<td align="center">2×2×1,2</td>
</tr>
<tr>
<td align="center">conv4a</td>
<td align="center">14×14×256</td>
<td align="center">14×14×512</td>
<td align="center">3×3×256,1</td>
</tr>
<tr>
<td align="center">conv4b</td>
<td align="center">14×14×512</td>
<td align="center">14×14×512</td>
<td align="center">3×3×512,1</td>
</tr>
<tr>
<td align="center">pool4</td>
<td align="center">14×14×512</td>
<td align="center">7×7×512</td>
<td align="center">2×2×1,2</td>
</tr>
<tr>
<td align="center">fc1</td>
<td align="center">7×7×512</td>
<td align="center">1×1×256</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">fc2</td>
<td align="center">1×1×256</td>
<td align="center">1×1×136</td>
<td align="center">-</td>
</tr>
</tbody></table>
<p>Feed Forward NN的输入是经过“IMAGE TRANSFORM“之后得到的偏移量ΔStΔSt，它是在新特征空间下的偏移量，在经过偏移后再经过反变换Tt−1(⋅)Tt−1(⋅)，将其还原到原始空间。</p>
<p>关键点热度图的计算就是一个中心衰减，关键点处值最大，越远则值越小，公式如下：</p>
<p>H(x,y)=11+Si∈Tt(St−1)  ∥(x,y)−Si∥H(x,y)=1+minSi∈Tt(St−1)  ∥(x,y)−Si∥1</p>
<p>从fc1fc1层生成特种图的目的是人为给 CNN 增加上一阶段信息。总而言之，DAN 是一个级联思想的关键点检测方法，通过引入关键点热图作为补充，DAN 可以从整张图片进行提取特征，从而获得更为精确的定位。</p>
<h2 id="EmotionalDAN"><a href="#EmotionalDAN" class="headerlink" title="EmotionalDAN"></a>EmotionalDAN</h2><p>Author: NYY</p>
<p>Link: <a href="http://yoursite.com/2018/11/08/computer_version/face-keypoint-detection/">http://yoursite.com/2018/11/08/computer_version/face-keypoint-detection/</a></p>
<p>Copyright Notice: All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a>unless stating additionally.</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/08/24/OpenGL/Adobe%20Animiation%20Flow/">OpenGL/Adobe Animiation Flow</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-08-24</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Graphic/">Graphic</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Adobe/">Adobe</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Animation/">Animation</a></span><div class="content"><ol>
<li>Download Adobe &amp; Zii , in <a href="https://www.waitsun.com/adobe-zii-2019.html" target="_blank" rel="noopener">https://www.waitsun.com/adobe-zii-2019.html</a></li>
<li>install body movin</li>
<li><a href="https://github.com/airbnb/lottie-web#plugin-installation" target="_blank" rel="noopener">https://github.com/airbnb/lottie-web#plugin-installation</a> &amp; ZXP_installer : <a href="https://www.jianshu.com/p/9a1500571269" target="_blank" rel="noopener">https://www.jianshu.com/p/9a1500571269</a></li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/08/21/DevOps/2019-08-21-Homebrew-change-mirror-source/">DevOps/2019-08-21-Homebrew-change-mirror-source</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-08-21</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/DevOps/">DevOps</a></span><div class="content"><p>Homebrew是Mac的软件包管理器，我们可以通过它安装大多数开源软件。但是在使用brew update更新的时候竟然要等待很久。猜测可能是因为brew的官方源被墙或或者响应慢。于是想到的切换Homebrew的更新源的办法, 如果coding.net的源还是很慢的话， 也可以尝试其他的源。具体代码如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="comment">#cd to homebrew foler</span></span><br><span class="line">$ <span class="built_in">cd</span> <span class="string">"<span class="variable">$(brew --repo)</span>"</span>；</span><br><span class="line">$ <span class="comment">#check  git remote status</span></span><br><span class="line">$ git remote -v;</span><br><span class="line">https://github.com/Homebrew/homebrew.git</span><br><span class="line">$ <span class="comment">#update remote url with Coding.net</span></span><br><span class="line">$ git remote <span class="built_in">set</span>-url origin https://git.coding.net/homebrew/homebrew.git</span><br><span class="line">$ brew update</span><br></pre></td></tr></table></figure>



<p>　</p>
<p>brew镜像源</p>
<ul>
<li>中科大brew镜像源    <a href="http://mirrors.ustc.edu.cn/homebrew.git" target="_blank" rel="noopener">http://mirrors.ustc.edu.cn/homebrew.git</a></li>
<li>清华brew镜像源  <a href="http://mirrors.ustc.edu.cn/homebrew.git" target="_blank" rel="noopener">http://mirrors.ustc.edu.cn/homebrew.git</a></li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/08/04/CV%20notes/2019-08-04-Pose-Generation/">CV notes/2019-08-04-Pose-Generation</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-08-04</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Deep-Learning/">Deep-Learning</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Deep-Learning/AI/">AI</a></span><div class="content"><p>(NOT MY NOTE, ref from colleaque’s)</p>
<h3 id="Deformable-GANs-for-Pose-based-Human-Image-Generation"><a href="#Deformable-GANs-for-Pose-based-Human-Image-Generation" class="headerlink" title="Deformable GANs for Pose-based Human Image Generation."></a>Deformable GANs for Pose-based Human Image Generation.</h3><p><a href="https://github.com/AliaksandrSiarohin/pose-gan" target="_blank" rel="noopener">https://github.com/AliaksandrSiarohin/pose-gan</a>.  cvpr2018</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6hp3mtcvuj30rp0aq42d.jpg" alt=""></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6hp4oxs5gj30gd0adwh2.jpg" alt=""></p>
<h3 id="Progressive-Pose-Attention-for-Person-Image-Generation"><a href="#Progressive-Pose-Attention-for-Person-Image-Generation" class="headerlink" title="Progressive Pose Attention for Person Image Generation"></a>Progressive Pose Attention for Person Image Generation</h3><p><a href="https://github.com/tengteng95/Pose-Transfer" target="_blank" rel="noopener">https://github.com/tengteng95/Pose-Transfer</a>.  cvpr2019, </p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6gthtcaz5j30o70b2wfd.jpg" alt="整体流程图"></p>
<p>整体结构中含有多个Pose  Attentional Block，其作用是对输入的image pathway和pose pathway按照Pose Mask进行更新，图中Mt即为Pose Mask，它引导网络将图片中人物的不同的部分按照目标姿态进行像素块迁移。</p>
<p>将最后一个Block中Image Pathway的数据经过解码网络，即得到了最终的生成图像。</p>
<h3 id="Unsupervised-Person-Image-Generation-with-Semantic-Parsing-Transformation"><a href="#Unsupervised-Person-Image-Generation-with-Semantic-Parsing-Transformation" class="headerlink" title="Unsupervised Person Image Generation with Semantic Parsing Transformation"></a>Unsupervised Person Image Generation with Semantic Parsing Transformation</h3><p><a href="https://github.com/SijieSong/person_generation_spt" target="_blank" rel="noopener">https://github.com/SijieSong/person_generation_spt</a>. cvpr2019</p>
<p>只有测试代码，测试输入还需要semantic parsing</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6lf6q884ej311s0mb0vb.jpg" alt="">  </p>
<p>###Dense Intrinsic Appearance Flow for Human Pose Transfer</p>
<p><a href="https://github.com/ly015/intrinsic_flow" target="_blank" rel="noopener">https://github.com/ly015/intrinsic_flow</a>      cvpr2019</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6m4tdrihzj31dk0lsgrt.jpg" alt=""></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6m4v9xer1j31bg0j40u9.jpg" alt=""></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6m4vecqfjj30o407udg5.jpg" alt=""></p>
<p>###Disentangled Person Image Generation</p>
<p><a href="https://github.com/charliememory/Disentangled-Person-Image-Generation" target="_blank" rel="noopener">https://github.com/charliememory/Disentangled-Person-Image-Generation</a> cvpr2018</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6m4zyq9zhj31pa0n076v.jpg" alt=""></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6m4xvk2woj31l00l8di5.jpg" alt=""></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/08/02/DevOps/2019-08-02-Docker-w-Pycharm/">DevOps/2019-08-02-Docker-w-Pycharm</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-08-02</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/DevOps/">DevOps</a></span><div class="content"><h3 id="docker-ssh配置"><a href="#docker-ssh配置" class="headerlink" title="docker ssh配置"></a>docker ssh配置</h3><h5 id="Concept"><a href="#Concept" class="headerlink" title="Concept"></a>Concept</h5><p>进行实验时用挂载的，让本地跟docker内的文件夹一样</p>
<p>#####新建docker container</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nvidia-docker run -it -p [host_port]:[container_port](<span class="keyword">do</span> not use 8888) --name:[container_name] [image_name] -v [container_path]:[host_path] /bin/bash</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nvidia-docker run -p 5592:5592 -p 5593:5593 -p 8022:22 --name=<span class="string">"liuzhen_tf"</span> -v ~/workspace/liuzhen/remote_workspace:/workspace/liuzhen/remote_workspace -it tensorflow/tensorflow:latest-gpu /bin/bash</span><br></pre></td></tr></table></figure>

<h5 id="配置ssh服务"><a href="#配置ssh服务" class="headerlink" title="配置ssh服务"></a>配置ssh服务</h5><p>在新建的容器内配置ssh，安装openssh-server</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ apt update</span><br><span class="line">$ apt install -y openssh-server</span><br></pre></td></tr></table></figure>

<p>设置ssh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir /var/run/sshd</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'root:passwd'</span> | chpasswd</span><br><span class="line"><span class="comment"># 这里使用你自己想设置的用户名和密码，passwd是此处设置的密码</span></span><br><span class="line">$ sed -i <span class="string">'s/PermitRootLogin prohibit-password/PermitRootLogin yes/'</span> /etc/ssh/sshd_config</span><br><span class="line">$ sed <span class="string">'s@session\s*required\s*pam_loginuid.so@session optional pam_loginuid.so@g'</span> -i /etc/pam.d/sshd</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"export VISIBLE=now"</span> &gt;&gt; /etc/profile</span><br></pre></td></tr></table></figure>

<h5 id="重启ssh激活配置"><a href="#重启ssh激活配置" class="headerlink" title="重启ssh激活配置"></a>重启ssh激活配置</h5><p>(<u>最常见的问题</u>就是docker容器停了以后里面的SSH服务也会相应停止，因此当你发现自己某一天连不上的时候，记得去docker里重启一下ssh服务：)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ service ssh restart</span><br></pre></td></tr></table></figure>

<p>在服务器（宿主机）上（不是服务器的docker里）测试刚刚新建docker容器中哪个端口转发到了服务器的22端口：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker port [your_container_name] 22</span><br><span class="line"><span class="comment"># 如果前面的配置生效了，你会看到如下输出</span></span><br><span class="line"><span class="comment"># 0.0.0.0:8022</span></span><br></pre></td></tr></table></figure>

<p>最后测试能否用SSH连接到远程docker：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ssh root@[your_host_ip] -p 8022</span><br><span class="line"><span class="comment"># 密码是你前面自己设置的</span></span><br></pre></td></tr></table></figure>

<h3 id="pycharm配置"><a href="#pycharm配置" class="headerlink" title="pycharm配置"></a>pycharm配置</h3><h5 id="打开本地代码"><a href="#打开本地代码" class="headerlink" title="打开本地代码"></a>打开本地代码</h5><p>打开PyCharm<code>Tools &gt; Deployment &gt; Configuration</code></p>
<p>#####新建服务器SFTP</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6gtkcxaeaj315r0u03zh.jpg" alt="image-20190828175349739"></p>
<p>输入如下图配置，注意这里的端口是你刚刚设置的映射到容器22端口的宿主机中的端口，我这里使用的是8022，账号密码是你刚刚自己设置的，这里的Root Path设置一个远程docker容器里的路径。</p>
<p>在Mappings中配置路径，这里的路径是你本地存放代码的路径，与刚刚配置的<em>Root Path</em>相互映射（意思是Mapping里本机的路径映射到远程的Root Path）<em>，</em>方便以后在本地和远程docker中进行代码和其他文件同步。</p>
<p>#####配置远程解释器</p>
<p>打开PyCharm<code>Preferences &gt; Project Interpreter</code></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6gtlykktsj317a0u0q4w.jpg" alt="image-20190828190716498"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6gtrxo163j307705et8o.jpg" alt=""></p>
<p>新建ssh Interpreter</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6gtml7aj1j31d30u0aam.jpg" alt="image-20190828191025481"></p>
<h5 id="配置运行环境变量"><a href="#配置运行环境变量" class="headerlink" title="配置运行环境变量"></a>配置运行环境变量</h5><p><code>run &gt; edit confuriguration</code></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6gtmztm35j30r80sk758.jpg" alt="image-20190828191253964"></p>
<h3 id="docker-jupyter使用"><a href="#docker-jupyter使用" class="headerlink" title="docker jupyter使用"></a>docker jupyter使用</h3><p>jupyter-notebook的默认端口号是8888，映射几个外部端口，如前面的5592</p>
<p>更新apt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br></pre></td></tr></table></figure>

<p>安装jupyter</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install jupyter</span><br></pre></td></tr></table></figure>

<p>(注意pip install jupyter notebook==5.7.5，高版本有bug)</p>
<p>配置jupyter</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">生成jupyter配置文件，这个会生成配置文件.jupyter/jupyter_notebook_config.py</span></span><br><span class="line">jupyter notebook --generate-config</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">使用ipython生成密码</span></span><br><span class="line">In [1]: from notebook.auth import passwd</span><br><span class="line">In [2]: passwd()</span><br><span class="line">Enter password: </span><br><span class="line">Verify password: </span><br><span class="line">Out[2]: 'sha1:38a5ecdf288b:c82dace8d3c7a212ec0bd49bbb99c9af3bae076e'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">去配置文件.jupyter/jupyter_notebook_config.py中修改以下参数</span></span><br><span class="line">c.NotebookApp.ip='*'                          #绑定所有地址</span><br><span class="line">c.NotebookApp.password = u'sha1:38a5ecdf288b:c82dace8d3c7a212ec0bd49bbb99c9af3bae076e'</span><br><span class="line">c.NotebookApp.open_browser = False            #启动后是否在浏览器中自动打开</span><br><span class="line">c.NotebookApp.port =5592                      #指定一个访问端口，默认8888，注意和映射的docker端口对应</span><br><span class="line">c.NotebookApp.allow_remote_access = True</span><br><span class="line">c.NotebookApp.allow_root = True               #allow the user to run the notebook as root</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> jupyter notebook</span></span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/08/01/DevOps/2019-08-01-Rebase/">DevOps/2019-08-01-Rebase</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-08-01</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/DevOps/">DevOps</a></span><div class="content"><p>ref: <a href="https://git-scm.com/book/zh/v2/Git-分支-变基" target="_blank" rel="noopener">https://git-scm.com/book/zh/v2/Git-%E5%88%86%E6%94%AF-%E5%8F%98%E5%9F%BA</a></p>
<h2 id="变基"><a href="#变基" class="headerlink" title="变基"></a>变基</h2><p>在 Git 中整合来自不同分支的修改主要有两种方法：<code>merge</code> 以及 <code>rebase</code>。 在本节中我们将学习什么是“变基”，怎样使用“变基”，并将展示该操作的惊艳之处，以及指出在何种情况下你应避免使用它。</p>
<h3 id="变基的基本操作"><a href="#变基的基本操作" class="headerlink" title="变基的基本操作"></a>变基的基本操作</h3><p>请回顾之前在 <a href="https://git-scm.com/book/zh/v2/ch00/r_basic_merging" target="_blank" rel="noopener">分支的合并</a> 中的一个例子，你会看到开发任务分叉到两个不同分支，又各自提交了更新。</p>
<p><img src="https://git-scm.com/book/en/v2/images/basic-rebase-1.png" alt="分叉的提交历史。"></p>
<p>Figure 35. 分叉的提交历史</p>
<p>之前介绍过，整合分支最容易的方法是 <code>merge</code> 命令。 它会把两个分支的最新快照（<code>C3</code> 和 <code>C4</code>）以及二者最近的共同祖先（<code>C2</code>）进行三方合并，合并的结果是生成一个新的快照（并提交）。</p>
<p><img src="https://git-scm.com/book/en/v2/images/basic-rebase-2.png" alt="通过合并操作来整合分叉了的历史。"></p>
<p>Figure 36. 通过合并操作来整合分叉了的历史</p>
<p>其实，还有一种方法：你可以提取在 <code>C4</code> 中引入的补丁和修改，然后在 <code>C3</code> 的基础上应用一次。 在 Git 中，这种操作就叫做 <em>变基</em>。 你可以使用 <code>rebase</code> 命令将提交到某一分支上的所有修改都移至另一分支上，就好像“重新播放”一样。</p>
<p>在上面这个例子中，运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout experiment</span><br><span class="line">$ git rebase master</span><br><span class="line">First, rewinding head to replay your work on top of it...</span><br><span class="line">Applying: added staged <span class="built_in">command</span></span><br></pre></td></tr></table></figure>

<p>它的原理是首先找到这两个分支（即当前分支 <code>experiment</code>、变基操作的目标基底分支 <code>master</code>）的最近共同祖先 <code>C2</code>，然后对比当前分支相对于该祖先的历次提交，提取相应的修改并存为临时文件，然后将当前分支指向目标基底 <code>C3</code>, 最后以此将之前另存为临时文件的修改依序应用。（译注：写明了 commit id，以便理解，下同）</p>
<p><img src="https://git-scm.com/book/en/v2/images/basic-rebase-3.png" alt="将 `C4` 中的修改变基到 `C3` 上。"></p>
<p>Figure 37. 将 <code>C4</code> 中的修改变基到 <code>C3</code> 上</p>
<p>现在回到 <code>master</code> 分支，进行一次快进合并。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">$ git merge experiment</span><br></pre></td></tr></table></figure>

<p><img src="https://git-scm.com/book/en/v2/images/basic-rebase-4.png" alt="master 分支的快进合并。"></p>
<p>Figure 38. master 分支的快进合并</p>
<p>此时，<code>C4&#39;</code> 指向的快照就和上面使用 <code>merge</code> 命令的例子中 <code>C5</code> 指向的快照一模一样了。 这两种整合方法的最终结果没有任何区别，但是变基使得提交历史更加整洁。 你在查看一个经过变基的分支的历史记录时会发现，尽管实际的开发工作是并行的，但它们看上去就像是串行的一样，提交历史是一条直线没有分叉。</p>
<p>一般我们这样做的目的是为了确保在向远程分支推送时能保持提交历史的整洁——例如向某个其他人维护的项目贡献代码时。 在这种情况下，你首先在自己的分支里进行开发，当开发完成时你需要先将你的代码变基到 <code>origin/master</code> 上，然后再向主项目提交修改。 这样的话，该项目的维护者就不再需要进行整合工作，只需要快进合并便可。</p>
<p>请注意，无论是通过变基，还是通过三方合并，整合的最终结果所指向的快照始终是一样的，只不过提交历史不同罢了。 变基是将一系列提交按照原有次序依次应用到另一分支上，而合并是把最终结果合在一起。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/07/31/FFmpeg/2019-07-31-ffmepg-cmds-2/">FFmpeg/2019-07-31-ffmepg-cmds-2</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-07-31</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ffmpeg/">ffmpeg</a></span><div class="content"><p>1.通过ffmpeg对AE直接导出的大文件压缩，(a.mov:16M，a.mp4:2.7M)，(b.mov:13M，a.mp4:1.6M)<br><code>ffmpeg -i a.mov -vcodec png a.mp4</code></p>
<p>2.对模板视频时长进行改变，(a.mp4:2.7M，a_fittime.mp4:2.6M)<br><code>ffmpeg -i a.mp4 -vf setpts=0.96*PTS -vcodec png a_fittime.mp4</code><br>模板6.25秒，素材6秒，经过上面的操作模板变成6.08秒</p>
<p>3.视频叠加，(intro_3_4.mp4:1.1M，a_fit_add.mp4:424k)<br><code>ffmpeg -i intro_3_4.mp4 -i a_fittime.mp4 -filter_complex overlay -strict -2 a_fit_add.mp4</code></p>
<p>4.Preset</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7akqezzvtj30rv0j9dkl.jpg" alt="image"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffoutputs += <span class="string">"[1:v]scale=if(gt(&#123;0&#125;/iw\, &#123;1&#125;/ih)\, -1\, &#123;0&#125;)"</span> \</span><br><span class="line">                       <span class="string">":if(gt(&#123;0&#125;/iw\, &#123;1&#125;/ih)\, &#123;1&#125;\, -1)[video];"</span>.format(dest_w, dest_h)</span><br></pre></td></tr></table></figure>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/07/07/Front-End/2019-07-07-front-end%20rendering/">Front-End Rendering!</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-07-07</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Front-End-Rendering/">Front-End-Rendering</a></span><div class="content"><h3 id="Front-End-Rendering"><a href="#Front-End-Rendering" class="headerlink" title="Front-End Rendering"></a>Front-End Rendering</h3><ul>
<li>图片：裁剪，模糊，亮度，对比度，阴影，灰度，色相旋转，反转，透明度，饱和度，褐色<br><a href="https://www.runoob.com/cssref/css3-pr-filter.html" target="_blank" rel="noopener">https://www.runoob.com/cssref/css3-pr-filter.html</a><br><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6nijqvpwvj31410kzgxe.jpg" alt="image-20190904152108270"></li>
</ul>
<ul>
<li><p>文字：模糊，阴影，透明度，发光，渐变</p>
<p><a href="https://codepen.io/wuyeguangming/pen/jONaWXr" target="_blank" rel="noopener">https://codepen.io/wuyeguangming/pen/jONaWXr</a></p>
</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6nibg1wusj31kz0u0aua.jpg" alt=""></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6nij8edvlj31kc0u0nb7.jpg" alt="image-20190904152348021"></p>
<ul>
<li><p>动效：位移，缩放，旋转，渐变<br><a href="https://animejs.com/" target="_blank" rel="noopener">https://animejs.com/</a></p>
</li>
<li><p>物理引擎：重力、碰撞、摩擦、阻力、惯性等<br><a href="http://brm.io/matter-js/" target="_blank" rel="noopener">http://brm.io/matter-js/</a></p>
</li>
<li><p>视差效果引擎：近大远小<br><a href="http://matthew.wagerfield.com/parallax/" target="_blank" rel="noopener">http://matthew.wagerfield.com/parallax/</a></p>
</li>
<li><p>3d<br><a href="https://threejs.org/examples/#webgl_animation_multiple" target="_blank" rel="noopener">https://threejs.org/examples/#webgl_animation_multiple</a></p>
</li>
<li><p>建模<br><a href="https://www.mixamo.com/#/" target="_blank" rel="noopener">https://www.mixamo.com/#/</a></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6nijxu7ahj31l00u04qp.jpg" alt="image-20190904151945987"></p>
</li>
</ul>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://animejs.com/" target="_blank" rel="noopener">https://animejs.com/</a><br><a href="http://svgjs.com/" target="_blank" rel="noopener">http://svgjs.com</a><br><a href="https://daneden.github.io/animate.css/" target="_blank" rel="noopener">https://daneden.github.io/animate.css/</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/06/25/FFmpeg/2019-06-25-ffmpeg-cmds/">ffmpeg_cmds!</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-06-25</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ffmpeg/">ffmpeg</a></span><div class="content"><h2 id="rm-black-sides"><a href="#rm-black-sides" class="headerlink" title="rm black sides"></a>rm black sides</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">╰─○ ffplay -i vn_hflip.mp4 -t 5 -vf cropdetect</span><br><span class="line">╰─○ ffplay -i vn_hflip.mp4 -t 5 -vf crop=1280:528:0:96</span><br></pre></td></tr></table></figure>

<h2 id="save-to-json"><a href="#save-to-json" class="headerlink" title="save to json"></a>save to json</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffprobe -hide_banner -print_format json -show_streams -i vn_hflip.mp4 &gt; vn_json_streams.log</span><br></pre></td></tr></table></figure>

<h2 id="check-error"><a href="#check-error" class="headerlink" title="check error"></a>check error</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffprobe -show_frames vn_hflip.mp4 &gt; vn_show_frames.log</span><br></pre></td></tr></table></figure>

<h2 id="video-to-pics"><a href="#video-to-pics" class="headerlink" title="video to pics"></a>video to pics</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i vn_hflip.mp4 -r 40 -f image2         -t 1 my%d.jpg        <span class="comment">## 跟下一行比會多了幾張重覆的，因為比來的video就25fps而已</span></span><br><span class="line"><span class="string">""</span><span class="string">"2938"</span><span class="string">""</span>  ffmpeg -i vn_hflip.mp4 -r 25 -f image2 -t 1 my25_%d.jpg <span class="comment">## 跟上一行几乎一样，就是正常的25 rate</span></span><br><span class="line">ffmpeg -i vn_hflip.mp4 -vcodec mjpeg -ss 0:0:2 -t 0:0:1 0m%04d.jpg  <span class="comment">## 跟上面比主要就是从第二秒开始</span></span><br><span class="line"></span><br><span class="line">2937  ffmpeg -i vn_hflip.mp4 -r 40 -f image2 -t 1 my25_%d.jpg</span><br><span class="line">★★★ -r, -ss, -t  本来的video要变成的rate，开始、抓多久</span><br><span class="line"></span><br><span class="line">ffmpeg -i vn_hflip.mp4 -ss 00:00:14.435 -vframes 1 out.png</span><br><span class="line">★★★ -vframes 抓几张</span><br></pre></td></tr></table></figure>

<h2 id="pics-to-video"><a href="#pics-to-video" class="headerlink" title="pics to video"></a>pics to video</h2><p>把多个图像文件使用h264编码封装成avi文件，如有my0.jpg, my1.jpg … my99.jpg</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i my%d.jpg  -vcodec h264 my.avi</span><br></pre></td></tr></table></figure>



<p>-r 选项的用法：</p>
<p>预设是</p>
<p>以25FPS读入所有图片，所以len(Images[])会是输出的video的duration. </p>
<p>作出25FPS的video, 所以如果 -r加在 output前面，会进行插帧、删帧。</p>
<p>如果-r加在 input前面，就是每秒读进来几张图片</p>
<p>如果　ffmpeg -r 10 -i z-%5d.jpeg -vcodec h264 -r 60 out10in60out.mp4</p>
<p>那么因为每秒读进来10张而已，硬做成60fps的video，也是没用，因为中间只是内插成了60fps</p>
<h2 id="video-to-gif"><a href="#video-to-gif" class="headerlink" title="video to gif"></a>video to gif</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i vn_hflip.mp4 -ss 0 -r 1 -vframes 6 vn.gif</span><br><span class="line">ffmpeg -i vn_hflip.mp4 -ss 0 -vf fps=1 -vframes 6 vn_fps.gif <span class="comment"># 这个似乎比上面的好一些</span></span><br></pre></td></tr></table></figure>




<p>##EXTRACTION !!!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> 2999  ffmpeg -i ../vn_hflip.mp4 -ss 00:00:00 -t 10 -vf fps=1 fps1_%d.png</span><br><span class="line">(joe_py36) ┌─[joe@JoeMBP2] - [~/Movies/exp/tmp] - [3003]</span><br><span class="line">└─[$] <span class="built_in">history</span> | grep r1                                                                                                                                                                           [22:06:04]</span><br><span class="line"> 2975  ffmpeg -i ../vn_hflip.mp4 -r 1 r1_%d.png</span><br><span class="line"> 2977  ffmpeg -i ../vn_hflip.mp4 -r 1 -vframes 6 r1_vframes_%d.png</span><br></pre></td></tr></table></figure>







<h2 id="add-logo"><a href="#add-logo" class="headerlink" title="add logo"></a>add logo</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i vn_hflip.mp4 -i ~/Pictures/Sackboy_0.jpeg -filter_complex overlay=W-w:H-h vn_logo.avi</span><br><span class="line">    如右下角: ffmpeg -i God.rm -i logo.png -filter_complex overlay=W-w:H-h my.avi</span><br><span class="line">    如居中:  ffmpeg -i God.rm -i logo.png -filter_complex overlay=W/2-w/2:H/2-h/2 my.avi</span><br></pre></td></tr></table></figure>



</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/06/07/Web/2019-06-07-Requests'%20secret:%20pool_connections%20and%20pool_maxsize/">Web/2019-06-07-Requests' secret: pool_connections and pool_maxsize</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-06-07</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Web/">Web</a></span><div class="content"><p>from: <a href="https://www.cnblogs.com/pengyusong/p/5802929.html" target="_blank" rel="noopener">https://www.cnblogs.com/pengyusong/p/5802929.html</a></p>
<p>and <a href="https://laike9m.com/blog/requests-secret-pool_connections-and-pool_maxsize,89/" target="_blank" rel="noopener">https://laike9m.com/blog/requests-secret-pool_connections-and-pool_maxsize,89/</a></p>
<h1 id="Requests’-secret-pool-connections-and-pool-maxsize"><a href="#Requests’-secret-pool-connections-and-pool-maxsize" class="headerlink" title="Requests’ secret: pool_connections and pool_maxsize"></a><strong>Requests’ secret: pool_connections and pool_maxsize</strong></h1><p><a href="http://docs.python-requests.org/en/latest/" target="_blank" rel="noopener">Requests</a> 是一个python开发者众所周知的第三方库。因其简单的API和高性能，大多数人倾向于使用requests而不是urllib2作为访问http的标准库。然而很多使用requests库的人可能不知道内部原因，今天我就来解释以下俩个概念: <code>pool_connections</code> 和<code>pool_maxsize</code>.</p>
<p>从 <code>Session 开始</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line">s.get(<span class="string">'https://www.google.com'</span>)</span><br></pre></td></tr></table></figure>

<p>这很简单，你可能知道requests’ <code>Session</code> 持有cookie. 但你知道 <code>Session</code> 有一个 <a href="http://docs.python-requests.org/en/latest/api/#requests.Session.mount" target="_blank" rel="noopener"><code>mount</code></a> 方法吗?</p>
<blockquote>
<p><code>mount(prefix, adapter)</code><br>Registers a connection adapter to a prefix.<br>Adapters are sorted in descending order by key length.</p>
</blockquote>
<p>不知道？很好，实际上你已经使用了这个方法当你初始化一个session对象时:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Session</span><span class="params">(SessionRedirectMixin)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        ...</span><br><span class="line">        <span class="comment"># Default connection adapters.</span></span><br><span class="line">        self.adapters = OrderedDict()</span><br><span class="line">        self.mount(<span class="string">'https://'</span>, HTTPAdapter())</span><br><span class="line">        self.mount(<span class="string">'http://'</span>, HTTPAdapter())</span><br></pre></td></tr></table></figure>

<p>现在，到了有趣的部分。如果你阅读过 Ian Cordasco’s 文章 <a href="http://www.coglib.com/~icordasc/blog/2014/12/retries-in-requests.html" target="_blank" rel="noopener">Retries in Requests</a>, 你应该知道 <code>HTTPAdapter</code> 可以提供重试功能. 但一个 <code>HTTPAdapter</code> 真实是什么? Quoted from <a href="http://docs.python-requests.org/en/latest/api/#requests.adapters.HTTPAdapter" target="_blank" rel="noopener">doc</a>:</p>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">requests</span>.<span class="title">adapters</span>.<span class="title">HTTPAdapter</span><span class="params">(pool_connections=<span class="number">10</span>, pool_maxsize=<span class="number">10</span>, max_retries=<span class="number">0</span>, pool_block=False)</span></span></span><br></pre></td></tr></table></figure>

<p>The built-in HTTP Adapter for urllib3.</p>
<p>Provides a general-case interface for Requests sessions to contact HTTP and HTTPS urls by implementing the Transport Adapter interface. This class will usually be created by the Session class under the covers.</p>
<p>Parameters:</p>
<ul>
<li><code>pool_connections</code> – The number of urllib3 connection pools to cache.</li>
<li><code>pool_maxsize</code> – The maximum number of connections to save in the pool.</li>
<li><code>max_retries(int)</code> – The maximum number of retries each connection should attempt. Note, this applies only to failed DNS lookups, socket connections and connection timeouts, never to requests where data has made it to the server. By default, Requests does not retry failed connections. If you need granular control over the conditions under which we retry a request, import urllib3’s Retry class and pass that instead.</li>
<li><code>pool_block</code> – Whether the connection pool should block for connections. Usage:</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; <span class="keyword">import</span> requests</span><br><span class="line">&gt;&gt; s = requests.Session()</span><br><span class="line">&gt;&gt; a = requests.adapters.HTTPAdapter(max_retries=<span class="number">3</span>)</span><br><span class="line">&gt;&gt; s.mount(<span class="string">'http://'</span>, a)</span><br></pre></td></tr></table></figure>
</blockquote>
<p>如果上面的文档使你迷惑，这里是我的解释: HTTP Adapter 所做的就是：根据不同的目标url，对每个不同的请求提供不同的配置，还记得上面的代码吗？</p>
<p>　　　　what HTTP Adapter does is simply <strong>providing different configurations for different requests according to target url</strong>. Remember the code above?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">self.mount(<span class="string">'https://'</span>, HTTPAdapter())</span><br><span class="line">self.mount(<span class="string">'http://'</span>, HTTPAdapter())</span><br></pre></td></tr></table></figure>

<p>它创建了俩个 <code>HTTPAdapter</code> 对象使用默认的参数：<code>pool_connections=10, pool_maxsize=10, max_retries=0, pool_block=False</code>, 并且挂载到 <code>https://</code> 和 <code>http:// 相对路径</code>, 意思是第一个配置在你访问 <code>http://xxx 会使用到， 第二个会在你访问 ``https://xxx</code>. 尽管上面俩个配置是相同的，请求http和https仍然是隔离的。我们会在下面看到说明。</p>
<p>就像我说的，这篇文章的目的主要是解释 <code>pool_connections</code> and <code>pool_maxsize</code>.</p>
<p>首先，让我们看看 <code>pool_connections</code>. 昨天我在stackoverflow提出了一个问题：<a href="http://stackoverflow.com/questions/34837026/whats-the-meaning-of-pool-connections-in-requests-adapters-httpadapter" target="_blank" rel="noopener">question</a> ，因为我不确定我是否理解正确，这个问题的回答消除了我的不确定性。HTTP，众所周知，是基于TCP协议，一个HTTP连接也是一个TCP连接，它是由一个五元组唯一标识:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&lt;protocol&gt;, &lt;src addr&gt;, &lt;src port&gt;, &lt;dest addr&gt;, &lt;dest port&gt;)</span><br></pre></td></tr></table></figure>

<p>就是说，你针对 <code>www.example.com 建立了一个HTTP/TCP连接</code>, 假设服务器支持 <code>Keep-Alive</code>, 下一次你发送请求到 <code>www.example.com/a</code> or <code>www.example.com/b</code>, 你可以使用相同的连接，因为五元组没有改变. 实际上, <a href="http://docs.python-requests.org/en/latest/user/advanced/#keep-alive" target="_blank" rel="noopener">requests’ Session 自动会帮你处理</a> 并且重用连接，只要它能.</p>
<p>这个问题是，什么决定了你是否可以重用老的连接？是的，就是 <code>pool_connections</code>!</p>
<blockquote>
<p>pool_connections – The number of urllib3 connection pools to cache.</p>
</blockquote>
<p>我知道，我知道，我也不想引入很多术语, 这是最后一个，我发誓. 简单的理解它， 一个host对应的一个连接池：<strong>one connection pool corresponds to one host</strong>, 嗯，就是这个意思.</p>
<p>这是一个例子，无关的行已被忽略:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line">s.mount(<span class="string">'https://'</span>, HTTPAdapter(pool_connections=1))</span><br><span class="line">s.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">s.get(<span class="string">'https://www.zhihu.com'</span>)</span><br><span class="line">s.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">""</span><span class="string">"output</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.baidu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 None</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.zhihu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 2621</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.baidu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 None</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br></pre></td></tr></table></figure>

<p><code>HTTPAdapter(pool_connections=1)</code> 被映射到 <code>https://</code>, 他意思是在同一时间仅有一个连接池. 在调用 <code>s.get(&#39;https://www.baidu.com&#39;)</code>, 缓存的连接池是 <code>connectionpool(&#39;https://www.baidu.com&#39;)</code>. 现在 <code>s.get(&#39;https://www.zhihu.com&#39;)</code> 来了，这个session发现他不能使用缓存的连接，因为他不是相同的host(one connection pool corresponds to one host, remember?). 因此session不得不创建一个新的连接池. 因为 <code>pool_connections=1</code>, session不能在同一时间持有俩个连接池, 因此他丢弃了旧的连接池： <code>connectionpool(&#39;https://www.baidu.com&#39;)</code> 并且保存了新的：<code>connectionpool(&#39;https://www.zhihu.com&#39;)</code>. 下一次get同样如此Next <code>get</code> is the same. 这就是我们看见三个 <code>Starting new HTTPS connection</code> 日志行的原因</p>
<p>如果我们设置 <code>pool_connections</code> 为 2:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line">s.mount(<span class="string">'https://'</span>, HTTPAdapter(pool_connections=2))</span><br><span class="line">s.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">s.get(<span class="string">'https://www.zhihu.com'</span>)</span><br><span class="line">s.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line"><span class="string">""</span><span class="string">"output</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.baidu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 None</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.zhihu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 2623</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 None</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br></pre></td></tr></table></figure>

<p>很好，现在我们可以创建连接俩次了并且保持连接活跃</p>
<p>最后, <code>pool_maxsize</code>.</p>
<p>首先, 仅当你在多线程环境下使用session，你才应该关心 <code>pool_maxsize</code> , 例如，从多个线程使用同一个session发出并发请求.</p>
<p>实际上，<code>pool_maxsize</code> 是一个用来初始化urllib3’s <code>HTTPConnectionPool的参数</code>, 它才是真正含义上的连接池. <code>HTTPConnectionPool</code> 是一个容器，针对于特定的host保存连接的集合, 且 <code>pool_maxsize</code> 是这个集合的最大值. 如果你运行你的代码在同一个线程，它是不可能针对多个主机创建多个连接的，因为 requests library 是阻塞的, 因此HTTP请求总是一个接着一个发送.</p>
<p>如果使用多线程就会不一样.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">def thread_get(url):</span><br><span class="line">    s.get(url)</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line">s.mount(<span class="string">'https://'</span>, HTTPAdapter(pool_connections=1, pool_maxsize=2))</span><br><span class="line">t1 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com'</span>,))</span><br><span class="line">t2 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/36612174'</span>,))</span><br><span class="line">t1.start();t2.start()</span><br><span class="line">t1.join();t2.join()</span><br><span class="line">t3 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/39420364'</span>,))</span><br><span class="line">t4 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/21362402'</span>,))</span><br><span class="line">t3.start();t4.start()</span><br><span class="line"><span class="string">""</span><span class="string">"output</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.zhihu.com</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (2): www.zhihu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/36612174 HTTP/1.1<span class="string">" 200 21906</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 2606</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/21362402 HTTP/1.1<span class="string">" 200 57556</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/39420364 HTTP/1.1<span class="string">" 200 28739</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br></pre></td></tr></table></figure>

<p>看见了吗? 它为相同的host建立了俩个连接： <code>www.zhihu.com</code>, 就像我说的, 这个仅发生在多线程环境下. 在这个例子中，我们创建了一个连接池，使用了参数 <code>pool_maxsize=2</code>, 发现同一时间不会超过俩个连接，因此这是足够的，我们看到<code>t3</code> 和 <code>t4</code> 没有创建新的连接，他们重用了就的连接.</p>
<p>如果没有足够的大小呢?</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line">s.mount(<span class="string">'https://'</span>, HTTPAdapter(pool_connections=1, pool_maxsize=1))</span><br><span class="line">t1 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com'</span>,))</span><br><span class="line">t2 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/36612174'</span>,))</span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line">t1.join();t2.join()</span><br><span class="line">t3 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/39420364'</span>,))</span><br><span class="line">t4 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/21362402'</span>,))</span><br><span class="line">t3.start();t4.start()</span><br><span class="line">t3.join();t4.join()</span><br><span class="line"><span class="string">""</span><span class="string">"output</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.zhihu.com</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (2): www.zhihu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/36612174 HTTP/1.1<span class="string">" 200 21906</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 2606</span></span><br><span class="line"><span class="string">WARNING:requests.packages.urllib3.connectionpool:Connection pool is full, discarding connection: www.zhihu.com</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (3): www.zhihu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/39420364 HTTP/1.1<span class="string">" 200 28739</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/21362402 HTTP/1.1<span class="string">" 200 57556</span></span><br><span class="line"><span class="string">WARNING:requests.packages.urllib3.connectionpool:Connection pool is full, discarding connection: www.zhihu.com</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br></pre></td></tr></table></figure>

<p>现在, <code>pool_maxsize=1</code>，会打印警告日志如下，就像下面的:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Connection pool is full, discarding connection: www.zhihu.com</span><br></pre></td></tr></table></figure>

<p>可以注意到仅有一个连接被保存在连接池中, 为t3或者t4创建一个新的连接. 很明显这是不够的. 这就是为什么在 urllib3’s 文档中说明如下:</p>
<blockquote>
<p>如果你计划在连接池环境下使用一个连接池, 你应该设置连接池最大数量为一个比较高的值，例如和线程的数量相同.</p>
</blockquote>
<p>最后, <code>HTTPAdapter</code> 实例映射到不同的前缀是相互独立的.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line">s.mount(<span class="string">'https://'</span>, HTTPAdapter(pool_connections=1, pool_maxsize=2))</span><br><span class="line">s.mount(<span class="string">'https://baidu.com'</span>, HTTPAdapter(pool_connections=1, pool_maxsize=1))</span><br><span class="line">t1 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com'</span>,))</span><br><span class="line">t2 =Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/36612174'</span>,))</span><br><span class="line">t1.start();t2.start()</span><br><span class="line">t1.join();t2.join()</span><br><span class="line">t3 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/39420364'</span>,))</span><br><span class="line">t4 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/21362402'</span>,))</span><br><span class="line">t3.start();t4.start()</span><br><span class="line">t3.join();t4.join()</span><br><span class="line"><span class="string">""</span><span class="string">"output</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.zhihu.com</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (2): www.zhihu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/36612174 HTTP/1.1<span class="string">" 200 21906</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 2623</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/39420364 HTTP/1.1<span class="string">" 200 28739</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/21362402 HTTP/1.1<span class="string">" 200 57669</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br></pre></td></tr></table></figure>

<p>上面的代码很容易，不需要再次解释了.</p>
<p>就这样了，希望这篇文章帮助你更好的理解requests库. 顺便说一下，我创建了一个gist <a href="https://gist.github.com/laike9m/ead19c65a416c7022c00" target="_blank" rel="noopener">here</a> 这里包含这篇文章的测试代码. 随便下载并尝试吧</p>
<h2 id="Appendix"><a href="#Appendix" class="headerlink" title="Appendix"></a>Appendix</h2><ol>
<li><p>For https, requests uses urllib3’s <a href="http://urllib3.readthedocs.org/en/latest/pools.html#urllib3.connectionpool.HTTPSConnectionPool" target="_blank" rel="noopener">HTTPSConnectionPool</a>, but it’s pretty much the same as HTTPConnectionPool so I didn’t differeniate them in this article.</p>
</li>
<li><p><code>Session</code>‘s <code>mount</code> method ensures the longest prefix gets matched first. Its implementation is pretty interesting so I posted it here.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mount</span><span class="params">(self, prefix, adapter)</span>:</span></span><br><span class="line">    <span class="string">"""Registers a connection adapter to a prefix.</span></span><br><span class="line"><span class="string">    Adapters are sorted in descending order by key length."""</span></span><br><span class="line">    self.adapters[prefix] = adapter</span><br><span class="line">    keys_to_move = [k <span class="keyword">for</span> k <span class="keyword">in</span> self.adapters <span class="keyword">if</span> len(k) &lt; len(prefix)]</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> keys_to_move:</span><br><span class="line">        self.adapters[key] = self.adapters.pop(key)</span><br></pre></td></tr></table></figure>

<p>Note that <code>self.adapters</code> is an <code>OrderedDict</code>.</p>
</li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/05/03/LC/2019-05-03-Remove-Element/">LC/2019-05-03-Remove-Element</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-05-03</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><div class="content"><p>RemoveElement</p>
<p>​</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/01/15/Python/2019-01-15-property,%20setter%20&amp;%20getter/">Python/2019-01-15-property, setter &amp; getter</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-01-15</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Python/">Python</a></span><div class="content"><p>ref: <a href="https://medium.com/bryanyang0528/python-setter-和-getter-6c08a9d37d46" target="_blank" rel="noopener">https://medium.com/bryanyang0528/python-setter-%E5%92%8C-getter-6c08a9d37d46</a></p>
<p>简言之：</p>
<p>obj.attribute_1 可以拿到 物件的 attribute；但也易被改掉。<br>為了不讓使用者輕易能改掉 attribute, 所以以下滑線開頭的私有屬性，但這樣就無法無法被obj直接使用，得透過oop的set&amp;get方法。<br>為了讓它可以用一樣的語法被拿出使用，所以用 <code>property</code>，將method變成屬性在作使用；同時，為了讓它可以用一樣的語法被設值，所以用<code>setter</code>，將關鍵字加在要變成屬性化的method上面，然後在method裡面去改私有屬性。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/01/08/System-Design/2020-01-08-Redis%20Task%20Manager/">System-Design/2020-01-08-Redis Task Manager</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-01-08</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/SystemDesign/">SystemDesign</a></span><div class="content"><h3 id="taskwork-py"><a href="#taskwork-py" class="headerlink" title="taskwork.py"></a>taskwork.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">from</span> multiprocessing.managers <span class="keyword">import</span> BaseManager</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QueueManager</span><span class="params">(BaseManager)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">QueueManager.register(<span class="string">'get_task_queue'</span>)</span><br><span class="line">QueueManager.register(<span class="string">'get_result_queue'</span>)</span><br><span class="line"></span><br><span class="line">server_addr = <span class="string">'127.0.0.1'</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Connect to server %s...'</span> % server_addr</span><br><span class="line">m = QueueManager(address=(server_addr, <span class="number">5000</span>), authkey=<span class="string">'abc'</span>)</span><br><span class="line">m.connect()</span><br><span class="line"></span><br><span class="line">task = m.get_task_queue()</span><br><span class="line">result = m.get_result_queue()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        n = task.get(timeout=<span class="number">10</span>)</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"run task %d * %d"</span> % (n, n)</span><br><span class="line">        r = <span class="string">"%d * %d = %d"</span> % (n, n, n*n)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        result.put(r)</span><br><span class="line">    <span class="keyword">except</span> Queue.Empty:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"task queue is empty!"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"worker exit!"</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="taskmanager-py"><a href="#taskmanager-py" class="headerlink" title="taskmanager.py"></a>taskmanager.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">如果我们已经有一个通过Quene通信的多进程程序在同一台机器上运行，现在，由于处理</span></span><br><span class="line"><span class="string">任务的进程任务繁重，希望把发送任务的进程和处理任务的进程分布到两台机器上。怎么</span></span><br><span class="line"><span class="string">用分布式进程实现？</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">from</span> multiprocessing.managers <span class="keyword">import</span> BaseManager</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送任务的队列:</span></span><br><span class="line">task_queue = Queue.Queue()</span><br><span class="line"><span class="comment"># 接收结果的队列:</span></span><br><span class="line">result_queue = Queue.Queue()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QueueManager</span><span class="params">(BaseManager)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    从BaseManager继承的QueneManager</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把两个Queue都注册到网络上，callable参数关联了Queue对象</span></span><br><span class="line">QueueManager.register(<span class="string">'get_task_queue'</span>, callable=<span class="keyword">lambda</span>: task_queue)</span><br><span class="line">QueueManager.register(<span class="string">'get_result_queue'</span>, callable=<span class="keyword">lambda</span>: result_queue)</span><br><span class="line"><span class="comment"># 绑定端口5000,设置验证码'abc'</span></span><br><span class="line">manager = QueueManager(address=(<span class="string">''</span>, <span class="number">5000</span>), authkey=<span class="string">'abc'</span>)</span><br><span class="line"><span class="comment"># 启动Queue</span></span><br><span class="line">manager.start()</span><br><span class="line"><span class="comment"># 获得通过网络访问的Queue对象</span></span><br><span class="line">task = manager.get_task_queue()</span><br><span class="line">result = manager.get_result_queue()</span><br><span class="line"></span><br><span class="line"><span class="comment"># producer</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    n = random.randint(<span class="number">0</span>, <span class="number">10000</span>)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Put task %d..."</span> % n</span><br><span class="line">    task.put(n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"Try get results..."</span></span><br><span class="line"><span class="comment"># worker</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    r = result.get(timeout=<span class="number">20</span>)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Result: %s"</span> % r</span><br><span class="line"></span><br><span class="line">manager.shutdown()</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/12/25/DevOps/2018-12-28-Redis%20Note/">DevOps/2018-12-28-Redis Note</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-12-25</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Python/">Python</a></span><div class="content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(joe_py36) ~ » redis-server /usr/<span class="built_in">local</span>/etc/redis.conf</span><br></pre></td></tr></table></figure>



<h3 id="Select-collection"><a href="#Select-collection" class="headerlink" title="Select collection"></a>Select collection</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli</span><br><span class="line">127.0.0.1:6379&gt; select 0</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>



<h3 id="prevent-Chinese-error-codes"><a href="#prevent-Chinese-error-codes" class="headerlink" title="prevent Chinese error codes"></a>prevent Chinese error codes</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --raw</span><br></pre></td></tr></table></figure>



<h3 id="Dict"><a href="#Dict" class="headerlink" title="Dict"></a>Dict</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; SET runoobkey redis</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; DEL runoobkey</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>



<h3 id=""><a href="#" class="headerlink" title=""></a></h3></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/12/25/LC/2020-1-1-Turtle_ing/">LC/2020-1-1-Turtle_ing</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-12-25</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Tur/">Tur</a></span><div class="content"><p>leetcode 84, 85, larget rectangle area</p>
<p>leetcode 1055 shortest way to form string</p>
<p>leetcode isPalindrome</p>
<p><a href="http://nataliekung.gitbook.io/ladder_code" target="_blank" rel="noopener">http://nataliekung.gitbook.io/ladder_code</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/12/20/DevOps/2018-12-20-Faster%20RCNN%20(Caffe)/">DevOps/2018-12-20-Faster RCNN (Caffe)</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-12-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/AI/">AI</a></span><div class="content"><h3 id="Faster-RCNN"><a href="#Faster-RCNN" class="headerlink" title="Faster RCNN"></a>Faster RCNN</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g98751x2waj30u0114juk.jpg" alt="image-20191123192705661"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g9875mkolxj30u00z70x2.jpg" alt="image-20191123192741508"></p>
<h4 id="prototxt"><a href="#prototxt" class="headerlink" title=".prototxt"></a>.prototxt</h4><p>(<a href="https://raw.githubusercontent.com/rbgirshick/py-faster-rcnn/master/models/pascal_voc/VGG16/faster_rcnn_end2end/test.prototxt" target="_blank" rel="noopener">https://raw.githubusercontent.com/rbgirshick/py-faster-rcnn/master/models/pascal_voc/VGG16/faster_rcnn_end2end/test.prototxt</a>) </p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g9898kj283j31m00k6jw4.jpg" alt="image-20191123203941972"></p>
<h5 id="netscope"><a href="#netscope" class="headerlink" title="netscope:"></a>netscope:</h5><p><a href="https://ethereon.github.io/netscope/#/editor" target="_blank" rel="noopener">https://ethereon.github.io/netscope/#/editor</a></p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br></pre></td><td class="code"><pre><span class="line">name: <span class="string">"VGG_ILSVRC_16_layers"</span></span><br><span class="line"></span><br><span class="line">input: <span class="string">"data"</span></span><br><span class="line">input_shape &#123;</span><br><span class="line">  dim: <span class="number">1</span></span><br><span class="line">  dim: <span class="number">3</span></span><br><span class="line">  dim: <span class="number">224</span></span><br><span class="line">  dim: <span class="number">224</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">input: <span class="string">"im_info"</span></span><br><span class="line">input_shape &#123;</span><br><span class="line">  dim: <span class="number">1</span></span><br><span class="line">  dim: <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"conv1_1"</span></span><br><span class="line">  type: <span class="string">"Convolution"</span></span><br><span class="line">  bottom: <span class="string">"data"</span></span><br><span class="line">  top: <span class="string">"conv1_1"</span></span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">0</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">0</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  convolution_param &#123;</span><br><span class="line">    num_output: <span class="number">64</span></span><br><span class="line">    pad: <span class="number">1</span></span><br><span class="line">    kernel_size: <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"relu1_1"</span></span><br><span class="line">  type: <span class="string">"ReLU"</span></span><br><span class="line">  bottom: <span class="string">"conv1_1"</span></span><br><span class="line">  top: <span class="string">"conv1_1"</span></span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"conv1_2"</span></span><br><span class="line">  type: <span class="string">"Convolution"</span></span><br><span class="line">  bottom: <span class="string">"conv1_1"</span></span><br><span class="line">  top: <span class="string">"conv1_2"</span></span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">0</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">0</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  convolution_param &#123;</span><br><span class="line">    num_output: <span class="number">64</span></span><br><span class="line">    pad: <span class="number">1</span></span><br><span class="line">    kernel_size: <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"relu1_2"</span></span><br><span class="line">  type: <span class="string">"ReLU"</span></span><br><span class="line">  bottom: <span class="string">"conv1_2"</span></span><br><span class="line">  top: <span class="string">"conv1_2"</span></span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"pool1"</span></span><br><span class="line">  type: <span class="string">"Pooling"</span></span><br><span class="line">  bottom: <span class="string">"conv1_2"</span></span><br><span class="line">  top: <span class="string">"pool1"</span></span><br><span class="line">  pooling_param &#123;</span><br><span class="line">    pool: MAX</span><br><span class="line">    kernel_size: <span class="number">2</span></span><br><span class="line">    stride: <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"conv2_1"</span></span><br><span class="line">  type: <span class="string">"Convolution"</span></span><br><span class="line">  bottom: <span class="string">"pool1"</span></span><br><span class="line">  top: <span class="string">"conv2_1"</span></span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">0</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">0</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  convolution_param &#123;</span><br><span class="line">    num_output: <span class="number">128</span></span><br><span class="line">    pad: <span class="number">1</span></span><br><span class="line">    kernel_size: <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"relu2_1"</span></span><br><span class="line">  type: <span class="string">"ReLU"</span></span><br><span class="line">  bottom: <span class="string">"conv2_1"</span></span><br><span class="line">  top: <span class="string">"conv2_1"</span></span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"conv2_2"</span></span><br><span class="line">  type: <span class="string">"Convolution"</span></span><br><span class="line">  bottom: <span class="string">"conv2_1"</span></span><br><span class="line">  top: <span class="string">"conv2_2"</span></span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">0</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">0</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  convolution_param &#123;</span><br><span class="line">    num_output: <span class="number">128</span></span><br><span class="line">    pad: <span class="number">1</span></span><br><span class="line">    kernel_size: <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"relu2_2"</span></span><br><span class="line">  type: <span class="string">"ReLU"</span></span><br><span class="line">  bottom: <span class="string">"conv2_2"</span></span><br><span class="line">  top: <span class="string">"conv2_2"</span></span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"pool2"</span></span><br><span class="line">  type: <span class="string">"Pooling"</span></span><br><span class="line">  bottom: <span class="string">"conv2_2"</span></span><br><span class="line">  top: <span class="string">"pool2"</span></span><br><span class="line">  pooling_param &#123;</span><br><span class="line">    pool: MAX</span><br><span class="line">    kernel_size: <span class="number">2</span></span><br><span class="line">    stride: <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"conv3_1"</span></span><br><span class="line">  type: <span class="string">"Convolution"</span></span><br><span class="line">  bottom: <span class="string">"pool2"</span></span><br><span class="line">  top: <span class="string">"conv3_1"</span></span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">1</span></span><br><span class="line">    decay_mult: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">2</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  convolution_param &#123;</span><br><span class="line">    num_output: <span class="number">256</span></span><br><span class="line">    pad: <span class="number">1</span></span><br><span class="line">    kernel_size: <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"relu3_1"</span></span><br><span class="line">  type: <span class="string">"ReLU"</span></span><br><span class="line">  bottom: <span class="string">"conv3_1"</span></span><br><span class="line">  top: <span class="string">"conv3_1"</span></span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"conv3_2"</span></span><br><span class="line">  type: <span class="string">"Convolution"</span></span><br><span class="line">  bottom: <span class="string">"conv3_1"</span></span><br><span class="line">  top: <span class="string">"conv3_2"</span></span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">1</span></span><br><span class="line">    decay_mult: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">2</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  convolution_param &#123;</span><br><span class="line">    num_output: <span class="number">256</span></span><br><span class="line">    pad: <span class="number">1</span></span><br><span class="line">    kernel_size: <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"relu3_2"</span></span><br><span class="line">  type: <span class="string">"ReLU"</span></span><br><span class="line">  bottom: <span class="string">"conv3_2"</span></span><br><span class="line">  top: <span class="string">"conv3_2"</span></span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"conv3_3"</span></span><br><span class="line">  type: <span class="string">"Convolution"</span></span><br><span class="line">  bottom: <span class="string">"conv3_2"</span></span><br><span class="line">  top: <span class="string">"conv3_3"</span></span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">1</span></span><br><span class="line">    decay_mult: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">2</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  convolution_param &#123;</span><br><span class="line">    num_output: <span class="number">256</span></span><br><span class="line">    pad: <span class="number">1</span></span><br><span class="line">    kernel_size: <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"relu3_3"</span></span><br><span class="line">  type: <span class="string">"ReLU"</span></span><br><span class="line">  bottom: <span class="string">"conv3_3"</span></span><br><span class="line">  top: <span class="string">"conv3_3"</span></span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"pool3"</span></span><br><span class="line">  type: <span class="string">"Pooling"</span></span><br><span class="line">  bottom: <span class="string">"conv3_3"</span></span><br><span class="line">  top: <span class="string">"pool3"</span></span><br><span class="line">  pooling_param &#123;</span><br><span class="line">    pool: MAX</span><br><span class="line">    kernel_size: <span class="number">2</span></span><br><span class="line">    stride: <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"conv4_1"</span></span><br><span class="line">  type: <span class="string">"Convolution"</span></span><br><span class="line">  bottom: <span class="string">"pool3"</span></span><br><span class="line">  top: <span class="string">"conv4_1"</span></span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">1</span></span><br><span class="line">    decay_mult: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">2</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  convolution_param &#123;</span><br><span class="line">    num_output: <span class="number">512</span></span><br><span class="line">    pad: <span class="number">1</span></span><br><span class="line">    kernel_size: <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"relu4_1"</span></span><br><span class="line">  type: <span class="string">"ReLU"</span></span><br><span class="line">  bottom: <span class="string">"conv4_1"</span></span><br><span class="line">  top: <span class="string">"conv4_1"</span></span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"conv4_2"</span></span><br><span class="line">  type: <span class="string">"Convolution"</span></span><br><span class="line">  bottom: <span class="string">"conv4_1"</span></span><br><span class="line">  top: <span class="string">"conv4_2"</span></span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">1</span></span><br><span class="line">    decay_mult: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">2</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  convolution_param &#123;</span><br><span class="line">    num_output: <span class="number">512</span></span><br><span class="line">    pad: <span class="number">1</span></span><br><span class="line">    kernel_size: <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"relu4_2"</span></span><br><span class="line">  type: <span class="string">"ReLU"</span></span><br><span class="line">  bottom: <span class="string">"conv4_2"</span></span><br><span class="line">  top: <span class="string">"conv4_2"</span></span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"conv4_3"</span></span><br><span class="line">  type: <span class="string">"Convolution"</span></span><br><span class="line">  bottom: <span class="string">"conv4_2"</span></span><br><span class="line">  top: <span class="string">"conv4_3"</span></span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">1</span></span><br><span class="line">    decay_mult: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">2</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  convolution_param &#123;</span><br><span class="line">    num_output: <span class="number">512</span></span><br><span class="line">    pad: <span class="number">1</span></span><br><span class="line">    kernel_size: <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"relu4_3"</span></span><br><span class="line">  type: <span class="string">"ReLU"</span></span><br><span class="line">  bottom: <span class="string">"conv4_3"</span></span><br><span class="line">  top: <span class="string">"conv4_3"</span></span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"pool4"</span></span><br><span class="line">  type: <span class="string">"Pooling"</span></span><br><span class="line">  bottom: <span class="string">"conv4_3"</span></span><br><span class="line">  top: <span class="string">"pool4"</span></span><br><span class="line">  pooling_param &#123;</span><br><span class="line">    pool: MAX</span><br><span class="line">    kernel_size: <span class="number">2</span></span><br><span class="line">    stride: <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"conv5_1"</span></span><br><span class="line">  type: <span class="string">"Convolution"</span></span><br><span class="line">  bottom: <span class="string">"pool4"</span></span><br><span class="line">  top: <span class="string">"conv5_1"</span></span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">1</span></span><br><span class="line">    decay_mult: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">2</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  convolution_param &#123;</span><br><span class="line">    num_output: <span class="number">512</span></span><br><span class="line">    pad: <span class="number">1</span></span><br><span class="line">    kernel_size: <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"relu5_1"</span></span><br><span class="line">  type: <span class="string">"ReLU"</span></span><br><span class="line">  bottom: <span class="string">"conv5_1"</span></span><br><span class="line">  top: <span class="string">"conv5_1"</span></span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"conv5_2"</span></span><br><span class="line">  type: <span class="string">"Convolution"</span></span><br><span class="line">  bottom: <span class="string">"conv5_1"</span></span><br><span class="line">  top: <span class="string">"conv5_2"</span></span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">1</span></span><br><span class="line">    decay_mult: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">2</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  convolution_param &#123;</span><br><span class="line">    num_output: <span class="number">512</span></span><br><span class="line">    pad: <span class="number">1</span></span><br><span class="line">    kernel_size: <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"relu5_2"</span></span><br><span class="line">  type: <span class="string">"ReLU"</span></span><br><span class="line">  bottom: <span class="string">"conv5_2"</span></span><br><span class="line">  top: <span class="string">"conv5_2"</span></span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"conv5_3"</span></span><br><span class="line">  type: <span class="string">"Convolution"</span></span><br><span class="line">  bottom: <span class="string">"conv5_2"</span></span><br><span class="line">  top: <span class="string">"conv5_3"</span></span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">1</span></span><br><span class="line">    decay_mult: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">2</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  convolution_param &#123;</span><br><span class="line">    num_output: <span class="number">512</span></span><br><span class="line">    pad: <span class="number">1</span></span><br><span class="line">    kernel_size: <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"relu5_3"</span></span><br><span class="line">  type: <span class="string">"ReLU"</span></span><br><span class="line">  bottom: <span class="string">"conv5_3"</span></span><br><span class="line">  top: <span class="string">"conv5_3"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#========= RPN ============</span><br><span class="line"></span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"rpn_conv/3x3"</span></span><br><span class="line">  type: <span class="string">"Convolution"</span></span><br><span class="line">  bottom: <span class="string">"conv5_3"</span></span><br><span class="line">  top: <span class="string">"rpn/output"</span></span><br><span class="line">  param &#123; lr_mult: <span class="number">1.0</span> decay_mult: <span class="number">1.0</span> &#125;</span><br><span class="line">  param &#123; lr_mult: <span class="number">2.0</span> decay_mult: <span class="number">0</span> &#125;</span><br><span class="line">  convolution_param &#123;</span><br><span class="line">    num_output: <span class="number">512</span></span><br><span class="line">    kernel_size: <span class="number">3</span> pad: <span class="number">1</span> stride: <span class="number">1</span></span><br><span class="line">    weight_filler &#123; type: <span class="string">"gaussian"</span> std: <span class="number">0.01</span> &#125;</span><br><span class="line">    bias_filler &#123; type: <span class="string">"constant"</span> value: <span class="number">0</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"rpn_relu/3x3"</span></span><br><span class="line">  type: <span class="string">"ReLU"</span></span><br><span class="line">  bottom: <span class="string">"rpn/output"</span></span><br><span class="line">  top: <span class="string">"rpn/output"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"rpn_cls_score"</span></span><br><span class="line">  type: <span class="string">"Convolution"</span></span><br><span class="line">  bottom: <span class="string">"rpn/output"</span></span><br><span class="line">  top: <span class="string">"rpn_cls_score"</span></span><br><span class="line">  param &#123; lr_mult: <span class="number">1.0</span> decay_mult: <span class="number">1.0</span> &#125;</span><br><span class="line">  param &#123; lr_mult: <span class="number">2.0</span> decay_mult: <span class="number">0</span> &#125;</span><br><span class="line">  convolution_param &#123;</span><br><span class="line">    num_output: <span class="number">18</span>   # <span class="number">2</span>(bg/fg) * <span class="number">9</span>(anchors)</span><br><span class="line">    kernel_size: <span class="number">1</span> pad: <span class="number">0</span> stride: <span class="number">1</span></span><br><span class="line">    weight_filler &#123; type: <span class="string">"gaussian"</span> std: <span class="number">0.01</span> &#125;</span><br><span class="line">    bias_filler &#123; type: <span class="string">"constant"</span> value: <span class="number">0</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"rpn_bbox_pred"</span></span><br><span class="line">  type: <span class="string">"Convolution"</span></span><br><span class="line">  bottom: <span class="string">"rpn/output"</span></span><br><span class="line">  top: <span class="string">"rpn_bbox_pred"</span></span><br><span class="line">  param &#123; lr_mult: <span class="number">1.0</span> decay_mult: <span class="number">1.0</span> &#125;</span><br><span class="line">  param &#123; lr_mult: <span class="number">2.0</span> decay_mult: <span class="number">0</span> &#125;</span><br><span class="line">  convolution_param &#123;</span><br><span class="line">    num_output: <span class="number">36</span>   # <span class="number">4</span> * <span class="number">9</span>(anchors)</span><br><span class="line">    kernel_size: <span class="number">1</span> pad: <span class="number">0</span> stride: <span class="number">1</span></span><br><span class="line">    weight_filler &#123; type: <span class="string">"gaussian"</span> std: <span class="number">0.01</span> &#125;</span><br><span class="line">    bias_filler &#123; type: <span class="string">"constant"</span> value: <span class="number">0</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">   bottom: <span class="string">"rpn_cls_score"</span></span><br><span class="line">   top: <span class="string">"rpn_cls_score_reshape"</span></span><br><span class="line">   name: <span class="string">"rpn_cls_score_reshape"</span></span><br><span class="line">   type: <span class="string">"Reshape"</span></span><br><span class="line">   reshape_param &#123; shape &#123; dim: <span class="number">0</span> dim: <span class="number">2</span> dim: -<span class="number">1</span> dim: <span class="number">0</span> &#125; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#========= RoI Proposal ============</span><br><span class="line"></span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"rpn_cls_prob"</span></span><br><span class="line">  type: <span class="string">"Softmax"</span></span><br><span class="line">  bottom: <span class="string">"rpn_cls_score_reshape"</span></span><br><span class="line">  top: <span class="string">"rpn_cls_prob"</span></span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: 'rpn_cls_prob_reshape'</span><br><span class="line">  type: 'Reshape'</span><br><span class="line">  bottom: 'rpn_cls_prob'</span><br><span class="line">  top: 'rpn_cls_prob_reshape'</span><br><span class="line">  reshape_param &#123; shape &#123; dim: <span class="number">0</span> dim: <span class="number">18</span> dim: -<span class="number">1</span> dim: <span class="number">0</span> &#125; &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: 'proposal'</span><br><span class="line">  type: 'Python'</span><br><span class="line">  bottom: 'rpn_cls_prob_reshape'</span><br><span class="line">  bottom: 'rpn_bbox_pred'</span><br><span class="line">  bottom: 'im_info'</span><br><span class="line">  top: 'rois'</span><br><span class="line">  python_param &#123;</span><br><span class="line">    module: 'rpn.proposal_layer'</span><br><span class="line">    layer: 'ProposalLayer'</span><br><span class="line">    param_str: <span class="string">"'feat_stride': 16"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#========= RCNN ============</span><br><span class="line"></span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"roi_pool5"</span></span><br><span class="line">  type: <span class="string">"ROIPooling"</span></span><br><span class="line">  bottom: <span class="string">"conv5_3"</span></span><br><span class="line">  bottom: <span class="string">"rois"</span></span><br><span class="line">  top: <span class="string">"pool5"</span></span><br><span class="line">  roi_pooling_param &#123;</span><br><span class="line">    pooled_w: <span class="number">7</span></span><br><span class="line">    pooled_h: <span class="number">7</span></span><br><span class="line">    spatial_scale: <span class="number">0.0625</span> # <span class="number">1</span>/<span class="number">16</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"fc6"</span></span><br><span class="line">  type: <span class="string">"InnerProduct"</span></span><br><span class="line">  bottom: <span class="string">"pool5"</span></span><br><span class="line">  top: <span class="string">"fc6"</span></span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">1</span></span><br><span class="line">    decay_mult: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">2</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  inner_product_param &#123;</span><br><span class="line">    num_output: <span class="number">4096</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"relu6"</span></span><br><span class="line">  type: <span class="string">"ReLU"</span></span><br><span class="line">  bottom: <span class="string">"fc6"</span></span><br><span class="line">  top: <span class="string">"fc6"</span></span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"drop6"</span></span><br><span class="line">  type: <span class="string">"Dropout"</span></span><br><span class="line">  bottom: <span class="string">"fc6"</span></span><br><span class="line">  top: <span class="string">"fc6"</span></span><br><span class="line">  dropout_param &#123;</span><br><span class="line">    dropout_ratio: <span class="number">0.5</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"fc7"</span></span><br><span class="line">  type: <span class="string">"InnerProduct"</span></span><br><span class="line">  bottom: <span class="string">"fc6"</span></span><br><span class="line">  top: <span class="string">"fc7"</span></span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">1</span></span><br><span class="line">    decay_mult: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">2</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  inner_product_param &#123;</span><br><span class="line">    num_output: <span class="number">4096</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"relu7"</span></span><br><span class="line">  type: <span class="string">"ReLU"</span></span><br><span class="line">  bottom: <span class="string">"fc7"</span></span><br><span class="line">  top: <span class="string">"fc7"</span></span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"drop7"</span></span><br><span class="line">  type: <span class="string">"Dropout"</span></span><br><span class="line">  bottom: <span class="string">"fc7"</span></span><br><span class="line">  top: <span class="string">"fc7"</span></span><br><span class="line">  dropout_param &#123;</span><br><span class="line">    dropout_ratio: <span class="number">0.5</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"cls_score"</span></span><br><span class="line">  type: <span class="string">"InnerProduct"</span></span><br><span class="line">  bottom: <span class="string">"fc7"</span></span><br><span class="line">  top: <span class="string">"cls_score"</span></span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">1</span></span><br><span class="line">    decay_mult: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">2</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  inner_product_param &#123;</span><br><span class="line">    num_output: <span class="number">21</span></span><br><span class="line">    weight_filler &#123;</span><br><span class="line">      type: <span class="string">"gaussian"</span></span><br><span class="line">      std: <span class="number">0.01</span></span><br><span class="line">    &#125;</span><br><span class="line">    bias_filler &#123;</span><br><span class="line">      type: <span class="string">"constant"</span></span><br><span class="line">      value: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"bbox_pred"</span></span><br><span class="line">  type: <span class="string">"InnerProduct"</span></span><br><span class="line">  bottom: <span class="string">"fc7"</span></span><br><span class="line">  top: <span class="string">"bbox_pred"</span></span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">1</span></span><br><span class="line">    decay_mult: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: <span class="number">2</span></span><br><span class="line">    decay_mult: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  inner_product_param &#123;</span><br><span class="line">    num_output: <span class="number">84</span></span><br><span class="line">    weight_filler &#123;</span><br><span class="line">      type: <span class="string">"gaussian"</span></span><br><span class="line">      std: <span class="number">0.001</span></span><br><span class="line">    &#125;</span><br><span class="line">    bias_filler &#123;</span><br><span class="line">      type: <span class="string">"constant"</span></span><br><span class="line">      value: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"cls_prob"</span></span><br><span class="line">  type: <span class="string">"Softmax"</span></span><br><span class="line">  bottom: <span class="string">"cls_score"</span></span><br><span class="line">  top: <span class="string">"cls_prob"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/12/12/Python/2018-12-12-MongoDB%20MapReduce/">Python/2018-12-12-MongoDB MapReduce</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-12-12</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Web/">Web</a></span><div class="content"><p>Ref: <a href="https://www.runoob.com/mongodb/mongodb-map-reduce.html" target="_blank" rel="noopener">https://www.runoob.com/mongodb/mongodb-map-reduce.html</a></p>
<p>Map-Reduce是一种计算模型，简单的说就是将大批量的工作（数据）分解（MAP）执行，然后再将结果合并成最终结果（REDUCE）。</p>
<p>MongoDB提供的Map-Reduce非常灵活，对于大规模数据分析也相当实用。</p>
<h3 id="MapReduce-命令"><a href="#MapReduce-命令" class="headerlink" title="MapReduce 命令"></a>MapReduce 命令</h3><p>以下是MapReduce的基本语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.collection.mapReduce(</span><br><span class="line">   function() &#123;emit(key,value);&#125;,  &#x2F;&#x2F;map 函数</span><br><span class="line">   function(key,values) &#123;return reduceFunction&#125;,   &#x2F;&#x2F;reduce 函数</span><br><span class="line">   &#123;</span><br><span class="line">      out: collection,</span><br><span class="line">      query: document,</span><br><span class="line">      sort: document,</span><br><span class="line">      limit: number</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>使用 MapReduce 要实现两个函数 Map 函数和 Reduce 函数,Map 函数调用 emit(key, value), 遍历 collection 中所有的记录, 将 key 与 value 传递给 Reduce 函数进行处理。</p>
<p>Map 函数必须调用 emit(key, value) 返回键值对。</p>
<p>参数说明:</p>
<ul>
<li><strong>map</strong> ：映射函数 (生成键值对序列,作为 reduce 函数参数)。</li>
<li><strong>reduce</strong> 统计函数，reduce函数的任务就是将key-values变成key-value，也就是把values数组变成一个单一的值value。。</li>
<li><strong>out</strong> 统计结果存放集合 (不指定则使用临时集合,在客户端断开后自动删除)。</li>
<li><strong>query</strong> 一个筛选条件，只有满足条件的文档才会调用map函数。（query。limit，sort可以随意组合）</li>
<li><strong>sort</strong> 和limit结合的sort排序参数（也是在发往map函数前给文档排序），可以优化分组机制</li>
<li><strong>limit</strong> 发往map函数的文档数量的上限（要是没有limit，单独使用sort的用处不大）</li>
</ul>
<p>以下实例在集合 orders 中查找 status:”A” 的数据，并根据 cust_id 来分组，并计算 amount 的总和。</p>
<p><img src="https://static.runoob.com/images/map-reduce.bakedsvg.svg" alt="map-reduce.bakedsvg"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/12/12/Python/2018-12-12-ODM%20&amp;%20ORM/">Python/2018-12-12-ODM &amp; ORM</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-12-12</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Web/">Web</a></span><div class="content"><p>Ref All: <a href="https://medium.com/@julianam.tyler/what-is-the-difference-between-odm-and-orm-267bbb7778b0" target="_blank" rel="noopener">https://medium.com/@julianam.tyler/what-is-the-difference-between-odm-and-orm-267bbb7778b0</a></p>
<p>“</p>
<p>When you first learn how to work with database, it all comes down to two types of database set ups which are ORM (object Relation Mapping) and ODM (Object Document Mapping)</p>
<p>ORM which is to map an object with a relational world, it basically converts data between incompatible types in object oriented programming languages. ORM wraps the implementation specific details of storage drivers in an API (application program interface), and maps the relational fields to an object members. For example if I have a table of employees, it is mapped to a single object for all employees, with various methods associated with it.</p>
<p>ODM on the other hand is an Object Document Mapper, which maps objects with a Document Database like MongoDB.</p>
<p>The main difference is that ORM is for MySQL databases, while ODM does the mapping for document representation of data.<br>best way to remember what ORM does would be to think of it as an excel spread sheet, with rows and columns. When using this set up, you want to be sure you have a great plan on how you want to tackle the current application, it does not allow as many modifications like ODM does. With ODM we can add new fields and properties easily but with ORM when adding a new field you need to keep in mind that nothing stays empty so it needs a value to be as default unless you want to go into each and modify.</p>
<p>“”</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/12/11/CVs/2018-12-11-Baysian%20&amp;%20Conditional%20Prob/">CVs/2018-12-11-Baysian &amp; Conditional Prob</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-12-11</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Probability/">Probability</a></span><div class="content"><h3 id="Baysian"><a href="#Baysian" class="headerlink" title="Baysian"></a>Baysian</h3><p>$$<br>P(A|C) = \frac{P(A\cap C)}{P(C)},<br>P(C|A) = \frac{P(A\cap C)}{P(A)}   \<br>Thus, P(A|C) = \frac{P(C|A) * P(A)}{P(C)}<br>$$</p>
<h3 id="Independent"><a href="#Independent" class="headerlink" title="Independent"></a>Independent</h3><p>$$<br>P(A|C) = \frac{P(A\cap C)}{P(C)}=\frac{P(A)<em>P(C)}{P(C)}=P(A) \<br>P(C|A) = \frac{P(A\cap C)}{P(A)}=\frac{P(A)</em>P(C)}{P(A)}=P(C)   \<br>%Thus, P(A|C) = \frac{P(C|A) * P(A)}{P(C)}<br>$$</p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9s1bgefz3j30hs0ffabh.jpg" alt="v2-d331a465a66032ebc14b6f24feae2457_b"></p>
<ul>
<li>posterior probability</li>
<li>priori probability</li>
</ul>
<hr>
<p><strong>为什么朴素贝叶斯如此“朴素”？</strong></p>
<p>因为它假定所有的特征在数据集中的作用是同样重要和独立的。正如我们所知，这个假设在现实世界中是很不真实的，因此，说朴素贝叶斯真的很“朴素”。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/12/03/ML/2018-12-03-File%20Size%20Limitation/">ML/2018-12-03-File Size Limitation</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-12-03</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/DevOps/">DevOps</a></span><div class="content"><h3 id="File-size-limitation"><a href="#File-size-limitation" class="headerlink" title="File size limitation"></a>File size limitation</h3><h1 id=""><a href="#" class="headerlink" title=""></a></h1></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/11/30/Math/2018-11-30-Conditional%20Probability/">Math/2018-11-30-Conditional Probability</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-11-30</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Probability/">Probability</a></span><div class="content"><p>Ref: <a href="https://zhuanlan.zhihu.com/p/35976057" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/35976057</a></p>
<h2 id="事件的独立性"><a href="#事件的独立性" class="headerlink" title="事件的独立性"></a>事件的独立性</h2><p>根据定义，两个事件<em>A</em>和<em>B</em>是<em>独立的，</em>如果：</p>
<p><img src="https://pic4.zhimg.com/80/v2-024ebd7be22be3792d0eb85ee51e8453_hd.jpg" alt="img"></p>
<p>使用条件概率，我们可以提供一个稍微不同的定义。以来：</p>
<p><img src="https://pic1.zhimg.com/80/v2-92899762e2fa58123284becb28237144_hd.jpg" alt="img"></p>
<p>并且<em>P（A∩B）</em> = <em>P（A）P（B）</em>：</p>
<p><img src="https://pic3.zhimg.com/80/v2-3ed71d1794cce026ac70140049e6813e_hd.jpg" alt="img"></p>
<p>只要<em>P（B）</em> &gt; 0，对于独立的<em>A</em>和<em>B</em>，我们有<em>P（A | B）</em> = <em>P（A）</em> ; 换言之，<em>B</em> 不会以任何方式影响<em>A</em>的概率。同样，我们可以证明对于<em>P（A）</em> &gt; 0，我们有<em>P（B | A）</em> = <em>P（B）</em>。</p>
<p>独立也延伸到事件的补充。回想一下，<em>P（B ^ C）</em> 是<em>B</em>没有发生的概率，或1 - <em>P（B）</em> ; 由于条件概率服从通常的概率公理，我们有<em>P（B ^ C | A）</em> = 1 - <em>P（B | A）</em>。那么，如果<em>A</em>和<em>B</em>是独立的：</p>
<p><img src="https://pic4.zhimg.com/80/v2-b1171212d1b5d818d21fb9dda0a70a53_hd.jpg" alt="img"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/11/23/DevOps/2018-11-23-C++%20ReArrange/">DevOps/2018-11-23-C++ ReArrange</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-11-23</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/C/">C++</a></span><div class="content"><h3 id="1-cout-of-char"><a href="#1-cout-of-char" class="headerlink" title="1.  cout of char*"></a>1.  cout of <code>char*</code></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *str = <span class="string">"hellogogo"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *pstr = str;</span><br><span class="line">  <span class="built_in">cout</span> <span class="string">"The address of pstr is: "</span> &lt;&lt; pstr &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------</span><br><span class="line"> <span class="string">"The address of pstr is: hellogogo"</span></span><br></pre></td></tr></table></figure>



<h3 id="2-compiled-by-c-or-c"><a href="#2-compiled-by-c-or-c" class="headerlink" title="2. compiled by c or c++"></a>2. compiled by c or c++</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cpluscplu</span></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"cpp"</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">	print(<span class="string">"c"</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>



<h4 id="3-compiled-time-OP-symbol"><a href="#3-compiled-time-OP-symbol" class="headerlink" title="3. compiled time OP symbol"></a>3. compiled time OP symbol</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> id[<span class="keyword">sizeof</span>(<span class="keyword">unsigned</span> <span class="keyword">long</span>)];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Compiled OK, cuz sizeof is COMPILING time symbol, which is determined in compile, regarded as machine-dependent constant.</span></span><br></pre></td></tr></table></figure>



<h3 id="4"><a href="#4" class="headerlink" title="4."></a>4.</h3></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/11/20/DevOps/2018-11-20-Source-Tree-Error/">DevOps/2018-11-20-Source-Tree-Error</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-11-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/DevOps/">DevOps</a></span><div class="content"><p>Error: The following untracked working tree files would be overwritten by checkout:</p>
<p>Sol:</p>
<p>​    開啟SourceTree通過命令列，進入本地版本倉庫目錄下，直接執行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clean -d -fx</span><br></pre></td></tr></table></figure>

<p>即可。可能很多人都不明白-d，-fx到底是啥意思，其實git clean -d -fx表示：刪除 一些 沒有 git add 的 檔案；</p>
<p>​    git clean 引數 </p>
<p>​    -n 顯示將要刪除的檔案和目錄；</p>
<p>​    -x —–刪除忽略檔案已經對git來說不識別的檔案</p>
<p>​    -d —–刪除未被新增到git的路徑中的檔案</p>
<p>​    -f —–強制執行</p>
<p>​    git clean -n</p>
<p>​    git clean -df</p>
<p>​    git clean -f</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/11/20/ML/2018-11-20-ML%20Review-1/">ML/2018-11-20-ML Review-1</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-11-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Machine-Learning/">Machine-Learning</a></span><div class="content"><h3 id="1-SVM"><a href="#1-SVM" class="headerlink" title="1. SVM"></a>1. SVM</h3><p>Ref: <a href="https://blog.csdn.net/sinat_35512245/article/details/54984251" target="_blank" rel="noopener">https://blog.csdn.net/sinat_35512245/article/details/54984251</a><br>$$<br>d=|w^Tx+b|||w||　　　　　　　　　　　（１）<br>$$<br>其中，||w||为w的范数。</p>
<p>当点A表示某一实例$x_i$，其类标记为yi=+1yi=+1。点A与超平面的距离记作didi，那么<br>$$<br>di=wTxi+b||w||　　　　　　　　　　（２）<br>$$<br>当点A表示某一实例xixi，其类标记为yi=−1yi=−1。点A与超平面的距离记作didi，那么<br>$$<br>di=−wTxi+b||w||　　　　　　　　　（３）<br>$$<br>一般地，点xixi与超平面的距离是<br>$$<br>di=yiwTxi+b||w||　　　　　　　　　（４）<br>$$<br>公式（４）也被称为超平面关于样本点xixi的几何间隔。</p>
<h4 id="最大间隔分离超平面"><a href="#最大间隔分离超平面" class="headerlink" title="最大间隔分离超平面"></a>最大间隔分离超平面</h4><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g9cwe8dihaj30c007cdgl.jpg" alt="这里写图片描述"></p>
<p>如上图所示，距离超平面最近的这几个训练样本点被称为<strong>支持向量</strong>，两个异类支持向量（即分别位于超平面两侧的点）到超平面的距离之和为<br>$$<br>d=2/||w||　　　　　　　　　　　　　　　（５）<br>$$<br>上面（5）的d称为间隔（margin）。<br>要求得最大间隔（即最大化 $2/w$），就是要满足：</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g9cwamnyyij309h02sjrb.jpg" alt="这里写图片描述"></p>
<p>显然，为了最大化间隔，仅需最大化$||w||^{−1}$，这等价于最小化$||w||^2$，于是上式可以重写为：</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g9cwaz5iy0j309u02mdfs.jpg" alt="这里写图片描述"></p>
<p>这就是支持向量机的基本模型。</p>
<p><strong>到目前为止，我们的 SVM 还比较弱，只能处理线性的情况，下面我们将引入核函数，进而推广到非线性分类问题。</strong></p>
<p><strong>非线性支持向量机和核函数</strong></p>
<p>非线性分类问题是指通过利用非线性模型才能很好地进行分类的问题。先看一个例子：</p>
<hr>
<h3 id="2-DeepLearning-Frameworks-Dynamic-vs-Static-Graphs"><a href="#2-DeepLearning-Frameworks-Dynamic-vs-Static-Graphs" class="headerlink" title="2. DeepLearning Frameworks: Dynamic vs Static Graphs"></a>2. DeepLearning Frameworks: Dynamic vs Static Graphs</h3><h1 id="动态图-vs-静态图"><a href="#动态图-vs-静态图" class="headerlink" title="动态图 vs. 静态图"></a>动态图 vs. 静态图</h1><p>ref: <a href="https://www.cnblogs.com/yifdu25/p/8763717.html" target="_blank" rel="noopener">https://www.cnblogs.com/yifdu25/p/8763717.html</a></p>
<p>在 fast.ai，我们在选择框架时优先考虑程序员编程的便捷性（能更方便地进行调试和更直观地设计），而不是框架所能带来的模型加速能力。这也正是我们选择 PyTorch 的理由，因为它是一个<strong>具有动态图机制的灵活框架</strong>。</p>
<p>依据采用动态计算或是静态计算的不同，可以将这些众多的深度学习框架划分成两大阵营，当然也有些框架同时具有动态计算和静态计算两种机制（比如 MxNet 和最新的 TensorFlow）。动态计算意味着程序将按照我们编写命令的顺序进行执行。这种机制将使得调试更加容易，并且也使得我们将大脑中的想法转化为实际代码变得更加容易。而静态计算则意味着程序在编译执行时将先生成神经网络的结构，然后再执行相应操作。从理论上讲，静态计算这样的机制允许编译器进行更大程度的优化，但是这也意味着你所期望的程序与编译器实际执行之间存在着更多的代沟。这也意味着，代码中的错误将更加难以发现（比如，如果计算图的结构出现问题，你可能只有在代码执行到相应操作的时候才能发现它）。<strong>尽管理论上而言，静态计算图比动态计算图具有更好的性能，但是在实践中我们经常发现并不是这样的。</strong></p>
<p>谷歌的 TensorFlow 主要使用了静态计算图，而 Facebook 的 PyTorch 则使用了动态计算图机制。（注：TensorFlow 在两周前宣布了一个动态计算选项 Eager Execution（<a href="http://t.cn/RlZizQ2），不过该特性还比较新颖并且" target="_blank" rel="noopener">http://t.cn/RlZizQ2），不过该特性还比较新颖并且</a> TensorFlow 的文档和项目依然以静态计算为主）。在九月份，fast.ai 宣布将在今年的课程中采用 PyTorch 框架进行教学以及开发 fast.ai 自己的框架（实际上就是采用了更好的编码方式对 PyTorch 进行高级封装）。简而言之，以下是我们选择 PyTorch 的几个原因（更详细的原因请参见这里<a href="http://t.cn/Rpqj6pu）：" target="_blank" rel="noopener">http://t.cn/Rpqj6pu）：</a></p>
<ul>
<li>更加容易调试</li>
<li>动态计算更适用于自然语言处理</li>
<li>传统的面向对象编程风格（这对我们来说更加自然）</li>
<li>TensorFlow 中采用的诸如 scope 和 sessions 等不寻常的机制容易使人感到疑惑不解，而且需要花费更多时间学习</li>
</ul>
<p>谷歌在推广 TensorFlow 上已经花费了大量的资源，其投入要远远大于任何其它公司或者团队，并且我想这也是为什么 TensorFlow 会如此出名的原因之一（对于很多深度学习的门外汉，TensorFlow 是他们唯一听说过的框架）。正如之前所述，TensorFlow 在几周前发布了动态计算选项，这将解决了一些上述提到的问题。然后许多人就向 fast.ai 提问说我们是否考虑迁移回 TensorFlow 框架。<strong>但是目前 TensorFlow 提供的动态选项还比较新颖而且开发也不够完善，所以我们依然选择继续愉快地使用 PyTorch</strong>。但是 TensorFlow 团队非常乐意于接受我们的想法，我们也很高兴看到我们的 fastai 库（<a href="http://t.cn/RYyK6jC）被移植到" target="_blank" rel="noopener">http://t.cn/RYyK6jC）被移植到</a> TensorFlow 中。</p>
<hr>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/11/06/DevOps/2018-11-06-Jupyter%20Ipykernel/">DevOps/2018-11-06-Jupyter Ipykernel</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-11-06</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/DevOps/">DevOps</a></span><div class="content"><h2 id="Conda"><a href="#Conda" class="headerlink" title="Conda"></a>Conda</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">list all env:</span><br><span class="line"></span><br><span class="line">conda info --env</span><br><span class="line"></span><br><span class="line">create a simple virtual env:</span><br><span class="line"></span><br><span class="line">conda create -n YourEnvName python=3*</span><br><span class="line"></span><br><span class="line">delete virtual env</span><br><span class="line"></span><br><span class="line">conda env remove -n NAME</span><br></pre></td></tr></table></figure>



<h2 id="Jupyter"><a href="#Jupyter" class="headerlink" title="Jupyter"></a>Jupyter</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> activate myenv</span><br><span class="line">pip install ipykernel</span><br><span class="line">python -m ipykernel install --user --name myenv --display-name <span class="string">"Python (myenv)"</span></span><br></pre></td></tr></table></figure>

<p><em>Installed kernelspec joe_segmentation_36 in /mnt/raid1/home/huangjiancong/.local/share/jupyter/kernels/joe_segmentation_36</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(joe4_py36) xxx@hpc4:~$ python -m ipykernel install --user --name joe4_py36_kernel --display-name <span class="string">"Joe4_Py36_Kernel"</span></span><br></pre></td></tr></table></figure>

<p><em>Installed kernelspec joe4_py36_kernel in /mnt/raid4/home/huangjiancong/.local/share/jupyter/kernels/joe4_py36_kernel</em></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/11/05/DevOps/2018-11-05-Docker%20Note/">DevOps/2018-11-05-Docker Note</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-11-05</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/DevOps/">DevOps</a></span><div class="content"><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">Docker:</span><br><span class="line">$ docker pull ubuntu:<span class="number">18.04</span></span><br><span class="line">因此将会获取官方镜像 library/ubuntu 仓库</span><br><span class="line"></span><br><span class="line">$ docker <span class="keyword">run</span><span class="bash"> -it (—rm 表示<span class="built_in">exit</span>后自动删除掉) ubuntu:18.04 bash  或 把it 改成dt</span></span><br><span class="line">root@<span class="number">569</span>c032785f2:/<span class="comment"># pwd</span></span><br><span class="line">/</span><br><span class="line">root@aaa:<span class="comment"># exit</span></span><br><span class="line">$ docker exec -it $CON_ID bash</span><br><span class="line"></span><br><span class="line">$ docker ps -a  &lt;==例出所有containers ;  docker rm $CON_ID</span><br><span class="line">$ docker ps -n5</span><br><span class="line">$ docker stop $CON_ID</span><br><span class="line">$ docker start $CON_ID</span><br><span class="line"></span><br><span class="line">╰$ cat Dockerfile</span><br><span class="line"><span class="keyword">FROM</span> registry.cn-hangzhou.aliyuncs.com/eigenlab/ideal-video:latest</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">'aaaaaaaaaaaaaaaaa'</span> &gt; ./test_aaa.log</span></span><br><span class="line">╰$ docker build -t aaa:v1</span><br><span class="line">╰$ docker image prune</span><br><span class="line">WARNING! This will remove all dangling images.</span><br><span class="line">Are you sure you want to continue? [y/N] y</span><br><span class="line">Deleted Images:</span><br><span class="line">deleted: sha256:<span class="number">0015</span>c03359ec60e4f133bb382dc0662f976dbebed7cdf70bf50bd9efca82052e</span><br><span class="line"></span><br><span class="line">Total reclaimed space: <span class="number">0</span>B</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Docker:</span><br><span class="line">$ docker pull ubuntu:<span class="number">18.04</span></span><br><span class="line">因此将会获取官方镜像 library/ubuntu 仓库</span><br><span class="line"></span><br><span class="line">$ docker <span class="keyword">run</span><span class="bash"> -it (—rm 表示<span class="built_in">exit</span>后自动删除掉) ubuntu:18.04 bash  或 把it 改成dt</span></span><br><span class="line">root@<span class="number">569</span>c032785f2:/<span class="comment"># pwd</span></span><br><span class="line">/</span><br><span class="line">root@aaa:<span class="comment"># exit</span></span><br><span class="line">$ docker exec -it $CON_ID bash</span><br><span class="line"></span><br><span class="line">$ docker ps -a  &lt;==例出所有containers ;  docker rm $CON_ID</span><br><span class="line">$ docker ps -n5</span><br><span class="line">$ docker stop $CON_ID</span><br><span class="line">$ docker start $CON_ID</span><br><span class="line"></span><br><span class="line">╰$ cat Dockerfile</span><br><span class="line"><span class="keyword">FROM</span> registry.cn-hangzhou.aliyuncs.com/eigenlab/ideal-video:latest</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">'aaaaaaaaaaaaaaaaa'</span> &gt; ./test_aaa.log</span></span><br><span class="line">╰$ docker build -t aaa:v1</span><br><span class="line">╰$ docker image prune</span><br><span class="line">WARNING! This will remove all dangling images.</span><br><span class="line">Are you sure you want to continue? [y/N] y</span><br><span class="line">Deleted Images:</span><br><span class="line">deleted: sha256:<span class="number">0015</span>c03359ec60e4f133bb382dc0662f976dbebed7cdf70bf50bd9efca82052e</span><br><span class="line"></span><br><span class="line">Total reclaimed space: <span class="number">0</span>B</span><br></pre></td></tr></table></figure>





<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run  -p 5599:5599 -p 8023:22 --name=<span class="string">"wazowski_joe_1106"</span> -v ~/workspace:/remote_workspace -it registry.cn-hangzhou.aliyuncs.com/eigenlab/wazowski_1688_leo:44 bash</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">huangjiancong@hpc3:~$ sudo docker port wazowski_joe_1106  22</span><br><span class="line">[sudo] password <span class="keyword">for</span> huangjiancong:</span><br><span class="line">Sorry, try again.</span><br><span class="line">[sudo] password <span class="keyword">for</span> huangjiancong:</span><br><span class="line">0.0.0.0:8023</span><br><span class="line">huangjiancong@hpc3:~$ ss -tulwn | grep 8023</span><br><span class="line">tcp    LISTEN     0      128      :::8023                 :::*</span><br></pre></td></tr></table></figure>



<p>不过没有关系，知道原理就行，根据提示 <strong>Offending ECDSA key in /root/.ssh/known_hosts:9</strong> ，删除路径中的第九行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sed -i <span class="string">'9d'</span> /root/.ssh/known_hosts</span><br></pre></td></tr></table></figure>



<p>Docker check mounted path </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect -f <span class="string">"&#123;&#123; .Mounts &#125;&#125;"</span>  7a96</span><br></pre></td></tr></table></figure>

<p>[{bind  /home/$USER/workspace/exp/docker_/opencv347 /workspace/remote_opencv347   true rprivate}]</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/10/21/LC/2018-10-21-python-Closure%20&amp;%20Non-local%20vs%20Global/">LC/2018-10-21-python-Closure &amp; Non-local vs Global</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-10-21</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/python/">python</a></span><div class="content"><h3 id="Closure-amp-Non-local-vs-Global"><a href="#Closure-amp-Non-local-vs-Global" class="headerlink" title="Closure &amp; Non-local vs Global"></a>Closure &amp; Non-local vs Global</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">方法一：创建生成器            </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">creatCounter</span><span class="params">( )</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">( )</span>:</span></span><br><span class="line">        x = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">              x = x +<span class="number">1</span></span><br><span class="line">              <span class="keyword">yield</span> x</span><br><span class="line">    </span><br><span class="line">    sum = f( ) </span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">def</span>  <span class="title">counter</span><span class="params">( )</span>:</span></span><br><span class="line">         <span class="keyword">return</span> next( sum )</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> counter</span><br></pre></td></tr></table></figure>



<p>这里没有直接调用f( )，即next( f( ) )，而是用定义sum = f( )，即next( sum )，</p>
<p>因为creatCounter( )返回的是counter这个函数，而此时f( )并没有执行并返回一个生成器对象，而执行next（sum）则会执行f( )生成一个新的生成器对象，变向的理解，s1 = f( )，s2 = f( )，但s1 == s2是false（这个变向理解感觉有点牵强）</p>
<p>方法二：创建列表</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">creatCounter</span><span class="params">()</span>:</span></span><br><span class="line">    s = [<span class="number">0</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">counter</span><span class="params">()</span>:</span></span><br><span class="line">        s[<span class="number">0</span>] = s[<span class="number">0</span>] + <span class="number">1</span></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">creat_counter</span><span class="params">()</span>:</span></span><br><span class="line">    i=<span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">counter</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">nonlocal</span> i</span><br><span class="line">        i=i+<span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> counter</span><br></pre></td></tr></table></figure>



<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8885skue5j30v30u042e.jpg" alt="image-20191023164204053"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g888hveiitj30dd0v4420.jpg" alt="image-20191023165343479"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g888i4jauxj30db0saq6i.jpg" alt="image-20191023165358740"></p>
<p>Ref:</p>
<p><a href="https://www.jianshu.com/p/703ad1289a00" target="_blank" rel="noopener">https://www.jianshu.com/p/703ad1289a00</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/10/21/Python/2018-10-21-python-Closure%20&amp;%20Non-local%20vs%20Global/">Python/2018-10-21-python-Closure &amp; Non-local vs Global</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-10-21</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Python/">Python</a></span><div class="content"><h3 id="Closure-amp-Non-local-vs-Global"><a href="#Closure-amp-Non-local-vs-Global" class="headerlink" title="Closure &amp; Non-local vs Global"></a>Closure &amp; Non-local vs Global</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">方法一：创建生成器            </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">creatCounter</span><span class="params">( )</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">( )</span>:</span></span><br><span class="line">        x = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">              x = x +<span class="number">1</span></span><br><span class="line">              <span class="keyword">yield</span> x</span><br><span class="line">    </span><br><span class="line">    sum = f( ) </span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">def</span>  <span class="title">counter</span><span class="params">( )</span>:</span></span><br><span class="line">         <span class="keyword">return</span> next( sum )</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> counter</span><br></pre></td></tr></table></figure>



<p>这里没有直接调用f( )，即next( f( ) )，而是用定义sum = f( )，即next( sum )，</p>
<p>因为creatCounter( )返回的是counter这个函数，而此时f( )并没有执行并返回一个生成器对象，而执行next（sum）则会执行f( )生成一个新的生成器对象，变向的理解，s1 = f( )，s2 = f( )，但s1 == s2是false（这个变向理解感觉有点牵强）</p>
<p>方法二：创建列表</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">creatCounter</span><span class="params">()</span>:</span></span><br><span class="line">    s = [<span class="number">0</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">counter</span><span class="params">()</span>:</span></span><br><span class="line">        s[<span class="number">0</span>] = s[<span class="number">0</span>] + <span class="number">1</span></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">creat_counter</span><span class="params">()</span>:</span></span><br><span class="line">    i=<span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">counter</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">nonlocal</span> i</span><br><span class="line">        i=i+<span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> counter</span><br></pre></td></tr></table></figure>



<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8885skue5j30v30u042e.jpg" alt="image-20191023164204053"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g888hveiitj30dd0v4420.jpg" alt="image-20191023165343479"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g888i4jauxj30db0saq6i.jpg" alt="image-20191023165358740"></p>
<p>Ref:</p>
<p><a href="https://www.jianshu.com/p/703ad1289a00" target="_blank" rel="noopener">https://www.jianshu.com/p/703ad1289a00</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/07/20/Deeplearning.ai/2018-07-20-Deeplearning.ai_Course4-ObjectDetection&amp;StyleTransfer/">Deeplearning.ai/2018-07-20-Deeplearning.ai_Course4-ObjectDetection&amp;StyleTransfer</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-07-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Deep-Learning/">Deep-Learning</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Deep-Learning/AI/">AI</a></span><div class="content"><p>Deeplearning.ai_Course4.md</p>
<h1 align="center">目标检测</h1>
目标检测是计算机视觉领域中一个新兴的应用方向，其任务是对输入图像进行分类的同时，检测图像中是否包含某些目标，并对他们准确定位并标识。

<h2 id="目标定位"><a href="#目标定位" class="headerlink" title="目标定位"></a>目标定位</h2><p>定位分类问题不仅要求判断出图片中物体的种类，还要在图片中标记出它的具体位置，用<strong>边框（Bounding Box，或者称包围盒）</strong>把物体圈起来。一般来说，定位分类问题通常只有一个较大的对象位于图片中间位置；而在目标检测问题中，图片可以含有多个对象，甚至单张图片中会有多个不同分类的对象。</p>
<p>为了定位图片中汽车的位置，可以让神经网络多输出 4 个数字，标记为 $b_x$、$b_y$、$b_h$、$b_w$。将图片左上角标记为 (0, 0)，右下角标记为 (1, 1)，则有：</p>
<ul>
<li>红色方框的中心点：($b_x$，$b_y$)</li>
<li>边界框的高度：$b_h$</li>
<li>边界框的宽度：$b_w$</li>
</ul>
<p>因此，训练集不仅包含对象分类标签，还包含表示边界框的四个数字。定义目标标签 Y 如下：</p>
<p>$$\left[\begin{matrix}P_c\\ b_x\\ b_y\\ b_h\\ b_w\\ c_1\\ c_2\\ c_3\end{matrix}\right]$$</p>
<p>则有：</p>
<p>$$P_c=1, Y = \left[\begin{matrix}1\\ b_x\\ b_y\\ b_h\\ b_w\\ c_1\\ c_2\\ c_3\end{matrix}\right]<br>$$</p>
<p>其中，$c_n$表示存在第 $n$个种类的概率；如果 $P_c=0$，表示没有检测到目标，则输出标签后面的 7 个参数都是无效的，可以忽略（用 ? 来表示）。</p>
<p>$$P_c=0, Y = \left[\begin{matrix}0\\ ?\\ ?\\ ?\\ ?\\ ?\\ ?\\ ?\end{matrix}\right]$$</p>
<p>损失函数可以表示为 $L(\hat y, y)$，如果使用平方误差形式，对于不同的 $P_c$有不同的损失函数（注意下标 $i$指标签的第 $i$个值）：</p>
<ol>
<li><p>$P_c=1$，即$y_1=1$：</p>
<p> $L(\hat y,y)=(\hat y_1-y_1)^2+(\hat y_2-y_2)^2+\cdots+(\hat y_8-y_8)^2$</p>
</li>
<li><p>$P_c=0$，即$y_1=0$：</p>
<p> $L(\hat y,y)=(\hat y_1-y_1)^2$</p>
</li>
</ol>
<p>除了使用平方误差，也可以使用逻辑回归损失函数，类标签 $c_1,c_2,c_3$ 也可以通过 softmax 输出。相比较而言，平方误差已经能够取得比较好的效果。</p>
<h2 id="特征点检测"><a href="#特征点检测" class="headerlink" title="特征点检测"></a>特征点检测</h2><p>神经网络可以像标识目标的中心点位置那样，通过输出图片上的特征点，来实现对目标特征的识别。在标签中，这些特征点以多个二维坐标的形式表示。</p>
<p>通过检测人脸特征点可以进行情绪分类与判断，或者应用于 AR 领域等等。也可以透过检测姿态特征点来进行人体姿态检测。</p>
<h2 id="目标检测"><a href="#目标检测" class="headerlink" title="目标检测"></a>目标检测</h2><p>想要实现目标检测，可以采用<strong>基于滑动窗口的目标检测（Sliding Windows Detection）</strong>算法。该算法的步骤如下：</p>
<ol>
<li>训练集上搜集相应的各种目标图片和非目标图片，样本图片要求尺寸较小，相应目标居于图片中心位置并基本占据整张图片。</li>
<li>使用训练集构建 CNN 模型，使得模型有较高的识别率。</li>
<li>选择大小适宜的窗口与合适的固定步幅，对测试图片进行从左到右、从上倒下的滑动遍历。每个窗口区域使用已经训练好的 CNN 模型进行识别判断。</li>
<li>可以选择更大的窗口，然后重复第三步的操作。</li>
</ol>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7himisg18j30oy0ahjxj.jpg" alt="Sliding-windows-detection"></p>
<p>滑动窗口目标检测的<strong>优点</strong>是原理简单，且不需要人为选定目标区域；<strong>缺点</strong>是需要人为直观设定滑动窗口的大小和步幅。滑动窗口过小或过大，步幅过大均会降低目标检测的正确率。另外，每次滑动都要进行一次 CNN 网络计算，如果滑动窗口和步幅较小，计算成本往往很大。</p>
<p>所以，滑动窗口目标检测算法虽然简单，但是性能不佳，效率较低。</p>
<h2 id="基于卷积的滑动窗口实现"><a href="#基于卷积的滑动窗口实现" class="headerlink" title="基于卷积的滑动窗口实现"></a>基于卷积的滑动窗口实现</h2><p>相比从较大图片多次截取，在卷积层上应用滑动窗口目标检测算法可以提高运行速度。所要做的仅是将全连接层换成卷积层，即使用与上一层尺寸一致的滤波器进行卷积运算。</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7himfw9zbj30pu0dgafa.jpg" alt="Convolution-implementation-of-sliding-windows"></p>
<p>如图，对于 16x16x3 的图片，步长为 2，CNN 网络得到的输出层为 2x2x4。其中，2x2 表示共有 4 个窗口结果。对于更复杂的 28x28x3 的图片，得到的输出层为 8x8x4，共 64 个窗口结果。最大池化层的宽高和步长相等。</p>
<p>运行速度提高的原理：在滑动窗口的过程中，需要重复进行 CNN 正向计算。因此，不需要将输入图片分割成多个子集，分别执行向前传播，而是将它们作为一张图片输入给卷积网络进行一次 CNN 正向计算。这样，公共区域的计算可以共享，以降低运算成本。</p>
<p>相关论文：<a href="https://arxiv.org/pdf/1312.6229.pdf" target="_blank" rel="noopener">Sermanet et al., 2014. OverFeat: Integrated Recognition, Localization and Detection using Convolutional Networks</a></p>
<h2 id="边框预测"><a href="#边框预测" class="headerlink" title="边框预测"></a>边框预测</h2><p>在上述算法中，边框的位置可能无法完美覆盖目标，或者大小不合适，或者最准确的边框并非正方形，而是长方形。</p>
<p><strong>YOLO（You Only Look Once）算法</strong>可以用于得到更精确的边框。YOLO 算法将原始图片划分为 n×n 网格，并将<a href="http://kyonhuang.top/Andrew-Ng-Deep-Learning-notes/#/Convolutional_Neural_Networks/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B?id=%e7%9b%ae%e6%a0%87%e5%ae%9a%e4%bd%8d" target="_blank" rel="noopener">目标定位</a>一节中提到的图像分类和目标定位算法，逐一应用在每个网格中，每个网格都有标签如：</p>
<p>$$\left[\begin{matrix}P_c\\ b_x\\ b_y\\ b_h\\ b_w\\ c_1\\ c_2\\ c_3\end{matrix}\right]$$</p>
<p>若某个目标的中点落在某个网格，则该网格负责检测该对象。</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7himdh2caj318n0l4nb2.jpg" alt="Bounding-Box-Predictions"></p>
<p>如上面的示例中，如果将输入的图片划分为 3×3 的网格、需要检测的目标有 3 类，则每一网格部分图片的标签会是一个 8 维的列矩阵，最终输出的就是大小为 3×3×8 的结果。要得到这个结果，就要训练一个输入大小为 100×100×3，输出大小为 3×3×8 的 CNN。在实践中，可能使用更为精细的 19×19 网格，则两个目标的中点在同一个网格的概率更小。</p>
<p>YOLO 算法的优点：</p>
<ol>
<li>和图像分类和目标定位算法类似，显式输出边框坐标和大小，不会受到滑窗分类器的步长大小限制。</li>
<li>仍然只进行一次 CNN 正向计算，效率很高，甚至可以达到实时识别。</li>
</ol>
<p>如何编码边框 $b_x$、$b_y$、$b_h$、$b_w$？YOLO 算法设 $b_x$、$b_y$、$b_h$、$b_w$ 的值是相对于网格长的比例。则 $b_x$、$b_y$ 在 0 到 1 之间，而 $b_h$、$b_w$ 可以大于 1。当然，也有其他参数化的形式，且效果可能更好。这里只是给出一个通用的表示方法。</p>
<p>相关论文：<a href="https://arxiv.org/pdf/1506.02640.pdf" target="_blank" rel="noopener">Redmon et al., 2015. You Only Look Once: Unified, Real-Time Object Detection</a>。Ng 认为该论文较难理解。</p>
<h2 id="交互比"><a href="#交互比" class="headerlink" title="交互比"></a>交互比</h2><p><strong>交互比（IoU, Intersection Over Union）</strong>函数用于评价对象检测算法，它计算预测边框和实际边框交集（I）与并集（U）之比：</p>
<p>$$IoU = \frac{I}{U}$$</p>
<p>IoU 的值在 0～1 之间，且越接近 1 表示目标的定位越准确。IoU 大于等于 0.5 时，一般可以认为预测边框是正确的，当然也可以更加严格地要求一个更高的阈值。</p>
<h2 id="非极大值抑制"><a href="#非极大值抑制" class="headerlink" title="非极大值抑制"></a>非极大值抑制</h2><p>YOLO 算法中，可能有很多网格检测到同一目标。<strong>非极大值抑制（Non-max Suppression）</strong>会通过清理检测结果，找到每个目标中点所位于的网格，确保算法对每个目标只检测一次。</p>
<p>进行非极大值抑制的步骤如下：</p>
<ol>
<li>将包含目标中心坐标的可信度 $P_c$ 小于阈值（例如 0.6）的网格丢弃；</li>
<li>选取拥有最大 $P_c$ 的网格；</li>
<li>分别计算该网格和其他所有网格的 IoU，将 IoU 超过预设阈值的网格丢弃；</li>
<li>重复第 2~3 步，直到不存在未处理的网格。</li>
</ol>
<p>上述步骤适用于单类别目标检测。进行多个类别目标检测时，对于每个类别，应该单独做一次非极大值抑制。</p>
<h2 id="Anchor-Boxes"><a href="#Anchor-Boxes" class="headerlink" title="Anchor Boxes"></a>Anchor Boxes</h2><p>到目前为止，我们讨论的情况都是一个网格只检测一个对象。如果要将算法运用在多目标检测上，需要用到 Anchor Boxes。一个网格的标签中将包含多个 Anchor Box，相当于存在多个用以标识不同目标的边框。</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7him3m8zxj30p20bqjw9.jpg" alt="Overlapping-objects"></p>
<p>在上图示例中，我们希望同时检测人和汽车。因此，每个网格的的标签中含有两个 Anchor Box。输出的标签结果大小从 3×3×8 变为 3×3×16。若两个 $P_c$ 都大于预设阈值，则说明检测到了两个目标。</p>
<p>在单目标检测中，图像中的目标被分配给了包含该目标中点的那个网格；引入 Anchor Box 进行多目标检测时，图像中的目标则被分配到了包含该目标中点的那个网格以及具有最高 IoU 值的该网格的 Anchor Box。</p>
<p>Anchor Boxes 也有局限性，对于同一网格有三个及以上目标，或者两个目标的 Anchor Box 高度重合的情况处理不好。</p>
<p>Anchor Box 的形状一般通过人工选取。高级一点的方法是用 k-means 将两类对象形状聚类，选择最具代表性的 Anchor Box。</p>
<p>如果对以上内容不是很理解，在“3.9 YOLO 算法”一节中视频的第 5 分钟，有一个更为直观的示例。</p>
<h2 id="R-CNN"><a href="#R-CNN" class="headerlink" title="R-CNN"></a>R-CNN</h2><p>前面介绍的滑动窗口目标检测算法对一些明显没有目标的区域也进行了扫描，这降低了算法的运行效率。为了解决这个问题，<strong>R-CNN（Region CNN，带区域的 CNN）</strong>被提出。通过对输入图片运行<strong>图像分割算法</strong>，在不同的色块上找出<strong>候选区域（Region Proposal）</strong>，就只需要在这些区域上运行分类器。</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7him6eqfhj30p607o0zs.jpg" alt="R-CNN"></p>
<p>R-CNN 的缺点是运行速度很慢，所以有一系列后续研究工作改进。例如 Fast R-CNN（与基于卷积的滑动窗口实现相似，但得到候选区域的聚类步骤依然很慢）、Faster R-CNN（使用卷积对图片进行分割）。不过大多数时候还是比 YOLO 算法慢。</p>
<p>相关论文：</p>
<ul>
<li>R-CNN：<a href="https://arxiv.org/pdf/1311.2524.pdf" target="_blank" rel="noopener">Girshik et al., 2013. Rich feature hierarchies for accurate object detection and semantic segmentation</a></li>
<li>Fast R-CNN：<a href="https://arxiv.org/pdf/1504.08083.pdf" target="_blank" rel="noopener">Girshik, 2015. Fast R-CNN</a></li>
<li>Faster R-CNN：<a href="https://arxiv.org/pdf/1506.01497v3.pdf" target="_blank" rel="noopener">Ren et al., 2016. Faster R-CNN: Towards real-time object detection with region proposal networks</a></li>
</ul>
<h2 id="——————–"><a href="#——————–" class="headerlink" title="——————–"></a>——————–</h2><h1 align="center">特殊应用：人脸识别和神经风格转换</h1>
## 人脸识别

<p><strong>人脸验证（Face Verification）</strong>和<strong>人脸识别（Face Recognition）</strong>的区别：</p>
<ul>
<li>人脸验证：一般指一个一对一问题，只需要验证输入的人脸图像是否与某个已知的身份信息对应；</li>
<li>人脸识别：一个更为复杂的一对多问题，需要验证输入的人脸图像是否与多个已知身份信息中的某一个匹配。</li>
</ul>
<p>一般来说，由于需要匹配的身份信息更多导致错误率增加，人脸识别比人脸验证更难一些。</p>
<h3 id="One-Shot-学习"><a href="#One-Shot-学习" class="headerlink" title="One-Shot 学习"></a>One-Shot 学习</h3><p>人脸识别所面临的一个挑战是要求系统只采集某人的一个面部样本，就能快速准确地识别出这个人，即只用一个训练样本来获得准确的预测结果。这被称为<strong>One-Shot 学习</strong>。</p>
<p>有一种方法是假设数据库中存有 N 个人的身份信息，对于每张输入图像，用 Softmax 输出 N+1 种标签，分别对应每个人以及都不是。然而这种方法的实际效果很差，因为过小的训练集不足以训练出一个稳健的神经网络；并且如果有新的身份信息入库，需要重新训练神经网络，不够灵活。</p>
<p>因此，我们通过学习一个 Similarity 函数来实现 One-Shot 学习过程。Similarity 函数定义了输入的两幅图像的差异度，其公式如下：</p>
<p>$$Similarity  = d(img1, img2)$$</p>
<p>可以设置一个超参数 $τ$ 作为阈值，作为判断两幅图片是否为同一个人的依据。</p>
<h3 id="Siamese-网络"><a href="#Siamese-网络" class="headerlink" title="Siamese 网络"></a>Siamese 网络</h3><p>实现 Similarity 函数的一种方式是使用<strong>Siamese 网络</strong>，它是一种对两个不同输入运行相同的卷积网络，然后对它们的结果进行比较的神经网络。</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7hiofwbebj30ni0bewg1.jpg" alt="Siamese"></p>
<p>如上图示例，将图片 $x^{(1)}$、$x^{(2)}$ 分别输入两个相同的卷积网络中，经过全连接层后不再进行 Softmax，而是得到特征向量 $f(x^{(1)})$、$f(x^{(2)})$。这时，Similarity 函数就被定义为两个特征向量之差的 L2 范数：</p>
<p>$$d(x^{(1)}, x^{(2)}) = ||f(x^{(1)}) - f(x^{(2)})||^2_2$$</p>
<p>相关论文：<a href="http://www.cs.wayne.edu/~mdong/taigman_cvpr14.pdf" target="_blank" rel="noopener">Taigman et al., 2014, DeepFace closing the gap to human level performance</a></p>
<h3 id="Triplet-损失"><a href="#Triplet-损失" class="headerlink" title="Triplet 损失"></a>Triplet 损失</h3><p><strong>Triplet 损失函数</strong>用于训练出合适的参数，以获得高质量的人脸图像编码。“Triplet”一词来源于训练这个神经网络需要大量包含 Anchor（靶目标）、Positive（正例）、Negative（反例）的图片组，其中 Anchor 和 Positive 需要是同一个人的人脸图像。</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7hiodz3jsj30fs0bz77i.jpg" alt="Training-set-using-triplet-loss"></p>
<p>对于这三张图片，应该有：</p>
<p>$$||f(A) - f(P)||^2_2 + \alpha \le ||f(A) - f(N)||^2_2$$</p>
<p>其中，$\alpha$ 被称为<strong>间隔（margin）</strong>，用于确保 $f()$ 不会总是输出零向量（或者一个恒定的值）。</p>
<p>Triplet 损失函数的定义：</p>
<p>$$L(A, P, N) = max(||f(A) - f(P)||^2_2 - ||f(A) - f(N)||^2_2 + \alpha, 0)$$</p>
<p>其中，因为 $||f(A) - f(P)||^2_2 - ||f(A) - f(N)||^2_2 + \alpha$ 的值需要小于等于 0，因此取它和 0 的更大值。</p>
<p>对于大小为 $m$ 的训练集，代价函数为：</p>
<p>$$J = \sum^m_{i=1}L(A^{(i)}, P^{(i)}, N^{(i)})$$</p>
<p>通过梯度下降最小化代价函数。</p>
<p>在选择训练样本时，随机选择容易使 Anchor 和 Positive 极为接近，而 Anchor 和 Negative 相差较大，以致训练出来的模型容易抓不到关键的区别。因此，最好的做法是人为增加 Anchor 和 Positive 的区别，缩小 Anchor 和 Negative 的区别，促使模型去学习不同人脸之间的关键差异。</p>
<p>相关论文：<a href="https://arxiv.org/pdf/1503.03832.pdf" target="_blank" rel="noopener">Schroff et al., 2015,  FaceNet: A unified embedding for face recognition and clustering</a></p>
<h3 id="二分类结构"><a href="#二分类结构" class="headerlink" title="二分类结构"></a>二分类结构</h3><p>除了 Triplet 损失函数，二分类结构也可用于学习参数以解决人脸识别问题。其做法是输入一对图片，将两个 Siamese 网络产生的特征向量输入至同一个 Sigmoid 单元，输出 1 则表示是识别为同一人，输出 0 则表示识别为不同的人。</p>
<p>Sigmoid 单元对应的表达式为：</p>
<p>$$\hat y = \sigma (\sum^K_{k=1}w_k|f(x^{(i)})_{k} - x^{(j)})_{k}| + b)$$</p>
<p>其中，$w_k$ 和 $b$ 都是通过梯度下降算法迭代训练得到的参数。上述计算表达式也可以用另一种表达式代替：</p>
<p>$$\hat y = \sigma (\sum^K_{k=1}w_k<br>\frac{(f(x^{(i)})_k - f(x^{(j)})_k)^2}{f(x^{(i)})_k + f(x^{(j)})_k} + b)$$</p>
<p>其中，$\frac{(f(x^{(i)})_k - f(x^{(j)})_k)^2}{f(x^{(i)})_k + f(x^{(j)})_k}$ 被称为 $\chi$ 方相似度。</p>
<p>无论是对于使用 Triplet 损失函数的网络，还是二分类结构，为了减少计算量，可以提前计算好编码输出 $f(x)$ 并保存。这样就不必存储原始图片，并且每次进行人脸识别时只需要计算测试图片的编码输出。</p>
<h2 id="神经风格迁移"><a href="#神经风格迁移" class="headerlink" title="神经风格迁移"></a>神经风格迁移</h2><p><strong>神经风格迁移（Neural style transfer）</strong>将参考风格图像的风格“迁移”到另外一张内容图像中，生成具有其特色的图像。</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7hioa4airj30pq0btk2v.jpg" alt="Neural-style-transfer"></p>
<h3 id="深度卷积网络在学什么？"><a href="#深度卷积网络在学什么？" class="headerlink" title="深度卷积网络在学什么？"></a>深度卷积网络在学什么？</h3><p>想要理解如何实现神经风格转换，首先要理解在输入图像数据后，一个深度卷积网络从中都学到了些什么。我们借助可视化来做到这一点。</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7hio81mcsj30ok0d7wpn.jpg" alt="Visualizing-deep-layers"></p>
<p>我们通过遍历所有的训练样本，找出使该层激活函数输出最大的 9 块图像区域。可以看出，浅层的隐藏层通常检测出的是原始图像的边缘、颜色、阴影等简单信息。随着层数的增加，隐藏单元能捕捉的区域更大，学习到的特征也由从边缘到纹理再到具体物体，变得更加复杂。</p>
<p>相关论文：<a href="https://arxiv.org/pdf/1311.2901.pdf" target="_blank" rel="noopener">Zeiler and Fergus., 2013, Visualizing and understanding convolutional networks</a></p>
<h3 id="代价函数"><a href="#代价函数" class="headerlink" title="代价函数"></a>代价函数</h3><p>神经风格迁移生成图片 G 的代价函数如下：</p>
<p>$$J(G) = \alpha \cdot J_{content}(C, G) + \beta \cdot J_{style}(S, G)$$</p>
<p>其中，$\alpha$、$\beta$ 是用于控制相似度比重的超参数。</p>
<p>神经风格迁移的算法步骤如下：</p>
<ol>
<li>随机生成图片 G 的所有像素点；</li>
<li>使用梯度下降算法使代价函数最小化，以不断修正 G 的所有像素点。</li>
</ol>
<p>相关论文：<a href="https://arxiv.org/pdf/1508.06576v2.pdf" target="_blank" rel="noopener">Gatys al., 2015. A neural algorithm of artistic style</a></p>
<h4 id="内容代价函数"><a href="#内容代价函数" class="headerlink" title="内容代价函数"></a>内容代价函数</h4><p>上述代价函数包含一个内容代价部分和风格代价部分。我们先来讨论内容代价函数 $J_{content}(C, G)$，它表示内容图片 C 和生成图片 G 之间的相似度。</p>
<p>$J_{content}(C, G)$ 的计算过程如下：</p>
<ul>
<li>使用一个预训练好的 CNN（例如 VGG）；</li>
<li>选择一个隐藏层 $l$ 来计算内容代价。$l$ 太小则内容图片和生成图片像素级别相似，$l$ 太大则可能只有具体物体级别的相似。因此，$l$ 一般选一个中间层；</li>
<li>设 $a^{(C)[l]}$、$a^{(G)[l]}$ 为 C 和 G 在 $l$ 层的激活，则有：</li>
</ul>
<p>$$J_{content}(C, G) = \frac{1}{2}||(a^{(C)[l]} - a^{(G)[l]})||^2$$</p>
<p>$a^{(C)[l]}$ 和 $a^{(G)[l]}$ 越相似，则 $J_{content}(C, G)$ 越小。</p>
<h4 id="风格代价函数"><a href="#风格代价函数" class="headerlink" title="风格代价函数"></a>风格代价函数</h4><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7hio60a4bj30a50g07a6.jpg" alt="Intuition-about-style-of-an-image"></p>
<p>每个通道提取图片的特征不同，比如标为红色的通道提取的是图片的垂直纹理特征，标为黄色的通道提取的是图片的橙色背景特征。那么计算这两个通道的相关性，相关性的大小，即表示原始图片既包含了垂直纹理也包含了该橙色背景的可能性大小。通过 CNN，“风格”被定义为同一个隐藏层不同通道之间激活值的相关系数，因其反映了原始图片特征间的相互关系。</p>
<p>对于风格图像 S，选定网络中的第 $l$ 层，则相关系数以一个 gram 矩阵的形式表示：</p>
<p>$$G^{[l](S)}_{kk’} = \sum^{n^{[l]}_H}_{i=1} \sum^{n^{[l]}_W}_{j=1} a^{[l](S)}_{ijk} a^{[l](S)}_{ijk’}$$</p>
<p>其中，$i$ 和 $j$ 为第 $l$ 层的高度和宽度；$k$ 和 $k’$ 为选定的通道，其范围为 $1$ 到 $n_C^{[l]}$；$a^{[l](S)}_{ijk}$ 为激活。</p>
<p>同理，对于生成图像 G，有：</p>
<p>$$G^{[l](G)}_{kk’} = \sum^{n^{[l]}_H}_{i=1} \sum^{n^{[l]}_W}_{j=1} a^{[l](G)}_{ijk} a^{[l](G)}_{ijk’}$$</p>
<p>因此，第 $l$ 层的风格代价函数为：</p>
<p>$$J^{[l]}_{style}(S, G) = \frac{1}{(2n^{[l]}_Hn^{[l]}_Wn^{[l]}_C)^2} \sum_k \sum_{k’}(G^{[l](S)}_{kk’} - G^{[l](G)}_{kk’})^2$$</p>
<p>如果对各层都使用风格代价函数，效果会更好。因此有：</p>
<p>$$J_{style}(S, G) = \sum_l \lambda^{[l]} J^{[l]}_{style}(S, G)$$</p>
<p>其中，$lambda$ 是用于设置不同层所占权重的超参数。</p>
<h3 id="推广至一维和三维"><a href="#推广至一维和三维" class="headerlink" title="推广至一维和三维"></a>推广至一维和三维</h3><p>之前我们处理的都是二维图片，实际上卷积也可以延伸到一维和三维数据。我们举两个示例来说明。</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7hio1u4fij30lb06qgmr.jpg" alt="1D-3D-Convolution"></p>
<p>EKG 数据（心电图）是由时间序列对应的每个瞬间的电压组成，是一维数据。一般来说我们会用 RNN（循环神经网络）来处理，不过如果用卷积处理，则有：</p>
<ul>
<li>输入时间序列维度：14 x 1</li>
<li>滤波器尺寸：5 x 1，滤波器个数：16</li>
<li>输出时间序列维度：10 x 16</li>
</ul>
<p>而对于三维图片的示例，有</p>
<ul>
<li>输入 3D 图片维度：14 x 14 x 14 x 1</li>
<li>滤波器尺寸：5 x 5 x 5 x 1，滤波器个数：16</li>
<li>输出 3D 图片维度：10 x 10 x 10 x 16</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/07/15/Deeplearning.ai/2018-07-15-Deeplearning.ai_Course4/">Deeplearning.ai/2018-07-15-Deeplearning.ai_Course4</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-07-15</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Deep-Learning/">Deep-Learning</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Deep-Learning/AI/">AI</a></span><div class="content"><h3 id="More-Edge-Detection"><a href="#More-Edge-Detection" class="headerlink" title="More Edge Detection"></a>More Edge Detection</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7hgvsxddgj30oc13o1kx.jpg" alt="image-20190930131327684"></p>
<h3 id="FC-image-20190930131559243-Users-joe-Library-Application-Support-typora-user-images-image-20190930131559243-png"><a href="#FC-image-20190930131559243-Users-joe-Library-Application-Support-typora-user-images-image-20190930131559243-png" class="headerlink" title="FC![image-20190930131559243](/Users/joe/Library/Application Support/typora-user-images/image-20190930131559243.png)"></a>FC![image-20190930131559243](/Users/joe/Library/Application Support/typora-user-images/image-20190930131559243.png)</h3><h3 id="ResNet"><a href="#ResNet" class="headerlink" title="ResNet"></a>ResNet</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7hh5larukj31540u0u0x.jpg" alt="image-20190930132251760"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7hh6b4jv8j30u00znnpd.jpg" alt="image-20190930132333911"></p>
<h3 id="1X1"><a href="#1X1" class="headerlink" title="1X1"></a>1X1</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7hh9e9z08j30vm0sukhp.jpg" alt="image-20190930132631493"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7hh9q42hqj31320ps1kx.jpg" alt="image-20190930132651113"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7hhajkqtsj30u00wl7wh.jpg" alt="image-20190930132738243"></p>
<h3 id="Inception"><a href="#Inception" class="headerlink" title="Inception"></a>Inception</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7hhhrhpwsj30u00vohdt.jpg" alt="image-20190930133434192"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7hhja5itdj30wi0u01kx.jpg" alt="image-20190930133601668"></p>
<p>“事 实 上 ， 如 果 你 读 过 论 文 的 原 文 ， 你 就 会 发 现 ， 这 里 其 实 还 有 一 些 分 支 ， 我 现 在 把 它 们 加 上 去 。 所 以 这 些 分 支 有 什  么 用 呢 ？ 在 网 络 的 最 后 几 层 ， 通 常 称 为 金 连 接 层 ， 在 它 之 后 是 一 个 s 。 ftmax 层 （ 编 号 1 ） 来 做 出 预 测 ， 这 些 分 支  （ 编 号 2 ） 所 做 的 就 是 通 过 隐 藏 层 （ 编 号 引 来 做 出 预 氵 则 ， 所 以 这 其 实 是 一 个 s 。 ftmax 输 出 （ 编 号 2 ） ， 这 （ 编 号  1 ） 也 是 。 是 另 一 条 分 支 （ 编 号 4 ） ， 它 也 包 含 了 一 个 隐 藏 层 ， 通 过 一 些 全 连 接 层 ， 然 后 有 一 个 so 代 max 来 预  测 ， 输 出 结 果 的 标 签 。  你 应 该 把 它 看 做 Incepti 。 n 网 络 的 一 个 细 节 ， 它 确 保 了 即 便 是 隐 藏 单 元 和 中 间 层 （ 编 号 5 ） 也 参 与 了 特 征 计 算 ， 它  们 也 能 预 测 图 片 的 分 类 。 它 在 Inception 网 络 中 ， 起 到 一 种 调 整 的 效 果 ， 并 且 能 防 止 网 络 发 生 过 拟 合 。  ”</p>
<h3 id="迁移学习"><a href="#迁移学习" class="headerlink" title="迁移学习"></a>迁移学习</h3><p>在“搭建机器学习项目”课程中，<a href="http://kyonhuang.top/Andrew-Ng-Deep-Learning-notes/#/Structuring_Machine_Learning_Projects/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%EF%BC%88ML%EF%BC%89%E7%AD%96%E7%95%A5%EF%BC%882%EF%BC%89?id=%e8%bf%81%e7%a7%bb%e5%ad%a6%e4%b9%a0" target="_blank" rel="noopener">迁移学习</a>已经被提到过。计算机视觉是一个经常用到迁移学习的领域。在搭建计算机视觉的应用时，相比于从头训练权重，下载别人已经训练好的网络结构的权重，用其做<strong>预训练</strong>，然后转换到自己感兴趣的任务上，有助于加速开发。</p>
<p>对于已训练好的卷积神经网络，可以将所有层都看作是<strong>冻结的</strong>，只需要训练与你的 Softmax 层有关的参数即可。大多数深度学习框架都允许用户指定是否训练特定层的权重。</p>
<p>而冻结的层由于不需要改变和训练，可以看作一个固定函数。可以将这个固定函数存入硬盘，以便后续使用，而不必每次再使用训练集进行训练了。</p>
<p>上述的做法适用于你只有一个较小的数据集。如果你有一个更大的数据集，应该冻结更少的层，然后训练后面的层。越多的数据意味着冻结越少的层，训练更多的层。如果有一个极大的数据集，你可以将开源的网络和它的权重整个当作初始化（代替随机初始化），然后训练整个网络。</p>
<h3 id="数据扩增"><a href="#数据扩增" class="headerlink" title="数据扩增"></a>数据扩增</h3><p>计算机视觉领域的应用都需要大量的数据。当数据不够时，<strong>数据扩增（Data Augmentation）</strong>就有帮助。常用的数据扩增包括镜像翻转、随机裁剪、色彩转换。</p>
<p>其中，色彩转换是对图片的 RGB 通道数值进行随意增加或者减少，改变图片色调。另外，<strong>PCA 颜色增强</strong>指更有针对性地对图片的 RGB 通道进行主成分分析（Principles Components Analysis，PCA），对主要的通道颜色进行增加或减少，可以采用高斯扰动做法来增加有效的样本数量。具体的 PCA 颜色增强做法可以查阅 AlexNet 的相关论文或者开源代码。</p>
<p>在构建大型神经网络的时候，数据扩增和模型训练可以由两个或多个不同的线程并行来实现。</p>
<h3 id="计算机视觉现状"><a href="#计算机视觉现状" class="headerlink" title="计算机视觉现状"></a>计算机视觉现状</h3><p>通常，学习算法有两种知识来源：</p>
<ul>
<li>被标记的数据</li>
<li>手工工程</li>
</ul>
<p><strong>手工工程（Hand-engineering，又称 hacks）</strong>指精心设计的特性、网络体系结构或是系统的其他组件。手工工程是一项非常重要也比较困难的工作。在数据量不多的情况下，手工工程是获得良好表现的最佳方式。正因为数据量不能满足需要，历史上计算机视觉领域更多地依赖于手工工程。近几年数据量急剧增加，因此手工工程量大幅减少。</p>
<p>另外，在模型研究或者竞赛方面，有一些方法能够有助于提升神经网络模型的性能：</p>
<ul>
<li>集成（Ensembling）：独立地训练几个神经网络，并平均输出它们的输出</li>
<li>Multi-crop at test time：将数据扩增应用到测试集，对结果进行平均</li>
</ul>
<p>但是由于这些方法计算和内存成本较大，一般不适用于构建实际的生产项目。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/06/15/Deeplearning.ai/2018-06-15-Deeplearning.ai_Course1/">Deeplearning.ai/2018-06-15-Deeplearning.ai_Course1</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-06-15</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Deep-Learning/">Deep-Learning</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Deep-Learning/AI/">AI</a></span><div class="content"><h3 id="Course1"><a href="#Course1" class="headerlink" title="Course1"></a>Course1</h3><h4 id="Week1"><a href="#Week1" class="headerlink" title="Week1"></a>Week1</h4><p>Would structured or unstructured data have features such as pixel values or individual words?</p>
<p>Ans: Unstructured data</p>
<h4 id="Week2"><a href="#Week2" class="headerlink" title="Week2"></a>Week2</h4><p>![image-20190906215336217](/Users/joe/Library/Application Support/typora-user-images/image-20190906215336217.png)</p>
<p>![image-20190906215454393](/Users/joe/Library/Application Support/typora-user-images/image-20190906215454393.png)</p>
<h5 id="Logistic-Regression’s-Gradient-Descent"><a href="#Logistic-Regression’s-Gradient-Descent" class="headerlink" title="Logistic Regression’s Gradient Descent"></a>Logistic Regression’s Gradient Descent</h5><p>![image-20190906215703253](/Users/joe/Library/Application Support/typora-user-images/image-20190906215703253.png)</p>
<p><a href="https://ithelp.ithome.com.tw/articles/10193718" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10193718</a></p>
<h6 id="My-Note"><a href="#My-Note" class="headerlink" title="My Note"></a>My Note</h6><p>![image-20190906215840755](/Users/joe/Library/Application Support/typora-user-images/image-20190906215840755.png)</p>
<h6 id="Cross-Entropy"><a href="#Cross-Entropy" class="headerlink" title="Cross Entropy"></a>Cross Entropy</h6><p>![image-20190906215928611](/Users/joe/Library/Application Support/typora-user-images/image-20190906215928611.png)</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7hgpf462kj31440u0x6n.jpg" alt="image-20190930130717483"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7hgre16lwj318q0u0u0x.jpg" alt="image-20190930130913470"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7hgs6tkroj30yk0nkqpv.jpg" alt="image-20190930131000168"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/05/04/DevOps/2018-05-04-tmux/">DevOps/2018-05-04-tmux</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-05-04</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/DevOps/">DevOps</a></span><div class="content"><h3 id="tmux"><a href="#tmux" class="headerlink" title="tmux"></a>tmux</h3><h3 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h3><p>前置键: ctrl-b</p>
<p><code>C-</code> 指的是 Ctrl + 某個鍵一起按 <code>M-</code> 則是 <code>Alt</code> 或 <code>Option</code>和某個鍵一起按。</p>
<p>水平切割則是 <code>C-b &quot;</code></p>
<p>移动所在视窗使用 <code>C-b</code> 搭配方向鍵</p>
<h3 id="Main-Manipulations-within-Session"><a href="#Main-Manipulations-within-Session" class="headerlink" title="Main Manipulations within Session"></a>Main Manipulations within Session</h3><p>關閉視窗區塊只需要使用 <code>C-d</code> (注意，這不是detach，而是直接真的關了)</p>
<ul>
<li><code>C-b c</code> 建立一個新視窗</li>
<li><code>C-b p</code> 上一個視窗</li>
<li><code>C-b n</code> 下一個視窗</li>
<li><code>C-b &lt;number&gt;</code> 依照編號直接切換（編號顯示於狀態列）</li>
</ul>
<h3 id="Detach-amp-Attach"><a href="#Detach-amp-Attach" class="headerlink" title="Detach &amp; Attach"></a>Detach &amp; Attach</h3><p>如果完成工作，要 detach 只需要 <code>C-b d</code>，又或者 <code>C-b D</code> 可以選擇要從那個 <code>session</code> 離開。</p>
<ul>
<li>tmux attach -t 0</li>
</ul>
<p>賦予每個 session 一個有意義的名稱</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tmux new -s database</span></span><br></pre></td></tr></table></figure>

<p>修改名稱</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tmux rename-session -t 0 database</span></span><br></pre></td></tr></table></figure>

<p>之後當我們要在重新連回該 session 時，只要使用該名稱即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux attach -t database</span><br></pre></td></tr></table></figure>



<p>優點：</p>
<p>點出幾個 <code>tmux</code> 的優點：</p>
<ul>
<li>session 的保留：attach 和 detach 協助我們在不同情境和遠端連線的情況下切換。</li>
<li>跨平台：我們可以在 Mac 底下使用，也可以在 Linux 環境下使用，甚至遠端伺服器或 Raspberry Pi，BeagleBones 等等都可以使用一樣的東西。</li>
<li>客製化：我們可以去自訂 tmux 的環境設定並且可以和不同平台環境同步</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新增</span></span><br><span class="line">$ tmux</span><br><span class="line"><span class="comment"># OR</span></span><br><span class="line">$ tmux new -s &lt;your_session_name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># session 列表</span></span><br><span class="line">$ tmux ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新連線 session</span></span><br><span class="line">$ tmux a -t 0</span><br><span class="line"><span class="comment"># OR</span></span><br><span class="line">$ tmux a -t &lt;session_name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 刪除 session</span></span><br><span class="line">$ tmux <span class="built_in">kill</span>-session -t 0</span><br><span class="line"><span class="comment"># OR</span></span><br><span class="line">$ tmux <span class="built_in">kill</span>-session -t &lt;session_name&gt;</span><br><span class="line"><span class="comment"># OR</span></span><br><span class="line">$ tmux <span class="built_in">kill</span>-session -a <span class="comment"># 全部</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 刪除 tmux server</span></span><br><span class="line">$ tmux <span class="built_in">kill</span>-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新命名 session</span></span><br><span class="line">$ tmux rename-session -t 0 &lt;new_session_name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 快捷鍵/視窗管理</span></span><br><span class="line"><span class="comment"># C-b ? Help</span></span><br><span class="line"><span class="comment"># C-b c 新增視窗</span></span><br><span class="line"><span class="comment"># C-b， 視窗命名</span></span><br><span class="line"><span class="comment"># C-b w 視窗列表</span></span><br><span class="line"><span class="comment"># C-b f 尋找視窗</span></span><br><span class="line"><span class="comment"># C-b &amp; 刪除視窗</span></span><br><span class="line"><span class="comment"># C-b % 垂直分割區塊</span></span><br><span class="line"><span class="comment"># C-b “ 水平分割區塊</span></span><br><span class="line"><span class="comment"># C-b &lt;方向鍵&gt;</span></span><br><span class="line"><span class="comment"># C-b p 上一個視窗</span></span><br><span class="line"><span class="comment"># C-b n 下一個視窗</span></span><br><span class="line"><span class="comment"># C-b &lt;number&gt; 依照編號直接切換（編號顯示於狀態列）</span></span><br><span class="line"><span class="comment"># C-b d 離開 session</span></span><br><span class="line"><span class="comment"># C-b x 關閉 Pane</span></span><br><span class="line"><span class="comment"># C-d   關閉 Pane</span></span><br><span class="line"><span class="comment"># C-b z 讓一個 Pane 變成全螢幕，在輸入一次則回到剛剛的尺寸</span></span><br></pre></td></tr></table></figure>



<h3 id="參考資源"><a href="#參考資源" class="headerlink" title="參考資源:"></a>參考資源:</h3><p><a href="https://www.hamvocke.com/blog/a-quick-and-easy-guide-to-tmux/" target="_blank" rel="noopener">A Quick and Easy Guide to tmux</a></p>
<p><a href="https://andyyou.github.io/2017/11/27/tmux-notes/" target="_blank" rel="noopener">tmux 快速入門筆記</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/02/14/C++/2018-02-14-Dynamic%20vs%20Static%20Binding/">C++/2018-02-14-Dynamic vs Static Binding</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-02-14</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/C/">C++</a></span><div class="content"><p>Ref: <a href="http://notes.maxwi.com/3516/08/19/static-dynamic-binding/" target="_blank" rel="noopener">http://notes.maxwi.com/3516/08/19/static-dynamic-binding/</a></p>
<ul>
<li>静态类型：就是对象声明时采用的类型，一旦确定就无法更改，编译期已经确定</li>
<li>动态类型：通常是指一个指针或引用在调用时所指向的类型，可以理解为赋值号右侧对象的类型（当然采用直接赋值就是括号中的对象的类型），可以在运行时更改，在运行期决定</li>
<li>静态绑定（static binding）：又名前期绑定（early binding），绑定的是对象的静态类型，发生在编译期，即程序编译完成后就已经确定</li>
<li>动态绑定（dynamic binding）：又名后期绑定（late binding），绑定的是对象的动态类型，发生在运行期，即在运行期由当前的动态类型决定所需要调用的函数或属性</li>
</ul>
<p>可以简单理解为，通常我们定义的非虚函数都是静态绑定，即静态类型与动态类型都指同一种类型，在编译期就已经确定，那么运行时调用的函数也就是相应类型对象的函数。<br>而虚函数可以发生动态绑定，即在运行时，根据指针或引用所指对象的类型来决定调用相应的虚函数。如当定义父类的指针，指向派生类的对象时，该指针的动态类型与静态类型就不一致,<br>动态类型即派生类，静态类型为父类，那么在使用此指针在运行时调用虚函数时会首先调用动态类型对象（即派生类对象）的虚函数，如果动态类型中没有重写（override）该虚函数，<br>则调用的还是基类中的虚函数。<br>举例说明：<br>所有的讲解都是注释中，请认真阅读每一句注释</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(<span class="keyword">void</span>)</span>  <span class="comment">//普通的非虚函数，只能静态绑定</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"A::func"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">vfunc1</span><span class="params">()</span>   <span class="comment">//虚函数，可以在运行时，根据动态类型不同而发生动态绑定</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"A::vfunc1"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">vfunc2</span><span class="params">(<span class="keyword">int</span> i = <span class="number">2</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"A::vfunc2: "</span> &lt;&lt; i &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> :</span> <span class="keyword">public</span> A &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"B::func"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">vfunc1</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"B::vfunc1"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">vfunc2</span><span class="params">(<span class="keyword">int</span> i = <span class="number">5</span>)</span>  <span class="comment">//注意B改变了继承而来的虚函数的默认参数</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"B::vfunc2: "</span> &lt;&lt; i &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> :</span> <span class="keyword">public</span> B &#123;  <span class="comment">//注意C继承自B而不是A</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    B* pb = <span class="keyword">new</span> B();  <span class="comment">//pb的静态类型即是它声明的类型B，动态类型是它指向的类型B，即动态类型与静态类型一致</span></span><br><span class="line">    C* pc = <span class="keyword">new</span> C(); <span class="comment">//pc的静态类型与动态类型一致</span></span><br><span class="line">    A* pa = pc;   <span class="comment">//pa的静态类型是A，动态类型是C</span></span><br><span class="line">    pa = pb; <span class="comment">//将pa的动态类型改为B</span></span><br><span class="line">    B *pbnull = <span class="literal">nullptr</span>;  <span class="comment">//定义B指向空指针，它将在编译期发生静态绑定</span></span><br><span class="line">    pa-&gt;func();  <span class="comment">//A::func，虽然pa的静态类型与动态类型不一样，但func是不是虚函数，只有在通过指针或引用调用虚函数时，才会有运行时发生动态绑定，即pa优先调用其动态类型中的虚函数，所以此时pa只能调用它自己的func</span></span><br><span class="line">    pa-&gt;vfunc1(); <span class="comment">//B::vfunc1，此时pa发生了动态绑定，即调用它动态类型B的虚函数vfunc1</span></span><br><span class="line">    pb-&gt;func(); <span class="comment">//B::func，pb的func将隐藏继承自A中的函数func，所有非虚函数的调用都由静态类型决定，即编译期就已经确定了</span></span><br><span class="line">    pb-&gt;vfunc2(); <span class="comment">//B::vfunc2:5，pb正常通过静态绑定调用自己的函数vfunc2</span></span><br><span class="line">    pa-&gt;vfunc2(); <span class="comment">//B::vfunc2:2，发现pa此时动态绑定调用的是类型B的成员函数，但形参去是A自己的形参，因为C++为了执行效率，缺省参数值都是静态绑定的，所以永远不要重新定义一个继承而来的virtual函数的缺省参数值</span></span><br><span class="line">    pc-&gt;func(); <span class="comment">//B::func，pc正常的静态绑定，调用继承自B的函数func</span></span><br><span class="line">    pa = pc;  <span class="comment">//将pa的动态类型改为pc</span></span><br><span class="line">    pa-&gt;vfunc1();  <span class="comment">//B::vfunc1，此时pa实际上发生了动态绑定，被动态绑定到pc，将调用其动态类型C中的虚函数，但由于C中没有重写继承自B的虚函数，所以只能调用其父类B中的虚函数，注意不是A中的</span></span><br><span class="line">    pbnull-&gt;func();  <span class="comment">//B::func，虽然pbnull此时指向的是空指针，但其静态绑定是在编译期确定的，也就是说编译完成之后，pbnull就已经存在pbnull-&gt;func()的调用了。</span></span><br><span class="line">    <span class="comment">// pbnull-&gt;vfunc1(); //编译没有问题，但将发生运行时错误，linux下运行报错为Segmentation fault。因为在运行时发生动态绑定时，pbnull是指向空指针的，显然空指针不属于任何类型，pbnull也就无法正常绑定。之所以编译器无法检查到这类问题应该就是动态导致用户可以随时将pbnull绑定到一个其派生类的对象上</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//释放动态内存</span></span><br><span class="line">    <span class="keyword">delete</span> pb;</span><br><span class="line">    <span class="keyword">delete</span> pc;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的注释中已经讲解的非常清楚了，最后两句指向空指针的类对象也可以调用其静态绑定的函数需要特别注意，这是一种极不推荐的做法</p>
<p>注意</p>
<ul>
<li>永远不要重新定义继承而来的非虚函数，这样的函数由对象声明时的静太类型确定，没有多态性，将给程序留下不可预知的隐患</li>
<li>永远不要重新定义一个继承而来的虚函数的缺省参数值，因为缺省参数值都是静态绑定的。</li>
<li>接口基类不应该有非虚函数，即全部使用纯虚函数</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/02/13/C++/2018-02-13-LRU/">C++/2018-02-13-LRU</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-02-13</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Data-Structures/">Data-Structures</a></span><div class="content"><p>Ref: <a href="https://zhuanlan.zhihu.com/p/34133067" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/34133067</a></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8ws3vt2ygj30k00fcdg0.jpg" alt="img"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8ws3t9yfrj30k00agt96.jpg" alt="img"></p>
</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By Joe Huang</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>