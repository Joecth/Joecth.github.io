<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="Joe Huang"><meta name="copyright" content="Joe Huang"><title>Awaken Desparado</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.1.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Joe Huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">273</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">25</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">40</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Awaken Desparado</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Awaken Desparado</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2019/06/07/Web/2019-06-07-Requests'%20secret:%20pool_connections%20and%20pool_maxsize/">Web/2019-06-07-Requests' secret: pool_connections and pool_maxsize</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-06-07</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Web/">Web</a></span><div class="content"><p>from: <a href="https://www.cnblogs.com/pengyusong/p/5802929.html" target="_blank" rel="noopener">https://www.cnblogs.com/pengyusong/p/5802929.html</a></p>
<p>and <a href="https://laike9m.com/blog/requests-secret-pool_connections-and-pool_maxsize,89/" target="_blank" rel="noopener">https://laike9m.com/blog/requests-secret-pool_connections-and-pool_maxsize,89/</a></p>
<h1 id="Requests’-secret-pool-connections-and-pool-maxsize"><a href="#Requests’-secret-pool-connections-and-pool-maxsize" class="headerlink" title="Requests’ secret: pool_connections and pool_maxsize"></a><strong>Requests’ secret: pool_connections and pool_maxsize</strong></h1><p><a href="http://docs.python-requests.org/en/latest/" target="_blank" rel="noopener">Requests</a> 是一个python开发者众所周知的第三方库。因其简单的API和高性能，大多数人倾向于使用requests而不是urllib2作为访问http的标准库。然而很多使用requests库的人可能不知道内部原因，今天我就来解释以下俩个概念: <code>pool_connections</code> 和<code>pool_maxsize</code>.</p>
<p>从 <code>Session 开始</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line">s.get(<span class="string">'https://www.google.com'</span>)</span><br></pre></td></tr></table></figure>

<p>这很简单，你可能知道requests’ <code>Session</code> 持有cookie. 但你知道 <code>Session</code> 有一个 <a href="http://docs.python-requests.org/en/latest/api/#requests.Session.mount" target="_blank" rel="noopener"><code>mount</code></a> 方法吗?</p>
<blockquote>
<p><code>mount(prefix, adapter)</code><br>Registers a connection adapter to a prefix.<br>Adapters are sorted in descending order by key length.</p>
</blockquote>
<p>不知道？很好，实际上你已经使用了这个方法当你初始化一个session对象时:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Session</span><span class="params">(SessionRedirectMixin)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        ...</span><br><span class="line">        <span class="comment"># Default connection adapters.</span></span><br><span class="line">        self.adapters = OrderedDict()</span><br><span class="line">        self.mount(<span class="string">'https://'</span>, HTTPAdapter())</span><br><span class="line">        self.mount(<span class="string">'http://'</span>, HTTPAdapter())</span><br></pre></td></tr></table></figure>

<p>现在，到了有趣的部分。如果你阅读过 Ian Cordasco’s 文章 <a href="http://www.coglib.com/~icordasc/blog/2014/12/retries-in-requests.html" target="_blank" rel="noopener">Retries in Requests</a>, 你应该知道 <code>HTTPAdapter</code> 可以提供重试功能. 但一个 <code>HTTPAdapter</code> 真实是什么? Quoted from <a href="http://docs.python-requests.org/en/latest/api/#requests.adapters.HTTPAdapter" target="_blank" rel="noopener">doc</a>:</p>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">requests</span>.<span class="title">adapters</span>.<span class="title">HTTPAdapter</span><span class="params">(pool_connections=<span class="number">10</span>, pool_maxsize=<span class="number">10</span>, max_retries=<span class="number">0</span>, pool_block=False)</span></span></span><br></pre></td></tr></table></figure>

<p>The built-in HTTP Adapter for urllib3.</p>
<p>Provides a general-case interface for Requests sessions to contact HTTP and HTTPS urls by implementing the Transport Adapter interface. This class will usually be created by the Session class under the covers.</p>
<p>Parameters:</p>
<ul>
<li><code>pool_connections</code> – The number of urllib3 connection pools to cache.</li>
<li><code>pool_maxsize</code> – The maximum number of connections to save in the pool.</li>
<li><code>max_retries(int)</code> – The maximum number of retries each connection should attempt. Note, this applies only to failed DNS lookups, socket connections and connection timeouts, never to requests where data has made it to the server. By default, Requests does not retry failed connections. If you need granular control over the conditions under which we retry a request, import urllib3’s Retry class and pass that instead.</li>
<li><code>pool_block</code> – Whether the connection pool should block for connections. Usage:</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; <span class="keyword">import</span> requests</span><br><span class="line">&gt;&gt; s = requests.Session()</span><br><span class="line">&gt;&gt; a = requests.adapters.HTTPAdapter(max_retries=<span class="number">3</span>)</span><br><span class="line">&gt;&gt; s.mount(<span class="string">'http://'</span>, a)</span><br></pre></td></tr></table></figure>
</blockquote>
<p>如果上面的文档使你迷惑，这里是我的解释: HTTP Adapter 所做的就是：根据不同的目标url，对每个不同的请求提供不同的配置，还记得上面的代码吗？</p>
<p>　　　　what HTTP Adapter does is simply <strong>providing different configurations for different requests according to target url</strong>. Remember the code above?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">self.mount(<span class="string">'https://'</span>, HTTPAdapter())</span><br><span class="line">self.mount(<span class="string">'http://'</span>, HTTPAdapter())</span><br></pre></td></tr></table></figure>

<p>它创建了俩个 <code>HTTPAdapter</code> 对象使用默认的参数：<code>pool_connections=10, pool_maxsize=10, max_retries=0, pool_block=False</code>, 并且挂载到 <code>https://</code> 和 <code>http:// 相对路径</code>, 意思是第一个配置在你访问 <code>http://xxx 会使用到， 第二个会在你访问 ``https://xxx</code>. 尽管上面俩个配置是相同的，请求http和https仍然是隔离的。我们会在下面看到说明。</p>
<p>就像我说的，这篇文章的目的主要是解释 <code>pool_connections</code> and <code>pool_maxsize</code>.</p>
<p>首先，让我们看看 <code>pool_connections</code>. 昨天我在stackoverflow提出了一个问题：<a href="http://stackoverflow.com/questions/34837026/whats-the-meaning-of-pool-connections-in-requests-adapters-httpadapter" target="_blank" rel="noopener">question</a> ，因为我不确定我是否理解正确，这个问题的回答消除了我的不确定性。HTTP，众所周知，是基于TCP协议，一个HTTP连接也是一个TCP连接，它是由一个五元组唯一标识:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&lt;protocol&gt;, &lt;src addr&gt;, &lt;src port&gt;, &lt;dest addr&gt;, &lt;dest port&gt;)</span><br></pre></td></tr></table></figure>

<p>就是说，你针对 <code>www.example.com 建立了一个HTTP/TCP连接</code>, 假设服务器支持 <code>Keep-Alive</code>, 下一次你发送请求到 <code>www.example.com/a</code> or <code>www.example.com/b</code>, 你可以使用相同的连接，因为五元组没有改变. 实际上, <a href="http://docs.python-requests.org/en/latest/user/advanced/#keep-alive" target="_blank" rel="noopener">requests’ Session 自动会帮你处理</a> 并且重用连接，只要它能.</p>
<p>这个问题是，什么决定了你是否可以重用老的连接？是的，就是 <code>pool_connections</code>!</p>
<blockquote>
<p>pool_connections – The number of urllib3 connection pools to cache.</p>
</blockquote>
<p>我知道，我知道，我也不想引入很多术语, 这是最后一个，我发誓. 简单的理解它， 一个host对应的一个连接池：<strong>one connection pool corresponds to one host</strong>, 嗯，就是这个意思.</p>
<p>这是一个例子，无关的行已被忽略:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line">s.mount(<span class="string">'https://'</span>, HTTPAdapter(pool_connections=1))</span><br><span class="line">s.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">s.get(<span class="string">'https://www.zhihu.com'</span>)</span><br><span class="line">s.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">""</span><span class="string">"output</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.baidu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 None</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.zhihu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 2621</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.baidu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 None</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br></pre></td></tr></table></figure>

<p><code>HTTPAdapter(pool_connections=1)</code> 被映射到 <code>https://</code>, 他意思是在同一时间仅有一个连接池. 在调用 <code>s.get(&#39;https://www.baidu.com&#39;)</code>, 缓存的连接池是 <code>connectionpool(&#39;https://www.baidu.com&#39;)</code>. 现在 <code>s.get(&#39;https://www.zhihu.com&#39;)</code> 来了，这个session发现他不能使用缓存的连接，因为他不是相同的host(one connection pool corresponds to one host, remember?). 因此session不得不创建一个新的连接池. 因为 <code>pool_connections=1</code>, session不能在同一时间持有俩个连接池, 因此他丢弃了旧的连接池： <code>connectionpool(&#39;https://www.baidu.com&#39;)</code> 并且保存了新的：<code>connectionpool(&#39;https://www.zhihu.com&#39;)</code>. 下一次get同样如此Next <code>get</code> is the same. 这就是我们看见三个 <code>Starting new HTTPS connection</code> 日志行的原因</p>
<p>如果我们设置 <code>pool_connections</code> 为 2:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line">s.mount(<span class="string">'https://'</span>, HTTPAdapter(pool_connections=2))</span><br><span class="line">s.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">s.get(<span class="string">'https://www.zhihu.com'</span>)</span><br><span class="line">s.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line"><span class="string">""</span><span class="string">"output</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.baidu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 None</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.zhihu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 2623</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 None</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br></pre></td></tr></table></figure>

<p>很好，现在我们可以创建连接俩次了并且保持连接活跃</p>
<p>最后, <code>pool_maxsize</code>.</p>
<p>首先, 仅当你在多线程环境下使用session，你才应该关心 <code>pool_maxsize</code> , 例如，从多个线程使用同一个session发出并发请求.</p>
<p>实际上，<code>pool_maxsize</code> 是一个用来初始化urllib3’s <code>HTTPConnectionPool的参数</code>, 它才是真正含义上的连接池. <code>HTTPConnectionPool</code> 是一个容器，针对于特定的host保存连接的集合, 且 <code>pool_maxsize</code> 是这个集合的最大值. 如果你运行你的代码在同一个线程，它是不可能针对多个主机创建多个连接的，因为 requests library 是阻塞的, 因此HTTP请求总是一个接着一个发送.</p>
<p>如果使用多线程就会不一样.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">def thread_get(url):</span><br><span class="line">    s.get(url)</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line">s.mount(<span class="string">'https://'</span>, HTTPAdapter(pool_connections=1, pool_maxsize=2))</span><br><span class="line">t1 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com'</span>,))</span><br><span class="line">t2 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/36612174'</span>,))</span><br><span class="line">t1.start();t2.start()</span><br><span class="line">t1.join();t2.join()</span><br><span class="line">t3 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/39420364'</span>,))</span><br><span class="line">t4 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/21362402'</span>,))</span><br><span class="line">t3.start();t4.start()</span><br><span class="line"><span class="string">""</span><span class="string">"output</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.zhihu.com</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (2): www.zhihu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/36612174 HTTP/1.1<span class="string">" 200 21906</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 2606</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/21362402 HTTP/1.1<span class="string">" 200 57556</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/39420364 HTTP/1.1<span class="string">" 200 28739</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br></pre></td></tr></table></figure>

<p>看见了吗? 它为相同的host建立了俩个连接： <code>www.zhihu.com</code>, 就像我说的, 这个仅发生在多线程环境下. 在这个例子中，我们创建了一个连接池，使用了参数 <code>pool_maxsize=2</code>, 发现同一时间不会超过俩个连接，因此这是足够的，我们看到<code>t3</code> 和 <code>t4</code> 没有创建新的连接，他们重用了就的连接.</p>
<p>如果没有足够的大小呢?</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line">s.mount(<span class="string">'https://'</span>, HTTPAdapter(pool_connections=1, pool_maxsize=1))</span><br><span class="line">t1 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com'</span>,))</span><br><span class="line">t2 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/36612174'</span>,))</span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line">t1.join();t2.join()</span><br><span class="line">t3 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/39420364'</span>,))</span><br><span class="line">t4 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/21362402'</span>,))</span><br><span class="line">t3.start();t4.start()</span><br><span class="line">t3.join();t4.join()</span><br><span class="line"><span class="string">""</span><span class="string">"output</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.zhihu.com</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (2): www.zhihu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/36612174 HTTP/1.1<span class="string">" 200 21906</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 2606</span></span><br><span class="line"><span class="string">WARNING:requests.packages.urllib3.connectionpool:Connection pool is full, discarding connection: www.zhihu.com</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (3): www.zhihu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/39420364 HTTP/1.1<span class="string">" 200 28739</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/21362402 HTTP/1.1<span class="string">" 200 57556</span></span><br><span class="line"><span class="string">WARNING:requests.packages.urllib3.connectionpool:Connection pool is full, discarding connection: www.zhihu.com</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br></pre></td></tr></table></figure>

<p>现在, <code>pool_maxsize=1</code>，会打印警告日志如下，就像下面的:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Connection pool is full, discarding connection: www.zhihu.com</span><br></pre></td></tr></table></figure>

<p>可以注意到仅有一个连接被保存在连接池中, 为t3或者t4创建一个新的连接. 很明显这是不够的. 这就是为什么在 urllib3’s 文档中说明如下:</p>
<blockquote>
<p>如果你计划在连接池环境下使用一个连接池, 你应该设置连接池最大数量为一个比较高的值，例如和线程的数量相同.</p>
</blockquote>
<p>最后, <code>HTTPAdapter</code> 实例映射到不同的前缀是相互独立的.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line">s.mount(<span class="string">'https://'</span>, HTTPAdapter(pool_connections=1, pool_maxsize=2))</span><br><span class="line">s.mount(<span class="string">'https://baidu.com'</span>, HTTPAdapter(pool_connections=1, pool_maxsize=1))</span><br><span class="line">t1 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com'</span>,))</span><br><span class="line">t2 =Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/36612174'</span>,))</span><br><span class="line">t1.start();t2.start()</span><br><span class="line">t1.join();t2.join()</span><br><span class="line">t3 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/39420364'</span>,))</span><br><span class="line">t4 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/21362402'</span>,))</span><br><span class="line">t3.start();t4.start()</span><br><span class="line">t3.join();t4.join()</span><br><span class="line"><span class="string">""</span><span class="string">"output</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.zhihu.com</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (2): www.zhihu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/36612174 HTTP/1.1<span class="string">" 200 21906</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 2623</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/39420364 HTTP/1.1<span class="string">" 200 28739</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/21362402 HTTP/1.1<span class="string">" 200 57669</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br></pre></td></tr></table></figure>

<p>上面的代码很容易，不需要再次解释了.</p>
<p>就这样了，希望这篇文章帮助你更好的理解requests库. 顺便说一下，我创建了一个gist <a href="https://gist.github.com/laike9m/ead19c65a416c7022c00" target="_blank" rel="noopener">here</a> 这里包含这篇文章的测试代码. 随便下载并尝试吧</p>
<h2 id="Appendix"><a href="#Appendix" class="headerlink" title="Appendix"></a>Appendix</h2><ol>
<li><p>For https, requests uses urllib3’s <a href="http://urllib3.readthedocs.org/en/latest/pools.html#urllib3.connectionpool.HTTPSConnectionPool" target="_blank" rel="noopener">HTTPSConnectionPool</a>, but it’s pretty much the same as HTTPConnectionPool so I didn’t differeniate them in this article.</p>
</li>
<li><p><code>Session</code>‘s <code>mount</code> method ensures the longest prefix gets matched first. Its implementation is pretty interesting so I posted it here.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mount</span><span class="params">(self, prefix, adapter)</span>:</span></span><br><span class="line">    <span class="string">"""Registers a connection adapter to a prefix.</span></span><br><span class="line"><span class="string">    Adapters are sorted in descending order by key length."""</span></span><br><span class="line">    self.adapters[prefix] = adapter</span><br><span class="line">    keys_to_move = [k <span class="keyword">for</span> k <span class="keyword">in</span> self.adapters <span class="keyword">if</span> len(k) &lt; len(prefix)]</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> keys_to_move:</span><br><span class="line">        self.adapters[key] = self.adapters.pop(key)</span><br></pre></td></tr></table></figure>

<p>Note that <code>self.adapters</code> is an <code>OrderedDict</code>.</p>
</li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/05/30/Algo.%20Ult./seminar_2%20&amp;%203/">Algo. Ult./seminar_2 &amp; 3</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-05-30</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/AlgoUlt/">AlgoUlt.</a></span><div class="content"><h2 id="645-識別名人"><a href="#645-識別名人" class="headerlink" title="645. 識別名人"></a>645. 識別名人</h2><ul>
<li><p>其他人他都不認識的，他就是名人</p>
</li>
<li><p>最多只會有一個名人，或「不存在」，不會有兩個名人</p>
</li>
<li><p>降低兩兩比較的時間！Trick! ==&gt; </p>
</li>
<li><p>as 892 Alien Dictionary, as 1836 Reaching Point</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">The knows API is already defined for you.</span></span><br><span class="line"><span class="string">@param a, person a</span></span><br><span class="line"><span class="string">@param b, person b</span></span><br><span class="line"><span class="string">@return a boolean, whether a knows b</span></span><br><span class="line"><span class="string">you can call Celebrity.knows(a, b)</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="comment"># @param &#123;int&#125; n a party with n people</span></span><br><span class="line">    <span class="comment"># @return &#123;int&#125; the celebrity's label or -1</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findCelebrity</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        <span class="comment"># return self.bf_NxN(n)</span></span><br><span class="line">        <span class="keyword">return</span> self.O_N(n)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">O_N</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        <span class="comment"># 候選人＝ 0 </span></span><br><span class="line">        <span class="comment"># for 循環遍歷其他的人 (1~n-1): i</span></span><br><span class="line">        <span class="comment">#     if i 認識候選人：</span></span><br><span class="line">        <span class="comment">#         i　不可能是名人</span></span><br><span class="line">        <span class="comment">#     if i 不認識至選人：</span></span><br><span class="line">        <span class="comment">#         候選人不可能是名人</span></span><br><span class="line">        <span class="comment">#         i　可能是名人</span></span><br><span class="line">        <span class="comment">#         ==&gt; 讓 i 成為最後的候選人</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># for 所有人判斷該候選人是否是名人</span></span><br><span class="line">        cand = <span class="number">0</span>    <span class="comment"># candidate</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</span><br><span class="line">            <span class="comment"># if Celebrity.knows(i, cand):</span></span><br><span class="line">            <span class="comment">#     cand = cand</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> Celebrity.knows(i, cand):</span><br><span class="line">                cand = i</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">if</span> i == cand:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> Celebrity.knows(cand, i) <span class="keyword">or</span> <span class="keyword">not</span> Celebrity.knows(i, cand):</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">        <span class="keyword">return</span> cand    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bf_NxN</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        <span class="comment"># Write your code here</span></span><br><span class="line">        <span class="comment"># for  所有人</span></span><br><span class="line">        <span class="comment">#   判斷這個人是否是名人 ==&gt; for其他所有人看是否其他人認識ｉ、ｉ是否認識其他人 </span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            is_celebrity = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">                <span class="keyword">if</span> i == j:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                    </span><br><span class="line">                <span class="keyword">if</span> Celebrity.knows(i, j) <span class="keyword">or</span> <span class="keyword">not</span> Celebrity.knows(j, i):</span><br><span class="line">                    is_celebrity = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">if</span> is_celebrity:</span><br><span class="line">                <span class="keyword">return</span> i</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>



<h2 id="654-稀疏矩陣乘法"><a href="#654-稀疏矩陣乘法" class="headerlink" title="654. 稀疏矩陣乘法"></a>654. 稀疏矩陣乘法</h2><ul>
<li>將兩個Matrix 相乘，</li>
</ul>
<ol>
<li><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfdpp1hf9gj30qa0c4q4t.jpg" alt="image-20200602095856594" style="zoom:50%;" />

<p>As Merge 2 sorted array, 雙指針讓兩條的值相等時再相乘</p>
<img src="/Users/joe/Library/Application Support/typora-user-images/image-20200602100301997.png" alt="image-20200602100301997" style="zoom:67%;" />



</li>
</ol>
<p>   Further:</p>
<ul>
<li><p>現在有兩個向量，非常稀疏，其中假設非0個數為n, 如何 O(n) 時間得到這兩個向量的乘積？</p>
<ul>
<li><p>如果是用arr存的話，再怎樣也要O(N)</p>
</li>
<li><p><strong>(Index, val)</strong>; LinkedList存才行  Arraylist<Node> or LinkedList<Node></p>
<ul>
<li>Two pointer method!</li>
</ul>
</li>
<li><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfdqlv9hfrj308g08gt9m.jpg" alt="image-20200602103032402" style="zoom:50%;" />
</li>
<li><p>　給過來的要是Node才有意義，如果是Array的話就沒意義了</p>
</li>
</ul>
</li>
</ul>
<ol start="2">
<li>PUSH method</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    @param A: a sparse matrix</span></span><br><span class="line"><span class="string">    @param B: a sparse matrix</span></span><br><span class="line"><span class="string">    @return: the result of A * B</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">multiply</span><span class="params">(self, A, B)</span>:</span></span><br><span class="line">        <span class="comment"># write your code here</span></span><br><span class="line">        <span class="comment"># return self.BF(A, B)</span></span><br><span class="line">        <span class="keyword">return</span> self.two_pointers(A, B)  <span class="comment"># optimization 1</span></span><br><span class="line">        <span class="keyword">return</span> self.push_model(A, B)    <span class="comment"># optimization 2</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment"># PUSH model: 通過原料加到結果裡面</span></span><br><span class="line">    <span class="comment"># 不是對於每個C裡的每個值拿A、B裡的每一個東西，而是看A裡面的每個值會對C裡的</span></span><br><span class="line">    <span class="comment"># 哪些值產生影響</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push_model</span><span class="params">(self, A, B)</span>:</span></span><br><span class="line">        n = len(A)</span><br><span class="line">        m = len(A[<span class="number">0</span>])</span><br><span class="line">        k = len(B[<span class="number">0</span>])</span><br><span class="line">        </span><br><span class="line">        C = [[<span class="number">0</span>] * k <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 如果A中非0元素為常數級別 ==&gt; O(N^2)</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(m):</span><br><span class="line">                <span class="string">""" 以下兩行為PUSH model的優化 """</span></span><br><span class="line">                <span class="keyword">if</span> A[i][j] == <span class="number">0</span>:    <span class="comment"># 但B裡面還是沒有優化到</span></span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">for</span> t <span class="keyword">in</span> range(k):</span><br><span class="line">                    C[i][t] += A[i][j] * B[j][t]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> C        </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">two_pointers_new</span><span class="params">(self, A, B)</span>:</span></span><br><span class="line">        n = len(A)</span><br><span class="line">        m = len(A[<span class="number">0</span>])</span><br><span class="line">        k = len(B[<span class="number">0</span>])</span><br><span class="line">        </span><br><span class="line">        row_vec = []</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">two_pointers</span><span class="params">(self, A, B)</span>:</span></span><br><span class="line">        n = len(A)</span><br><span class="line">        m = len(A[<span class="number">0</span>])</span><br><span class="line">        k = len(B[<span class="number">0</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 假設 n, m, k 是相同數量級</span></span><br><span class="line">        <span class="comment"># O(n^2)</span></span><br><span class="line">        row_vector = [</span><br><span class="line">            [</span><br><span class="line">                (j, A[i][j])</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(m)</span><br><span class="line">                <span class="keyword">if</span> A[i][j] != <span class="number">0</span></span><br><span class="line">            ]    </span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(n)</span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># O(n^2)</span></span><br><span class="line">        col_vector = [</span><br><span class="line">            [</span><br><span class="line">                (i, B[i][j])</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(m)</span><br><span class="line">                <span class="keyword">if</span> B[i][j] != <span class="number">0</span></span><br><span class="line">            ]    </span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(k)</span><br><span class="line">        ]</span><br><span class="line">        <span class="comment"># Java C++ 只能Hashmap套ArrayList</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># O(n^2 * O(self.multi()))</span></span><br><span class="line">        C = [</span><br><span class="line">                [</span><br><span class="line">                    self.multi(row, col)</span><br><span class="line">                    <span class="keyword">for</span> col <span class="keyword">in</span> col_vector</span><br><span class="line">                ]</span><br><span class="line">                <span class="keyword">for</span> row <span class="keyword">in</span> row_vector</span><br><span class="line">            ]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># C = [[0] * k for i in range(n)]</span></span><br><span class="line">        <span class="keyword">return</span> C</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># row = [(0,1), (2,3), (3,5)]</span></span><br><span class="line">        <span class="comment"># col = [(1,2), (3,5)]</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment"># O(len(row) + len(col)) ==&gt;  行向量與列向量中非0元素的個數</span></span><br><span class="line">    <span class="comment"># ==&gt; 假設非0元素個數是常數級  ==&gt;  O(1), 如 1000x1000，但只有10、20個有值</span></span><br><span class="line">    <span class="comment"># As Merge Two sorted array</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    A = [</span></span><br><span class="line"><span class="string">            [1,0,0],</span></span><br><span class="line"><span class="string">            [-1,0,3]</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">    B = [</span></span><br><span class="line"><span class="string">            [7,0,0]</span></span><br><span class="line"><span class="string">            [0,0,0]</span></span><br><span class="line"><span class="string">            [0,0,1]</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">    mapping_A:</span></span><br><span class="line"><span class="string">        0: [0]</span></span><br><span class="line"><span class="string">        1: [0,2]</span></span><br><span class="line"><span class="string">            　↑</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    mapping_B:</span></span><br><span class="line"><span class="string">        0:[0]</span></span><br><span class="line"><span class="string">        1:[]</span></span><br><span class="line"><span class="string">        2:[2]</span></span><br><span class="line"><span class="string">        　 ↑</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">multi</span><span class="params">(self, row, col)</span>:</span></span><br><span class="line">        <span class="comment"># 雙指針</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        ans = <span class="number">0</span> <span class="comment"># 向量相乘後的結果</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; len(row) <span class="keyword">and</span> j &lt; len(col):</span><br><span class="line">            index1, val1 = row[i]</span><br><span class="line">            index2, val2 = col[j]</span><br><span class="line">            <span class="keyword">if</span> index1 &lt; index2:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> index1 &gt; index2:</span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ans += val1 * val2</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> ans</span><br><span class="line">                </span><br><span class="line">    <span class="comment"># PULL model</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">BF</span><span class="params">(self, A, B)</span>:</span></span><br><span class="line">        m, n, k = len(A), len(A[<span class="number">0</span>]), len(B[<span class="number">0</span>])</span><br><span class="line">        C = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(k)] <span class="keyword">for</span> _ <span class="keyword">in</span> range(m)]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(k):</span><br><span class="line">                <span class="keyword">for</span> t <span class="keyword">in</span> range(n):</span><br><span class="line">                    C[i][j] += A[i][t] * B[t][j]</span><br><span class="line">        <span class="keyword">return</span> C</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">BF_old</span><span class="params">(self, A, B)</span>:</span></span><br><span class="line">        n = len(A)</span><br><span class="line">        m = len(A[<span class="number">0</span>])</span><br><span class="line">        k = len(B[<span class="number">0</span>])</span><br><span class="line">        </span><br><span class="line">        C = [[<span class="number">0</span>]*k <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(k):</span><br><span class="line">                <span class="comment"># C[i][j] = A[i][t] * B[t][j]</span></span><br><span class="line">                <span class="keyword">for</span> t <span class="keyword">in</span> range(m):</span><br><span class="line">                    C[i][j] += A[i][t] * B[t][j]</span><br><span class="line">        <span class="keyword">return</span> C</span><br></pre></td></tr></table></figure>



<h2 id="140-快速冪"><a href="#140-快速冪" class="headerlink" title="140. 快速冪"></a>140. 快速冪</h2><ul>
<li>求 a**n%b</li>
<li>其中 n非常大 (n &lt;= 10**9)</li>
<li>如何獲得logn的複雜度？</li>
<li>思想：a*^1000 &lt;== (a^500)^2</li>
<li>a ^ 10000000000 &lt;== a ^ 5000000000 &lt;== </li>
<li>問題規模: n -&gt; n/2 -&gt; n/4 -&gt; n/8 -&gt; n/16</li>
<li>討論平方關係：<ul>
<li>x^(n/2) * x(^n/2): O(N)，只是divide &amp; conquer，但每個還是重複算了</li>
<li>x^(n/2) ** 2: O(logN)   思想不同上面的！是真正的切半</li>
</ul>
</li>
<li>related to 949 fibII、65</li>
</ul>
<h2 id="Freq"><a href="#Freq" class="headerlink" title="Freq:"></a>Freq:</h2><p>—————– 很常見 </p>
<ol>
<li>BFS</li>
<li>模擬(interger -&gt; roman OA)、隱式圖老題 (數獨、word ladder (X)，word break Ⅱ 必須要最優化, dfs暴力指數級，dp(O(N)))、K largest … (Amazon)</li>
</ol>
<p>—————– 比較常見</p>
<ol start="3">
<li><p>DFS、二叉樹、基礎DP(背包、序列型dp、坐標型dp、雙序列型dp(LCS)、常見的問題(LIS、LPS))、二分答案、前缀和</p>
</li>
<li><p>LRU、LFU、雙指針 (Sliding Window), LInkedList (老題、快慢、環、相交點)、Copy Linked List with random pointer、掃描線、單調棧</p>
</li>
</ol>
<p>—————– 基本不怎麼出現</p>
<ol start="5">
<li>二分搜索、數據結構(heap, quick select)、比較難的DP(區間DP、概率DP、狀態壓縮DP (TSP)), Union find, sort, trie (quantcast(OA)), segment tree，紅黑樹(G)，dfs非遞歸實現 (樹的非遞歸遍歷)、矩陣快速冪</li>
<li>Floyd, dij, spfa</li>
</ol>
<p>Graph ==&gt; BFS, DFS, targan(Amazon), Union find, dij, Floyd (最小生成樹)</p>
<ul>
<li>Find Critical connection (Amazon!) V</li>
</ul>
<p>A onsite: Stone Game</p>
<p>Word Ladder 2</p>
<h1 id="Seminar-3"><a href="#Seminar-3" class="headerlink" title="Seminar 3"></a>Seminar 3</h1><ul>
<li></li>
</ul>
<h2 id="1310-數組除了自身的乘積"><a href="#1310-數組除了自身的乘積" class="headerlink" title="1310. 數組除了自身的乘積"></a>1310. 數組除了自身的乘積</h2><ol>
<li>左往右，前綴積: prefix[i] = nums[0] * … * nums[i]</li>
<li>右往左，後綴積: suffix[i] = nums[i] * … * nums[n-1</li>
<li>遍歷所有位置 outpus[i] = prefix[i-1] * suffix[i+1]</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    @param nums: an array of integers</span></span><br><span class="line"><span class="string">    @return: the product of all the elements of nums except nums[i].</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">productExceptSelf</span><span class="params">(self, nums)</span>:</span></span><br><span class="line">        <span class="comment"># write your code here</span></span><br><span class="line">        <span class="comment"># return self.O_N(nums)</span></span><br><span class="line">        <span class="keyword">return</span> self.O_1(nums)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">O_1</span><span class="params">(self, nums)</span>:</span></span><br><span class="line">        <span class="comment"># 從前往後掃，把當前的前綴積放到output中</span></span><br><span class="line">        <span class="comment"># 從後往前掃，把當前的後綴積乘上output[i]</span></span><br><span class="line">        n = len(nums)</span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">            </span><br><span class="line">        output = [<span class="number">1</span>] * n</span><br><span class="line"></span><br><span class="line">        prefix = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            output[i] = prefix</span><br><span class="line">            prefix *= nums[i]</span><br><span class="line">        </span><br><span class="line">        suffix = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n<span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            output[i] *= suffix</span><br><span class="line">            suffix *= nums[i]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">O_N</span><span class="params">(self, nums)</span>:</span></span><br><span class="line">        <span class="comment"># 1. 左往右，前綴積: prefix[i] = nums[0] * ... * nums[i]</span></span><br><span class="line">        <span class="comment"># 2. 右往左，後綴積: suffix[i] = nums[i] * ... * nums[n-1</span></span><br><span class="line">        <span class="comment"># 3. 遍歷所有位置 outpus[i] = prefix[i-1] * suffix[i+1]</span></span><br><span class="line">        n = len(nums)</span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">            </span><br><span class="line">        output = [<span class="number">0</span>] * n</span><br><span class="line">        prefix = [<span class="number">0</span>] * n</span><br><span class="line">        suffix = [<span class="number">0</span>] * n</span><br><span class="line">        </span><br><span class="line">        prefix[<span class="number">0</span>] = nums[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</span><br><span class="line">            prefix[i] = prefix[i<span class="number">-1</span>] * nums[i]</span><br><span class="line">        </span><br><span class="line">        suffix[n<span class="number">-1</span>] = nums[n<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n<span class="number">-2</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            suffix[i] = suffix[i+<span class="number">1</span>] * nums[i]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">                output[i] = suffix[i+<span class="number">1</span>]</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> i == n - <span class="number">1</span>:</span><br><span class="line">                output[i] = prefix[i<span class="number">-1</span>]</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            output[i] = prefix[i<span class="number">-1</span>] * suffix[i+<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> output</span><br></pre></td></tr></table></figure>



<h2 id="1844-子數組和為K-II"><a href="#1844-子數組和為K-II" class="headerlink" title="1844. 子數組和為K II"></a>1844. 子數組和為K II</h2><ul>
<li>為何不能用雙指針？<ul>
<li>因為有負數的。。。太慘。。</li>
</ul>
</li>
<li>基础版：838子数组和为K</li>
<li>Follow up: 1507.和至少為K的最短長度</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfg232v0fqj30wg0eqadb.jpg" alt="image-20200604103838917"></p>
<h2 id="1507-和至少为K的最短长度"><a href="#1507-和至少为K的最短长度" class="headerlink" title="1507. 和至少为K的最短长度"></a>1507. 和至少为K的最短长度</h2><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfg2ia573fj30y80jcn3e.jpg" alt="image-20200604105311696"></p>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfg2oc4xwbj30im0ictc7.jpg" alt="image-20200604105910757" style="zoom:67%;" />



<h2 id="391-數飛機"><a href="#391-數飛機" class="headerlink" title="391. 數飛機"></a>391. 數飛機</h2><ul>
<li>差分前綴和</li>
<li>根據原數組獲得差分數組 ==&gt; 求前綴和</li>
<li>什麼是差分數組？</li>
</ul>
<img src="/Users/joe/Library/Application Support/typora-user-images/image-20200604112647832.png" alt="image-20200604112647832" style="zoom:67%;" />



<h2 id="194-寻找单词"><a href="#194-寻找单词" class="headerlink" title="194. 寻找单词"></a>194. 寻找单词</h2><ol>
<li>BF 雙指針</li>
</ol>
<img src="/Users/joe/Library/Application Support/typora-user-images/image-20200604113217218.png" alt="image-20200604113217218" style="zoom:67%;" />

<ol start="2">
<li><p>大暴力 2^N 空間</p>
</li>
<li><p>hashmap 存所有字母出現的位置</p>
<ul>
<li>o:[2,4,9,15]</li>
<li>index = 5</li>
<li>去找下一個o<ul>
<li>二分</li>
</ul>
</li>
<li>aaaaaaaaaaa<ul>
<li>a: [1,2,3,4,5,6,7,8,9,10]</li>
<li>index = 4</li>
</ul>
</li>
<li>O(m x logN x k)</li>
</ul>
</li>
<li><p>當前字符串的後一個任意字符的位置 ★待學習　</p>
</li>
</ol>
<h4 id="Sol"><a href="#Sol" class="headerlink" title="Sol"></a>Sol</h4><h5 id="O-N-2-的預處理，太慢"><a href="#O-N-2-的預處理，太慢" class="headerlink" title="O(N^2) 的預處理，太慢"></a>O(N^2) 的預處理，太慢</h5><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfppb5ahcjj30ry0dcaf6.jpg" alt="image-20200612185220046"></p>
<h5 id="O-N-預處理-by-後往前遞推！"><a href="#O-N-預處理-by-後往前遞推！" class="headerlink" title="O(N) 預處理 by 後往前遞推！"></a>O(N) 預處理 by 後往前遞推！</h5><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfpq0quxeuj30ia0kc7be.jpg" alt="image-20200612191700269"></p>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfppn80qp6j308c03wgmj.jpg" alt="image-20200612190400078" style="zoom: 67%;" />

<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfppol54aej30c600m74i.jpg" alt="image-20200612190519367"></p>
<h2 id="946-233-Matrix"><a href="#946-233-Matrix" class="headerlink" title="946. 233 Matrix"></a>946. 233 Matrix</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">MOD = <span class="number">10000007</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Matrix</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, n, m)</span>:</span></span><br><span class="line">        self.mat = [[<span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> range(m)] <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line">        self.n = n</span><br><span class="line">        self.m = m</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># A * B ==&gt; A.__mul__(B)    n*m (x) m*k</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__mul__</span><span class="params">(self, matrix)</span>:</span></span><br><span class="line">        k = len(matrix.mat[<span class="number">0</span>])</span><br><span class="line">        tmp = Matrix(self.n, k) <span class="comment"># <span class="doctag">TODO:</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    @param X: a list of integers</span></span><br><span class="line"><span class="string">    @param m: an integer</span></span><br><span class="line"><span class="string">    @return: return an integer</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcTheValueOfAnm</span><span class="params">(self, X, m)</span>:</span></span><br><span class="line">        <span class="comment"># write your code here</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> X <span class="keyword">and</span> m == <span class="number">0</span>:    <span class="comment"># 特判</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="comment"># return self.O_NxM_MLE(X, m)</span></span><br><span class="line">        <span class="comment"># return self.O_N_TLE(X, m)</span></span><br><span class="line">        <span class="comment"># return self.O_lgN(X, m)   # TODO ... not OK now</span></span><br><span class="line">        <span class="keyword">return</span> self.sol(X, m)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sol</span><span class="params">(self, X, m)</span>:</span></span><br><span class="line">        <span class="comment"># write your code here</span></span><br><span class="line">        n = len(X)</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">0</span> <span class="keyword">and</span> m == <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span>(m == <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">return</span> X[n - <span class="number">1</span>]</span><br><span class="line">        self.n, self.mod = n + <span class="number">2</span>, <span class="number">10000007</span></span><br><span class="line">        A = [[<span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> range(n + <span class="number">2</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> range(n + <span class="number">2</span>)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n + <span class="number">1</span>):</span><br><span class="line">            A[i][<span class="number">0</span>] = <span class="number">10</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n + <span class="number">2</span>):</span><br><span class="line">            A[i][n + <span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, i + <span class="number">1</span>):</span><br><span class="line">                A[i][j] = <span class="number">1</span></span><br><span class="line">        tmp = self.power(A, m);</span><br><span class="line">        ans = tmp[n][<span class="number">0</span>] * <span class="number">23</span> + tmp[n][n + <span class="number">1</span>] * <span class="number">3</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">            ans += tmp[n][i] * X[i - <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> ans % <span class="number">10000007</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mul</span><span class="params">(self, A, B)</span>:</span></span><br><span class="line">        tmp = [[<span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> range(self.n)] <span class="keyword">for</span> i <span class="keyword">in</span> range(self.n)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.n):</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> range(self.n):</span><br><span class="line">                <span class="keyword">if</span> (A[i][k] == <span class="number">0</span>):</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(self.n):</span><br><span class="line">                    tmp[i][j] = (tmp[i][j] + A[i][k] * B[k][j]) % self.mod</span><br><span class="line">        <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">power</span><span class="params">(self, A, a)</span>:</span></span><br><span class="line">        B = [[<span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> range(self.n)] <span class="keyword">for</span> i <span class="keyword">in</span> range(self.n)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.n):</span><br><span class="line">            B[i][i] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> a &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> (a % <span class="number">2</span> == <span class="number">1</span>):</span><br><span class="line">                B = self.mul(B, A)</span><br><span class="line">            A = self.mul(A, A)</span><br><span class="line">            a //= <span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> B</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">O_lgN_tmpl</span><span class="params">(self, X, m)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span>    <span class="comment"># <span class="doctag">TODO:</span></span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    23      10*A[0][0]+3        10*A[0][1]+3        10*A[0][2]+3</span></span><br><span class="line"><span class="string">    a1      a1+↑</span></span><br><span class="line"><span class="string">    a2      a2+↑</span></span><br><span class="line"><span class="string">    a3      a3+↑</span></span><br><span class="line"><span class="string">    a4      a4+↑</span></span><br><span class="line"><span class="string">    """</span>    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">O_lgN</span><span class="params">(self, X, m)</span>:</span>  <span class="comment"># FastPow, Buggy... for m, n and DIM</span></span><br><span class="line">        n = len(X)</span><br><span class="line">        col = [<span class="number">0</span>] * (n+<span class="number">2</span>)</span><br><span class="line">        col[<span class="number">0</span>] = <span class="number">23</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n+<span class="number">2</span><span class="number">-1</span>): <span class="comment">#  23</span></span><br><span class="line">            <span class="comment"># print(col)</span></span><br><span class="line">            col[i] = X[i<span class="number">-1</span>]       <span class="comment">#  a1</span></span><br><span class="line">                                  <span class="comment">#  a2</span></span><br><span class="line">                                  <span class="comment">#  a3</span></span><br><span class="line">                                  <span class="comment">#  3</span></span><br><span class="line">        col[<span class="number">-1</span>] = <span class="number">3</span></span><br><span class="line">        print(<span class="string">"col: &#123;&#125;"</span>.format(col))</span><br><span class="line">        <span class="comment"># T : (n+2) x (m+2)</span></span><br><span class="line">        <span class="string">"""""</span></span><br><span class="line"><span class="string">        doc WRONG!!! ↓  n should be equal to len(vec)</span></span><br><span class="line"><span class="string">        [   </span></span><br><span class="line"><span class="string">            [10, 0, 0, 0, 1],</span></span><br><span class="line"><span class="string">            [10, 1, 0, 0, 1],</span></span><br><span class="line"><span class="string">            [10, 1, 1, 0, 1],</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">            CORRECT　↓  for [0,0,3], 2</span></span><br><span class="line"><span class="string">        [   </span></span><br><span class="line"><span class="string">            [10, 0, 0, 0, 1],</span></span><br><span class="line"><span class="string">            [10, 1, 0, 0, 1],</span></span><br><span class="line"><span class="string">            [10, 1, 1, 0, 1],</span></span><br><span class="line"><span class="string">            [10, 1, 1, 1, 1],</span></span><br><span class="line"><span class="string">            [10, 1, 1, 1, 1],            </span></span><br><span class="line"><span class="string">        ]            </span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># T = [[0] * (m+2) for _ in range(n+2)]   # WRONG!!!</span></span><br><span class="line">        T = [[<span class="number">0</span>] * (n+<span class="number">2</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(n+<span class="number">2</span>)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n+<span class="number">2</span>):</span><br><span class="line">            T[i][<span class="number">0</span>] = <span class="number">10</span></span><br><span class="line">            T[i][<span class="number">-1</span>] = <span class="number">1</span></span><br><span class="line">        <span class="comment"># print("T: \n&#123;&#125;".format(T))</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n+<span class="number">2</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n+<span class="number">2</span>):</span><br><span class="line">                <span class="keyword">if</span> i &gt;= j:</span><br><span class="line">                    T[i][j] = <span class="number">1</span></span><br><span class="line">        print(<span class="string">"T OK: \n&#123;&#125;"</span>.format(T))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(m):</span><br><span class="line">            col = self.transform(T, col)</span><br><span class="line">            col[<span class="number">-1</span>] = <span class="number">3</span></span><br><span class="line">            print(col)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> col[<span class="number">-2</span>]</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">transform</span><span class="params">(self, A, vec)</span>:</span>    <span class="comment"># diff frome general __mul__ 'cause of DIM issue, so better use class template...</span></span><br><span class="line">        n, m = len(A), len(A[<span class="number">0</span>])</span><br><span class="line">        print(n, m, len(vec))</span><br><span class="line">        k = <span class="number">1</span></span><br><span class="line">        C = [<span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> range(n+<span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(m):</span><br><span class="line">                C[i] += A[i][j] * vec[j]</span><br><span class="line">        <span class="keyword">return</span> C</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># def mul(self, A, B):</span></span><br><span class="line">    <span class="comment">#     n, m, k = len(A), len(A[0]), len(B[0])</span></span><br><span class="line">    <span class="comment">#     print(n, m, len(B), k)</span></span><br><span class="line">    <span class="comment">#     C = [[0 for _ in range(k)] for _ in range(n)]</span></span><br><span class="line">    <span class="comment">#     for i in range(n):</span></span><br><span class="line">    <span class="comment">#         for t in range(k):</span></span><br><span class="line">    <span class="comment">#             for j in range(m):</span></span><br><span class="line">    <span class="comment">#                 C[i][t] = A[i][j] * B[j][t]</span></span><br><span class="line">    <span class="comment">#     return C</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">O_N_TLE</span><span class="params">(self, X, m)</span>:</span></span><br><span class="line">        n = len(X)</span><br><span class="line">        <span class="comment"># T = [[0] * (m+1) for _ in range(n+1)]</span></span><br><span class="line">        col = [<span class="number">0</span>] * (n+<span class="number">1</span>)</span><br><span class="line">        col[<span class="number">0</span>] = <span class="number">23</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># for j in range(1, m+1):</span></span><br><span class="line">        <span class="comment">#     T[0][j] = 10*T[0][j-1] +  3</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n+<span class="number">1</span>):</span><br><span class="line">            col[i] = X[i<span class="number">-1</span>]</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, m+<span class="number">1</span>):</span><br><span class="line">            <span class="comment"># print(T)</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, n+<span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">                    col[i] = <span class="number">10</span> * col[i] + <span class="number">3</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    col[i] = col[i] + col[i<span class="number">-1</span>]</span><br><span class="line">            </span><br><span class="line">        <span class="comment"># print(T)</span></span><br><span class="line">        <span class="keyword">return</span> col[n] % MOD</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">O_NxM_MLE</span><span class="params">(self, X, m)</span>:</span></span><br><span class="line">        n = len(X)</span><br><span class="line">        T = [[<span class="number">0</span>] * (m+<span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(n+<span class="number">1</span>)]</span><br><span class="line">        T[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">23</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, m+<span class="number">1</span>):</span><br><span class="line">            T[<span class="number">0</span>][j] = <span class="number">10</span>*T[<span class="number">0</span>][j<span class="number">-1</span>] +  <span class="number">3</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n+<span class="number">1</span>):</span><br><span class="line">            T[i][<span class="number">0</span>] = X[i<span class="number">-1</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># print(T)</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, m+<span class="number">1</span>):</span><br><span class="line">                T[i][j] = T[i<span class="number">-1</span>][j] + T[j][i<span class="number">-1</span>]</span><br><span class="line">        <span class="comment"># print(T)</span></span><br><span class="line">        <span class="keyword">return</span> T[n][m] % MOD</span><br></pre></td></tr></table></figure>



<h2 id="前綴和的定義和實現"><a href="#前綴和的定義和實現" class="headerlink" title="前綴和的定義和實現"></a>前綴和的定義和實現</h2><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfnnqe58rzj30qg0cg77y.jpg" alt="image-20200611002631135"></p>
<p>![image-20200611002923263](/Users/joe/Library/Application Support/typora-user-images/image-20200611002923263.png)</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfnnwnq0x7j30ue0eg79y.jpg" alt="image-20200611003241851"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfnny2cwesj30ts0cmzmq.jpg" alt="image-20200611003404254"></p>
<h4 id="2D"><a href="#2D" class="headerlink" title="2D"></a>2D</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfpably4w2j30ue0em44a.jpg" alt="image-20200612101348111"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfpaj7hx6oj30tu0emqde.jpg" alt="image-20200612102108325"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfpajm0uz8j30tu0dw0xw.jpg" alt="image-20200612102132182"></p>
<h4 id="動規V-S-前綴和"><a href="#動規V-S-前綴和" class="headerlink" title="動規V.S.前綴和"></a>動規V.S.前綴和</h4><ul>
<li><p>前綴和是一種特殊的動規</p>
</li>
<li><p>e.g.</p>
<ul>
<li><p>打劫房屋</p>
</li>
<li><p>不同路徑2D DP, 也是一種前綴和、DP、</p>
</li>
<li><p>爬樓梯</p>
<ul>
<li>dp = dp[i-1] + dp[i-2]</li>
</ul>
</li>
<li><p>股票</p>
<ul>
<li><p>DP思維: dp[i] profit</p>
<ul>
<li>dp[i] = max(dp[i-1], a[i] - min_cost)</li>
</ul>
</li>
<li><p>前綴思想：</p>
<ul>
<li><p>前綴最小值</p>
<p>Min_price, max_profit</p>
</li>
</ul>
</li>
<li><p>思維路徑：</p>
<ul>
<li>先想簡單的方法試起<ol>
<li>前綴<ol>
<li>前綴最小、最大</li>
<li>前綴和</li>
</ol>
</li>
<li>雙指針</li>
</ol>
</li>
<li>再想進階的辦法<ol>
<li>動規</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
<li><p>簡單法做起</p>
</li>
</ul>
</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/05/15/OOD/2019-05-15-OOD%20for%20Management%20System/">OOD/2019-05-15-OOD for Management System</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-05-15</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/OOD/">OOD</a></span><div class="content"><h1 id="Strategy-Pattern"><a href="#Strategy-Pattern" class="headerlink" title="Strategy Pattern"></a>Strategy Pattern</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">	Context *-- Strategy</span><br><span class="line">	Strategy &lt;|-- ConcreteStrategyA</span><br><span class="line">  Strategy &lt;|-- ConcreteStrategyB</span><br><span class="line">	Strategy : &lt;&lt;interface&gt;&gt;</span><br><span class="line">	Strategy : +execute()</span><br><span class="line">  ConcreteStrategyA : +execute()</span><br><span class="line">  ConcreteStrategyB : +execute()</span><br></pre></td></tr></table></figure>



<h1 id="Management-OOD"><a href="#Management-OOD" class="headerlink" title="Management OOD"></a>Management OOD</h1><ul>
<li>Gym </li>
<li>Parking lot</li>
<li>Restaurant</li>
<li>Library</li>
<li>Super market</li>
<li>Hotel</li>
</ul>
<p>– 模擬管理員的日常工作</p>
<h2 id="Clarify"><a href="#Clarify" class="headerlink" title="Clarify"></a>Clarify</h2><ul>
<li>parking lot</li>
<li>vehicle</li>
</ul>
<h2 id="Core-Object"><a href="#Core-Object" class="headerlink" title="Core Object"></a>Core Object</h2><ul>
<li>input?</li>
<li>output?</li>
<li>Elevator: Input: request; Output: elevator</li>
</ul>
<h2 id="Case"><a href="#Case" class="headerlink" title="Case"></a>Case</h2><ul>
<li>Reserve</li>
<li>Serve</li>
<li>Checkout</li>
</ul>
<h2 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h2><ul>
<li>收據形式以保管information</li>
<li>例子：圖書館管理裡別用User Class包個Book的list或Book Class 包個User；比較好是用個收據單紀錄哪個人借了什麼書</li>
</ul>
<h1 id="Design-Parking-lot"><a href="#Design-Parking-lot" class="headerlink" title="Design Parking lot"></a>Design Parking lot</h1><h2 id="Clarify-1"><a href="#Clarify-1" class="headerlink" title="Clarify"></a>Clarify</h2><ul>
<li><p>What, How, Who</p>
<ul>
<li>要管理什么？input? output?</li>
<li>Key words: parking lot、vehicle、parking spot </li>
<li>data member 性質的可不多考慮</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">	A[Vehicle] --&gt; B[ParkingLot] --&gt; C[Parking Spot]</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="Challenge"><a href="#Challenge" class="headerlink" title="Challenge"></a>Challenge</h3><ul>
<li><p>keywords 的各種種類的區別</p>
<ul>
<li><p>parking lot 類別</p>
<ul>
<li>露天：parking lot -&gt; parking spaces</li>
<li>停車塔多層樓: parking lot -&gt; parking level -&gt; parking spaces</li>
<li>室內機械室: parking lot -&gt; parking level (optional) -&gt;  -&gt;parking spaces -&gt; Upper/Lower space</li>
</ul>
</li>
<li><p>vehicle 類別</p>
<p>不同種類的車對設計的影響？</p>
<ul>
<li>Bus, </li>
<li>car, </li>
<li>motorcycle</li>
</ul>
</li>
<li><p>parking spot 類別</p>
<ul>
<li>殘疾人</li>
<li>充電車位</li>
</ul>
</li>
</ul>
</li>
<li><p>針對本題:</p>
<ul>
<li>考慮多層的Parking lot 沒錯層，考慮三種大小的車、不考慮殘疾、充電車位</li>
<li>當尋找合適車位時，要看是否為空　vs 特製化車位，彈性低不易擴展</li>
</ul>
</li>
</ul>
<p>How: </p>
<ul>
<li>如何車？<ul>
<li>已知信息：所有車位都是相同規格的</li>
</ul>
</li>
<li>角度：<ul>
<li>從車：開進停車場-&gt;經過每個位置看能否停-&gt;停進一個位置</li>
<li>從停車場: 開進停車場-&gt;返回一個能停的地方-&gt;停進一個位置</li>
</ul>
</li>
<li>規則：<ol>
<li>停車</li>
<li>收費</li>
</ol>
</li>
<li>假設針對時間收費</li>
</ul>
<h2 id="Core-Object-1"><a href="#Core-Object-1" class="headerlink" title="Core Object"></a>Core Object</h2><ul>
<li>What, Why, How</li>
<li>Core Ojbects 之間的 mapping 關係</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">	B[Bus] --&gt; P[ParkingLot]</span><br><span class="line">	C[Car] --&gt; P[ParkingLot]</span><br><span class="line">	M[Motorcycle] --&gt; P[ParkingLot]</span><br><span class="line">	P --&gt; Spot[Spot]</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Bad Desigs:　↓　</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">	class ParkingLot</span><br><span class="line">	ParkingLot: - List&lt;Car&gt; cars</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">	class Spot</span><br><span class="line">	Spot: - Car car</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li>不好的原因：<ol>
<li>停車場不可能去知道是不是停了什麼顏色的什麼車</li>
<li>Parking lot跟 Spot 都是靜態的Class, Car是個動態的東西；可以說Parking log 包含 spot；但靜態包動態的不好，停完車就出來了，車裡面放spot也無理</li>
<li>如果spot加了car也是加了一個不必要的dependency:<ul>
<li>假設Spot可叫讓Car拿他的車牌號叫get_plate()；但有天get_plate名字換了，Spot裡面的呼呼也要跟著變，但這是不合理的。</li>
<li>不必須的dependency, ParkingLot現在depend在Car, 把 cars刪了會無法 compile；車子的操作改變跟停車場沒鳥關係</li>
</ul>
</li>
<li>比較好是ParkingLog跟Splot有關係，用個parking ticket作紀錄，讓停車場去抽取這個關係就好</li>
</ol>
</li>
</ul>
<h2 id="Cases-Use-Case"><a href="#Cases-Use-Case" class="headerlink" title="Cases (Use Case)"></a>Cases (Use Case)</h2><ul>
<li><p>What, Why, How –  一份將做完的事的合約</p>
</li>
<li><p>根據類作思考，把自己想成是個去停車的人或把自己想像成自己是停車場 – Better!</p>
</li>
</ul>
<ol>
<li>車子 - 沒user Cases</li>
<li>Parking Lot ‘s features’<ul>
<li>Get available count</li>
<li>Park vehicle</li>
<li>Clear spot</li>
<li>Calculate price</li>
</ul>
</li>
<li>Spot <ul>
<li>N/A </li>
</ul>
</li>
</ol>
<h3 id="Management-常見-User-Case"><a href="#Management-常見-User-Case" class="headerlink" title="Management 常見 User Case:"></a>Management 常見 User Case:</h3><ul>
<li>Reservation: X</li>
<li><strong>Serve: Park vehicle</strong></li>
<li><strong>Check out: Clear spot + Calculate price</strong></li>
</ul>
<h2 id="Class-1"><a href="#Class-1" class="headerlink" title="Class"></a>Class</h2><ul>
<li>What, Why – 可交遞的東西, How – ?</li>
</ul>
<p>​    </p>
<table>
<thead>
<tr>
<th align="center">Use Cases</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><em>Get available count</em></td>
</tr>
<tr>
<td align="center">Park vehicle</td>
</tr>
<tr>
<td align="center">Clear Spot</td>
</tr>
<tr>
<td align="center">Calculate price</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">  class Vehicle &#123;</span><br><span class="line">  	- int size</span><br><span class="line">  &#125;</span><br><span class="line">	class ParkingLot &#123;</span><br><span class="line">		- List&lt;Level&gt; levels</span><br><span class="line">		- int availableCount</span><br><span class="line">	&#125;</span><br><span class="line">	class Level &#123;</span><br><span class="line">		- List&lt;Spot&gt; spots</span><br><span class="line">		- int availableCount</span><br><span class="line">	&#125;</span><br><span class="line">	class Spot &#123;</span><br><span class="line">		- boolean available</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	Vehicle: + int getSize()</span><br><span class="line">	ParkingLot: + int getAvailableCount()</span><br><span class="line">	ParkingLot: + List&lt;Spot&gt; findSpotsForBus(Bus b)</span><br><span class="line">	ParkingLot: + List&lt;Spot&gt; findSpotsForBus(Car c)</span><br><span class="line">  ParkingLot: + List&lt;Spot&gt; findSpotsForBus(Motorcycle m)</span><br><span class="line">	Level: + int getAvailableCount()</span><br><span class="line">	Spot: + boolean isAvailable()</span><br></pre></td></tr></table></figure>



<h3 id="Use-Case-Get-available-counts"><a href="#Use-Case-Get-available-counts" class="headerlink" title="Use Case: Get available counts"></a>Use Case: Get available counts</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">	class ParkingLot</span><br><span class="line">	ParkingLot: - List&lt;Car&gt; cars</span><br><span class="line">	ParkingLot: - int availableCountLevelOne</span><br><span class="line">	ParkingLot: - int availableCountLevelTwo</span><br><span class="line">	ParkingLot: + int getAvailableCountLevelOne()</span><br><span class="line">	ParkingLot: + int getAvailableCountLevelTwo()</span><br></pre></td></tr></table></figure>

<p>違背 O 原則</p>
<ul>
<li>比較好是建一個Level類來管理。</li>
</ul>
<blockquote>
<h5 id="单选题-视频中Bus，Car，Motorcycle的抽象类Vehicle有哪些成员变量和成员函数，如何定义？"><a href="#单选题-视频中Bus，Car，Motorcycle的抽象类Vehicle有哪些成员变量和成员函数，如何定义？" class="headerlink" title="[单选题]视频中Bus，Car，Motorcycle的抽象类Vehicle有哪些成员变量和成员函数，如何定义？"></a>[单选题]视频中Bus，Car，Motorcycle的抽象类Vehicle有哪些成员变量和成员函数，如何定义？</h5><p>A.<code>- int size,+ int getSize()</code>8.05% 选择</p>
<p>B.<code># int size,+ int getSize()</code>87.71% 选择</p>
<p>C.<code>- int size, # int getSize()</code>4.24% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTM0MTgxMjgxODM5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM3NjIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxOC4xMiA1MTYuMTZtLTQ5MCAwYTQ5MCA0OTAgMCAxIDAgOTgwIDAgNDkwIDQ5MCAwIDEgMC05ODAgMFoiIGZpbGw9IiM1NkI0MzIiIHAtaWQ9IjM3NjMiPjwvcGF0aD48cGF0aCBkPSJNMzkzLjIxMzYxOSA2NjQuMzM1NDk1bTI4LjI4NDI3MS0yOC4yODQyNzFsMjk2Ljk4NDg0OS0yOTYuOTg0ODQ4cTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBsMCAwcTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDJsLTI5Ni45ODQ4NDggMjk2Ljk4NDg0OHEtMjguMjg0MjcxIDI4LjI4NDI3MS01Ni41Njg1NDMgMGwwIDBxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDJaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY0Ij48L3BhdGg+PHBhdGggZD0iTTI4OS40Njk4NCA0NTIuODQ3ODgzbTI4LjI4NDI3MSAyOC4yODQyNzFsMTU1LjU2MzQ5MiAxNTUuNTYzNDkycTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDNsMCAwcS0yOC4yODQyNzEgMjguMjg0MjcxLTU2LjU2ODU0MyAwbC0xNTUuNTYzNDkxLTE1NS41NjM0OTJxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDNsMCAwcTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY1Ij48L3BhdGg+PC9zdmc+" alt="img">答对了，您选择的答案是B</p>
<p><strong>正确答案:</strong>B</p>
</blockquote>
<h3 id="Use-Case-Park-vehicle"><a href="#Use-Case-Park-vehicle" class="headerlink" title="Use Case: Park vehicle"></a>Use Case: Park vehicle</h3><ul>
<li>parkinglot checks the size of vehicle</li>
<li>parkinglot find an available spot for this vehicle </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">	Vehicle &lt;|-- Bus: Inheritance</span><br><span class="line">	Vehicle &lt;|-- Car: Inheritance</span><br><span class="line">	Vehicle &lt;|-- Motorcycle: Inheritance  </span><br><span class="line">  class Vehicle &#123;</span><br><span class="line">  	# int size</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">	Vehicle: + getSize()</span><br><span class="line">	</span><br><span class="line">	class ParkingLot&#123;</span><br><span class="line">		- List&lt;Level&gt; levels</span><br><span class="line">	&#125;</span><br><span class="line">	ParkingLot: + int getAvailableCount()</span><br><span class="line">	ParkingLot: - List&lt;Spot&gt; findSpotsForVehicle(Vehicle v)</span><br><span class="line">	ParkingLot: + void parkVehicle(Vehicle v)</span><br></pre></td></tr></table></figure>

<p>findSpotsForVehicle 只會被內部的 parkVehicle所調用，所以可設為是private</p>
<p>parkVehicle 成功還是失敗？最好的是加個Exception, 如 fullException。返回 T/F 不好；不同的Engineer看會有不同的理解，而且是二元的，只能handle兩種情況，所以避免用 bool，而是用Exception。</p>
<h3 id="Use-Case-Clear-spot"><a href="#Use-Case-Clear-spot" class="headerlink" title="Use Case: Clear spot"></a>Use Case: Clear spot</h3><ul>
<li><p>Parking lot find the spot to clear</p>
</li>
<li><p>Solution1: vehicle 找到車位，由Car作調用 –&gt; 不合理</p>
</li>
<li><p><strong>Solution with Receipt:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">	class Ticket&#123; </span><br><span class="line">		- Vehicle v</span><br><span class="line">		- List&lt;Spot&gt; spots</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	class ParkingLot&#123;</span><br><span class="line">		- List&lt;Level&gt; levels</span><br><span class="line">	&#125;</span><br><span class="line">	ParkingLot: + int getAvailableCount()</span><br><span class="line">	ParkingLot: - List&lt;Spot&gt; findSpotsForVehicle(Vehicle v)</span><br><span class="line">	ParkingLot: + Ticket parkVehicle(Vehicle v)	</span><br><span class="line">	ParkingLot: + void clearSpot(Ticket t)</span><br></pre></td></tr></table></figure>

<p>Bus需要三個車位；如果是車位不同大小的話，就就是改成把Spot用Inheritance處理</p>
<p>現在是Spot都一樣的，所以就是在停的時候也要找附近可以的車位</p>
<p>private function – findSpotsForVehicle 可以不重要，重要的是public的</p>
</li>
<li><p>客人對到幾號桌？ –&gt; 存到 receipt</p>
</li>
</ul>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">	class Ticket&#123; </span><br><span class="line">		- Vehicle v</span><br><span class="line">		- List&lt;Spot&gt; spots</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	class ParkingLot&#123;</span><br><span class="line">		- List&lt;Level&gt; levels</span><br><span class="line">	&#125;</span><br><span class="line">	ParkingLot: + int getAvailableCount()</span><br><span class="line">	ParkingLot: - List&lt;Spot&gt; findSpotsForVehicle(Vehicle v)</span><br><span class="line">	ParkingLot: + Ticket parkVehicle(Vehicle v)	</span><br><span class="line">	ParkingLot: + void clearSpot(Ticket t)</span><br></pre></td></tr></table></figure>

<h3 id="Use-Case-Calculate"><a href="#Use-Case-Calculate" class="headerlink" title="Use Case: Calculate $"></a>Use Case: Calculate $</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">	class Ticket&#123; </span><br><span class="line">		- Vehicle v</span><br><span class="line">		- List&lt;Spot&gt; spots</span><br><span class="line">		- Time startTime</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	class ParkingLot&#123;</span><br><span class="line">		- List&lt;Level&gt; levels</span><br><span class="line">		- float hourlyRate</span><br><span class="line">	&#125;</span><br><span class="line">	ParkingLot: + int getAvailableCount()</span><br><span class="line">	ParkingLot: - List&lt;Spot&gt; findSpotsForVehicle(Vehicle v)</span><br><span class="line">	ParkingLot: + Ticket parkVehicle(Vehicle v)	</span><br><span class="line">	ParkingLot: + void clearSpot(Ticket t)</span><br><span class="line">	ParkingLot: - float calculatePrice(Ticket t)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span>  <span class="title">calculatePrice</span>:</span></span><br><span class="line">	retun (time - startTime) * hourlyRate</span><br></pre></td></tr></table></figure>

<p>availableCount 不等於 spotCount</p>
<p>bus要找到三個在一起的空的才可以</p>
<ul>
<li>主人公是 Parkinglot 的視角</li>
</ul>
<h2 id="Correctness"><a href="#Correctness" class="headerlink" title="Correctness"></a>Correctness</h2><ul>
<li>Valid use cases</li>
<li>follow good practice, e.g. <ul>
<li>access modifier: private, public</li>
<li>exception: invalid ticket; fullParkingLot</li>
</ul>
</li>
<li>SOLID</li>
<li>Design Pattern</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">	class ParkingLotFullException&#123; </span><br><span class="line">	&#125;</span><br><span class="line">	class InvalidTicketException</span><br></pre></td></tr></table></figure>

<ul>
<li>每層的spots 怎麼排列？<ul>
<li>Sol1: 每行的都一樣，未考慮到畸零地或柱子</li>
<li>Sol2: Parkinglot =&gt; level =&gt; Row =&gt; Spot</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">	class Spot&#123; </span><br><span class="line">		- boolean available</span><br><span class="line">		- Level l</span><br><span class="line">		+ boolean isAvailable()</span><br><span class="line">		+ void takeSpot()</span><br><span class="line">    + void leaveSpot()</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	class Level&#123;</span><br><span class="line">		- List&lt;Row&gt; rows</span><br><span class="line">		- int availableCount</span><br><span class="line">		+ int getAvailableCount()</span><br><span class="line">		+ voidi updateAvailableCount(int diff)</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	class Row &#123;</span><br><span class="line">		- List&lt;Spot&gt; spots</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h1 id="ParkingLot-in-Action"><a href="#ParkingLot-in-Action" class="headerlink" title="ParkingLot in Action"></a>ParkingLot in Action</h1><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gey7yd5u2nj30u207yaez.jpg" alt="image-20200520002106057" style="zoom:67%;" />

<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gey7ybe0e7j30u207yaez.jpg" alt="image-20200520002124925" style="zoom:50%;" />





<h1 id="Singleton"><a href="#Singleton" class="headerlink" title="Singleton"></a>Singleton</h1><blockquote>
<h5 id="单选题-类中的成员在加上static修饰后，它会如何变化，下面哪句话是正确的："><a href="#单选题-类中的成员在加上static修饰后，它会如何变化，下面哪句话是正确的：" class="headerlink" title="[单选题]类中的成员在加上static修饰后，它会如何变化，下面哪句话是正确的："></a>[单选题]类中的成员在加上static修饰后，它会如何变化，下面哪句话是正确的：</h5><p>A.static关键字会改变类中成员的访问权限。6.29% 选择</p>
<p>B.static是修饰类的属性和方法，让他们成为属于类的成员属性和方法。71.46% 选择</p>
<p>C.static修饰的类的属性或者方法，这些属性或者方法它还是属于实例。22.25% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTM0MTgxMjgxODM5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM3NjIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxOC4xMiA1MTYuMTZtLTQ5MCAwYTQ5MCA0OTAgMCAxIDAgOTgwIDAgNDkwIDQ5MCAwIDEgMC05ODAgMFoiIGZpbGw9IiM1NkI0MzIiIHAtaWQ9IjM3NjMiPjwvcGF0aD48cGF0aCBkPSJNMzkzLjIxMzYxOSA2NjQuMzM1NDk1bTI4LjI4NDI3MS0yOC4yODQyNzFsMjk2Ljk4NDg0OS0yOTYuOTg0ODQ4cTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBsMCAwcTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDJsLTI5Ni45ODQ4NDggMjk2Ljk4NDg0OHEtMjguMjg0MjcxIDI4LjI4NDI3MS01Ni41Njg1NDMgMGwwIDBxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDJaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY0Ij48L3BhdGg+PHBhdGggZD0iTTI4OS40Njk4NCA0NTIuODQ3ODgzbTI4LjI4NDI3MSAyOC4yODQyNzFsMTU1LjU2MzQ5MiAxNTUuNTYzNDkycTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDNsMCAwcS0yOC4yODQyNzEgMjguMjg0MjcxLTU2LjU2ODU0MyAwbC0xNTUuNTYzNDkxLTE1NS41NjM0OTJxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDNsMCAwcTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY1Ij48L3BhdGg+PC9zdmc+" alt="img">答对了，您选择的答案是B</p>
<p><strong>正确答案:</strong>B</p>
<p><strong>解析:</strong></p>
<p>解析：被static修饰的类的变量或者方法它是属于类的，而并不属于某一个具体的实例。static方法一般称作静态方法,对于静态方法来说，是没有this的，因为它不依附于任何对象。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParkingLot</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Level&gt; levels;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ParkingLot</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		levels = <span class="keyword">new</span> ArrayList&lt;Level&gt;();	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gey7ygky3bj30pi0jqqcz.jpg" alt="image-20200519224834175" style="zoom:50%;" />



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">	SingletonPatternDemo --|&gt; SingleObject : asks</span><br><span class="line">	SingleObject -- SingletonPatternDemo</span><br><span class="line">	class SingletonPatternDemo &#123;</span><br><span class="line">		+ main(): void</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	class SingleObject &#123;</span><br><span class="line">		- instance: SingleObject</span><br><span class="line">		- SingleObject()</span><br><span class="line">		+ SingleObject getInstance()</span><br><span class="line">		+ void showMessage()</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">publist <span class="class"><span class="keyword">class</span> <span class="title">ParkingLot</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> ParkingLot _instance = <span class="keyword">null</span>;</span><br><span class="line">  <span class="keyword">private</span> List&lt;Level&gt; levels;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">ParkingLot</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    levels = <span class="keyword">new</span> ArrayList&lt;Level&gt;();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ParkingLot <span class="title">getInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (_instance == <span class="keyword">null</span>)</span><br><span class="line">    &#123;  </span><br><span class="line">     	_instance = <span class="keyword">new</span> ParkingLot(); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>static –  和class associate在一起，而不是和instance綁一起的</li>
<li>因為getInstance要去訪問 _instance，所以 _instance得也要是static</li>
</ul>
<h4 id="Thread-Safe"><a href="#Thread-Safe" class="headerlink" title="Thread Safe"></a>Thread Safe</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">publist <span class="class"><span class="keyword">class</span> <span class="title">ParkingLot</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> ParkingLot _instance = <span class="keyword">null</span>;</span><br><span class="line">  <span class="keyword">private</span> List&lt;Level&gt; levels;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">ParkingLot</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    levels = <span class="keyword">new</span> ArrayList&lt;Level&gt;();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> ParkingLot <span class="title">getInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (_instance == <span class="keyword">null</span>)</span><br><span class="line">    &#123;  </span><br><span class="line">     	_instance = <span class="keyword">new</span> ParkingLot(); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以免由於多線程生成兩個不同的，安全但不夠有效率</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">publist <span class="class"><span class="keyword">class</span> <span class="title">ParkingLot</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">ParkingLot</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyParkingLot</span></span></span><br><span class="line"><span class="class">  </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> ParkingLot _instance = <span class="keyword">new</span> ParkingLot();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ParkingLot <span class="title">getInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> LazyParkingLot._instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>當類是static, 在build time就會把類裡的東西執行一次</p>
<p>​    <em>static final ParkingLot _instance = new ParkingLot();</em></p>
<p>這句話就已被執行了</p>
<h1 id="Law-of-Demeter"><a href="#Law-of-Demeter" class="headerlink" title="Law of Demeter"></a>Law of Demeter</h1><p>迪米特法則</p>
<p>在做OOD時的新法則，不在SOLID裡，但這個是新被重視的</p>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gey7yjmqqlj30oq0ru43l.jpg" alt="image-20200519225500096" style="zoom:33%;" />

<p>VS. </p>
<p>correct as following:</p>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gey7yn06vrj30hy0k4q3y.jpg" alt="image-20200519225632424" style="zoom:33%;" />

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/05/06/Data-Structure/SegmentTree/">Data-Structure/SegmentTree</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-05-06</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Languages/">Languages</a></span><div class="content"><h4 id=""><a href="#" class="headerlink" title=""></a></h4><p>查詢時將區間映射到樹上的各個節點並取出值作比節，達到 lg(N) 的級別。</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geimzfa16cj31620oah0o.jpg" alt="image-20200506125234854"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class SegmentTreeNode &#123;</span><br><span class="line">    public int start, end, max;</span><br><span class="line">    public SegmentTreeNode left, right;</span><br><span class="line">    public SegmentTreeNode(int start, int end, int max) &#123;</span><br><span class="line">        this.start = start;</span><br><span class="line">        this.end = end;</span><br><span class="line">        this.max = max</span><br><span class="line">        this.left = this.right = null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>首先线段树是<code>一棵二叉树</code>, 平常我们所指的线段树都是指一维线段树。 故名思义, 线段树能解决的是线段上的问题, 这个线段也可指<code>区间</code>.<br>我们先来看线段树的逻辑结构。</p>
<p>一颗线段树的构造就是根据区间的性质的来构造的, 如下是一棵区间<code>[0, 3]</code>的线段树，每个<code>[start, end]</code>都是一个二叉树中的节点。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">         [0,3]</span><br><span class="line">        &#x2F;     \</span><br><span class="line">   [0,1]       [2,3]</span><br><span class="line">   &#x2F;   \       &#x2F;   \</span><br><span class="line">[0,0] [1,1] [2,2] [3,3]</span><br></pre></td></tr></table></figure>

<p>区间划分大概就是上述的区间划分。可以看出每次都将区间的长度一分为二,数列长度为n,所以线段树的高度是<code>log(n)</code>,这是很多高效操作的基础。<br>上述的区间存储的只是区间的左右边界。我们可以将区间的最大值加入进来,也就是树中的Node需要存储left，right左右子节点外，还需要存储<code>start, end, val</code>区间的范围和区间内表示的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">            [0,3]</span><br><span class="line">           (val&#x3D;4)</span><br><span class="line">         &#x2F;         \</span><br><span class="line">     [0,1]         [2,3]</span><br><span class="line">    (val&#x3D;4)       (val&#x3D;3)</span><br><span class="line">    &#x2F;    \         &#x2F;    \</span><br><span class="line"> [0,0]  [1,1]   [2,2]  [3,3]</span><br><span class="line">(val&#x3D;1)(val&#x3D;4) (val&#x3D;2)(val&#x3D;3)</span><br></pre></td></tr></table></figure>

<p>区间的第三维就是区间的最大值。<br>加这一维的时候只需要在建完了左右区间之后，根据左右区间的最大值来更新当前区间的最大值即可，即当前子树的最大值是左子树的最大和右子树的最大值里面选出来的最大值。</p>
<p>因为每次将区间的长度一分为二,所有创造的节点个数，即底层有n个节点，那么倒数第二次约n/2个节点，倒数第三次约n/4个节点，依次类推：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    n + 1&#x2F;2 * n + 1&#x2F;4 * n + 1&#x2F;8 * n + ...</span><br><span class="line">&#x3D;   (1 + 1&#x2F;2 + 1&#x2F;4 + 1&#x2F;8 + ...) * n</span><br><span class="line">&#x3D;   2n</span><br><span class="line">所以构造线段树的时间复杂度和空间复杂度都为O(n)</span><br></pre></td></tr></table></figure></blockquote>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/05/03/LC/2019-05-03-Remove-Element/">LC/2019-05-03-Remove-Element</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-05-03</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><div class="content"><p>RemoveElement</p>
<p>​</p>
</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/43/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/43/">43</a><span class="page-number current">44</span><a class="page-number" href="/page/45/">45</a><span class="space">&hellip;</span><a class="page-number" href="/page/55/">55</a><a class="extend next" rel="next" href="/page/45/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By Joe Huang</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>