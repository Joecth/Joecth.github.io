<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="Joe Huang"><meta name="copyright" content="Joe Huang"><title>Awaken Desparado</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-180692466-1', 'auto');
ga('send', 'pageview');</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Joe Huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">384</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">26</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">66</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Awaken Desparado</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Awaken Desparado</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2020/02/05/System-Design/2020-02-05-System%20Design%20-%20Sharding%20&amp;%20Queue/">System-Design/2020-02-05-System Design - Sharding &amp; Queue</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-05</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/System/">System</a></span><div class="content"><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h1 id="分片-partition-or-sharding"><a href="#分片-partition-or-sharding" class="headerlink" title="分片 partition  or  sharding"></a>分片 partition  or  sharding</h1><p>廣告的話，不只在database，LB某種意義上分給機器們，也就是。</p>
<p>每個機器分一部分就是要切小塊，LB就是在做pardition，當然sharding更指<strong>DB</strong>的存儲</p>
<p>日本放在日本的db，因為有 sharding　所以要<strong>Routing</strong>去找數據</p>
<p>可能數據在西部，但我去東西旅遊之類</p>
<img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gbmy6i9wcvj30hu0k8781.jpg" alt="img" style="zoom:50%;" />



<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggvb0fupt1j30y009mgui.jpg" alt="image-20200718183127240"></p>
<p>sharding　一般來說指的是db　</p>
<p>partition不一定是固定的，也可能增加了機器，每個就管得比較少了</p>
<p>照地理位置去找</p>
<p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gbn4cs9n1vj30yg0lcdit.jpg" alt="image-20200206202240123"></p>
<img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gbmy90zsmlj30tw0k0dnz.jpg" alt="image-20200206202333357" style="zoom:50%;" />

<p>![image-20200206202407013](/Users/joe/Library/Application Support/typora-user-images/image-20200206202407013.png)</p>
<img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gbmya9oquoj30ym0jck1l.jpg" alt="image-20200206202443059" style="zoom:50%;" />





<h3 id="Partition-Method"><a href="#Partition-Method" class="headerlink" title="Partition Method"></a>Partition Method</h3><p>by ID, by letter, by Term</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggvb7hzfyaj30zk0kowqn.jpg" alt="image-20200718183813083"></p>
<p>Horizontal partitioning : as by ID　風險：range分得不好，所以不平衡，怎麼evenly distributed?!</p>
<p>Vertical Partitioning : 按業務去分　如下圖↓</p>
<img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gbmyk67nx2j30kw0mwjyj.jpg" alt="image-20200206203421886" style="zoom:50%;" /> 

<p>業務調整、或是中間加一層就更複雜了</p>
<h2 id="Partitioning-Criteria"><a href="#Partitioning-Criteria" class="headerlink" title="Partitioning Criteria"></a>Partitioning Criteria</h2><ol>
<li>key or hash-based partitioning<br>userid每次加１的id，對100取個模去知道哪個機器，工業中一般不用　這個是<strong>distributed hashing</strong>，用<strong><em>consistent hashing</em></strong>比較好↓</li>
<li>list partitionging 自己聲明rule 就像mongodb，自己定義</li>
<li>round-robin</li>
<li>composite</li>
</ol>
<p>3</p>
<p>1 4 7 10</p>
<p>2 5 8 11</p>
<p>3 6 9 12</p>
<p>4</p>
<p>1 5 9  </p>
<p>2 6 10</p>
<p>3 7 11</p>
<p>4 8 12</p>
<h2 id="Consistent-Hashing"><a href="#Consistent-Hashing" class="headerlink" title="Consistent Hashing"></a>Consistent Hashing</h2><p>把所有可能的hash值分成圓五份 </p>
<p>這樣可能不均勻</p>
<p>所以就有個vnnode的概念 一個機器對應五個 vnnode</p>
<img src="/Users/joe/Library/Application Support/typora-user-images/image-20200206204214506.png" alt="image-20200206204214506" style="zoom:50%;" />

<p>如上右圖的話A, F, K, Q, V 對應到第一台機器，B, G, L, R, W對應到第二台機器</p>
<p>像 Cassandra 可能一個配置可能對應256個vnnode</p>
<h4 id="備份↓"><a href="#備份↓" class="headerlink" title="備份↓"></a>備份↓</h4><img src="/Users/joe/Library/Application Support/typora-user-images/image-20200206204351704.png" alt="image-20200206204351704" style="zoom:50%;" />

<p>如果４～５區段的這台機器掛了，一般是自動歸到A這台機器去了；但全給A承擔太不公平；但如果有vnnode如上面的右圖，一台機器掛了就是A, F, K, Q, V沒了，後面的每個機器都可以均勻分擔這個量，這邊的B, G, L, R, W不見得是在每個區的第二台，上圖是只為了便於理解；或也可能是第一台機器對應的不是每<strong>個區的第一個node! 最想看到的是E掛了的話，其他四台數據可以均分他本來的量! 不然的話取模是大變動</strong></p>
<p>distributed hash是大挪移要全重算…　所以一致性哈希好</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggvf9mfexmj30zm0hwk25.jpg" alt="image-20200718205839869"></p>
<h2 id="Common-problems-of-Sharding"><a href="#Common-problems-of-Sharding" class="headerlink" title="Common problems of Sharding"></a>Common problems of Sharding</h2><p>就是在說機器掛了怎麼辦？</p>
<p>因為數據不是在一處，就是因為sharding分開了，所以要去多個地方去取，數據分散在各個地方那怎辦？</p>
<ol>
<li><p>Join and Denormalization 如user_id還得去user table 去查 name ；<br>就是說一個table要去refer另一個table, 跨個太平洋的數據難作join, </p>
<ul>
<li>Denormalize就是說數據有冗餘，一般為了不要hop很遠的地方去，所以讓數據有冗餘，讀還ok寫就麻煩了</li>
</ul>
</li>
<li><p>Referential integrity ，如果有別的table的主鍵的話。。外鍵在sharding裡面會比較痛苦</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggvff8w0puj30ys02sgnd.jpg" alt="image-20200718210405029"></p>
</li>
<li><p>Rebalancing 重弄分片；有某個zip數據量特大。</p>
</li>
</ol>
<h1 id="LinkedIn-Prob"><a href="#LinkedIn-Prob" class="headerlink" title="LinkedIn Prob."></a>LinkedIn Prob.</h1><img src="/Users/joe/Library/Application Support/typora-user-images/image-20200206205226121.png" alt="image-20200206205226121" style="zoom:50%;" />

<img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gbmz3ewua8j30x40jqn9w.jpg" alt="image-20200206205246002" style="zoom:50%;" />

<img src="/Users/joe/Library/Application Support/typora-user-images/image-20200206205350491.png" alt="image-20200206205350491" style="zoom:50%;" />

<ul>
<li>APPLE 跟 STORE對應的 Documents id 應該在這裡要是 交集!</li>
</ul>
<p>但如果documents太多，返回的量會很大呀!</p>
<p>分開算，在Expression Tree</p>
<h5 id="Expression-Tree"><a href="#Expression-Tree" class="headerlink" title="Expression Tree"></a>Expression Tree</h5><img src="/Users/joe/Library/Application Support/typora-user-images/image-20200206205535354.png" alt="image-20200206205535354" style="zoom:50%;" />

<p>下面這張圖沒講太細</p>
<p>![image-20200718211447294](/Users/joe/Library/Application Support/typora-user-images/image-20200718211447294.png)</p>
<h1 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h1><p>Ref: <a href="https://www.youtube.com/watch?v=P_JPdQfjXY4&amp;list=PLbhaS_83B97vSWVslD63vjIi5OTYmSVrk&amp;index=15" target="_blank" rel="noopener">https://www.youtube.com/watch?v=P_JPdQfjXY4&amp;list=PLbhaS_83B97vSWVslD63vjIi5OTYmSVrk&amp;index=15</a></p>
<h4 id="message-queue"><a href="#message-queue" class="headerlink" title="message queue　"></a>message queue　</h4><p>不會丟，可以保證不會丟失</p>
<p>往ｑ放東西，consumer拿東西，本身是個異步過程。 Hot-spot, burst，Q就是個buffer，</p>
<p>系統可以不用等在那邊，可防止 burst</p>
<ul>
<li>An application publishes a job to the queue, then notifies the user of job status</li>
<li>A worker picks up the job from the queue, processes it, then signals the job is complete</li>
</ul>
<p>可以buffer住一堆來的請求，讓producer不用等在那邊<br>consumer一直去polling　就是異步</p>
<p>這情況同步會降低效能 </p>
<p>要確定放成功了 要拿個 task_id 之後再一直去要</p>
<p><strong><a href="https://redis.io/" target="_blank" rel="noopener">Redis</a></strong> is useful as a simple message broker but messages can be lost.</p>
<p><strong><a href="https://www.rabbitmq.com/" target="_blank" rel="noopener">RabbitMQ</a></strong> is popular but requires you to adapt to the ‘AMQP’ protocol and manage your own nodes.</p>
<p><strong><a href="https://aws.amazon.com/sqs/" target="_blank" rel="noopener">Amazon SQS</a></strong> is hosted but can have high latency and has the possibility of messages being delivered twice.</p>
<p>上面三個比較有名的 message queue的框架</p>
<p> server取完後再去把task刪了，至少這個task還是在queue裡的 </p>
<h5 id="可以取出來在db-or-que寫-in-progress，-gt-high-availability-不丟消息"><a href="#可以取出來在db-or-que寫-in-progress，-gt-high-availability-不丟消息" class="headerlink" title="可以取出來在db or que寫 in progress，==&gt; high availability　不丟消息"></a>可以取出來在db or que寫 in progress，==&gt; high availability　不丟消息</h5><p>可以retry</p>
<p>![image-20200206211146919](/Users/joe/Library/Application Support/typora-user-images/image-20200206211146919.png)</p>
<h5 id="Async-缺點：當計算快時比較建議用同步就好，因為que會有delay跟complexity"><a href="#Async-缺點：當計算快時比較建議用同步就好，因為que會有delay跟complexity" class="headerlink" title="Async 缺點：當計算快時比較建議用同步就好，因為que會有delay跟complexity"></a>Async 缺點：當計算快時比較建議用同步就好，因為que會有delay跟complexity</h5></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/02/05/System-Design/2020-02-05-System%20Design%20-%20TinyURL/">System-Design/2020-02-05-System Design - TinyURL</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-05</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/System/">System</a></span><div class="content"><h1 id="TinyURL"><a href="#TinyURL" class="headerlink" title="TinyURL"></a>TinyURL</h1><ul>
<li>[0-9, a-z, A-Z] 一共62個，62^6 ~= 56.8 Billions unique Strings 應是夠用的</li>
<li>要考慮到其他國家的string 這邊當然主要只是英文字母</li>
<li>Similar: bit.ly, goo.gl </li>
<li>簡答的通常是這個系統的一個功能</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghbmqzsggoj30q00fqq51.jpg" alt="image-20200801212636104"></p>
<h2 id="Read-Heavy"><a href="#Read-Heavy" class="headerlink" title="Read Heavy"></a>Read Heavy</h2><h2 id="Constraints"><a href="#Constraints" class="headerlink" title="Constraints"></a>Constraints</h2><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghbmt7b338j30pa0batf5.jpg" alt="image-20200801212843299" style="zoom: 50%;" />



<h2 id="REST-APIs"><a href="#REST-APIs" class="headerlink" title="REST APIs"></a>REST APIs</h2><h3 id="長做短"><a href="#長做短" class="headerlink" title="長做短"></a>長做短</h3><h4 id="Goo"><a href="#Goo" class="headerlink" title="Goo"></a>Goo</h4><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghbmuaiyitj30q60e2wjr.jpg" alt="image-20200801212946459" style="zoom:50%;" />

<ul>
<li>201 - created</li>
<li>content-typ是告訴你body是什麼</li>
<li>怎麼去客製化url?<ul>
<li>body可以加個參數像是defaul none</li>
</ul>
</li>
<li>Response e.g.</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghbmw80drzj30l20oodq6.jpg" alt="image-20200801213136358"></p>
<h4 id="Bitly"><a href="#Bitly" class="headerlink" title="Bitly"></a>Bitly</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghbmx33xswj30um0f0agv.jpg" alt="image-20200801213226710"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghbmxkp980j30xk0c0teo.jpg" alt="image-20200801213255365"></p>
<h3 id="短回長"><a href="#短回長" class="headerlink" title="短回長"></a>短回長</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghbmyfkjlpj30lu07odis.jpg" alt="image-20200801213345334"></p>
<ul>
<li>3XX redirection</li>
<li><strong>301 moved Permanently</strong></li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghbmyvowbyj30z60rm18f.jpg" alt="image-20200801213408593"></p>
<ul>
<li>Header 裡會有個key 就是location知道要redirect到哪裡</li>
<li>我收到301跟它的loc後，會再發一個網址去我要去的地方</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghbn1qu2i5j30am04ogm8.jpg" alt="image-20200801213656344" style="zoom:33%;" />







<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghbmzm8bsfj30jw0ciwin.jpg" alt="image-20200801213452950" style="zoom: 33%;" />



<h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghbn05k9ynj30i407k0vl.jpg" alt="image-20200801213523160" style="zoom: 50%;" />



<h2 id="Storage"><a href="#Storage" class="headerlink" title="Storage"></a>Storage</h2><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghbn4qhmtyj30t00f0wpp.jpg" alt="image-20200801213946574"></p>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghbpxnpwgzj30hs0amaca.jpg" alt="image-20200801231648267" style="zoom:50%;" />

<ul>
<li>2 跟3要綁事務了</li>
</ul>
<img src="/Users/joe/Library/Application Support/typora-user-images/image-20200801225936514.png" alt="image-20200801225936514" style="zoom: 33%;" />

<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghbpjz88wfj30yq0lyn1c.jpg" alt="image-20200801230337236"></p>
<p>ref: <a href="https://www.educative.io/courses/grokking-the-system-design-interview/m2ygV4E81AR" target="_blank" rel="noopener">https://www.educative.io/courses/grokking-the-system-design-interview/m2ygV4E81AR</a></p>
<ul>
<li>黃色那塊是就是lazy cleanup</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghbptwfkwdj30s00hk46g.jpg" alt="image-20200801231309317"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghbpu1y125j30ws0kg129.jpg" alt="image-20200801231319438"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/02/05/System-Design/2020-02-05-System%20Design%20xcode-%20%E6%89%BE%E6%9C%88%E7%90%83%E4%B8%8A%E7%AC%ACk%E5%A4%A7%E7%9A%84%E6%95%B8/">System-Design/2020-02-05-System Design xcode- 找月球上第k大的數</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-05</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/SystemDesign/">SystemDesign</a></span><div class="content"><h1 id="找月球上第k大的數據"><a href="#找月球上第k大的數據" class="headerlink" title="找月球上第k大的數據"></a>找月球上第k大的數據</h1><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gi80ysv6phj312w07kagl.jpg" alt="image-20200829215631253" style="zoom:67%;" />



<p>一台台扁長的機器</p>
<p>一萬就是說這機器上有很多數字，別揪結，就是大</p>
<p>有n台機器，怎麼找全部起來第</p>
<p>壓縮扯遠了</p>
<p>Kth biggest number</p>
<p>我人在地球，這批機器是在月球，主要是說傳輸我到機器的距離很長，帶寬對我是個很大的問題，一般最終的問題就是在帶寬。sql去查，上億條就是map reduce之類的優化，找到了index，還是有上億個，至少上MB了，要一下返回，整個數據中心的網路都堵啦，網路傳不過去，太多啦。</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gi816q553hj311q0hyq6x.jpg" alt="image-20200829220410378"></p>
<p>眼、嘴、手都用上。在扯XD。</p>
<h3 id="解一-n台機器就是N-k-gt-然後再找出第k大"><a href="#解一-n台機器就是N-k-gt-然後再找出第k大" class="headerlink" title="解一: n台機器就是N*k =&gt; 然後再找出第k大"></a>解一: n台機器就是N*k =&gt; 然後再找出第k大</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gi81aawsh8j31280i479b.jpg" alt="image-20200829220736573"></p>
<p>最大的問題是：假如k是一萬呢？100台機器，不然返回了100萬個數？我要等半天！</p>
<p>我在地球耶。</p>
<h3 id="解法二："><a href="#解法二：" class="headerlink" title="解法二："></a>解法二：</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gi81f2xwgyj313a0i4wlr.jpg" alt="image-20200829221211451"></p>
<ol>
<li>我把每台的第k個數返回，我用到的就是n</li>
<li>我拿到每個機器的第k大的，我要找min數</li>
</ol>
<p>重點是要減少round trip</p>
<h1 id="排序超大数"><a href="#排序超大数" class="headerlink" title="排序超大数"></a>排序超大数</h1><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gi81jz5d2cj312g0m2wu1.jpg" alt="image-20200829221654279"></p>
<h2 id="radix-sort，要都是等長的，如都是三位"><a href="#radix-sort，要都是等長的，如都是三位" class="headerlink" title="radix sort，要都是等長的，如都是三位"></a>radix sort，要都是等長的，如都是三位</h2><p>runtime是 n*k，k表digit數，bucket sort也是一樣幾乎 線性，比快排快</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/01/23/System-Design/ACE/2021-01-23%20Fandango%20&amp;%20Robinhood/">System-Design/ACE/2021-01-23 Fandango &amp; Robinhood</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-01-23</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/SystemDesign/">SystemDesign</a></span><div class="content"><h1 id="票務系統、Distributed-Transaction"><a href="#票務系統、Distributed-Transaction" class="headerlink" title="票務系統、Distributed Transaction"></a>票務系統、Distributed Transaction</h1><ul>
<li>相似: Ticketmaster、秒殺、Robinhood</li>
<li>DB、不超賣、峰值concurrency</li>
</ul>
<h2 id="Req"><a href="#Req" class="headerlink" title="Req"></a>Req</h2><h3 id="Non-Fn"><a href="#Non-Fn" class="headerlink" title="Non-Fn"></a>Non-Fn</h3><h2 id="Resource-Est"><a href="#Resource-Est" class="headerlink" title="Resource Est."></a>Resource Est.</h2><h2 id="Q1-Sub-Services"><a href="#Q1-Sub-Services" class="headerlink" title="Q1. Sub Services?"></a>Q1. Sub Services?</h2><ul>
<li>Search </li>
<li>Seat</li>
<li>Payment</li>
<li>Waitlist</li>
</ul>
<h2 id="Q2-同場同位不重複賣"><a href="#Q2-同場同位不重複賣" class="headerlink" title="Q2. 同場同位不重複賣?"></a>Q2. 同場同位不重複賣?</h2><p>事務鎖</p>
<h2 id="Q3-怎避免付款後發現選的已賣出"><a href="#Q3-怎避免付款後發現選的已賣出" class="headerlink" title="Q3: 怎避免付款後發現選的已賣出?"></a>Q3: 怎避免付款後發現選的已賣出?</h2><p>選定座位後，預留並作ttl</p>
<h2 id="Storage"><a href="#Storage" class="headerlink" title="Storage"></a>Storage</h2></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/01/15/Python/2020-01-15-bisect%20in%20python%20/">Python/2020-01-15-bisect in python </a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-01-15</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Python/">Python</a></span><div class="content"><h3 id="Finding-Pos"><a href="#Finding-Pos" class="headerlink" title="Finding Pos"></a>Finding Pos</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bisect</span><br><span class="line"> </span><br><span class="line">a = [<span class="number">1</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">15</span>,<span class="number">20</span>]</span><br><span class="line">position = bisect.bisect(a,<span class="number">13</span>)</span><br><span class="line">print(position)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 用可变序列内置的insert方法插入</span></span><br><span class="line">a.insert(position,<span class="number">13</span>)</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<p>5<br>[1, 4, 6, 8, 12, 13, 15, 20]</p>
<hr>
<h3 id="Insert"><a href="#Insert" class="headerlink" title="Insert"></a>Insert</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bisect</span><br><span class="line"> </span><br><span class="line">a = [<span class="number">1</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">15</span>,<span class="number">20</span>]</span><br><span class="line">bisect.insort(a,<span class="number">13</span>)</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/19/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><span class="page-number current">20</span><a class="page-number" href="/page/21/">21</a><span class="space">&hellip;</span><a class="page-number" href="/page/77/">77</a><a class="extend next" rel="next" href="/page/21/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2023 By Joe Huang</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>