<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="Joe Huang"><meta name="copyright" content="Joe Huang"><title>Awaken Desparado</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.1.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Joe Huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">249</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">24</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">36</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Awaken Desparado</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Awaken Desparado</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2020/02/10/LC/2020-02-10-LC%20Recurssion%20Arrangement/">LC/2020-02-10-LC Recurssion Arrangement</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-10</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><div class="content"><h2 id="Binary-Tree"><a href="#Binary-Tree" class="headerlink" title="Binary Tree"></a>Binary Tree</h2><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>[Maximum depth of Binary Tree]</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>[Symmetric Tree]</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>[Path Sum]</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>[Count Univalue Subtrees]</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th>status</th>
<th>coded</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><a href="#39">39 Combination Sum</a></td>
<td></td>
<td></td>
<td></td>
<td>v</td>
<td>v</td>
<td></td>
</tr>
<tr>
<td><a href="#40">40 Combination Sum Ⅱ</a></td>
<td></td>
<td></td>
<td></td>
<td>v</td>
<td>v</td>
<td></td>
</tr>
<tr>
<td><a href="#77">77 Combinations</a></td>
<td></td>
<td>easy</td>
<td></td>
<td>v</td>
<td>v</td>
<td></td>
</tr>
<tr>
<td><a href="#">79 Word Search</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="39"><a href="#39" class="headerlink" title="39"></a><a name="39">39</a></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">combinationSum</span><span class="params">(self, candidates: List[int], target: int)</span> -&gt; List[List[int]]:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> candidates: </span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        self.result = []</span><br><span class="line">        <span class="comment"># self.counters = &#123;&#125;</span></span><br><span class="line">        l = sorted(candidates, key=<span class="keyword">lambda</span> val: val)</span><br><span class="line">        self.helper(l, <span class="number">0</span>, target, [], <span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> self.result</span><br><span class="line"></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(self, l, idx, rem, item, level)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> rem == <span class="number">0</span>:</span><br><span class="line">            self.result.append(item.copy())</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> idx == len(l) <span class="keyword">or</span> rem &lt; l[idx] <span class="keyword">or</span> rem &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2 3 6 7     7               2</span></span><br><span class="line">        elem = l[idx]</span><br><span class="line">        item.append(elem)</span><br><span class="line">        rem -= elem</span><br><span class="line">        <span class="comment"># if rem &lt; elem:        SHOULDN'T TRUNCATE HERE </span></span><br><span class="line">        <span class="comment">#     return      #1 &lt; 2       2 2 </span></span><br><span class="line">        self.helper(l, idx, rem, item, level+<span class="number">1</span>)</span><br><span class="line">        item.pop()</span><br><span class="line">        rem += elem</span><br><span class="line">        self.helper(l, idx+<span class="number">1</span>, rem, item, level+<span class="number">1</span>)</span><br></pre></td></tr></table></figure>



<h3 id="77"><a href="#77" class="headerlink" title="77"></a><a name="77">77</a></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">combine</span><span class="params">(self, n: int, k: int)</span> -&gt; List[List[int]]:</span></span><br><span class="line">        self.result = []</span><br><span class="line">        self.helper(n, k, <span class="number">0</span>, []) </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> self.result</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(self, n, k, idx, item)</span>:</span>    <span class="comment"># 4, 2 # no level since already have len(item)</span></span><br><span class="line">        <span class="keyword">if</span> len(item) == k:</span><br><span class="line">            self.result.append(item.copy())</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(idx, n):</span><br><span class="line">            item.append(i+<span class="number">1</span>)</span><br><span class="line">            self.helper(n, k, i+<span class="number">1</span>, item)    <span class="comment"># i, level</span></span><br><span class="line">            item.pop()</span><br></pre></td></tr></table></figure>



<h3 id="40"><a href="#40" class="headerlink" title="40"></a><a name="40">40</a></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">combinationSum2</span><span class="params">(self, candidates: List[int], target: int)</span> -&gt; List[List[int]]:</span></span><br><span class="line">        self.target = target</span><br><span class="line">        result = []</span><br><span class="line">        candidates.sort()</span><br><span class="line">        self.gen(<span class="number">0</span>, candidates, [], result, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gen</span><span class="params">(self, i, nums, items, result, total)</span>:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> i == len(nums):</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        items.append(nums[i])</span><br><span class="line">        total += nums[i]</span><br><span class="line">        <span class="comment"># if sum(items) == self.target:</span></span><br><span class="line">        <span class="keyword">if</span> total == self.target:</span><br><span class="line">            <span class="keyword">if</span> items <span class="keyword">not</span> <span class="keyword">in</span> result:</span><br><span class="line">                result.append(items)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> total &lt;= self.target:   <span class="comment"># to prune as early as possible</span></span><br><span class="line">            self.gen(i+<span class="number">1</span>, nums, items.copy(), result, total)</span><br><span class="line">            </span><br><span class="line">        items.pop()</span><br><span class="line">        total -= nums[i]</span><br><span class="line">        self.gen(i+<span class="number">1</span>, nums, items.copy(), result, total)</span><br></pre></td></tr></table></figure>



<h3 id="79"><a href="#79" class="headerlink" title="79"></a><a name="79">79</a></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> deepcopy</span><br><span class="line"><span class="comment"># from collections import deque</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">exist</span><span class="params">(self, board: List[List[str]], word: str)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> board <span class="keyword">or</span> <span class="keyword">not</span> board[<span class="number">0</span>]:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        </span><br><span class="line">        ans = <span class="literal">False</span></span><br><span class="line">        <span class="comment"># visited = [[False for j in range(len(board[0]))]for i in range(len(board))]</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(board)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(len(board[<span class="number">0</span>])):</span><br><span class="line">                <span class="keyword">if</span> board[i][j] == word[<span class="number">0</span>]:</span><br><span class="line">                    visited = [[<span class="literal">False</span> <span class="keyword">for</span> j <span class="keyword">in</span> range(len(board[<span class="number">0</span>]))]<span class="keyword">for</span> i <span class="keyword">in</span> range(len(board))]</span><br><span class="line">                    ans = self.helper(board, i, j, word, <span class="literal">False</span>, visited) <span class="keyword">or</span> ans  </span><br><span class="line">                    <span class="keyword">if</span> ans:</span><br><span class="line">                        <span class="keyword">return</span> ans</span><br><span class="line">        <span class="keyword">return</span> ans</span><br><span class="line">    </span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    First version failed AT:</span></span><br><span class="line"><span class="string">    [["C","A","A"],</span></span><br><span class="line"><span class="string">     ["A","A","A"],</span></span><br><span class="line"><span class="string">     ["B","C","D"]]</span></span><br><span class="line"><span class="string">    "AAB"</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(self, board, row, col, item, ans, visited)</span>:</span></span><br><span class="line">        <span class="comment"># if not item:</span></span><br><span class="line">        <span class="comment">#     return True</span></span><br><span class="line">        <span class="keyword">if</span> visited[row][col] == <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> board[row][col] == item[<span class="number">0</span>]:</span><br><span class="line">            visited[row][col] = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">if</span> len(item) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                item = item[<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> row &lt; len(board)<span class="number">-1</span>:</span><br><span class="line">            <span class="comment"># print(row, col)</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> visited[row+<span class="number">1</span>][col]:</span><br><span class="line">                tmp = visited[row+<span class="number">1</span>][col]</span><br><span class="line">                <span class="comment"># ans = self.helper(board, row+1, col, item, ans, deepcopy(visited)) or ans</span></span><br><span class="line">                ans = self.helper(board, row+<span class="number">1</span>, col, item, ans, visited) <span class="keyword">or</span> ans</span><br><span class="line">                visited[row+<span class="number">1</span>][col] = tmp</span><br><span class="line">            <span class="keyword">if</span> ans:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> row &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> visited[row<span class="number">-1</span>][col]:</span><br><span class="line">                tmp = visited[row<span class="number">-1</span>][col]</span><br><span class="line">                <span class="comment"># ans = self.helper(board, row-1, col, item, ans, deepcopy(visited)) or ans</span></span><br><span class="line">                ans = self.helper(board, row<span class="number">-1</span>, col, item, ans, visited) <span class="keyword">or</span> ans</span><br><span class="line">                visited[row<span class="number">-1</span>][col] = tmp</span><br><span class="line">            <span class="keyword">if</span> ans:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> col &lt; len(board[<span class="number">0</span>])<span class="number">-1</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> visited[row][col+<span class="number">1</span>]:</span><br><span class="line">                tmp = visited[row][col+<span class="number">1</span>]</span><br><span class="line">                <span class="comment"># ans = self.helper(board, row, col+1, item, ans, deepcopy(visited)) or ans</span></span><br><span class="line">                ans = self.helper(board, row, col+<span class="number">1</span>, item, ans, visited) <span class="keyword">or</span> ans</span><br><span class="line">                visited[row][col+<span class="number">1</span>] = tmp</span><br><span class="line">            <span class="keyword">if</span> ans:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> col &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> visited[row][col<span class="number">-1</span>]:</span><br><span class="line">                tmp = visited[row][col<span class="number">-1</span>]</span><br><span class="line">                <span class="comment"># ans = self.helper(board, row, col-1, item, ans, deepcopy(visited)) or ans</span></span><br><span class="line">                ans = self.helper(board, row, col<span class="number">-1</span>, item, ans, visited) <span class="keyword">or</span> ans</span><br><span class="line">                visited[row][col<span class="number">-1</span>] = tmp</span><br><span class="line">            <span class="keyword">if</span> ans:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/02/06/System-Design/2020-02-05-System%20Design%20-%20TinuURL/">System-Design/2020-02-05-System Design - TinuURL</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-06</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/System/">System</a></span><div class="content"></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/02/06/System-Design/2020-02-05-System%20Design%20-%20Push%20vs%20Pull/">System-Design/2020-02-05-System Design - Push vs Pull</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-06</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/System/">System</a></span><div class="content"><h1 id="Long-Polling-vs-WebSockets-vs-Server-Sent-Events"><a href="#Long-Polling-vs-WebSockets-vs-Server-Sent-Events" class="headerlink" title="Long-Polling vs WebSockets vs Server-Sent Events"></a>Long-Polling vs WebSockets vs Server-Sent Events</h1><h3 id="push-vs-pull"><a href="#push-vs-pull" class="headerlink" title="push vs pull"></a>push vs pull</h3><p>一般經常用到的service architecture 有 queuing, REST, RPC(Remote Procedure Call) 是服務之間怎麼交流</p>
<p>![image-20200206230736407](/Users/joe/Library/Application Support/typora-user-images/image-20200206230736407.png)</p>
<p>S 不一定要知道 C 的 ip, 上網看用戶的就是 C。 </p>
<p>![image-20200206231014572](/Users/joe/Library/Application Support/typora-user-images/image-20200206231014572.png)</p>
<p>定點對應服務</p>
<p>基本http請求就是 push請求</p>
<h2 id="Long-Polling"><a href="#Long-Polling" class="headerlink" title="Long-Polling"></a>Long-Polling</h2><p>什麼是HTTP </p>
<ul>
<li>用戶開connection 並向server請求data</li>
<li>server 算response</li>
<li>server送回response</li>
</ul>
<h4 id="Ajax-Polling-對應的也是-PUSH"><a href="#Ajax-Polling-對應的也是-PUSH" class="headerlink" title="Ajax Polling 對應的也是 PUSH"></a>Ajax Polling 對應的也是 PUSH</h4><p>每隔一段時間發一個請求去問好了沒，每0.5秒發一次</p>
<img src="/Users/joe/Library/Application Support/typora-user-images/image-20200206231603559.png" alt="image-20200206231603559" style="zoom:50%;" />

<p>老有人來煩server。</p>
<p>中間也有個latency</p>
<h3 id="HTTP-Long-Polling-對應的也是-PUSH"><a href="#HTTP-Long-Polling-對應的也是-PUSH" class="headerlink" title="HTTP Long Polling - 對應的也是 PUSH"></a>HTTP Long Polling - 對應的也是 PUSH</h3><p>不是馬上response回來，connection一直hold，等在那邊直到好了被通知再發一個真正的請求過去</p>
<p>之前的請求只是要知道「什麼時候好」</p>
<p>有個timeout　</p>
<h3 id="WebSockets-PULL"><a href="#WebSockets-PULL" class="headerlink" title="WebSockets - PULL"></a>WebSockets - PULL</h3><h4 id="Full-duplex-bidirectional"><a href="#Full-duplex-bidirectional" class="headerlink" title="Full-duplex bidirectional"></a>Full-duplex bidirectional</h4><p><strong>C、S兩邊都可以發請求，同時的</strong>。half-duplex 是只有一邊發。</p>
<p>小負擔、幾乎實時、S不需要C的請求，也可以發過去。</p>
<img src="https://tva1.sinaimg.cn/large/0082zybpgy1gbn4dopv4ij30w40ggag2.jpg" alt="image-20200206232250565" style="zoom:50%;" />

<p>Server可以PUSH, 發請求，即時拿到。</p>
<p>一般C對S發的Socket是收到response後就關掉了</p>
<p>是「不斷的」所以S可以找到C。</p>
<p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gbn4dvvbxfj310e0fqgu4.jpg" alt="image-20200206232544827"></p>
<p>S 可以即時PUSH!</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/02/06/System-Design/2020-02-05-System%20Design%20-%20NoSQL/">System-Design/2020-02-05-System Design - NoSQL</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-06</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/System/">System</a></span><div class="content"><p>SQL - ORM</p>
<h2 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL"></a>NoSQL</h2><p>Not Only SQL</p>
<p>本身有幾個派別如kv, document</p>
<h4 id="Normalize-–-JOIN-在ORM用的，往往一個機器"><a href="#Normalize-–-JOIN-在ORM用的，往往一個機器" class="headerlink" title="Normalize – JOIN　在ORM用的，往往一個機器"></a>Normalize – JOIN　在ORM用的，往往一個機器</h4><h4 id="Denormalize-–-大量重複寫多份，寫麻煩，讀有利"><a href="#Denormalize-–-大量重複寫多份，寫麻煩，讀有利" class="headerlink" title="Denormalize – 大量重複寫多份，寫麻煩，讀有利　"></a>Denormalize – 大量重複寫多份，寫麻煩，讀有利　</h4><p>在nosql 裡用的 ，nosql往往為了多機器作分布</p>
<p>數據中心要同步數據怎麼辦？跨data-center Denormalize就兩邊都寫</p>
<p>寫時要保證各國的數據中心都寫進去了</p>
<p>要知道是 read-heavy or write-heavy 大多是讀的多</p>
<h5 id="缺點：冗缺、如果系統write-heavy就很不利，如logging-system、message-que"><a href="#缺點：冗缺、如果系統write-heavy就很不利，如logging-system、message-que" class="headerlink" title="缺點：冗缺、如果系統write-heavy就很不利，如logging system、message que"></a>缺點：冗缺、如果系統write-heavy就很不利，如logging system、message que</h5><p>kafka 對寫的支持很好</p>
<ul>
<li><p>要做join的話是在applicatin layer也是middle layer的　＝＝＞　<img src="/Users/joe/Library/Application Support/typora-user-images/image-20200206221633536.png" alt="image-20200206221633536" style="zoom: 25%;" /></p>
</li>
<li><p>不支持ACID - <em>ACID</em> (<em>atomicity, consistency, isolation, durability</em>) is a set of properties of database transactions intended to guarantee validity ，那麼多機器不能保證事務</p>
</li>
<li><p>nosql不好鎖，多個當然不好鎖，慢慢才最終一致</p>
</li>
<li><p>linkedin發了文章，不是需要馬上好友都看到，可以有latency的，我的follower之後才收到沒差</p>
<p>叫作 <strong><em>eventually consistency</em></strong></p>
</li>
<li><h4 id="Quorum-假如有三個人，2-1，少數服從多數"><a href="#Quorum-假如有三個人，2-1，少數服從多數" class="headerlink" title="Quorum - 假如有三個人，2:1，少數服從多數"></a>Quorum - 假如有三個人，2:1，少數服從多數</h4></li>
</ul>
<h4 id="Transaction-銀行的經典例子"><a href="#Transaction-銀行的經典例子" class="headerlink" title="Transaction 銀行的經典例子 -"></a>Transaction 銀行的經典例子 -</h4><p>銀行在意事務，所以ORM比較好。如果在一個地方取，中間</p>
<p>帳號是個變量a, 本來有1000元，一邊要存5000元，另個人從我的帳戶也取1000元。如果沒有事務保護</p>
<p>數據就亂了</p>
<p>DBMS裡在　為保證transation可靠，所以要有ACID</p>
<img src="/Users/joe/Library/Application Support/typora-user-images/image-20200206222645993.png" alt="image-20200206222645993" style="zoom:50%;" />



<h1 id="NoSQL-Cont"><a href="#NoSQL-Cont" class="headerlink" title="NoSQL Cont."></a>NoSQL Cont.</h1><ul>
<li><p>CAP Theorem</p>
</li>
<li><p>在<a href="https://zh.wikipedia.org/wiki/理論計算機科學" target="_blank" rel="noopener">理論計算機科學</a>中，<strong>CAP定理</strong>（CAP theorem），又被稱作<strong>布魯爾定理</strong>（Brewer’s theorem），它指出對於一個<a href="https://zh.wikipedia.org/wiki/分布式计算" target="_blank" rel="noopener">分布式計算系統</a>來說，不可能同時滿足以下三點：<a href="https://zh.wikipedia.org/wiki/CAP定理#cite_note-Lynch-1" target="_blank" rel="noopener">[1]</a><a href="https://zh.wikipedia.org/wiki/CAP定理#cite_note-2" target="_blank" rel="noopener">[2]</a></p>
<ul>
<li>一致性（<strong>C</strong>onsistency） （等同於所有節點訪問同一份最新的數據副本）</li>
<li><a href="https://zh.wikipedia.org/wiki/可用性" target="_blank" rel="noopener">可用性</a>（<strong>A</strong>vailability）（每次請求都能獲取到非錯的響應——但是不保證獲取的數據為最新數據）</li>
<li><a href="https://zh.wikipedia.org/w/index.php?title=网络分区&action=edit&redlink=1" target="_blank" rel="noopener">分區容錯性</a>（<strong>P</strong>artition tolerance）（以實際效果而言，分區相當於對通信的時限要求。系統如果不能在時限內達成數據一致性，就意味著發生了分區的情況，必須就當前操作在C和A之間做出選擇<a href="https://zh.wikipedia.org/wiki/CAP定理#cite_note-3" target="_blank" rel="noopener">[3]</a>。）</li>
</ul>
<p>根據定理，分布式系統只能滿足三項中的兩項而不可能滿足全部三項<a href="https://zh.wikipedia.org/wiki/CAP定理#cite_note-4" target="_blank" rel="noopener">[4]</a>。理解CAP理論的最簡單方式是想像兩個節點分處分區兩側。允許至少一個節點更新狀態會導致數據不一致，即喪失了C性質。如果為了保證數據一致性，將分區一側的節點設置為不可用，那麼又喪失了A性質。除非兩個節點可以互相通信，才能既保證C又保證A，這又會導致喪失P性質。</p>
<p><strong>BASE</strong> is often used to describe the properties of NoSQL databases. In comparison with the <a href="https://github.com/donnemartin/system-design-primer#cap-theorem" target="_blank" rel="noopener">CAP Theorem</a>, BASE chooses availability over consistency.</p>
<ul>
<li><strong>Basically available</strong> - the system guarantees availability.</li>
<li><strong>Soft state</strong> - the state of the system may change over time, even without input.</li>
<li><strong>Eventual consistency</strong> - the system will become consistent over a period of time, given that the system doesn’t receive input during that period.</li>
</ul>
</li>
</ul>
<h4 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h4><p>ORM object relational mapping, mysql oracle都是可以被java裡搞定起來</p>
<p>DDL 時都是差不多的　－　Data Definition Language，DDL</p>
<h4 id="NoSQL就有分流派了-主要就是四大流派"><a href="#NoSQL就有分流派了-主要就是四大流派" class="headerlink" title="NoSQL就有分流派了 主要就是四大流派"></a>NoSQL就有分流派了 主要就是四大流派</h4><p>Key-Value資料庫、記憶體資料庫、圖學資料庫和文件資料庫.</p>
<h4 id="Source-s-and-further-reading-key-value-store"><a href="#Source-s-and-further-reading-key-value-store" class="headerlink" title="Source(s) and further reading: key-value store"></a>Source(s) and further reading: key-value store</h4><ul>
<li><p><a href="https://en.wikipedia.org/wiki/Key-value_database" target="_blank" rel="noopener">Key-value database</a></p>
<p>如cassandra</p>
</li>
<li><p><a href="http://stackoverflow.com/questions/4056093/what-are-the-disadvantages-of-using-a-key-value-table-over-nullable-columns-or" target="_blank" rel="noopener">Disadvantages of key-value stores</a></p>
</li>
<li><p><a href="http://qnimate.com/overview-of-redis-architecture/" target="_blank" rel="noopener">Redis architecture</a>　比較是緩存服務</p>
</li>
<li><p><a href="https://www.adayinthelifeof.nl/2011/02/06/memcache-internals/" target="_blank" rel="noopener">Memcached architecture</a>　比較是緩存服務</p>
</li>
</ul>
<h4 id="Document-Store-MongoDB"><a href="#Document-Store-MongoDB" class="headerlink" title="Document Store - MongoDB"></a>Document Store - MongoDB</h4><h5 id="最重要的就是Schemaless-–-就是沒有schema"><a href="#最重要的就是Schemaless-–-就是沒有schema" class="headerlink" title="最重要的就是Schemaless – 就是沒有schema,"></a>最重要的就是Schemaless – 就是沒有schema,</h5><h4 id="Document-store"><a href="#Document-store" class="headerlink" title="Document store"></a>Document store</h4><blockquote>
<p>Abstraction: key-value store with documents stored as values</p>
</blockquote>
<p>A document store is centered around documents (XML, JSON, binary, etc), where a document stores all information for a given object. Document stores provide APIs or a query language to query based on the internal structure of the document itself. <em>Note, many key-value stores include features for working with a value’s metadata, blurring the lines between these two storage types.</em></p>
<p>Based on the underlying impleme</p>
<h5 id="Source-s-and-further-reading-document-store"><a href="#Source-s-and-further-reading-document-store" class="headerlink" title="Source(s) and further reading: document store"></a>Source(s) and further reading: document store</h5><ul>
<li><a href="https://en.wikipedia.org/wiki/Document-oriented_database" target="_blank" rel="noopener">Document-oriented database</a></li>
<li><a href="https://www.mongodb.com/mongodb-architecture" target="_blank" rel="noopener">MongoDB architecture</a></li>
<li><a href="https://blog.couchdb.org/2016/08/01/couchdb-2-0-architecture/" target="_blank" rel="noopener">CouchDB architecture</a></li>
<li><a href="https://www.elastic.co/blog/found-elasticsearch-from-the-bottom-up" target="_blank" rel="noopener">Elasticsearch architecture</a></li>
</ul>
<h4 id="Wide-column-store"><a href="#Wide-column-store" class="headerlink" title="Wide column store"></a>Wide column store</h4><p><a href="https://tva1.sinaimg.cn/large/0082zybpgy1gbn4cnj0ioj30g506f0t2.jpg" target="_blank" rel="noopener"><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gbn4cnj0ioj30g506f0t2.jpg" alt="img"></a><br><strong><em><a href="http://blog.grio.com/2015/11/sql-nosql-a-brief-history.html" target="_blank" rel="noopener">Source: SQL &amp; NoSQL, a brief history</a></em></strong></p>
<blockquote>
<p>Abstraction: nested map <code>ColumnFamily&gt;</code></p>
</blockquote>
<p>Google introduced <a href="http://www.read.seas.harvard.edu/~kohler/class/cs239-w08/chang06bigtable.pdf" target="_blank" rel="noopener">Bigtable</a> as the first wide column store, which influenced the open-source <a href="https://www.mapr.com/blog/in-depth-look-hbase-architecture" target="_blank" rel="noopener">HBase</a> often-used in the Hadoop ecosystem, and <a href="http://docs.datastax.com/en/cassandra/3.0/cassandra/architecture/archIntro.html" target="_blank" rel="noopener">Cassandra</a> from Facebook. Stores such as BigTable, HBase, and Cassandra maintain keys in lexicographic order, allowing efficient retrieval of selective key ranges.</p>
<h4 id="Graph-DB-–-for-social-Network"><a href="#Graph-DB-–-for-social-Network" class="headerlink" title="Graph DB – for social Network"></a>Graph DB – for social Network</h4><h5 id="Graph-database"><a href="#Graph-database" class="headerlink" title="Graph database"></a>Graph database</h5><p><a href="https://tva1.sinaimg.cn/large/0082zybpgy1gbn4cpicsqj30h40c4gps.jpg" target="_blank" rel="noopener"><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gbn4cpicsqj30h40c4gps.jpg" alt="img"></a><br><em><a href="https://en.wikipedia.org/wiki/File:GraphDatabase_PropertyGraph.png" target="_blank" rel="noopener">Source: Graph database</a></em></p>
<blockquote>
<p>Abstraction: graph</p>
</blockquote>
<p>In a graph database, each node is a record and each arc is a relationship between two nodes. Graph databases are optimized to represent complex relationships with many foreign keys or many-to-many relationships.</p>
<p>Graphs databases offer high performance for data models with complex relationships, such as a social network. They are relatively new and are not yet widely-used; it might be more difficult to find development tools and resources. Many graphs can only be accessed with <a href="https://github.com/donnemartin/system-design-primer#representational-state-transfer-rest" target="_blank" rel="noopener">REST APIs</a>.</p>
<h5 id="Source-s-and-further-reading-graph"><a href="#Source-s-and-further-reading-graph" class="headerlink" title="Source(s) and further reading: graph"></a>Source(s) and further reading: graph</h5><ul>
<li><a href="https://en.wikipedia.org/wiki/Graph_database" target="_blank" rel="noopener">Graph database</a></li>
<li><a href="https://neo4j.com/" target="_blank" rel="noopener">Neo4j</a></li>
<li><a href="https://blog.twitter.com/2010/introducing-flockdb" target="_blank" rel="noopener">FlockDB</a></li>
</ul>
<h2 id="SQL-vs-NoSQL"><a href="#SQL-vs-NoSQL" class="headerlink" title="SQL vs NoSQL"></a>SQL vs NoSQL</h2><p>mysql vs cassandra 之間的區別之類的？</p>
<p>Reasons for <strong>SQL</strong>:</p>
<ul>
<li>Structured data</li>
<li>Strict schema</li>
<li>Relational data</li>
<li>Need for complex joins 如用戶跟group</li>
<li>Transactions　事務</li>
<li>Clear patterns for scaling</li>
<li>More established: developers, community, code, tools, etc</li>
<li>Lookups by <strong><em>index</em></strong> are very fast</li>
</ul>
<p>Reasons for <strong>NoSQL</strong>:</p>
<ul>
<li>Semi-structured data　　</li>
<li><strong><em>Dynamic or flexible schema</em></strong></li>
<li>Non-relational data</li>
<li>No need for complex joins</li>
<li><strong><em>Store many TB (or PB) of data</em></strong>　</li>
<li><strong><em>Very data intensive workload</em></strong> </li>
<li>Very high throughput for IOPS (Input/Output Operations Per Second</li>
</ul>
<p>Sample data well-suited for NoSQL:</p>
<ul>
<li>Rapid ingest of clickstream and <strong><em>log data</em></strong> 之前說的頻繁寫的</li>
<li>Leaderboard or scoring data <strong><em>就 eventually consistency 就好的</em></strong></li>
<li>Temporary data, such as a shopping cart  有cache就可以搞定</li>
<li>Frequently accessed (‘hot’) tables</li>
<li>Metadata/lookup tables</li>
</ul>
<h5 id="Source-s-and-further-reading-SQL-or-NoSQL"><a href="#Source-s-and-further-reading-SQL-or-NoSQL" class="headerlink" title="Source(s) and further reading: SQL or NoSQL"></a>Source(s) and further reading: SQL or NoSQL</h5><ul>
<li><a href="https://www.youtube.com/watch?v=w95murBkYmU" target="_blank" rel="noopener">Scaling up to your first 10 million users</a></li>
<li><a href="https://www.sitepoint.com/sql-vs-nosql-differences/" target="_blank" rel="noopener">SQL vs NoSQL differences</a></li>
</ul>
<p>![image-20200206225707917](/Users/joe/Library/Application Support/typora-user-images/image-20200206225707917.png)</p>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><p>![image-20200206225824207](/Users/joe/Library/Application Support/typora-user-images/image-20200206225824207.png)</p>
<p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gbn4crkjxdj311005wdge.jpg" alt="image-20200206225934479"></p>
<img src="/Users/joe/Library/Application Support/typora-user-images/image-20200206230007842.png" alt="image-20200206230007842" style="zoom:50%;" />

<p>量不大時　SQL 就夠了；如ACID、data不會變的或結構的</p>
<p>量大時才會用 NoSQL 學校一般用不到那麼大流量啊 量大時一般沒結構，的確NoSQL也是比較靈活</p>
<p>雲上一般要多個機器，硬體也都比較便宜</p>
<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd5cj2dgicj30u00wv1g9.jpg" alt="image-20200324213805414" style="zoom: 33%;" /></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/02/06/System-Design/2020-02-05-System%20Design%20-%20Sharding%20&amp;%20Queue/">System-Design/2020-02-05-System Design - Sharding &amp; Queue</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-06</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/System/">System</a></span><div class="content"><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h1 id="分片"><a href="#分片" class="headerlink" title="分片"></a>分片</h1><p>partition  or  sharding</p>
<p>每個機器分一部分就是要切小塊，LB就是在做pardition　sharding更指db的存儲</p>
<p>日本放在日本的db，因為有 sharding　所以要routing去找數據</p>
<img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gbmy6i9wcvj30hu0k8781.jpg" alt="img" style="zoom:50%;" />

<p>sharding　一般來說指的是db　</p>
<p>partition不一定是固定的，也可能增加了機器，每個就管得比較少了</p>
<p>照地理位置去找</p>
<p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gbn4cs9n1vj30yg0lcdit.jpg" alt="image-20200206202240123"></p>
<img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gbmy90zsmlj30tw0k0dnz.jpg" alt="image-20200206202333357" style="zoom:50%;" />

<p>![image-20200206202407013](/Users/joe/Library/Application Support/typora-user-images/image-20200206202407013.png)</p>
<img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gbmya9oquoj30ym0jck1l.jpg" alt="image-20200206202443059" style="zoom:50%;" />



<h3 id="Partition-Method"><a href="#Partition-Method" class="headerlink" title="Partition Method"></a>Partition Method</h3><p>by ID, by letter, by Term</p>
<p>Horizontal partitioning : as by ID　風險：range分得不好，所以不平衡，怎麼evenly distributed?!</p>
<p>Vertical Partitioning : 按業務去分　如下圖↓</p>
<img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gbmyk67nx2j30kw0mwjyj.jpg" alt="image-20200206203421886" style="zoom:50%;" /> 

<p>業務調整、或是中間加一層就更複雜了</p>
<h2 id="Partitioning-Criteria"><a href="#Partitioning-Criteria" class="headerlink" title="Partitioning Criteria"></a>Partitioning Criteria</h2><ol>
<li>key or hash-based partitioning<br>userid每次加１的id，對100取個mod去知道哪個機器，工業中一般不用　這個是distributed hashing，用consistent hashing比較好↓</li>
<li>list partitionging 自己聲明rule 就像mongodb，自己定義</li>
<li>round-robin</li>
<li>composite</li>
</ol>
<h2 id="Consistent-Hashing"><a href="#Consistent-Hashing" class="headerlink" title="Consistent Hashing"></a>Consistent Hashing</h2><p>把所有可能的hash值分成圓五份 </p>
<p>這樣可能不均勻</p>
<p>所以就有個vnnode的概念 一個機器對應五個 vnnode</p>
<img src="/Users/joe/Library/Application Support/typora-user-images/image-20200206204214506.png" alt="image-20200206204214506" style="zoom:50%;" />

<p>可能一個對應256個vnnode</p>
<h4 id="備份↓"><a href="#備份↓" class="headerlink" title="備份↓"></a>備份↓</h4><img src="/Users/joe/Library/Application Support/typora-user-images/image-20200206204351704.png" alt="image-20200206204351704" style="zoom:50%;" />

<p>如果４～５區段掛了，全給A承擔太不公平；如果有vnnode　一台機器掛了，後面的每個機器都可以均勻分擔這個量</p>
<p>distributed hash是大挪移要全重算…　所以一致性哈希好</p>
<h2 id="Common-problems-of-Sharding"><a href="#Common-problems-of-Sharding" class="headerlink" title="Common problems of Sharding"></a>Common problems of Sharding</h2><p>因為數據不是在一處，所以要去多個地方去取。</p>
<ol>
<li>Join and Denormalization 去user table 去查 name ；<br>讀還ok寫就麻煩了</li>
<li>Referential integrity </li>
<li>Rebalancing 重弄分片；有某個zip數據量特大。</li>
</ol>
<h2 id="LinkedIn-Prob"><a href="#LinkedIn-Prob" class="headerlink" title="LinkedIn Prob."></a>LinkedIn Prob.</h2><img src="/Users/joe/Library/Application Support/typora-user-images/image-20200206205226121.png" alt="image-20200206205226121" style="zoom:50%;" />

<img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gbmz3ewua8j30x40jqn9w.jpg" alt="image-20200206205246002" style="zoom:50%;" />

<img src="/Users/joe/Library/Application Support/typora-user-images/image-20200206205350491.png" alt="image-20200206205350491" style="zoom:50%;" />



<h5 id="Expression-Tree"><a href="#Expression-Tree" class="headerlink" title="Expression Tree"></a>Expression Tree</h5><img src="/Users/joe/Library/Application Support/typora-user-images/image-20200206205535354.png" alt="image-20200206205535354" style="zoom:50%;" />



<h1 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h1><h4 id="message-queue"><a href="#message-queue" class="headerlink" title="message queue　"></a>message queue　</h4><p>不會丟，可以保證不會丟失</p>
<p>往ｑ放東西，consumer拿東西，本身是個異步過程。 Hot-spot, burst，Q就是個buffer，</p>
<p>系統可以不用等在那邊，可防止 burst</p>
<ul>
<li>An application publishes a job to the queue, then notifies the user of job status</li>
<li>A worker picks up the job from the queue, processes it, then signals the job is complete</li>
</ul>
<p>可以buffer住一堆來的請求，讓producer不用等在那邊<br>consumer一直去polling　就是異步</p>
<p>這情況同步會降低效能 </p>
<p>要確定放成功了 要拿個 task_id 之後再一直去要</p>
<p><strong><a href="https://redis.io/" target="_blank" rel="noopener">Redis</a></strong> is useful as a simple message broker but messages can be lost.</p>
<p><strong><a href="https://www.rabbitmq.com/" target="_blank" rel="noopener">RabbitMQ</a></strong> is popular but requires you to adapt to the ‘AMQP’ protocol and manage your own nodes.</p>
<p><strong><a href="https://aws.amazon.com/sqs/" target="_blank" rel="noopener">Amazon SQS</a></strong> is hosted but can have high latency and has the possibility of messages being delivered twice.</p>
<p>上面三個比較有名的 message queue的框架</p>
<p> server取完後再去把task刪了，至少這個task還是在queue裡的 </p>
<h5 id="可以取出來在db-or-que寫-in-progress，-gt-high-availability-不丟消息"><a href="#可以取出來在db-or-que寫-in-progress，-gt-high-availability-不丟消息" class="headerlink" title="可以取出來在db or que寫 in progress，==&gt; high availability　不丟消息"></a>可以取出來在db or que寫 in progress，==&gt; high availability　不丟消息</h5><p>可以retry</p>
<p>![image-20200206211146919](/Users/joe/Library/Application Support/typora-user-images/image-20200206211146919.png)</p>
<h5 id="Async-缺點：當計算快時比較建議用同步就好，因為que會有delay跟complexity"><a href="#Async-缺點：當計算快時比較建議用同步就好，因為que會有delay跟complexity" class="headerlink" title="Async 缺點：當計算快時比較建議用同步就好，因為que會有delay跟complexity"></a>Async 缺點：當計算快時比較建議用同步就好，因為que會有delay跟complexity</h5></div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/50/">50</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By Joe Huang</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>