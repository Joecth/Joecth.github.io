<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="Joe Huang"><meta name="copyright" content="Joe Huang"><title>Awaken Desparado</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.1.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Joe Huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">249</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">24</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">36</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Awaken Desparado</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Awaken Desparado</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/18/System-Design/9p/2020-03-18-System%20Design%20&amp;%20Design%20Twitter/">System-Design/9p/2020-03-18-System Design &amp; Design Twitter</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-18</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/SystemDesign/">SystemDesign</a></span><div class="content"><ul>
<li><h3 id="Web-Server"><a href="#Web-Server" class="headerlink" title="Web Server"></a>Web Server</h3></li>
<li><h3 id="DB"><a href="#DB" class="headerlink" title="DB"></a>DB</h3></li>
<li><h3 id="File-System"><a href="#File-System" class="headerlink" title="File System"></a>File System</h3></li>
<li><h3 id="Cache"><a href="#Cache" class="headerlink" title="Cache"></a>Cache</h3></li>
</ul>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><h1 id="Design-Twitter"><a href="#Design-Twitter" class="headerlink" title="Design Twitter"></a>Design Twitter</h1><h2 id="General"><a href="#General" class="headerlink" title="General"></a>General</h2><ol>
<li>注意事項：<ul>
<li>這個問題要考慮的用戶規模有多大？</li>
<li>有哪些功能需要我設計的？</li>
</ul>
</li>
<li>Key words: <ul>
<li>Load Balancer, Memcache, NodeJS, MongoDB, MySQL, Sharding, Consistent Sharding, Master Slave, HDFS, Hadoop…<ul>
<li>How if only 2 users?…  No need all above… So, <strong>ASK</strong> for clarification first!</li>
</ul>
</li>
</ul>
</li>
<li>側重：<ul>
<li>Work solution</li>
<li>Special Case</li>
<li>Analysis</li>
<li>Tradeoff, PlanA vs PlanB</li>
<li>Knowledge Base, e.g. DB, FS, Memory, Info Queue</li>
</ul>
</li>
</ol>
<ol start="4">
<li>4S analyzation<ul>
<li>Scenario<br>需要設計哪些功能？功能要到多厲害？<br>Ask: Features, QPS, DAU, Interfaces</li>
<li>Service<br>將大系統拆分為小服務<br>Split Application, Module</li>
<li>Storage<br>數據如何存儲與訪問<br>Schema: Data, SQL, NoSQL, File System</li>
<li>Scale<br>怎麼解決缺陷，處理可能遇到的問題<br>Sharding, Optimize, Special Case</li>
</ul>
</li>
</ol>
<h2 id="Scenario-場景"><a href="#Scenario-場景" class="headerlink" title="Scenario 場景"></a>Scenario 場景</h2><ol>
<li>Ask; 2. Analysis</li>
</ol>
<ul>
<li>需要設計哪些功能？</li>
<li>需要承受多大的訪問量？<ul>
<li>DAU</li>
<li>Twitter: MAU 330M, DAU ~170+M</li>
</ul>
</li>
</ul>
<p>有些公司會用註冊用戶，但這不準。一般要看MAU。</p>
<blockquote>
<h5 id="单选题-下面说法中，”不”正确的是"><a href="#单选题-下面说法中，”不”正确的是" class="headerlink" title="[单选题]下面说法中，”不”正确的是"></a>[单选题]下面说法中，”不”正确的是</h5><p>A.MAU 会影响到 DAU，DAU 会影响到并发请求的用户数，从而影响到系统的承载力5.37% 选择</p>
<p>B.一个用户一个月登陆了3次，会累加 3次 MAU77.78% 选择</p>
<p>C.一个用户一天登陆了10次也只算一次 DAU9.55% 选择</p>
<p>D.MAU 和 DAU 的比例通常是 2:1 左右7.30% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTM0MTgxMjgxODM5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM3NjIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxOC4xMiA1MTYuMTZtLTQ5MCAwYTQ5MCA0OTAgMCAxIDAgOTgwIDAgNDkwIDQ5MCAwIDEgMC05ODAgMFoiIGZpbGw9IiM1NkI0MzIiIHAtaWQ9IjM3NjMiPjwvcGF0aD48cGF0aCBkPSJNMzkzLjIxMzYxOSA2NjQuMzM1NDk1bTI4LjI4NDI3MS0yOC4yODQyNzFsMjk2Ljk4NDg0OS0yOTYuOTg0ODQ4cTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBsMCAwcTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDJsLTI5Ni45ODQ4NDggMjk2Ljk4NDg0OHEtMjguMjg0MjcxIDI4LjI4NDI3MS01Ni41Njg1NDMgMGwwIDBxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDJaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY0Ij48L3BhdGg+PHBhdGggZD0iTTI4OS40Njk4NCA0NTIuODQ3ODgzbTI4LjI4NDI3MSAyOC4yODQyNzFsMTU1LjU2MzQ5MiAxNTUuNTYzNDkycTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDNsMCAwcS0yOC4yODQyNzEgMjguMjg0MjcxLTU2LjU2ODU0MyAwbC0xNTUuNTYzNDkxLTE1NS41NjM0OTJxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDNsMCAwcTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY1Ij48L3BhdGg+PC9zdmc+" alt="img">答对了，您选择的答案是B</p>
<p><strong>正确答案:</strong>B</p>
<p><strong>解析:</strong></p>
<p>B是错的，一个用户一个月登陆 100 次也只算作 1 次 MAU</p>
</blockquote>
<h3 id="需要設計哪些功能"><a href="#需要設計哪些功能" class="headerlink" title="需要設計哪些功能"></a>需要設計哪些功能</h3><p>Step1. Enumerate - 把 Twitter 的功能一個個羅列出來</p>
<ul>
<li>Register/ Login</li>
<li>User Profile Display / Edit</li>
<li>Upload Image / Video * </li>
<li>Search *</li>
<li>Post /Share a tweet</li>
<li>Timeline News Feed</li>
<li>Follow Unfollow a User</li>
</ul>
<p>Step2. Sort - 選出核心功能</p>
<ul>
<li>Post a Tweet</li>
<li>Timeline</li>
<li>News Feed</li>
<li>Follow / Unfollow a user</li>
<li>Register / Login</li>
</ul>
<blockquote>
<ul>
<li><p>Read QPS: 是对数据库的操作频率</p>
</li>
<li><p>TPS = Transactions Per second<br>QPS = Queries Per second<br>一个 Transaction 里可能会有多个 Db Query。<br>一般来说我做这么细的区分，统一都用 QPS 就可以了。</p>
</li>
<li><p>mongodb, dynamodb 的QPS大概多少:</p>
<ul>
<li>根据机器配置不同，是不一样的。大概在 1w~10w 这个级别。</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd6gby3ys1j30x40ewac9.jpg" alt="image-20200325203515823" style="zoom:50%;" />
</li>
<li><p>SQL vs NoSQL 大概有几个原则：</p>
<ol>
<li>大部分的情况，用SQL也好，用NoSQL也好，都是可以的</li>
<li>需要支持 Transaction 的话不能选 NoSQL</li>
<li>你想不想偷懒很大程度决定了选什么数据库，SQL更成熟帮你做了很多事儿，NoSQL很多事儿都要亲力亲为(Serialization, Secondary Index)</li>
<li>如果想省点服务器获得更高的性能，NoSQL就更好硬盘型的NoSQL比SQL一般都要快10倍以上</li>
</ol>
<p>这个NoSQ跟SQL的选择没有一套万能的方法去告诉你应该怎么选，需要了解各种数据库的优缺点，根据场景需求灵活选择。</p>
</li>
<li><p>NoSQL 的数据结构比较简单，支持的查询操作也比较简单。结构简单的话，处理效率就高。SQL 为了支持一些很复杂的查询，所以处理效率较低。</p>
</li>
<li><p>Database 里index query是啥呀</p>
<ul>
<li>就是说查询的时候，database 通过 index 进行查询，会比一个一个数据查过去的方式更快</li>
<li>select * from xxx table where yyy=1, 如果 yyy 有 index，就是一个 index query，否则就是一个 sequential query</li>
</ul>
</li>
<li><p>join应该是变慢，index query是加快，为什么都会让qps变小呢？</p>
<ul>
<li>index query 这里指的是相对于按照 primary key(id) 去 query。因为 index query 要先query index 的内部表，再去具体的表单里取数据，相比直接通过 id 去取数据要慢的。</li>
</ul>
</li>
<li><p>为啥NOSQL承受量这么多， 跟SQL比起来</p>
<ul>
<li>因为 NoSQL 的数据结构比较简单，支持的查询操作也比较简单。结构简单的话，处理效率就高。SQL 为了支持一些很复杂的查询，所以处理效率较低。</li>
</ul>
</li>
<li><p>join应该是变慢，index query是加快，为什么都会让qps变小呢？</p>
<p>index query多所以查询速度快，所以每秒可处理的query更多，所以qps的值不是应该更大么？课件上说join和index query多的话，qps会小。。 ?</p>
<ul>
<li>index query 这里指的是相对于按照 primary key(id) 去 query。因为 index query 要先query index 的内部表，再去具体的表单里取数据，相比直接通过 id 去取数据要慢的。</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><p>將大系統拆分為小服務, 如 SOA, Service Oriented Architecture</p>
<p>合併需要設計的功能，相似的功能整合為一個Service - 邏輯處理的整合</p>
<ol>
<li>Replay 重放需求</li>
<li>Merge 歸併需求</li>
</ol>
<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd6gnly99kj30oc0bead6.jpg" alt="image-20200325204630511" style="zoom:50%;" />







<h2 id="Storage"><a href="#Storage" class="headerlink" title="Storage"></a>Storage</h2><ul>
<li>现在 id 一般要用 Bigint （64位）才不会担心溢出。</li>
<li>細化數據表單</li>
<li>畫圖展示數據存、讀過程</li>
<li>為每個Service選合適的儲存</li>
</ul>
<blockquote>
<h5 id="单选题-关于文件系统和数据库系统之间的关系，下列说法“不正确”的是？"><a href="#单选题-关于文件系统和数据库系统之间的关系，下列说法“不正确”的是？" class="headerlink" title="[单选题]关于文件系统和数据库系统之间的关系，下列说法“不正确”的是？"></a>[单选题]关于文件系统和数据库系统之间的关系，下列说法“不正确”的是？</h5><p>A.数据库系统是建立在文件系统之上的，也就是说数据库系统中存储的数据最终都是要存在文件系统上的18.45% 选择</p>
<p>B.文件系统中可以支持丰富的数据查询接口，如在记录用户信息的文件中快速挑选出所有身高在 175 到 185 之间的男性68.39% 选择</p>
<p>C.我们一般将结构化的数据（Structured Data）放在数据库系统中，把非结构化的数据放在文件系统中9.42% 选择</p>
<p>D.文件系统和数据库系统都是可持久化的存储系统3.74% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTQxNzAwNjYyNTQzIiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjEwODgiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iNjQiIGhlaWdodD0iNjQiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxMiAwYTUxMiA1MTIgMCAxIDAgMCAxMDI0QTUxMiA1MTIgMCAwIDAgNTEyIDB6IG0xNjUuOTUyIDYzNy43NmwxNS4wNCAxNC45NzZhMjguNDE2IDI4LjQxNiAwIDEgMS00MC4yNTYgNDAuMjU2bC0xNC45NzYtMTUuMDRMNTA5LjUwNCA1NDkuNzYgMzcxLjIgNjg4YTI4LjQxNiAyOC40MTYgMCAxIDEtNDAuMjU2LTQwLjI1NmwxMzguMzA0LTEzOC4yNC0xMjMuMi0xMjMuMi0xNS4xMDQtMTUuMTA0YTI4LjU0NCAyOC41NDQgMCAwIDEgMC00MC4yNTYgMjguNTQ0IDI4LjU0NCAwIDAgMSA0MC4yNTYgMGwxNS4wNCAxNS4xMDRMNTA5LjQ0IDQ2OS4yNDhsMTQzLjIzMi0xNDMuMjk2YTI4LjQxNiAyOC40MTYgMCAxIDEgNDAuMjU2IDQwLjI1Nkw1NDkuNzYgNTA5LjUwNGwxMjguMTkyIDEyOC4yNTZ6IiBmaWxsPSIjRjY1RTVFIiBwLWlkPSIxMDg5Ij48L3BhdGg+PC9zdmc+" alt="img">答错了，您选择的答案是C</p>
<p><strong>正确答案:</strong>B</p>
<p><strong>解析:</strong></p>
<p>数据库系统是文件系统的一层“包装”，将数据结构化的存储起来，从而可以支持更丰富的数据查询方法。如筛选某个属性在某个范围内的所有数据。而文件系统一般就是支持最简单的查询方法：取出某个文件从第x个字节开始的长度为y的所有数据。</p>
</blockquote>
<p>NoSQL 有index吗？</p>
<p>有的，MongoDB就支持索引<a href="http://www.runoob.com/mongodb/mongodb-indexing.html。" target="_blank" rel="noopener">http://www.runoob.com/mongodb/mongodb-indexing.html。</a><br>索引就是帮助快速定位数据的一组附加信息，可以用在NoSQL上。</p>
<blockquote>
<h5 id="单选题-为什么-User-Table-里不用-username-email-作为-Primary-key"><a href="#单选题-为什么-User-Table-里不用-username-email-作为-Primary-key" class="headerlink" title="[单选题]为什么 User Table 里不用 username / email 作为 Primary key"></a>[单选题]为什么 User Table 里不用 username / email 作为 Primary key</h5><p>A.因为两个用户可能使用同一个 Username23.95% 选择</p>
<p>B.因为数据库只支持整数作为 primary key6.02% 选择</p>
<p>C.因为 email 要区分大小写，查询相对较慢4.06% 选择</p>
<p>D.因为很多网站支持用户修改 email 和 username65.97% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTQxNzAwNjYyNTQzIiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjEwODgiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iNjQiIGhlaWdodD0iNjQiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxMiAwYTUxMiA1MTIgMCAxIDAgMCAxMDI0QTUxMiA1MTIgMCAwIDAgNTEyIDB6IG0xNjUuOTUyIDYzNy43NmwxNS4wNCAxNC45NzZhMjguNDE2IDI4LjQxNiAwIDEgMS00MC4yNTYgNDAuMjU2bC0xNC45NzYtMTUuMDRMNTA5LjUwNCA1NDkuNzYgMzcxLjIgNjg4YTI4LjQxNiAyOC40MTYgMCAxIDEtNDAuMjU2LTQwLjI1NmwxMzguMzA0LTEzOC4yNC0xMjMuMi0xMjMuMi0xNS4xMDQtMTUuMTA0YTI4LjU0NCAyOC41NDQgMCAwIDEgMC00MC4yNTYgMjguNTQ0IDI4LjU0NCAwIDAgMSA0MC4yNTYgMGwxNS4wNCAxNS4xMDRMNTA5LjQ0IDQ2OS4yNDhsMTQzLjIzMi0xNDMuMjk2YTI4LjQxNiAyOC40MTYgMCAxIDEgNDAuMjU2IDQwLjI1Nkw1NDkuNzYgNTA5LjUwNGwxMjguMTkyIDEyOC4yNTZ6IiBmaWxsPSIjRjY1RTVFIiBwLWlkPSIxMDg5Ij48L3BhdGg+PC9zdmc+" alt="img">答错了，您选择的答案是A</p>
<p><strong>正确答案:</strong>D</p>
<p><strong>相关知识点:</strong>主键和外键 Primary Key &amp; Foreign Key</p>
<p><strong>解析:</strong></p>
<p>如果用 username / email 作为 primary key，会因被其他 table 引用而存储在其他的 table 中，如果被修改，会引起一连串的修改，效率很低。另外一个重要的原因是，通常 primary key 会作为 url 中的一个部分被分享出去，如果 primary key 被修改，则可能导致原本被分享出去的 url 失效。</p>
</blockquote>
<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd5ektr01cj30v60do430.jpg" alt="image-20200324224901600" style="zoom:50%;" />

<ul>
<li>varchar 是数据库里的 string。</li>
<li>用来作foreign key 的不希望它經常變化</li>
<li>Tweet可以放在SQL也可以放在NoSQL。这里的Schema只是为了确定每条Tweet需要有哪些字段，这些字段可以存在SQL数据库中也可以存在NoSQL中。如果用SQL存的话，那么就是一行是一个tweet，如果是key-value型的NoSQL，那可能就是id =&gt; {user_id, content, created_at}这样的结构。</li>
<li>media service 就不需要有任何結構啦</li>
</ul>
<h3 id="PULL"><a href="#PULL" class="headerlink" title="PULL"></a>PULL</h3><h4 id="News-Feed-如何存取？-gt-Tradeoff"><a href="#News-Feed-如何存取？-gt-Tradeoff" class="headerlink" title="News Feed 如何存取？==&gt; Tradeoff!"></a>News Feed 如何存取？==&gt; Tradeoff!</h4><ul>
<li>登入後看到的info的整合</li>
<li>典型例子<ul>
<li>FB, Twitter, 朋友圈，RSS Reader(關啦)</li>
</ul>
</li>
<li>新鮮事系統的核心因素？<ul>
<li>關注＆被關注</li>
<li>每個人看到的新鮮都是不同的</li>
</ul>
</li>
</ul>
<p>主動要，拉自己關注的10個好友的前100 tweets，再合成一個給自己看的前100條 ==&gt; </p>
<ul>
<li>Merge K Sorted Lists</li>
<li>複雜度：<ul>
<li>如果關注了N個人，那麼就N次DB REA時間 + N路merge時間(這個可忽略)</li>
<li>disk 慢 memory 1000倍。</li>
<li>Post a tweet =&gt; 1 次 DB Write 的時間</li>
</ul>
</li>
</ul>
<blockquote>
<h5 id="单选题-关于为什么多路归并的时间可以被忽略，下列说法不正确的是"><a href="#单选题-关于为什么多路归并的时间可以被忽略，下列说法不正确的是" class="headerlink" title="[单选题]关于为什么多路归并的时间可以被忽略，下列说法不正确的是"></a>[单选题]关于为什么多路归并的时间可以被忽略，下列说法不正确的是</h5><p>A.因为 DB Reads 的时间是瓶颈15.43% 选择</p>
<p>B.因为多路归并的操作都是在内存和CPU中进行的，相对于在DB中读取数据是很快的43.05% 选择</p>
<p>C.因为多路归并的时间复杂度相对磁盘读取更低41.53% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTM0MTgxMjgxODM5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM3NjIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxOC4xMiA1MTYuMTZtLTQ5MCAwYTQ5MCA0OTAgMCAxIDAgOTgwIDAgNDkwIDQ5MCAwIDEgMC05ODAgMFoiIGZpbGw9IiM1NkI0MzIiIHAtaWQ9IjM3NjMiPjwvcGF0aD48cGF0aCBkPSJNMzkzLjIxMzYxOSA2NjQuMzM1NDk1bTI4LjI4NDI3MS0yOC4yODQyNzFsMjk2Ljk4NDg0OS0yOTYuOTg0ODQ4cTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBsMCAwcTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDJsLTI5Ni45ODQ4NDggMjk2Ljk4NDg0OHEtMjguMjg0MjcxIDI4LjI4NDI3MS01Ni41Njg1NDMgMGwwIDBxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDJaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY0Ij48L3BhdGg+PHBhdGggZD0iTTI4OS40Njk4NCA0NTIuODQ3ODgzbTI4LjI4NDI3MSAyOC4yODQyNzFsMTU1LjU2MzQ5MiAxNTUuNTYzNDkycTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDNsMCAwcS0yOC4yODQyNzEgMjguMjg0MjcxLTU2LjU2ODU0MyAwbC0xNTUuNTYzNDkxLTE1NS41NjM0OTJxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDNsMCAwcTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY1Ij48L3BhdGg+PC9zdmc+" alt="img">答对了，您选择的答案是C</p>
<p><strong>正确答案:</strong>C</p>
<p><strong>解析:</strong></p>
<p>假设一共 N 个关注的好友，每个好友100条信息。多路归并的时间复杂度是 O(100NlogN)，这里使用了一个大小为 N 的堆。初始化这个堆需要 O(N) 的时间，归并出 100N 条信息，每一条需要 O(logN) 的时间。值得注意的是，读 DB 的时间是获取了 O(100N) 条数据，这个从时间复杂度上来说要更低，但是因为 DB 的操作事实上是在对文件进行操作，而文件的访问比内存访问慢几百上千倍。</p>
</blockquote>
<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd5f4d7ckaj31ii0pawgp.jpg" alt="image-20200324230746737" style="zoom:67%;" />

<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd6g3t4bkvj30v20c8teh.jpg" alt="image-20200325202727234" style="zoom:50%;" />

<ul>
<li><p>缺點：</p>
<ul>
<li>現算，就是慢，算好才能展示，卡住，用戶可感知的慢</li>
</ul>
</li>
</ul>
<h3 id="Push"><a href="#Push" class="headerlink" title="Push"></a>Push</h3><p>別人在發帖時，就把他的推到了我的News Feed List裡 – <strong><em>Fanout</em></strong></p>
<p>需要一個News Feed Table。</p>
<ul>
<li>用戶需要查看News Feed時，只要從該News Feed Lists中讀取最新的100條就可</li>
</ul>
<table>
<thead>
<tr>
<th>New Feed Table</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>integer</td>
</tr>
<tr>
<td>owner_id</td>
<td>Foreign Key</td>
</tr>
<tr>
<td>tweet_id</td>
<td>Foreign Key</td>
</tr>
<tr>
<td>created_at</td>
<td>timestamp</td>
</tr>
</tbody></table>
<blockquote>
<p>Denormalized 叫去标准化。通俗的解释是，通过在不同的 Table 中存储同一份数据的（也就是说至少一份是冗余数据）的形式，来加速数据的查询。因为当数据只存储在一个固定的 Table A 的时候，其他 Table B访问时如果需要同时取得关联的 Table A 的数据，则需要进行 join 操作之类的，会比较慢。一个例子就是在，统计有多少人点赞了一个帖子，可以通过 <code>select count(*) from like_table where post_id=</code> 的方式来获取，但是也可以在 post table 中新增一个 like_count，每次点赞就 +1。这里 like_count 就是一个 denormalized field，因为是可以通过 <code>select count(*)</code> 在 like table 中获得的。</p>
</blockquote>
<ul>
<li>複雜度分析<ul>
<li>News Feed =&gt; 1次 DB Read</li>
<li>Post a tweet =&gt; N 個粉絲，需要N次的DB Write, <ul>
<li>可以用異步在後台執行，不需要用戶等待</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd6f979oduj30ya0foaos.jpg" alt="image-20200325195759690" style="zoom:50%;" />

<ul>
<li>如果想讓這次的query很快的話，數據庫的index 該怎麼建？</li>
</ul>
<blockquote>
<h5 id="单选题-NewsFeedTable的索引（index）该怎么建？"><a href="#单选题-NewsFeedTable的索引（index）该怎么建？" class="headerlink" title="[单选题]NewsFeedTable的索引（index）该怎么建？"></a>[单选题]NewsFeedTable的索引（index）该怎么建？</h5><p>A.为 owner_id 建索引即可17.32% 选择</p>
<p>B.为 created_at 建倒序索引即可4.96% 选择</p>
<p>C.为 owner_id + created_at 建立联合索引（Composite Index）62.15% 选择</p>
<p>D.为 owner_id 和 created_at 分别建索引15.57% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTQxNzAwNjYyNTQzIiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjEwODgiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iNjQiIGhlaWdodD0iNjQiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxMiAwYTUxMiA1MTIgMCAxIDAgMCAxMDI0QTUxMiA1MTIgMCAwIDAgNTEyIDB6IG0xNjUuOTUyIDYzNy43NmwxNS4wNCAxNC45NzZhMjguNDE2IDI4LjQxNiAwIDEgMS00MC4yNTYgNDAuMjU2bC0xNC45NzYtMTUuMDRMNTA5LjUwNCA1NDkuNzYgMzcxLjIgNjg4YTI4LjQxNiAyOC40MTYgMCAxIDEtNDAuMjU2LTQwLjI1NmwxMzguMzA0LTEzOC4yNC0xMjMuMi0xMjMuMi0xNS4xMDQtMTUuMTA0YTI4LjU0NCAyOC41NDQgMCAwIDEgMC00MC4yNTYgMjguNTQ0IDI4LjU0NCAwIDAgMSA0MC4yNTYgMGwxNS4wNCAxNS4xMDRMNTA5LjQ0IDQ2OS4yNDhsMTQzLjIzMi0xNDMuMjk2YTI4LjQxNiAyOC40MTYgMCAxIDEgNDAuMjU2IDQwLjI1Nkw1NDkuNzYgNTA5LjUwNGwxMjguMTkyIDEyOC4yNTZ6IiBmaWxsPSIjRjY1RTVFIiBwLWlkPSIxMDg5Ij48L3BhdGg+PC9zdmc+" alt="img">答错了，您选择的答案是D</p>
<p><strong>正确答案:</strong>C</p>
<p><strong>相关知识点:</strong>数据库索引 Index</p>
<p><strong>解析:</strong></p>
<p>解析见视频</p>
</blockquote>
<ul>
<li><p>單獨給兩個feature作排序沒用，應該是要建一個複合索引 (composite index)，</p>
</li>
<li><p>新增好友，会创建一个异步任务，去把这个好友发的帖子查询到，然后插入到当前用户的 news feed 里。删除好友的时候也是类似的。看起来似乎很土，但是确实实际工程里就是这么做的。系统设计很多东西都不是大家想象的那种需要什么牛逼的技巧的，只要能用不费力就可以了。这个方法看着土，但是用异步任务可以很好的解决，也不是特别慢。十分行之有效。</p>
</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd6fm9su6zj30xu0fa0ub.jpg" alt="image-20200325201034815" style="zoom:50%;" />

<ul>
<li><p>缺陷</p>
<blockquote>
<h5 id="多选题-Push-模型有什么主要的缺陷？"><a href="#多选题-Push-模型有什么主要的缺陷？" class="headerlink" title="[多选题]Push 模型有什么主要的缺陷？"></a>[多选题]Push 模型有什么主要的缺陷？</h5><p>A.数据库中创建太多记录，浪费磁盘20.49% 选择</p>
<p>B.粉丝数目可能很大，导致 Fanout 过程很长，从而导致用户刷到新鲜事有延迟26.92% 选择</p>
<p>C.浪费系统资源去为很多僵尸粉创建新鲜事记录25.38% 选择</p>
<p>D.明星发帖会在短时间内为系统带来很大的处理压力27.21% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTQxNzAwNjYyNTQzIiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjEwODgiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iNjQiIGhlaWdodD0iNjQiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxMiAwYTUxMiA1MTIgMCAxIDAgMCAxMDI0QTUxMiA1MTIgMCAwIDAgNTEyIDB6IG0xNjUuOTUyIDYzNy43NmwxNS4wNCAxNC45NzZhMjguNDE2IDI4LjQxNiAwIDEgMS00MC4yNTYgNDAuMjU2bC0xNC45NzYtMTUuMDRMNTA5LjUwNCA1NDkuNzYgMzcxLjIgNjg4YTI4LjQxNiAyOC40MTYgMCAxIDEtNDAuMjU2LTQwLjI1NmwxMzguMzA0LTEzOC4yNC0xMjMuMi0xMjMuMi0xNS4xMDQtMTUuMTA0YTI4LjU0NCAyOC41NDQgMCAwIDEgMC00MC4yNTYgMjguNTQ0IDI4LjU0NCAwIDAgMSA0MC4yNTYgMGwxNS4wNCAxNS4xMDRMNTA5LjQ0IDQ2OS4yNDhsMTQzLjIzMi0xNDMuMjk2YTI4LjQxNiAyOC40MTYgMCAxIDEgNDAuMjU2IDQwLjI1Nkw1NDkuNzYgNTA5LjUwNGwxMjguMTkyIDEyOC4yNTZ6IiBmaWxsPSIjRjY1RTVFIiBwLWlkPSIxMDg5Ij48L3BhdGg+PC9zdmc+" alt="img">答错了，您选择的答案是ABCD</p>
<p><strong>正确答案:</strong>BCD</p>
<p><strong>解析:</strong></p>
<p>记住一句话 “Disk is cheap”，不要怕浪费数据库存储，为了加速查询，多存一些东西是没关系的。</p>
</blockquote>
<p>Pull - 自己關注的人不會很多一般來講，但明星的粉絲很多！一億之類，要為所有粉絲都建紀錄，超大。</p>
</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd6fsjx9npj30qw0eogn0.jpg" alt="image-20200325201633121" style="zoom:50%;" />

<ul>
<li><p>FB - Pull; Ins - Push + Pull; Twitter - Pull; Friends Circle - 最多就是有廣告，沒排序或找你沒看過的，Pull</p>
<p>總是要作Tradeoff的。勇擇一個</p>
<blockquote>
<h5 id="单选题-广告的插入是-Push-还是-Pull-模型？"><a href="#单选题-广告的插入是-Push-还是-Pull-模型？" class="headerlink" title="[单选题]广告的插入是 Push 还是 Pull 模型？"></a>[单选题]广告的插入是 Push 还是 Pull 模型？</h5><p>A.Push54.32% 选择</p>
<p>B.Pull43.45% 选择</p>
<p>C.猜不出来2.23% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTM0MTgxMjgxODM5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM3NjIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxOC4xMiA1MTYuMTZtLTQ5MCAwYTQ5MCA0OTAgMCAxIDAgOTgwIDAgNDkwIDQ5MCAwIDEgMC05ODAgMFoiIGZpbGw9IiM1NkI0MzIiIHAtaWQ9IjM3NjMiPjwvcGF0aD48cGF0aCBkPSJNMzkzLjIxMzYxOSA2NjQuMzM1NDk1bTI4LjI4NDI3MS0yOC4yODQyNzFsMjk2Ljk4NDg0OS0yOTYuOTg0ODQ4cTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBsMCAwcTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDJsLTI5Ni45ODQ4NDggMjk2Ljk4NDg0OHEtMjguMjg0MjcxIDI4LjI4NDI3MS01Ni41Njg1NDMgMGwwIDBxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDJaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY0Ij48L3BhdGg+PHBhdGggZD0iTTI4OS40Njk4NCA0NTIuODQ3ODgzbTI4LjI4NDI3MSAyOC4yODQyNzFsMTU1LjU2MzQ5MiAxNTUuNTYzNDkycTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDNsMCAwcS0yOC4yODQyNzEgMjguMjg0MjcxLTU2LjU2ODU0MyAwbC0xNTUuNTYzNDkxLTE1NS41NjM0OTJxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDNsMCAwcTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY1Ij48L3BhdGg+PC9zdmc+" alt="img">答对了，您选择的答案是B</p>
<p><strong>正确答案:</strong>B</p>
<p><strong>解析:</strong></p>
<p>广告的投放人群很多，Push 模式很费时间，无法实时生效。且广告主可以筛选和改变投放人群，因此 Push 模型并不能很好的支持这种动态的改动。</p>
</blockquote>
</li>
</ul>
<ul>
<li>可以在 push 的时候筛选没错，但是消息一旦push 出去以后，你再想要改动就很难了。广告主的需求很可能是 push 出去之后发现钱烧得太快要缩小投放访问，这个时候 push 模式就不太方便了。</li>
</ul>
<h3 id="數據庫的索引"><a href="#數據庫的索引" class="headerlink" title="數據庫的索引"></a>數據庫的索引</h3><p>查字典時，先找頭、找到全身、去翻頁碼，要有序啦</p>
<p>相當於一張專門存index的表</p>
<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd6j1mdm73j30xy0ewgu3.jpg" alt="image-20200325212010964" style="zoom:67%;" />

<ul>
<li>這個暫存表告訴我們直接去原表的4、9 row找</li>
<li>可加速 where時、還有range時的查詢</li>
<li>原理就 B+ Tree, 關聯型主要都是它，通過多分叉減小樹的高度，以減小磁盤 seek 次數<ul>
<li>1000 =&gt;lg1000為10了，還是多會有磁頭移動的物理過程，不像內存裡動很快。所以仍希望二分-&gt;三分-&gt;四分，就是二叉的樹高還是太高，所以才有B+樹叉開</li>
</ul>
</li>
</ul>
<p>怎麼建index. &amp; 常用的幾類 index</p>
<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd6ia4xbojj30sa0c0wfy.jpg" alt="image-20200325214230561" style="zoom:67%;" />

<ul>
<li>唯一索引：如在email, phone_number, user_name</li>
<li>聯合索引：涉及多個col需求，就是建聯合索引</li>
<li><strong><em>條件索引</em></strong>：如要去filter已經付費的用戶中，的聯合索引；我們不去care沒付錢的</li>
</ul>
<h2 id="Scale"><a href="#Scale" class="headerlink" title="Scale"></a>Scale</h2><p>擴展 - 如何優化？</p>
<blockquote>
<ul>
<li>Newsfeed 是朋友圈（你和你朋友发的帖子的汇总），timeline是你发的帖子的汇总。有的网站也把这两个概念反过来。我们课上用的是我刚才说的方式。</li>
<li>那这个cache什么时候更新呢？是在N个用户任意一个发了新推特时候既更新DB又更新cache吗 （异步任务）？<ul>
<li>用户发新的 post 的时候，只更新这个用户发过了哪些帖子的 cache，不会去更新关注他的人的 cache。关注他的人要获得这个新的帖子，需要 pull 一下然后拿到新的 post 然后再更新自己的 news feed cache。</li>
</ul>
</li>
<li>pull优化中每个人的cache如何更新呢？如果每发一个新的tweet都更新一次cache，本质上和push就一样了吧<ul>
<li>pull的时候才更新cache，但是只更新上一次pull之后发的tweet。比如说你一分钟前pull过，pull的结果放在了cache里面，然后你现在再pull，就只会去db或者每个人的timeline cache里面取最近一分钟的tweets，从而优化了pull的速度。</li>
</ul>
</li>
<li>刚才有个人问了这个问题：”请问pull优化中每个人的cache如何更新呢？如果每发一个新的tweet都更新一次cache，本质上和push就一样了吧“。 我想说就算是从某个时间戳之后去DB拉去 Follower的数据，从IO次数上讲没有本质的变化啊。<ul>
<li>是有区别的。如果我需要拿这个人所有的 posts 和我拿这个人最近5分钟的 posts，前者数据多，取出来慢，后者很多时候都是没有数据，速度很快。时间效率不仅仅跟 query 次数有关，跟数据的传输量也有关系。你想一下如果一个 hash map 里，key1 里存了 1个数，key2 里存了 1m 个数，你是取1个数快呢，还是取 1m 个数快呢？找到 1个数和 1m 个数的内存首地址是一样的。但是这里因为是访问 cache，cache和访问者未必在同一台机器，所以虽然 key1和 Key2都很快找到数据了，但是 key2 传输 1m 个数据到 cache 的使用者，这个过程是要比传输1个数据要慢的。</li>
</ul>
</li>
</ul>
</blockquote>
<ol>
<li><p>優化</p>
<ul>
<li><p>解決設計缺陷如 Pull vs Push</p>
<ul>
<li><p>PULL - 登入時才去組織內容，他要是關注了1000個用戶，就要有這麼多次的SQL query，效率就是還低。</p>
<ul>
<li>所以可以在DB訪問前加入 Cache</li>
<li>Cache每個用戶的 Timeline<ul>
<li>N次DB請求 =》 N次Cache請求</li>
<li>Tradeoff: Cache幾條？最近的1000條？其實也就100、200就差不多啦</li>
</ul>
</li>
<li>Cache 每個用戶的 News Feed – 可能30秒我就刷一下，刷跟刷之間我所關注的人沒有更新，每次都做merge太浪費計算時間啦。<ul>
<li>沒有 Cache News Feeds 的用戶: Merge N用戶的最近100條 Tweets，然後取出前100條，除非這個是第一次。</li>
<li>有Cache News Feeds的用戶：Merge N 用戶在某個<strong>時間戳</strong>之後的所有 Tweets</li>
</ul>
</li>
<li>對比 MySQL vs Memcached 的 QPS<ul>
<li>約 1000 ~100</li>
</ul>
</li>
</ul>
</li>
<li><p>PUSH - 浪費了更多的 Disk</p>
<ul>
<li><p>PULL 是存在Mem中</p>
</li>
<li><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd6iuzhttdj30ma0b4t9v.jpg" alt="image-20200325220243909" style="zoom:67%;" />
</li>
<li><p>Fanout的時過程要幾個小時啊！資源該多為大多數人服務</p>
<ul>
<li>嘗試在現有的模型作最小改動優化之，多加幾台用於作Push任務的機器, Problem solved! </li>
<li>對長期的增長進行估計，並評估是否值得轉換整個模型成PULL或混合的，PULL還可以方便插入廣告、內容排序、幹掉zombie粉不給他發帖了</li>
</ul>
</li>
</ul>
</li>
<li><p>PUSH + PULL </p>
<ul>
<li>普通用戶一樣是PUSH</li>
<li>明星就標上去，不PUSH到用戶的News Feed中</li>
<li>當用戶需要的時候，來明星用戶的Timeline拿，然後合併到News Feed裡</li>
</ul>
</li>
<li><p>怎麼定義明星？</p>
<ul>
<li><blockquote>
<h5 id="单选题-直接用粉丝数目判断是否是明星会不会有问题"><a href="#单选题-直接用粉丝数目判断是否是明星会不会有问题" class="headerlink" title="[单选题]直接用粉丝数目判断是否是明星会不会有问题"></a>[单选题]直接用粉丝数目判断是否是明星会不会有问题</h5><p>A.有问题80.95% 选择</p>
<p>B.没有问题12.72% 选择</p>
<p>C.猜不出6.33% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTM0MTgxMjgxODM5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM3NjIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxOC4xMiA1MTYuMTZtLTQ5MCAwYTQ5MCA0OTAgMCAxIDAgOTgwIDAgNDkwIDQ5MCAwIDEgMC05ODAgMFoiIGZpbGw9IiM1NkI0MzIiIHAtaWQ9IjM3NjMiPjwvcGF0aD48cGF0aCBkPSJNMzkzLjIxMzYxOSA2NjQuMzM1NDk1bTI4LjI4NDI3MS0yOC4yODQyNzFsMjk2Ljk4NDg0OS0yOTYuOTg0ODQ4cTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBsMCAwcTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDJsLTI5Ni45ODQ4NDggMjk2Ljk4NDg0OHEtMjguMjg0MjcxIDI4LjI4NDI3MS01Ni41Njg1NDMgMGwwIDBxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDJaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY0Ij48L3BhdGg+PHBhdGggZD0iTTI4OS40Njk4NCA0NTIuODQ3ODgzbTI4LjI4NDI3MSAyOC4yODQyNzFsMTU1LjU2MzQ5MiAxNTUuNTYzNDkycTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDNsMCAwcS0yOC4yODQyNzEgMjguMjg0MjcxLTU2LjU2ODU0MyAwbC0xNTUuNTYzNDkxLTE1NS41NjM0OTJxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDNsMCAwcTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY1Ij48L3BhdGg+PC9zdmc+" alt="img">答对了，您选择的答案是A</p>
<p><strong>正确答案:</strong>A</p>
<p><strong>解析:</strong></p>
<p>明星可能会掉粉，会从 &gt;=1m 掉粉掉到 &lt;1m，导致一些用户丢失掉一些明星发的帖子</p>
</blockquote>
</li>
</ul>
<p>如果大明星掉了粉好幾10萬，</p>
<p>最初因為他是大明星，所以系統不push他的文章，當他掉了一堆粉，我刷新News Feed, 因為這時大明星不是明星了，所以系統就不去Pull他的文章，我就丟失了他的動態啦。。</p>
<ul>
<li>所以不要動態計算他是不是明星，要離線計算，可以在User Table加一個字段 : is_superstar。</li>
</ul>
</li>
<li><p>為什麼大家都用PULL, 幹嘛還要學PUSH?</p>
<ul>
<li><p>設計本就不是找唯一方案，而是最合適</p>
</li>
<li><p>流量小時，Push是最經濟跟省力方式</p>
<table>
<thead>
<tr>
<th>PUSH 使用時機</th>
<th>PULL 使用時機</th>
</tr>
</thead>
<tbody><tr>
<td>資源少</td>
<td>資源多</td>
</tr>
<tr>
<td>想少寫code</td>
<td></td>
</tr>
<tr>
<td><strong>實時性不高</strong></td>
<td>****</td>
</tr>
<tr>
<td>用戶帖少</td>
<td>用戶帖多</td>
</tr>
<tr>
<td>雙向好友關係，沒有明★問題，如朋友圈</td>
<td>單向好友關係，有明★問題</td>
</tr>
</tbody></table>
<p>twitter就發得多，隨便噴；ins就比較慢</p>
<p>FB PULL，又作群組又排序又插廣告就PULL</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>更多功能</p>
<ul>
<li>Like，Follow &amp; Unfollow, Ads</li>
</ul>
</li>
<li><p>特殊情況時，如僵屍粉、大新聞搞掛了服務</p>
<ul>
<li>掛了怎辦？</li>
<li>用戶逐漸</li>
<li>服務器頂不住壓力怎辦？</li>
<li>數據庫頂不住怎辦？</li>
</ul>
</li>
</ul>
</li>
<li><p>Maintenance</p>
<ul>
<li>魯棒性，要是掛了怎辦</li>
<li>擴展性，要是流量暴增怎辦</li>
</ul>
</li>
</ol>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><ul>
<li>Ask before Design – 先問清楚再設計</li>
</ul>
<ul>
<li>no more no less – 要設計剛剛好夠用的就好</li>
</ul>
<ul>
<li>Work solution first – 先設計一個基本能工作的，再逐本優化</li>
<li>Analysis is important than solution – 分析過程展示知識儲備；權衡各種設計方式的利弊</li>
</ul>
<h1 id="Extension"><a href="#Extension" class="headerlink" title="Extension"></a>Extension</h1><h2 id="數據持久化與常見的數據庫"><a href="#數據持久化與常見的數據庫" class="headerlink" title="數據持久化與常見的數據庫"></a>數據持久化與常見的數據庫</h2><ul>
<li>MySQL, PostgreSQL</li>
<li>Memcached<ul>
<li>k-v緩存系統</li>
<li>value 不支持 set / list</li>
<li>無法持久化</li>
</ul>
</li>
<li>Redis<ul>
<li>value 支持 set / list，O(1) add, append，</li>
<li>數據可持久化同步上disk，數據都load進memory，</li>
<li>後來可多台機器的內存</li>
<li>可用作 Cache/ Message Queu/ Database，重開機還在</li>
</ul>
</li>
<li>Cassandra, HBase<ul>
<li>Column Family Base NoSQL 數據庫</li>
<li>key分為 row-key, column-key</li>
<li>適合放查詢請求簡單不複雜的data</li>
</ul>
</li>
<li>MongoDB<ul>
<li>適合寫多讀少的數據，寫快讀慢</li>
</ul>
</li>
<li>Rocksdb<ul>
<li>kv, value 不支持 set / list</li>
<li>用於大公司的kv storage底層, 如FB、抖音</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>选择memcached 和cache 的区别？<ul>
<li>cache单机的，单机的内存有限制，并且只能本机访问，memcache是一个cache db，可以由多台机器组成，并且可以多个server同时访问</li>
</ul>
</li>
</ul>
</blockquote>
<blockquote>
<p>异步任务中适合放那些不着急响应结果给用户或者执行起来比较慢的任务。所以 LintCode 评测和发邮件都适合放在异步任务中执行。C和D中的两个操作只是简单的在数据库中创建一条记录，是很快的，不需要通过异步任务执行，且 D 选项必须马上反馈给用户是否注册成功，更加不能放在异步任务中。</p>
</blockquote>
<h2 id="消息隊列"><a href="#消息隊列" class="headerlink" title="消息隊列"></a>消息隊列</h2><p>IPC</p>
<p>關注一個最主要是把好友關係存下來</p>
<p>RabbitMQ, Redis(Cache比不過Memcached, MQ比不上RabbitMQ, DB比不上SQL…)</p>
<p>Amazon Simple Queue Service</p>
<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd7r1stfcrj30ta0g475i.jpg" alt="image-20200326233130851" style="zoom:67%;" />



<hr>
<h5 id="Tradeoff"><a href="#Tradeoff" class="headerlink" title="Tradeoff"></a>Tradeoff</h5><h5 id="SOA"><a href="#SOA" class="headerlink" title="SOA"></a>SOA</h5><h5 id="Pull-vs-Push-Model"><a href="#Pull-vs-Push-Model" class="headerlink" title="Pull vs Push Model"></a>Pull vs Push Model</h5><h5 id="DB-Systems"><a href="#DB-Systems" class="headerlink" title="DB Systems"></a>DB Systems</h5><h5 id="Async-amp-Message-Queue"><a href="#Async-amp-Message-Queue" class="headerlink" title="Async &amp; Message Queue"></a>Async &amp; Message Queue</h5><h5 id="Persistent"><a href="#Persistent" class="headerlink" title="Persistent"></a>Persistent</h5><h5 id="Denormalize"><a href="#Denormalize" class="headerlink" title="Denormalize"></a>Denormalize</h5><h5 id="Thundering-Herd"><a href="#Thundering-Herd" class="headerlink" title="Thundering Herd"></a>Thundering Herd</h5><h5 id="News-Feed-Design"><a href="#News-Feed-Design" class="headerlink" title="News Feed Design?!"></a>News Feed Design?!</h5></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/03/SQL/T/">SQL/T</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-03</time><div class="content"><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcg1afg4rdj30jg0hkdgt.jpg" alt="image-20200303001005931" style="zoom:50%;" />

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> tmp</span><br><span class="line"><span class="keyword">AS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> *</span><br><span class="line">	<span class="keyword">FROM</span> Campaigns</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> Campaign_id</span><br><span class="line">			,<span class="keyword">min</span>(<span class="built_in">DATE</span>) <span class="keyword">AS</span> earliest_date</span><br><span class="line">			,Spend_amount_USD</span><br><span class="line">		<span class="keyword">FROM</span> Spend</span><br><span class="line">		<span class="keyword">GROUP</span> <span class="keyword">BY</span> Campaign_id</span><br><span class="line">		) ss <span class="keyword">ON</span> Campaigns.Campaign_id = ss.Campaign_id</span><br><span class="line">	)</span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> tmp</span><br></pre></td></tr></table></figure>





<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> Campaigns</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> s1.Campaign_id</span><br><span class="line">		,s1.DATE</span><br><span class="line">		,Spend_amount_USD</span><br><span class="line">	<span class="keyword">FROM</span> Spend <span class="keyword">AS</span> s1</span><br><span class="line">	<span class="keyword">INNER</span> <span class="keyword">JOIN</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> Campaign_id</span><br><span class="line">			,<span class="keyword">min</span>(<span class="built_in">DATE</span>) <span class="keyword">AS</span> earliest_date</span><br><span class="line">		<span class="keyword">FROM</span> Spend</span><br><span class="line">		<span class="keyword">GROUP</span> <span class="keyword">BY</span> Campaign_id</span><br><span class="line">		) tmp <span class="keyword">ON</span> s1.Campaign_id = tmp.Campaign_id</span><br><span class="line">		<span class="keyword">AND</span> s1.DATE = tmp.earliest_date</span><br><span class="line">	) ss <span class="keyword">ON</span> Campaigns.Campaign_id = ss.Campaign_id</span><br></pre></td></tr></table></figure>

<p>left join 因為，可能 Spend裡找不到235這活動，但是他的確是Account_id２辦過的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> cs</span><br><span class="line"><span class="keyword">AS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> *</span><br><span class="line">	<span class="keyword">FROM</span> Campaigns</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> Campaign_id</span><br><span class="line">			,<span class="keyword">min</span>(<span class="built_in">DATE</span>) <span class="keyword">AS</span> earliest_date</span><br><span class="line">			,Spend_amount_USD</span><br><span class="line">		<span class="keyword">FROM</span> Spend</span><br><span class="line">		<span class="keyword">GROUP</span> <span class="keyword">BY</span> Campaign_id</span><br><span class="line">		) ss <span class="keyword">ON</span> Campaigns.Campaign_id = ss.Campaign_id</span><br><span class="line">	)</span><br><span class="line">	</span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> cs <span class="keyword">AS</span> c1</span><br><span class="line"><span class="keyword">WHERE</span> c1.earliest_date = (</span><br><span class="line">		<span class="keyword">SELECT</span> <span class="keyword">min</span>(c2.earliest_date)</span><br><span class="line">		<span class="keyword">FROM</span> cs <span class="keyword">AS</span> c2</span><br><span class="line">		<span class="keyword">WHERE</span> c2.Account_id = c2.Account_id</span><br><span class="line">		)</span><br><span class="line">	<span class="keyword">OR</span> c1.earliest_date <span class="keyword">IS</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> account_id</span><br></pre></td></tr></table></figure>





<table>
<thead>
<tr>
<th>ID</th>
<th>Account_id</th>
<th>Campaign_id</th>
<th>Campaign_type</th>
<th>Campaign_id:1</th>
<th>earliest_date</th>
<th>Spend_amount_USD</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
<td>123</td>
<td>Promoted Trend</td>
<td>123</td>
<td>2017-08-01</td>
<td>200.0</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>234</td>
<td>Promoted Account</td>
<td>234</td>
<td>2017-08-01</td>
<td>500.0</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>235</td>
<td>Promoted Tweet</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>1</td>
<td>456</td>
<td>Promoted Trend</td>
<td>456</td>
<td>2017-08-01</td>
<td>200.0</td>
</tr>
<tr>
<td>5</td>
<td>1</td>
<td>999</td>
<td>NONO</td>
<td>999</td>
<td>2017-08-11</td>
<td>1000.0</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>ID</th>
<th>Account_id</th>
<th>Campaign_id</th>
<th>Campaign_type</th>
<th>Campaign_id:1</th>
<th>earliest_date</th>
<th>Spend_amount_USD</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
<td>123</td>
<td>Promoted Trend</td>
<td>123</td>
<td>2017-08-01</td>
<td>200.0</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>234</td>
<td>Promoted Account</td>
<td>234</td>
<td>2017-08-01</td>
<td>500.0</td>
</tr>
<tr>
<td>4</td>
<td>1</td>
<td>456</td>
<td>Promoted Trend</td>
<td>456</td>
<td>2017-08-01</td>
<td>200.0</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>235</td>
<td>Promoted Tweet</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> cs</span><br><span class="line"><span class="keyword">AS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> *</span><br><span class="line">	<span class="keyword">FROM</span> Campaigns</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> Campaign_id</span><br><span class="line">			,<span class="keyword">min</span>(<span class="built_in">DATE</span>) <span class="keyword">AS</span> earliest_date</span><br><span class="line">			,<span class="keyword">SUM</span>(Spend_amount_USD)</span><br><span class="line">		<span class="keyword">FROM</span> Spend</span><br><span class="line">		<span class="keyword">GROUP</span> <span class="keyword">BY</span> Campaign_id</span><br><span class="line">		) ss <span class="keyword">ON</span> Campaigns.Campaign_id = ss.Campaign_id</span><br><span class="line">	)</span><br><span class="line">	</span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> cs <span class="keyword">AS</span> c1</span><br><span class="line"><span class="keyword">WHERE</span> c1.earliest_date = (</span><br><span class="line">		<span class="keyword">SELECT</span> <span class="keyword">min</span>(c2.earliest_date)</span><br><span class="line">		<span class="keyword">FROM</span> cs <span class="keyword">AS</span> c2</span><br><span class="line">		<span class="keyword">WHERE</span> c1.Account_id = c2.Account_id</span><br><span class="line">		)</span><br><span class="line">	<span class="keyword">OR</span> c1.earliest_date <span class="keyword">IS</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> account_id</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/02/Books/2020-03-02%20%E9%9D%9E%E6%9A%B4%E5%8A%9B%E6%BA%9D%E9%80%9A-NonViolent%20Communication/">Books/2020-03-02 非暴力溝通-NonViolent Communication</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-02</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Books/">Books</a></span><div class="content"><h5 id=""><a href="#" class="headerlink" title=""></a></h5><h2 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h2><h3 id="暴力溝通四種模式："><a href="#暴力溝通四種模式：" class="headerlink" title="暴力溝通四種模式："></a>暴力溝通四種模式：</h3><p>Four modes of violent communication:</p>
<p>道德批判、進行比較、迴避責任、強人所難。</p>
<p>Ethical criticism, comparison, avoidance of responsibility, and tough people.</p>
<h3 id="非暴力溝通模式-–-觀察對方和自己的需要"><a href="#非暴力溝通模式-–-觀察對方和自己的需要" class="headerlink" title="非暴力溝通模式 – 觀察對方和自己的需要"></a>非暴力溝通模式 – 觀察對方和自己的需要</h3><p>Non-violent communication mode – Observe the needs of others and yourself</p>
<h4 id="e-g"><a href="#e-g" class="headerlink" title="e.g."></a>e.g.</h4><p>和幾個同事在一個小組，需要共同完成一項工作。可有一位同事被大家認為沒有團隊精神，喜”單打獨鬥”。如果我們們用非暴力的思維去思考他的行為，就會發現他喜歡單打獨鬥的背後，一定有他的需要，可能他搞長難度更高的工作、可能他特別渴望獲得尊重。這個時候，我們可以平和引導他說出，他喜歡單打獨鬥的原因，然後綜合大家的需求，找到滿足雙方需求的方法，而不是用道德判斷的暴力溝通方式，覺得他價值觀有問題而去疏遠他。</p>
<p>In a small group with several colleagues, you need to complete a job together. However, one colleague was considered to have no team spirit and liked “single fight alone.” If we use non-violent thinking to think about his behavior, we will find that he likes to fight alone and there must be his needs. Maybe he has a more difficult job. Maybe he is particularly eager to get respect. At this time, we can calmly guide him to explain why he likes to fight alone, and then integrate everyone’s needs to find a way to meet the needs of both parties, instead of using violent communication methods based on moral judgment, and feel alienated in his values he.</p>
<h4 id="觀察、感受、需要、請求"><a href="#觀察、感受、需要、請求" class="headerlink" title="觀察、感受、需要、請求,"></a>觀察、感受、需要、請求,</h4><h4 id="Observe-feel-need-request"><a href="#Observe-feel-need-request" class="headerlink" title="Observe, feel, need, request"></a>Observe, feel, need, request</h4><p>比如，一位下屬沒有按時提交報表，如果是非暴力溝通的上級，可能會這樣和他交流：</p>
<p>上次的報表應該上週就完成的，可是你在昨天才給到我，我感到有點擔心，因為整體的工作進度可能會被擔誤，我不確定是不是你手頭上的工作太多，還是說你家裡有事情。我希望能幫助你更有效率地工作，可以告訴我你最近有什麼困難嗎？</p>
<p>For example, a subordinate did not submit a report on time. If he is a superior who communicates nonviolently, he may communicate with him like this:</p>
<p>The last report should have been completed last week, but you only gave it to me yesterday. I am a bit worried because the overall work progress may be burdened. I am not sure if you have too much work on hand, or Say you have something at home. I hope to help you work more efficiently. Can you tell me about any recent difficulties?</p>
<h2 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h2><h3 id="區分觀察-vs-評論-Distinguish-observation-vs-comments"><a href="#區分觀察-vs-評論-Distinguish-observation-vs-comments" class="headerlink" title="區分觀察 vs 評論 Distinguish observation vs comments"></a>區分觀察 vs 評論 Distinguish observation vs comments</h3><p>評論為絕對化的；觀察式的不會有反感，要避免絕對化的評論。</p>
<p>觀察結果的表述 – 加上絕對的時間跟地點</p>
<p>Comments are absolute; observations are not objectionable. Avoid absolute comments. Representation of observations – together w/ absolute time and place</p>
<h3 id="體會表達感受-Express-feelings"><a href="#體會表達感受-Express-feelings" class="headerlink" title="體會表達感受  Express feelings"></a>體會表達感受  Express feelings</h3><p>Thnks about the roots behind feelings</p>
<h3 id="找到並表達需求-Find-and-express-needs"><a href="#找到並表達需求-Find-and-express-needs" class="headerlink" title="找到並表達需求 Find and express needs"></a>找到並表達需求 Find and express needs</h3><h3 id="學會表達請求-Learn-to-express-requests"><a href="#學會表達請求-Learn-to-express-requests" class="headerlink" title="學會表達請求 Learn to express requests"></a>學會表達請求 Learn to express requests</h3><p>Refine goals with requests when expressing</p>
<h5 id="例１-E-g-1"><a href="#例１-E-g-1" class="headerlink" title="例１ E.g.1"></a>例１ E.g.1</h5><p>”我覺得這項工作我做得不是很好” – 僅想法，未表達感受</p>
<p>”這項工作沒做好，我很愧疚” – 表達感受；且適當示弱有助於溝通，是一種有效緩解對立情緒、解決衝突的方法。</p>
<p>“I don’t think I did a good job with this job” – only thoughts, no feelings </p>
<p>“This job is not done well, I feel guilty” – expressing feelings; BTW, showing weakness appropriately helps communication, which is an effective way to alleviate conflicts and resolve conflicts.</p>
<h5 id="例２-E-g-2"><a href="#例２-E-g-2" class="headerlink" title="例２ E.g.2"></a>例２ E.g.2</h5><p>看到下屬將機密文件隨便放到了辦公桌上，於是對他說：「你將機密文件放到辦公桌上，沒有及時鎖起來，這讓我特別緊張。」</p>
<p>接著，要繼續說「因為我不想讓機密文件存在任何洩密隱患」，這句話，挑明了”需求”。</p>
<p>「那麼，請你下次注意將文件第一時間收到保險箱裡，好嗎？」，這句話，則提出了我們的”請求”。</p>
<p>When seeing my subordinates placing confidential documents on the desk, and said to him, “You placed the confidential documents on the desk and did not lock them in time, which made me particularly nervous.</p>
<p>Then, to continue to say “because I don’t want any hidden dangers of confidential documents”, this sentence clarifies the “need”.</p>
<p>“Then, please pay attention to the documents once after being received and put in the safe as soon as possible, okay?” In this sentence, we made our “request”.</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/02/28/ML/2019-03-27-Time%20Series%20Analysis/">ML/2019-03-27-Time Series Analysis</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-28</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/M/">M</a></span><div class="content"><h2 id="時間數據的特徵工程"><a href="#時間數據的特徵工程" class="headerlink" title="時間數據的特徵工程"></a>時間數據的特徵工程</h2><p>可展開成年、月、日、星期幾、週末、月的哪部分，一年當中第幾天、第幾個月、月初還是月末、節日</p>
<p>上中下旬用數字不OK, 所以可用one-hot encoding，用很多個bool表示其中那個用1, 2, 3表示的上中下旬。</p>
<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd8c7zt08dj30w20bg75q.jpg" alt="image-20200327114411681" style="zoom:67%;" />



<p>pd.get_dummies 做 one-hot- encoding</p>
<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd8cgz308wj314g0iq411.jpg" alt="image-20200327115247759" style="zoom:80%;" />

<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd8ccnwq2gj310409k757.jpg" alt="image-20200327114837591" style="zoom:67%;" />

<p>用10個維度表示其中的10年</p>
<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd8cbtiq38j310o096aam.jpg" alt="image-20200327114753055" style="zoom:67%;" />





<p>然後整理數據集</p>
<p>Linear regression, 多項式迴歸、嶺迴歸、Lasso regression 需要　X_dummy , with one-hot-encoding, 成72維度</p>
<p>DT、RF不需要 one-hot-encoding，用 X_before_dummy</p>
<h2 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h2><p>MSE, RMSE, MAbsoluteE, R Square</p>
<h4 id="線性迴歸"><a href="#線性迴歸" class="headerlink" title="線性迴歸"></a>線性迴歸</h4><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd8cqzb6j7j312u0huh1c.jpg" alt="image-20200327120233707"></p>
<p>我們看到的是72維在2D平面的投影</p>
<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd8ct2bdltj313m02mdgg.jpg" alt="image-20200327120425110" style="zoom:80%;" />



<h4 id="多項式迴歸"><a href="#多項式迴歸" class="headerlink" title="多項式迴歸"></a>多項式迴歸</h4><p>二次、三次</p>
<h4 id="嶺迴歸"><a href="#嶺迴歸" class="headerlink" title="嶺迴歸"></a>嶺迴歸</h4><ul>
<li>線性加了L1正則</li>
</ul>
<h4 id="Lasso迴歸"><a href="#Lasso迴歸" class="headerlink" title="Lasso迴歸"></a>Lasso迴歸</h4><ul>
<li>線性加了L2正則</li>
</ul>
<h4 id="RF"><a href="#RF" class="headerlink" title="RF"></a>RF</h4><ul>
<li>bagging 子集建各樹、考慮最大的特徵數，作Cross Validation</li>
</ul>
<h2 id="模型比較"><a href="#模型比較" class="headerlink" title="模型比較"></a>模型比較</h2><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd8df910hwj31eu0m8n1b.jpg" alt="image-20200327122545346" style="zoom:67%;" />

<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd8dfjtqpej315o0gk4cq.jpg" alt="image-20200327122605413" style="zoom:67%;" /></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/02/28/Old_Records_for_Daily_Practice/2020-02-28-Daily%20Problem/">Old_Records_for_Daily_Practice/2020-02-28-Daily Problem</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-28</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Daily/">Daily</a></span><div class="content"><h3 id="Anagram-in-a-string"><a href="#Anagram-in-a-string" class="headerlink" title="Anagram in a string"></a>Anagram in a string</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_anagrams</span><span class="params">(s, t)</span>:</span></span><br><span class="line">  <span class="comment"># Fill this in.</span></span><br><span class="line"></span><br><span class="line">print(find_anagrams(<span class="string">'acdbacdacb'</span>, <span class="string">'abc'</span>))</span><br><span class="line"><span class="comment"># [3, 7]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findAnagrams_Counter</span><span class="params">(self, s: str, p: str)</span> -&gt; List[int]:</span>    <span class="comment"># Took 7300 ms</span></span><br><span class="line">        window = len(p)</span><br><span class="line">        c_p = Counter(p)</span><br><span class="line">        </span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(window<span class="number">-1</span>, len(s)):   <span class="comment"># 2</span></span><br><span class="line">            pat = s[i-window+<span class="number">1</span>:i+<span class="number">1</span>]</span><br><span class="line">            <span class="comment"># print(pat)</span></span><br><span class="line">            c_pat = Counter(pat)  </span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> c_p == c_pat:</span><br><span class="line">                res.append(i-window+<span class="number">1</span>) </span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findAnagrams</span><span class="params">(self, s: str, p: str)</span> -&gt; List[int]:</span>    <span class="comment"># 100 ms</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> s <span class="keyword">or</span> <span class="keyword">not</span> p:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        </span><br><span class="line">        enc_p = self.encoder(p)</span><br><span class="line">        win = len(p)</span><br><span class="line">        <span class="comment"># enc_s = self.encoder(s[:win])</span></span><br><span class="line">        </span><br><span class="line">        offset = win<span class="number">-1</span></span><br><span class="line">        res = []</span><br><span class="line">        <span class="string">'''Dynamically update pattern in s'''</span></span><br><span class="line">        <span class="comment"># for i in range(offset, len(s)):</span></span><br><span class="line">        enc_c = [<span class="number">0</span>] * <span class="number">26</span></span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(s)):</span><br><span class="line">            enc_c[ord(s[i]) - ord(<span class="string">'a'</span>)] += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> i - j &gt;= win:</span><br><span class="line">                enc_c[ord(s[j]) - ord(<span class="string">'a'</span>)] -= <span class="number">1</span></span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> enc_c == enc_p:</span><br><span class="line">                res.append(j)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findAnagrams_TLE</span><span class="params">(self, s: str, p: str)</span> -&gt; List[int]:</span>    <span class="comment"># TLE</span></span><br><span class="line">        <span class="string">''' TLE, SHOULD Dynamically  Update enc_tmp'''</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> s <span class="keyword">or</span> <span class="keyword">not</span> p:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        </span><br><span class="line">        enc_p = self.encoder(p)</span><br><span class="line">        win = len(p)</span><br><span class="line">        </span><br><span class="line">        offset = win<span class="number">-1</span></span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(offset, len(s)):</span><br><span class="line">            start = i - win + <span class="number">1</span></span><br><span class="line">            sub_s = s[start:i+<span class="number">1</span>]</span><br><span class="line">            <span class="comment"># print(sub_s)</span></span><br><span class="line">            enc_tmp = self.encoder(sub_s)  <span class="comment"># 2 - (3-1) : 3  # No OOR</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> enc_tmp == enc_p:</span><br><span class="line">                res.append(start)</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>



<h3 id="Reverse-Words"><a href="#Reverse-Words" class="headerlink" title="Reverse Words"></a><del>Reverse Words</del></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reverse_words</span><span class="params">(words)</span>:</span></span><br><span class="line">  <span class="comment"># Fill this in.</span></span><br><span class="line"></span><br><span class="line">s = list(<span class="string">"can you read this"</span>)</span><br><span class="line">reverse_words(s)</span><br><span class="line">print(<span class="string">''</span>.join(s))</span><br><span class="line"><span class="comment"># this read you can</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverseWords</span><span class="params">(self, s: str)</span> -&gt; str:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> s:</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">        l = s.split()[::<span class="number">-1</span>]</span><br><span class="line">        res = <span class="string">' '</span>.join(l)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>

<h3 id="Reverse-Words-Ⅱ"><a href="#Reverse-Words-Ⅱ" class="headerlink" title="Reverse Words Ⅱ"></a><del>Reverse Words Ⅱ</del></h3><p>Given an input string , reverse the string word by word. </p>
<p><strong>Example:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input:  [&quot;t&quot;,&quot;h&quot;,&quot;e&quot;,&quot; &quot;,&quot;s&quot;,&quot;k&quot;,&quot;y&quot;,&quot; &quot;,&quot;i&quot;,&quot;s&quot;,&quot; &quot;,&quot;b&quot;,&quot;l&quot;,&quot;u&quot;,&quot;e&quot;]</span><br><span class="line">Output: [&quot;b&quot;,&quot;l&quot;,&quot;u&quot;,&quot;e&quot;,&quot; &quot;,&quot;i&quot;,&quot;s&quot;,&quot; &quot;,&quot;s&quot;,&quot;k&quot;,&quot;y&quot;,&quot; &quot;,&quot;t&quot;,&quot;h&quot;,&quot;e&quot;]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverseWords</span><span class="params">(self, s: List[str])</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Do not return anything, modify s in-place instead.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        t = <span class="string">' '</span>.join(<span class="string">''</span>.join(s).split()[::<span class="number">-1</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(s)):</span><br><span class="line">            s[i] = t[i]</span><br></pre></td></tr></table></figure>

<h3 id="Reverse-Words-Ⅲ"><a href="#Reverse-Words-Ⅲ" class="headerlink" title="Reverse Words Ⅲ"></a><del>Reverse Words Ⅲ</del></h3><p><strong>Example 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;Let&#39;s take LeetCode contest&quot;</span><br><span class="line">Output: &quot;s&#39;teL ekat edoCteeL tsetnoc&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverseWords</span><span class="params">(self, s: str)</span> -&gt; str:</span></span><br><span class="line">        t  = s.split()</span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> t:</span><br><span class="line">            w = w[::<span class="number">-1</span>]</span><br><span class="line">            res.append(w)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">' '</span>.join(res)</span><br></pre></td></tr></table></figure>



<h3 id="Find-Subtree"><a href="#Find-Subtree" class="headerlink" title="Find Subtree"></a><del>Find Subtree</del></h3><p>Given 2 binary trees t and s, find if s has an equal subtree in t, where the structure and the values are the same. Return True if it exists, otherwise return False.</p>
<p>Here’s some starter code and an example:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, value, left=None, right=None)</span>:</span></span><br><span class="line">    self.value = value</span><br><span class="line">    self.left = left</span><br><span class="line">    self.right = right</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f"(Value: <span class="subst">&#123;self.value&#125;</span> Left: <span class="subst">&#123;self.left&#125;</span> Right: <span class="subst">&#123;self.right&#125;</span>)"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_subtree</span><span class="params">(s, t)</span>:</span></span><br><span class="line">  <span class="comment"># Fill this in.</span></span><br><span class="line"></span><br><span class="line">t3 = Node(<span class="number">4</span>, Node(<span class="number">3</span>), Node(<span class="number">2</span>))</span><br><span class="line">t2 = Node(<span class="number">5</span>, Node(<span class="number">4</span>), Node(<span class="number">-1</span>))</span><br><span class="line">t = Node(<span class="number">1</span>, t2, t3)</span><br><span class="line"></span><br><span class="line">s = Node(<span class="number">4</span>, Node(<span class="number">3</span>), Node(<span class="number">2</span>))</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Tree t:</span></span><br><span class="line"><span class="string">    1</span></span><br><span class="line"><span class="string">   / \</span></span><br><span class="line"><span class="string">  4   5 </span></span><br><span class="line"><span class="string"> / \ / \</span></span><br><span class="line"><span class="string">3  2 4 -1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Tree s:</span></span><br><span class="line"><span class="string">  4 </span></span><br><span class="line"><span class="string"> / \</span></span><br><span class="line"><span class="string">3  2 </span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">print(find_subtree(s, t))</span><br><span class="line"><span class="comment"># True</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isSubtree</span><span class="params">(self, s: TreeNode, t: TreeNode)</span> -&gt; bool:</span></span><br><span class="line">        </span><br><span class="line">            <span class="comment"># self.isSubtree()</span></span><br><span class="line">        <span class="comment"># self.t = t</span></span><br><span class="line">        <span class="keyword">return</span> self.preorder(s, t) <span class="keyword">or</span> self.preorder(t, s)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">preorder</span><span class="params">(self, root, ref)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        ans =  self.is_sametree(root, ref)</span><br><span class="line">        </span><br><span class="line">        L_has_same = self.preorder(root.left, ref)</span><br><span class="line">        R_has_same = self.preorder(root.right, ref)</span><br><span class="line">        <span class="keyword">return</span> ans <span class="keyword">or</span> L_has_same <span class="keyword">or</span> R_has_same</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_sametree</span><span class="params">(self, s, t)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> s <span class="keyword">and</span> <span class="keyword">not</span> t:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> s <span class="keyword">or</span> <span class="keyword">not</span> t:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> s.val == t.val <span class="keyword">and</span> self.is_sametree(s.left, t.left) <span class="keyword">and</span> self.is_sametree(s.right, t.right)</span><br></pre></td></tr></table></figure>



<h3 id="Sorted-Square-Numbers"><a href="#Sorted-Square-Numbers" class="headerlink" title="Sorted Square Numbers"></a><del>Sorted Square Numbers</del></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def square_numbers(nums):</span><br><span class="line"> # Fill this in.</span><br><span class="line"></span><br><span class="line">print(square_numbers([-5, -3, -1, 0, 1, 4, 5]))</span><br><span class="line"># [0, 1, 1, 9, 16, 25, 25]Solve this problem in O(n) time.</span><br></pre></td></tr></table></figure>



<h3 id="Picking-up-Change"><a href="#Picking-up-Change" class="headerlink" title="Picking up Change?!"></a><del>Picking up Change?!</del></h3><h3 id="Determine-if-numbe-–-Hard-if-not-able-to-use-built-in…"><a href="#Determine-if-numbe-–-Hard-if-not-able-to-use-built-in…" class="headerlink" title="Determine if numbe – Hard if not able to use built-in…"></a>Determine if numbe – Hard if not able to use built-in…</h3><p>Given a string that may represent a number, determine if it is a number. Here’s some of examples of how the number may be presented:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;123&quot; # Integer</span><br><span class="line">&quot;12.3&quot; # Floating point</span><br><span class="line">&quot;-123&quot; # Negative numbers</span><br><span class="line">&quot;-.3&quot; # Negative floating point</span><br><span class="line">&quot;1.5e5&quot; # Scientific notation</span><br></pre></td></tr></table></figure>

<p>Here’s some examples of what isn’t a proper number:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;12a&quot; # No letters</span><br><span class="line">&quot;1 2&quot; # No space between numbers</span><br><span class="line">&quot;1e1.2&quot; # Exponent can only be an integer (positive or negative or 0)</span><br></pre></td></tr></table></figure>

<p>Scientific notation requires the first number to be less than 10, however to simplify the solution assume the first number can be greater than 10. Do not parse the string with int() or any other python functions.</p>
<h2 id="Swap-bits-–-A-Neat-Bitwise-Trick-For-Swapping-Even-and-Odd-Bits"><a href="#Swap-bits-–-A-Neat-Bitwise-Trick-For-Swapping-Even-and-Odd-Bits" class="headerlink" title="Swap bits – A Neat Bitwise Trick For Swapping Even and Odd Bits"></a>Swap bits – A Neat Bitwise Trick For Swapping Even and Odd Bits</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def swap_bits(x):</span><br><span class="line">    EVEN &#x3D; 0b10101010</span><br><span class="line">    ODD &#x3D; 0b01010101</span><br><span class="line">    return (x &amp; EVEN) &gt;&gt; 1 | (x &amp; ODD) &lt;&lt; 1</span><br></pre></td></tr></table></figure>



<h3 id="String-to-Integer-atoi"><a href="#String-to-Integer-atoi" class="headerlink" title="String to Integer(atoi)"></a>String to Integer(atoi)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">myAtoi</span><span class="params">(self, str: str)</span> -&gt; int:</span></span><br><span class="line">        t = str.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> t:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span> t[<span class="number">0</span>] <span class="keyword">not</span> <span class="keyword">in</span> <span class="string">'+-1234567890'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        flag = <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> t[<span class="number">0</span>] == <span class="string">'-'</span>:</span><br><span class="line">            <span class="keyword">if</span> len(t) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">            flag = <span class="number">-1</span></span><br><span class="line">            t = t[<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">'+'</span>:</span><br><span class="line">            <span class="keyword">if</span> len(t) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">            t = t[<span class="number">1</span>:]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> t[<span class="number">0</span>] <span class="keyword">not</span> <span class="keyword">in</span> <span class="string">"1234567890"</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># chech 0s and " "</span></span><br><span class="line">        q = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> q &lt; len(t):</span><br><span class="line">            <span class="keyword">if</span> t[q] <span class="keyword">in</span> <span class="string">"1234567890"</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            q += <span class="number">1</span></span><br><span class="line">                </span><br><span class="line">        <span class="keyword">if</span> q == len(t):<span class="comment"># or q == 0:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">            </span><br><span class="line">        t = t[q:]</span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        tmp = <span class="number">10</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> idx <span class="keyword">in</span> range(len(t)):</span><br><span class="line">            <span class="keyword">if</span> t[idx] <span class="keyword">not</span> <span class="keyword">in</span> <span class="string">"1234567890"</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            digit = (ord(t[idx]) - ord(<span class="string">'0'</span>))</span><br><span class="line">            <span class="comment"># print(digit)</span></span><br><span class="line">            <span class="comment"># res *= tmp</span></span><br><span class="line">            res = tmp*res + digit</span><br><span class="line">            <span class="comment"># tmp *= 10</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">        ans = res*flag</span><br><span class="line">        <span class="keyword">if</span> flag == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> min(ans, <span class="number">2</span>**<span class="number">31</span> - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> max(ans, <span class="number">-2</span>**<span class="number">31</span>)</span><br></pre></td></tr></table></figure>



<h3 id="Rotate-Matrix"><a href="#Rotate-Matrix" class="headerlink" title="Rotate Matrix"></a><del>Rotate Matrix</del></h3><h3 id="Pow"><a href="#Pow" class="headerlink" title="Pow"></a>Pow</h3><h5 id="Wrong-This-doesn’t-solve-overflow-issue-for-2-31-2-31-1"><a href="#Wrong-This-doesn’t-solve-overflow-issue-for-2-31-2-31-1" class="headerlink" title="Wrong, This doesn’t solve overflow issue for [-2^(31), 2^31-1]"></a>Wrong, This doesn’t solve overflow issue for [-2^(31), 2^31-1]</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import math</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">myPow</span><span class="params">(self, x: float, n: int)</span> -&gt; float:</span></span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span> <span class="keyword">or</span> x  == <span class="number">1</span>: </span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> x</span><br><span class="line">        <span class="keyword">if</span> n &lt; <span class="number">0</span>:       <span class="comment">#2**(-3) ==  1/2**3 == 2* 2**(-4)</span></span><br><span class="line">            <span class="comment"># n = -(n+1)</span></span><br><span class="line">            n = abs(n) + <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> x * (<span class="number">1</span>/self.pos_pow(x, n))</span><br><span class="line">        <span class="keyword">return</span> self.pos_pow(x, n)</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pos_pow</span><span class="params">(self, x, n)</span>:</span></span><br><span class="line">        <span class="comment"># print(x, n)</span></span><br><span class="line">        res = <span class="number">1</span>    </span><br><span class="line">        <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> n % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">                res *= x</span><br><span class="line">            <span class="comment"># x = x ** 2      # <span class="doctag">TODO:</span> CAUTIOUS, Numerical result out of range for (2, -2**31)</span></span><br><span class="line">            x = x * x         <span class="comment"># SHOULD USE THIS!</span></span><br><span class="line">            n = n//<span class="number">2</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    for neg number: </span></span><br><span class="line"><span class="string">    [-2**31, 2**31 -1]</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">res   base index</span></span><br><span class="line"><span class="string">1     2    9      ** --&gt; ans!</span></span><br><span class="line"><span class="string">2     4    4</span></span><br><span class="line"><span class="string">2     16   2</span></span><br><span class="line"><span class="string">2     256  1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1     2    10</span></span><br><span class="line"><span class="string">1     4    5</span></span><br><span class="line"><span class="string">4     16   2</span></span><br><span class="line"><span class="string">4     256  1</span></span><br><span class="line"><span class="string">    '''</span></span><br></pre></td></tr></table></figure>



<h5 id="Correct"><a href="#Correct" class="headerlink" title="Correct"></a>Correct</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">myPow</span><span class="params">(self, x: float, n: int)</span> -&gt; float:</span></span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span> <span class="keyword">or</span> x == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> x</span><br><span class="line">        <span class="keyword">if</span> n &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># return XXXX # TODO</span></span><br><span class="line">            n1 = abs(n) - <span class="number">1</span>                         <span class="comment"># n == -2**31</span></span><br><span class="line">            <span class="keyword">return</span> (<span class="number">1</span>/x) * (<span class="number">1</span>/self.pos_pow(x, n1))  <span class="comment"># 2^(-4) == 1/2^4 ==  1/2 * 1/2^3</span></span><br><span class="line">        <span class="keyword">return</span> self.pos_pow(x, n)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pos_pow</span><span class="params">(self, base, idx)</span>:</span></span><br><span class="line">        res = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> idx &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># print(base, idx)</span></span><br><span class="line">            <span class="keyword">if</span> idx % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">                res *= base</span><br><span class="line">            base *= base</span><br><span class="line">            idx //= <span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">        </span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    res base    idx</span></span><br><span class="line"><span class="string">    1   2       10</span></span><br><span class="line"><span class="string">    1   4       5</span></span><br><span class="line"><span class="string">    4   16      2    </span></span><br><span class="line"><span class="string">    4   256     1</span></span><br><span class="line"><span class="string">    ans </span></span><br><span class="line"><span class="string">    '''</span></span><br></pre></td></tr></table></figure>



<h3 id="Sqrt"><a href="#Sqrt" class="headerlink" title="Sqrt"></a><del>Sqrt</del></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mySqrt</span><span class="params">(self, x: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="comment"># if x &lt;= 1:</span></span><br><span class="line">        <span class="comment">#     return x</span></span><br><span class="line">        l, r = <span class="number">0</span>, x</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> l &lt;= r:</span><br><span class="line">            mid = l + (r-l)//<span class="number">2</span></span><br><span class="line">            print(l, r, mid)</span><br><span class="line">            <span class="keyword">if</span>  mid*mid &lt;= x &lt; (mid+<span class="number">1</span>)*(mid+<span class="number">1</span>):</span><br><span class="line">                <span class="keyword">return</span> mid</span><br><span class="line">            <span class="keyword">elif</span> mid*mid &gt; x:</span><br><span class="line">                r = mid - <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                l = mid + <span class="number">1</span></span><br></pre></td></tr></table></figure>



<h3 id="Missing-Ranges"><a href="#Missing-Ranges" class="headerlink" title="Missing Ranges"></a>Missing Ranges</h3><p>Given a sorted integer array <strong><em>nums\</em></strong>, where the range of elements are in the <strong>inclusive range</strong> <strong>[*lower*, *upper*]</strong>, return its missing ranges.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">0 1 3         50</span></span><br><span class="line"><span class="string">start       1+1 = 2   4</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findMissingRanges</span><span class="params">(self, nums: List[int], lower: int, upper: int)</span> -&gt; List[str]:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> nums:</span><br><span class="line">            <span class="keyword">return</span> [str(lower) + <span class="string">"-&gt;"</span> + str(upper)] <span class="keyword">if</span> lower != upper <span class="keyword">else</span> [str(lower)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        res = []</span><br><span class="line">        <span class="comment"># item = ""</span></span><br><span class="line">        <span class="keyword">if</span> nums[<span class="number">0</span>] != lower:</span><br><span class="line">            <span class="comment"># print('aaaaaaa')</span></span><br><span class="line">            item = <span class="string">"&#123;&#125;-&gt;&#123;&#125;"</span>.format(lower, nums[<span class="number">0</span>]<span class="number">-1</span>) <span class="keyword">if</span> lower != nums[<span class="number">0</span>] - <span class="number">1</span> <span class="keyword">else</span> <span class="string">"&#123;&#125;"</span>.format(str(lower))</span><br><span class="line">            res.append(item)</span><br><span class="line">            </span><br><span class="line">        start, end = float(<span class="string">'-inf'</span>), float(<span class="string">'inf'</span>)</span><br><span class="line">        prev = nums[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(nums)):</span><br><span class="line">            <span class="keyword">if</span> nums[i] - prev &gt; <span class="number">1</span>:</span><br><span class="line">                start, end = prev + <span class="number">1</span>, nums[i] - <span class="number">1</span></span><br><span class="line">                item = <span class="string">"&#123;&#125;-&gt;&#123;&#125;"</span>.format(start, end) <span class="keyword">if</span> start != end <span class="keyword">else</span> str(end)</span><br><span class="line">                res.append(item)</span><br><span class="line">            prev = nums[i]</span><br><span class="line">        <span class="keyword">if</span> nums[<span class="number">-1</span>] != upper:</span><br><span class="line">            item = <span class="string">"&#123;&#125;-&gt;&#123;&#125;"</span>.format(nums[<span class="number">-1</span>]+<span class="number">1</span>, upper) <span class="keyword">if</span> nums[<span class="number">-1</span>] + <span class="number">1</span> != upper <span class="keyword">else</span> <span class="string">"&#123;&#125;"</span>.format(str(upper))</span><br><span class="line">            res.append(item)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>



<h3 id="Sudoku-Check"><a href="#Sudoku-Check" class="headerlink" title="Sudoku Check"></a>Sudoku Check</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isValidSudoku</span><span class="params">(self, board: List[List[str]])</span> -&gt; bool:</span></span><br><span class="line">        </span><br><span class="line">        dict_cols = defaultdict(defaultdict)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(board)):</span><br><span class="line">            dict_row = defaultdict(str)</span><br><span class="line">            <span class="keyword">if</span> i % <span class="number">3</span> == <span class="number">0</span>:</span><br><span class="line">                dict_boxes = defaultdict(defaultdict)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(len(board[<span class="number">0</span>])):</span><br><span class="line">                <span class="keyword">if</span> board[i][j] != <span class="string">'.'</span>:</span><br><span class="line">                    <span class="keyword">if</span> board[i][j] <span class="keyword">in</span> dict_row:</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        dict_row[board[i][j]] = <span class="literal">True</span></span><br><span class="line">                        </span><br><span class="line">                    <span class="keyword">if</span> board[i][j] <span class="keyword">in</span> dict_cols[j]:</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        dict_cols[j][board[i][j]] = <span class="literal">True</span></span><br><span class="line">                        </span><br><span class="line">                    <span class="comment"># if board[i][j] in dict_boxes</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="number">0</span> &lt;= j % <span class="number">9</span> &lt;= <span class="number">2</span>:</span><br><span class="line">                        <span class="keyword">if</span> board[i][j] <span class="keyword">in</span> dict_boxes[<span class="number">0</span>]:</span><br><span class="line">                            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">                        dict_boxes[<span class="number">0</span>][board[i][j]] = <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">elif</span> <span class="number">3</span> &lt;= j % <span class="number">9</span> &lt;= <span class="number">5</span>:</span><br><span class="line">                        <span class="keyword">if</span> board[i][j] <span class="keyword">in</span> dict_boxes[<span class="number">1</span>]:</span><br><span class="line">                            <span class="keyword">return</span> <span class="literal">False</span>                        </span><br><span class="line">                        dict_boxes[<span class="number">1</span>][board[i][j]] = <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">elif</span> <span class="number">6</span> &lt;= j % <span class="number">9</span> &lt;= <span class="number">8</span>:</span><br><span class="line">                        <span class="keyword">if</span> board[i][j] <span class="keyword">in</span> dict_boxes[<span class="number">2</span>]:</span><br><span class="line">                            <span class="keyword">return</span> <span class="literal">False</span>                        </span><br><span class="line">                        dict_boxes[<span class="number">2</span>][board[i][j]] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>



<h3 id="Sum-of-Squares"><a href="#Sum-of-Squares" class="headerlink" title="Sum of Squares"></a><del>Sum of Squares</del></h3><h3 id="RM-Duplicate-from-Sorted-Linked-List"><a href="#RM-Duplicate-from-Sorted-Linked-List" class="headerlink" title="RM Duplicate from Sorted Linked List"></a>RM Duplicate from Sorted Linked List</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">deleteDuplicates</span><span class="params">(self, head: ListNode)</span> -&gt; ListNode:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> head :</span><br><span class="line">            <span class="keyword">return</span> head</span><br><span class="line"></span><br><span class="line">        cur = head</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> cur.next:</span><br><span class="line">            <span class="keyword">if</span> cur.next.val == cur.val: <span class="comment"># TODO check cur.next</span></span><br><span class="line">                cur.next = cur.next.next</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                cur = cur.next</span><br><span class="line">        <span class="keyword">return</span> head</span><br></pre></td></tr></table></figure>



<h3 id="N-Queens"><a href="#N-Queens" class="headerlink" title="N-Queens"></a><del>N-Queens</del></h3><h3 id="Remove-One-Layer-of-Parentheses"><a href="#Remove-One-Layer-of-Parentheses" class="headerlink" title="Remove One Layer of Parentheses"></a><del>Remove One Layer of Parentheses</del></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">algo.</span></span><br><span class="line"><span class="string">( score+1</span></span><br><span class="line"><span class="string">) -1</span></span><br><span class="line"><span class="string">res = []</span></span><br><span class="line"><span class="string">if score == 0:</span></span><br><span class="line"><span class="string">    item.pop()</span></span><br><span class="line"><span class="string">    res.append(item[1:-1])</span></span><br><span class="line"><span class="string">return ''.join(res)</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">removeOuterParentheses</span><span class="params">(self, S: str)</span> -&gt; str:</span></span><br><span class="line">        score = <span class="number">0</span></span><br><span class="line">        item = <span class="string">''</span></span><br><span class="line">        res = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(S)):</span><br><span class="line">            <span class="comment"># if S[j] == 0:</span></span><br><span class="line">            <span class="keyword">if</span> S[i] == <span class="string">'('</span>:</span><br><span class="line">                score += <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> S[i] == <span class="string">')'</span>:</span><br><span class="line">                score -= <span class="number">1</span></span><br><span class="line">            item += S[i]    <span class="comment"># '(() ...'</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> score == <span class="number">0</span>:</span><br><span class="line">                res.append(item[<span class="number">1</span>:<span class="number">-1</span>])  <span class="comment"># NO OOR since slicing helps handle it</span></span><br><span class="line">                item = <span class="string">''</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(res)</span><br></pre></td></tr></table></figure>



<h3 id="Count-Primes"><a href="#Count-Primes" class="headerlink" title="Count Primes"></a>Count Primes</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">0 1 2 3 4 5 6 7 8 9 10 11 </span></span><br><span class="line"><span class="string">x x v v   v   v         v</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">countPrimes</span><span class="params">(self, m: int)</span> -&gt; int:</span></span><br><span class="line">        n = m - <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> n &lt;= <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">            </span><br><span class="line">        isPrime = [<span class="literal">None</span>] + [<span class="literal">None</span>] * n</span><br><span class="line">        isPrime[<span class="number">0</span>] = isPrime[<span class="number">1</span>] = <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, n+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> isPrime[i] == <span class="literal">None</span>:</span><br><span class="line">                isPrime[i] = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(i*<span class="number">2</span>, n+<span class="number">1</span>, i):</span><br><span class="line">                    isPrime[j] = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> sum(isPrime)</span><br></pre></td></tr></table></figure>



<h3 id="Inorder-Successor"><a href="#Inorder-Successor" class="headerlink" title="Inorder Successor"></a>Inorder Successor</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"># class TreeNode:</span></span><br><span class="line"><span class="comment">#     def __init__(self, x):</span></span><br><span class="line"><span class="comment">#         self.val = x</span></span><br><span class="line"><span class="comment">#         self.left = None</span></span><br><span class="line"><span class="comment">#         self.right = None</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">      5</span></span><br><span class="line"><span class="string">    3     6</span></span><br><span class="line"><span class="string">   2  4 </span></span><br><span class="line"><span class="string">'''</span>    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="comment"># def __init__(self):</span></span><br><span class="line">        <span class="comment"># self.flag = False</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inorderSuccessor</span><span class="params">(self, root: <span class="string">'TreeNode'</span>, p: <span class="string">'TreeNode'</span>)</span> -&gt; 'TreeNode':</span> </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="comment"># self.result = []</span></span><br><span class="line"><span class="comment">#         self.helper(root, p, [])</span></span><br><span class="line">        <span class="keyword">return</span> self.helper(root, p.val)</span><br><span class="line"><span class="comment">#         if not self.result:</span></span><br><span class="line"><span class="comment">#             return None</span></span><br><span class="line"><span class="comment">#         else:</span></span><br><span class="line"><span class="comment">#             return self.result[0].val</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">          5</span></span><br><span class="line"><span class="string">        3     33</span></span><br><span class="line"><span class="string">       2  4     40</span></span><br><span class="line"><span class="string">               34</span></span><br><span class="line"><span class="string">                 36 v</span></span><br><span class="line"><span class="string">    '''</span>  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(self, root, target)</span>:</span></span><br><span class="line">        cur = root</span><br><span class="line">        suc = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> cur:</span><br><span class="line">            <span class="comment"># suc = cur</span></span><br><span class="line">            <span class="keyword">if</span> target &gt; cur.val:</span><br><span class="line">                cur = cur.right</span><br><span class="line">            <span class="keyword">elif</span> target == cur.val:</span><br><span class="line">                cur = cur.right</span><br><span class="line">                <span class="comment"># if target == cur.val:</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                suc = cur</span><br><span class="line">                cur = cur.left</span><br><span class="line">        <span class="keyword">return</span> suc</span><br></pre></td></tr></table></figure>



<h3 id="Number-of-Connected-Components-in-an-Undirected-Graph"><a href="#Number-of-Connected-Components-in-an-Undirected-Graph" class="headerlink" title="Number of Connected Components in an Undirected Graph"></a>Number of Connected Components in an Undirected Graph</h3><h3 id="Split-BST"><a href="#Split-BST" class="headerlink" title="Split BST"></a>Split BST</h3><p>Ref: </p>
<ul>
<li><a href="https://www.coursera.org/lecture/data-structures/split-and-merge-22BgE" target="_blank" rel="noopener">https://www.coursera.org/lecture/data-structures/split-and-merge-22BgE</a></li>
<li><a href="https://leetcode.com/problems/split-bst/discuss/159985/Python-DFS-tm" target="_blank" rel="noopener">https://leetcode.com/problems/split-bst/discuss/159985/Python-DFS-tm</a></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"># class TreeNode:</span></span><br><span class="line"><span class="comment">#     def __init__(self, x):</span></span><br><span class="line"><span class="comment">#         self.val = x</span></span><br><span class="line"><span class="comment">#         self.left = None</span></span><br><span class="line"><span class="comment">#         self.right = None</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">          4                 V == 2</span></span><br><span class="line"><span class="string">        /   \</span></span><br><span class="line"><span class="string">      2      6</span></span><br><span class="line"><span class="string">     / \    / \</span></span><br><span class="line"><span class="string">    1   3  5   7</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">splitBST</span><span class="params">(self, root: TreeNode, V: int)</span> -&gt; List[TreeNode]:</span></span><br><span class="line">        <span class="keyword">return</span> self.helper(root, V)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(self, root, V)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root: </span><br><span class="line">            <span class="keyword">return</span> [<span class="literal">None</span>, <span class="literal">None</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> V &lt; root.val:</span><br><span class="line">            R1, R2 = self.helper(root.left, V)    <span class="comment"># keep splitting LHS, </span></span><br><span class="line">                                             <span class="comment"># R1 means LEFT, R2 means RIGHT</span></span><br><span class="line">                                             <span class="comment"># [2-&gt;1, 3]</span></span><br><span class="line">            <span class="comment"># Merge R1 and root.right with root </span></span><br><span class="line">            self.merge(R2, root.right, root)      <span class="comment"># [3 subtree, 657, 4]</span></span><br><span class="line">            <span class="keyword">return</span> [R1, root]                       <span class="comment"># [2, 4]</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">else</span>: <span class="comment"># V &gt;= root.val</span></span><br><span class="line">            R1, R2 = self.helper(root.right, V) <span class="comment"># if V==5 or 5.5 </span></span><br><span class="line">                                                <span class="comment"># [5, 6-&gt;7]</span></span><br><span class="line">            self.merge(root.left, R1, root)          <span class="comment"># [2 subtree, 5, 4]</span></span><br><span class="line">            <span class="keyword">return</span> [root, R2]                   <span class="comment"># [4, 6]</span></span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">merge</span><span class="params">(self, l, r, T)</span>:</span></span><br><span class="line">        T.left = l</span><br><span class="line">        T.right = r</span><br></pre></td></tr></table></figure>



<h3 id="Find-the-Closest-Points"><a href="#Find-the-Closest-Points" class="headerlink" title="Find the Closest Points"></a>Find the Closest Points</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">kClosest</span><span class="params">(self, points: List[List[int]], K: int)</span> -&gt; List[List[int]]:</span></span><br><span class="line">        <span class="comment"># return self.helper_heap_KlgK(points, K)</span></span><br><span class="line">        <span class="keyword">return</span> self.helper_Q_select(points, K)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">helper_Q_select</span><span class="params">(self, points, K)</span>:</span></span><br><span class="line">        dis = []</span><br><span class="line">        <span class="keyword">for</span> pt <span class="keyword">in</span> points:</span><br><span class="line">            dis.append(self.distance(pt, [<span class="number">0</span>,<span class="number">0</span>]))</span><br><span class="line">        </span><br><span class="line">        self.Q_select(dis, K, points) <span class="comment"># 0, len(dis)-1, K)</span></span><br><span class="line">        <span class="keyword">return</span> points[:K]</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Q_select</span><span class="params">(self, dis, K, points)</span>:</span></span><br><span class="line">        </span><br><span class="line">        l, r = <span class="number">0</span>, len(dis)<span class="number">-1</span></span><br><span class="line">        <span class="keyword">while</span> l &lt; r:</span><br><span class="line">            meetup = self.partition(dis, l, r, points)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> meetup == K:</span><br><span class="line">                <span class="keyword">return</span> </span><br><span class="line">            <span class="keyword">elif</span> meetup &lt; K:</span><br><span class="line">                l = meetup + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                r = meetup - <span class="number">1</span>        </span><br><span class="line">                </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">partition</span><span class="params">(self, arr, low, high, points)</span>:</span></span><br><span class="line">        <span class="comment"># def swap(x, y):</span></span><br><span class="line">        <span class="comment">#     x, y = y, x</span></span><br><span class="line">            </span><br><span class="line">        i = low - <span class="number">1</span></span><br><span class="line">        pvt = arr[high]      </span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">              3    0 5 4 1 8 2 2</span></span><br><span class="line"><span class="string">        low              high </span></span><br><span class="line"><span class="string">        X    X X 2 Y Y Y Y </span></span><br><span class="line"><span class="string">               i         4   </span></span><br><span class="line"><span class="string">        # 0 1 2 2</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(low, high):</span><br><span class="line">            <span class="keyword">if</span> arr[j] &lt;= pvt:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">                arr[i], arr[j] = arr[j], arr[i]</span><br><span class="line">                points[i], points[j] = points[j], points[i]</span><br><span class="line">                <span class="comment"># swap(arr[j], arr[i])      # NO USE</span></span><br><span class="line">                <span class="comment"># swap(points[j], points[i])</span></span><br><span class="line">            </span><br><span class="line">        <span class="comment"># swap(arr[i+1], arr[high])</span></span><br><span class="line">        <span class="comment"># swap(points[i+1], points[high])</span></span><br><span class="line">        arr[i+<span class="number">1</span>], arr[high] = arr[high], arr[i+<span class="number">1</span>]</span><br><span class="line">        points[i+<span class="number">1</span>], points[high] = points[high], points[i+<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> i+<span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">partitionX</span><span class="params">(self, arr, l, r, points)</span>:</span> <span class="comment"># 18, 26, 20</span></span><br><span class="line">        pvt = arr[l]</span><br><span class="line">        pvt_point = points[l]</span><br><span class="line">        i = l+<span class="number">1</span></span><br><span class="line">        j = r</span><br><span class="line">                    </span><br><span class="line">        <span class="keyword">while</span> i &lt; j:</span><br><span class="line">            <span class="string">'''</span></span><br><span class="line"><span class="string">               3 2 1 5 0 8 7 4   </span></span><br><span class="line"><span class="string">             pvt i i i</span></span><br><span class="line"><span class="string">                       j, </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">               3 2 1 0</span></span><br><span class="line"><span class="string">             pvt  </span></span><br><span class="line"><span class="string">                     i</span></span><br><span class="line"><span class="string">            '''</span>            </span><br><span class="line">            <span class="keyword">while</span> arr[i] &lt; pvt <span class="keyword">and</span> i &lt; j:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> arr[j] &gt; pvt <span class="keyword">and</span> i &lt; j:</span><br><span class="line">                j -= <span class="number">1</span></span><br><span class="line">            <span class="comment"># if i &lt; j:</span></span><br><span class="line">            <span class="keyword">if</span> <span class="literal">True</span>:</span><br><span class="line">                arr[i], arr[j] = arr[j], arr[i]</span><br><span class="line">                points[i], points[j] = points[j], points[i]</span><br><span class="line">                <span class="comment"># i += 1</span></span><br><span class="line">                <span class="comment"># j -= 1</span></span><br><span class="line">        <span class="comment"># arr[l], arr[i] = arr[i], pvt   # arr[l] WRONG!</span></span><br><span class="line">        <span class="comment"># points[l], points[i] = points[i], pvt_point   # arr[l] WRONG!</span></span><br><span class="line">        <span class="keyword">return</span> j</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">helper_heap_KlgK</span><span class="params">(self, points, K)</span>:</span>  <span class="comment"># should use max-heap since we pop out unwanted ones   </span></span><br><span class="line">        l = []</span><br><span class="line">        <span class="keyword">for</span> pt <span class="keyword">in</span> points:   <span class="comment"># O(N*lg(K))</span></span><br><span class="line">            <span class="comment"># heapq._heappush_max(l, (self.distance(pt, [0,0]), pt))</span></span><br><span class="line">            heapq.heappush(l, (<span class="number">-1</span>*self.distance(pt, [<span class="number">0</span>,<span class="number">0</span>]), pt))</span><br><span class="line">            <span class="keyword">if</span> len(l) == K+<span class="number">1</span>:</span><br><span class="line">                heapq.heappop(l)</span><br><span class="line">        </span><br><span class="line">        Q = deque()</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(len(l)):</span><br><span class="line">            _, pt = heapq.heappop(l)</span><br><span class="line">            Q.appendleft(pt)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> Q</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">helper_heap_NlgN</span><span class="params">(self, points, K)</span>:</span></span><br><span class="line">        </span><br><span class="line">        l = []</span><br><span class="line">        <span class="keyword">for</span> pt <span class="keyword">in</span> points:   <span class="comment"># O(N*lg(N))</span></span><br><span class="line">            <span class="comment"># l.append(self.distance(pt, [0,0]), pt)</span></span><br><span class="line">            heapq.heappush(l, (self.distance(pt, [<span class="number">0</span>,<span class="number">0</span>]), pt))</span><br><span class="line">            </span><br><span class="line">        ans = []</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(K):</span><br><span class="line">            _, pt = heapq.heappop(l)</span><br><span class="line">            ans.append(pt)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> ans</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">kClosest_old</span><span class="params">(self, points: List[List[int]], K: int)</span> -&gt; List[List[int]]:</span></span><br><span class="line">        <span class="string">''' N*log(N)</span></span><br><span class="line"><span class="string">        # Q-sort tech</span></span><br><span class="line"><span class="string">        # [dis1, dis2, dis3]</span></span><br><span class="line"><span class="string">        if not points or not K:</span></span><br><span class="line"><span class="string">            return 0</span></span><br><span class="line"><span class="string">        l = []</span></span><br><span class="line"><span class="string">        for xy in points:</span></span><br><span class="line"><span class="string">            heapq.heappush(l, (self.distance(xy), xy[0], xy[1]))  # n*log(n)</span></span><br><span class="line"><span class="string">            # if len(l) &gt; K:</span></span><br><span class="line"><span class="string">            #     heapq._heappop_max(l)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        # map(points, self.distance)</span></span><br><span class="line"><span class="string">        # for point in points:</span></span><br><span class="line"><span class="string">        #     self.distance(point)</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        res = []</span></span><br><span class="line"><span class="string">        for i in range(K):</span></span><br><span class="line"><span class="string">            dis, x, y = heapq.heappop(l)</span></span><br><span class="line"><span class="string">            res.append([x,y])</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">        return res</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        l = []</span><br><span class="line">        <span class="keyword">for</span> xy <span class="keyword">in</span> points:</span><br><span class="line">            dist = self.distance(xy)</span><br><span class="line">            dist = <span class="number">-1</span>*dist</span><br><span class="line">            <span class="keyword">if</span> len(l) &lt;= K<span class="number">-1</span>:</span><br><span class="line">                heapq.heappush(l, (dist, xy))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># print('---', dist)</span></span><br><span class="line">                <span class="keyword">if</span> dist &gt; l[<span class="number">0</span>][<span class="number">0</span>]:</span><br><span class="line">                    heapq.heappop(l)</span><br><span class="line">                    heapq.heappush(l, (dist, xy))</span><br><span class="line">                    </span><br><span class="line">        res = []</span><br><span class="line">        <span class="comment"># for i in range(len(l)):</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(K):</span><br><span class="line">            res.append(heapq.heappop(l)[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">distance</span><span class="params">(self, xy, xy2=[<span class="number">0</span>,<span class="number">0</span>])</span>:</span></span><br><span class="line">        <span class="keyword">return</span> math.sqrt((xy[<span class="number">0</span>]-xy2[<span class="number">0</span>])**<span class="number">2</span> + (xy[<span class="number">1</span>]-xy2[<span class="number">1</span>])**<span class="number">2</span>)<span class="comment">#, xy[0], xy[1]</span></span><br></pre></td></tr></table></figure>

<p><strong>For Quick-Select Complexity Analysis</strong></p>
<ul>
<li>Time Complexity: <em>O</em>(<em>N</em>) in <em>average case</em> complexity, where <em>N</em> is the length of <code>points</code>., worst when O(N^2)</li>
<li>Space Complexity: <em>O</em>(<em>N</em>).</li>
</ul>
<h3 id="Duplicate-Subtrees"><a href="#Duplicate-Subtrees" class="headerlink" title="Duplicate Subtrees"></a>Duplicate Subtrees</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findDuplicateSubtrees</span><span class="params">(self, root: TreeNode)</span> -&gt; List[TreeNode]:</span></span><br><span class="line">        </span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        serialize each node in post order</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.mapping = defaultdict(int)</span><br><span class="line">        self.res = []</span><br><span class="line">        self.helper(root)</span><br><span class="line">        <span class="keyword">return</span> self.res</span><br><span class="line">        </span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">                1</span></span><br><span class="line"><span class="string">       /                    \</span></span><br><span class="line"><span class="string">      2 (2 (4 # #) #)         3</span></span><br><span class="line"><span class="string">     /          / \</span></span><br><span class="line"><span class="string">    4 (4 # #)      2   4</span></span><br><span class="line"><span class="string">                   /</span></span><br><span class="line"><span class="string">                  4 (4 # #)</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(self, root)</span>:</span></span><br><span class="line">        <span class="comment"># post order </span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"#"</span></span><br><span class="line">        <span class="comment"># if not root.left and not root.right:</span></span><br><span class="line">            </span><br><span class="line">        </span><br><span class="line">        L = self.helper(root.left)</span><br><span class="line">        R = self.helper(root.right)</span><br><span class="line">        </span><br><span class="line">        pattern = <span class="string">"(&#123;&#125; &#123;&#125; &#123;&#125;)"</span>.format(root.val, L, R)</span><br><span class="line">        <span class="comment"># 4 # #</span></span><br><span class="line">        self.mapping[pattern] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.mapping[pattern] == <span class="number">2</span>:</span><br><span class="line">            self.res += [root]    </span><br><span class="line">        <span class="keyword">return</span> pattern</span><br></pre></td></tr></table></figure>



<h3 id="K-Closest-Elements"><a href="#K-Closest-Elements" class="headerlink" title="K Closest Elements"></a>K Closest Elements</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findClosestElements</span><span class="params">(self, arr: List[int], k: int, x: int)</span> -&gt; List[int]:</span></span><br><span class="line">        <span class="comment"># use a max-heap to maintain </span></span><br><span class="line">        <span class="comment"># return self.helper_random_when_tie(arr, k, x)</span></span><br><span class="line">        <span class="keyword">return</span> self.helper(arr, k, x)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(self, arr, k, x)</span>:</span></span><br><span class="line">        num_rm = len(arr) - k</span><br><span class="line">        l, r = <span class="number">0</span>, len(arr)<span class="number">-1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(num_rm):</span><br><span class="line">            <span class="keyword">if</span> abs(arr[l]-x) &lt;= abs(arr[r]-x):</span><br><span class="line">                r -= <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                l += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> arr[l:r+<span class="number">1</span>]</span><br><span class="line">  ref: https://www.bilibili.com/video/av92867152?from=search&amp;seid=10589543388785979484</span><br></pre></td></tr></table></figure>



<h3 id="Index-of-Larger-Next-Number"><a href="#Index-of-Larger-Next-Number" class="headerlink" title="Index of Larger Next Number"></a>Index of Larger Next Number</h3><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd2z6g4039j318i0r4h4c.jpg" alt="image-20200322202508690"></p>
<h3 id="Number-of-Meeting-Rooms"><a href="#Number-of-Meeting-Rooms" class="headerlink" title="Number of Meeting Rooms"></a>Number of Meeting Rooms</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">minMeetingRooms</span><span class="params">(self, intervals: List[List[int]])</span> -&gt; int:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> intervals:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    arr = sorted(intervals, key=<span class="keyword">lambda</span> x: x[<span class="number">0</span>])</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    0   5   10.  15   20.  25.  30     </span></span><br><span class="line"><span class="string">    s.                           e </span></span><br><span class="line"><span class="string">        s    e</span></span><br><span class="line"><span class="string">                 s     e </span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    ends = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(arr)):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ends:</span><br><span class="line">            ends.append(arr[i][<span class="number">1</span>])</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">        <span class="comment"># can use while, to compare arr[i][0] with all ends, but we dont' have to store so manu </span></span><br><span class="line">        <span class="comment"># but if it's ends is sorted ACS, we can compare only once , so , use min-heap</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># if ends[0] &lt; arr[i][1]:</span></span><br><span class="line">            <span class="keyword">if</span> ends[<span class="number">0</span>] &lt;= arr[i][<span class="number">0</span>]:    </span><br><span class="line">                <span class="string">"""結束的那瞬間跟別人開始時一樣是OK的，第二組人馬還是可以用"""</span></span><br><span class="line">                <span class="comment"># count += 1</span></span><br><span class="line">                heapq.heapreplace(ends, arr[i][<span class="number">1</span>])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">                heapq.heappush(ends, arr[i][<span class="number">1</span>])</span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> count</span><br></pre></td></tr></table></figure>

<h3 id="Primes"><a href="#Primes" class="headerlink" title="Primes"></a><del>Primes</del></h3><h3 id="Multiply-Strings"><a href="#Multiply-Strings" class="headerlink" title="Multiply Strings"></a>Multiply Strings</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">multiply</span><span class="params">(self, num1: str, num2: str)</span> -&gt; str:</span></span><br><span class="line">        a = self.string2num(num1)</span><br><span class="line">        b = self.string2num(num2)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> str(a*b)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">string2num</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        ret = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(n)):</span><br><span class="line">            digit = ord(n[i]) - ord(<span class="string">'0'</span>)</span><br><span class="line">            ret = <span class="number">10</span>*ret + digit</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ret</span><br></pre></td></tr></table></figure>



<h3 id="Remove-Adjacent-Duplicate-Characters"><a href="#Remove-Adjacent-Duplicate-Characters" class="headerlink" title="Remove Adjacent Duplicate Characters"></a>Remove Adjacent Duplicate Characters</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">removeDuplicates</span><span class="params">(self, S: str)</span> -&gt; str:</span></span><br><span class="line">        <span class="keyword">return</span> self.helper2(S)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">helper2</span><span class="params">(self, S)</span>:</span></span><br><span class="line">        <span class="comment"># if len(S)</span></span><br><span class="line">        tmp = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(S)):</span><br><span class="line">            <span class="keyword">if</span> tmp <span class="keyword">and</span> tmp[<span class="number">-1</span>] == S[i]:</span><br><span class="line">                tmp.pop()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                tmp.append(S[i])</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(tmp)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">removeDuplicates</span><span class="params">(self, s: str, k: int)</span> -&gt; str:</span>  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>.join(self.helper(s, k))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(self, s, k)</span>:</span></span><br><span class="line">        stack = [[<span class="string">'#'</span>, <span class="number">0</span>]]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(s)):</span><br><span class="line">            <span class="keyword">if</span> stack[<span class="number">-1</span>][<span class="number">0</span>] != s[i]:</span><br><span class="line">                stack.append([s[i], <span class="number">1</span>])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># stack[-1] = [stack[-1][0], stack[-1][1]+1]</span></span><br><span class="line">                stack[<span class="number">-1</span>][<span class="number">1</span>] += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> stack[<span class="number">-1</span>][<span class="number">1</span>] == k:</span><br><span class="line">                stack.pop()</span><br><span class="line">        res = <span class="string">''</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(len(stack)):</span><br><span class="line">            res += stack[j][<span class="number">0</span>] * stack[j][<span class="number">1</span>]</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>



<h3 id="Common-Characters"><a href="#Common-Characters" class="headerlink" title="Common Characters"></a>Common Characters</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter, defaultdict</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">commonChars</span><span class="params">(self, A: List[str])</span> -&gt; List[str]:</span></span><br><span class="line">        </span><br><span class="line">        c_maps = Counter(A[<span class="number">0</span>])</span><br><span class="line">        <span class="comment"># keys, values = c_maps.keys(), c_maps.values()</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(A)):</span><br><span class="line">            ret = defaultdict(int)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(len(A[i])):</span><br><span class="line">                <span class="keyword">if</span> A[i][j] <span class="keyword">in</span> c_maps <span class="keyword">and</span> c_maps[A[i][j]] &gt; <span class="number">0</span>:</span><br><span class="line">                    ret[A[i][j]] += <span class="number">1</span></span><br><span class="line">                    c_maps[A[i][j]] -= <span class="number">1</span></span><br><span class="line">            c_maps = ret</span><br><span class="line">        </span><br><span class="line">        res = <span class="string">''</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> ret:</span><br><span class="line">            res += k * ret[k]</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> list(res)</span><br></pre></td></tr></table></figure>



<h3 id="Matrix-Transpose"><a href="#Matrix-Transpose" class="headerlink" title="Matrix Transpose"></a><del>Matrix Transpose</del></h3><h3 id="Convert-to-Hexadecimal"><a href="#Convert-to-Hexadecimal" class="headerlink" title="Convert to Hexadecimal"></a>Convert to Hexadecimal</h3><h3 id="Remove-Character-to-Create-Palindrome"><a href="#Remove-Character-to-Create-Palindrome" class="headerlink" title="Remove Character to Create Palindrome"></a>Remove Character to Create Palindrome</h3><p>==&gt; Turn into LCS if num of deletion is not limited</p>
<h3 id="Convert-Fraction-to-Decimal"><a href="#Convert-Fraction-to-Decimal" class="headerlink" title="Convert Fraction to Decimal"></a>Convert Fraction to Decimal</h3><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3></div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/50/">50</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By Joe Huang</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>