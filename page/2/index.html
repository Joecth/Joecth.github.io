<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="Joe Huang"><meta name="copyright" content="Joe Huang"><title>Awaken Desparado</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.1.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Joe Huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">249</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">24</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">36</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Awaken Desparado</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Awaken Desparado</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2020/01/08/Design-Patterns/%E2%80%9C2019-01-08-Design%20Patterns%20-%20Observer%E2%80%9D/">Design-Patterns/“2019-01-08-Design Patterns - Observer”</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-01-08</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/DesignPattern/">DesignPattern</a></span><div class="content"><h3 id="Observer-Pattern"><a href="#Observer-Pattern" class="headerlink" title="Observer Pattern"></a>Observer Pattern</h3><p>Still for OCP – Open Close Principle, which means, open for extension, close for modification.</p>
<p>Define 1vsMany, such that all observers receives notification when the observable getting update.</p>
<img src="/Users/joe/Library/Application Support/typora-user-images/image-20200116114053868.png" alt="image-20200116114053868" style="zoom:67%;" />





<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Vector obs = <span class="keyword">new</span> Vector();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addObserver</span><span class="params">(Observer obs)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.obs.add(obs);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delObserver</span><span class="params">(Observer obs)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.obs.remove(obs);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">notifyObserver</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(Observer o: obs)&#123;</span><br><span class="line">            o.update();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteSubject</span> <span class="keyword">extends</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"被观察者事件反生"</span>);</span><br><span class="line">        <span class="keyword">this</span>.notifyObserver();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserver1</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"观察者1收到信息，并进行处理。"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserver2</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"观察者2收到信息，并进行处理。"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Subject sub = <span class="keyword">new</span> ConcreteSubject();</span><br><span class="line">        sub.addObserver(<span class="keyword">new</span> ConcreteObserver1()); <span class="comment">//添加观察者1</span></span><br><span class="line">        sub.addObserver(<span class="keyword">new</span> ConcreteObserver2()); <span class="comment">//添加观察者2</span></span><br><span class="line">        sub.doSomething();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ref from: <a href="https://wiki.jikexueyuan.com/project/java-design-pattern/observer-pattern.html" target="_blank" rel="noopener">https://wiki.jikexueyuan.com/project/java-design-pattern/observer-pattern.html</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/22/Web/2019-12-19-Self-defined%20JSON%20serialization%20for%20json%20dump/">Web/2019-12-19-Self-defined JSON serialization for json dump</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-22</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Web/">Web</a></span><div class="content"><h2 id="date-2019-12-21"><a href="#date-2019-12-21" class="headerlink" title="date: 2019-12-21"></a>date: 2019-12-21</h2><h3 id="Self-defined-serializable-for-JSON-dump"><a href="#Self-defined-serializable-for-JSON-dump" class="headerlink" title="Self-defined serializable for JSON dump"></a>Self-defined serializable for JSON dump</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySerialization</span><span class="params">(json.JSONEncoder)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(self, obj)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(obj, np.integer):</span><br><span class="line">            <span class="keyword">return</span> int(obj)</span><br><span class="line">        <span class="keyword">elif</span> isinstance(obj, np.floating):</span><br><span class="line">            <span class="keyword">return</span> float(obj)</span><br><span class="line">        <span class="keyword">elif</span> isinstance(obj, np.ndarray):</span><br><span class="line">            <span class="keyword">return</span> obj.tolist()</span><br><span class="line">        <span class="keyword">if</span> isinstance(obj, time):</span><br><span class="line">            <span class="keyword">return</span> obj.__str__()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> super(NpEncoder, self).default(obj)</span><br></pre></td></tr></table></figure>


<p>Then, </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json.dumps(data, cls=MySerialization)</span><br></pre></td></tr></table></figure>





<p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gajfy4hc41j30m405jn01.jpg" alt="image-20200103161320526"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_art_inf</span><span class="params">(self, cfg)</span>:</span></span><br><span class="line">    info = &#123;&#125;</span><br><span class="line">    d1 = &#123;</span><br><span class="line">            <span class="string">"name"</span>: os.path.basename(cfg[<span class="string">'path'</span>]),  </span><br><span class="line">            <span class="string">"config_json"</span>: cfg, 	<span class="comment"># This should be a json configuration</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    info[<span class="string">"manuscript"</span>] = json.dumps(d1)   <span class="comment"># should do json.dumps() here instead of at line 5</span></span><br><span class="line">    <span class="keyword">return</span> info</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/13/Web/2019-12-13-Hexo/">Web/2019-12-13-Hexo</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-13</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Web/">Web</a></span><div class="content"><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="Hexo-Init"><a href="#Hexo-Init" class="headerlink" title="Hexo Init !"></a>Hexo Init !</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">node -v </span><br><span class="line">sudo hexo init </span><br><span class="line">ls -l </span><br><span class="line"><span class="built_in">pwd</span> </span><br><span class="line">hexo s </span><br><span class="line">hexo n <span class="string">"My first HEXO"</span></span><br><span class="line">ll <span class="built_in">source</span>/_posts/</span><br><span class="line">ls  <span class="built_in">source</span>/_posts/</span><br><span class="line">vi <span class="built_in">source</span>/_posts/My-first-HEXO.md </span><br><span class="line">vim <span class="built_in">source</span>/_posts/My-first-HEXO.md</span><br><span class="line"><span class="built_in">pwd</span> </span><br><span class="line">hexo clean </span><br><span class="line">hexo generate</span><br><span class="line">hexo s </span><br><span class="line">cnpm install --save hexo-deployer-git</span><br><span class="line">ls </span><br><span class="line">vi _config.yml </span><br><span class="line"><span class="string">''</span><span class="string">'</span></span><br><span class="line"><span class="string">#  repo: https://github.com/Joecth/Joecth.github.io.git </span></span><br><span class="line"><span class="string">#  branch: master</span></span><br><span class="line"><span class="string">'</span><span class="string">''</span></span><br><span class="line"></span><br><span class="line">hexo d </span><br><span class="line"><span class="built_in">pwd</span> </span><br><span class="line">git <span class="built_in">clone</span> https://github.com/litten/hexo-theme-yilia.git themes/yilia</span><br><span class="line">ls -l </span><br><span class="line"><span class="built_in">cd</span> themes/</span><br><span class="line">ls </span><br><span class="line">ls -l </span><br><span class="line">.. </span><br><span class="line"><span class="built_in">cd</span> .. </span><br><span class="line">vi _config.yml </span><br><span class="line">hexo clean </span><br><span class="line">hexo g</span><br><span class="line">hexo s</span><br><span class="line">hexo d </span><br><span class="line"><span class="built_in">history</span> &gt; his.log</span><br><span class="line"><span class="string">''</span><span class="string">'</span></span><br><span class="line"><span class="string"># ## Themes: https://hexo.io/themes/</span></span><br><span class="line"><span class="string"># theme: yilia</span></span><br><span class="line"><span class="string">'</span><span class="string">''</span></span><br><span class="line"></span><br><span class="line">ref: https://www.bilibili.com/video/av44544186?from=search&amp;seid=17843376507979725408</span><br></pre></td></tr></table></figure>

<h3 id="melody-w-default-sidebar"><a href="#melody-w-default-sidebar" class="headerlink" title="melody w/ default sidebar"></a>melody w/ default sidebar</h3><p>ref: <a href="https://pratnket.github.io/2019/02/22/Nexo-tutorial/#Hexo-%E9%9B%9C%E9%A0%85%E7%AD%86%E8%A8%98" target="_blank" rel="noopener">https://pratnket.github.io/2019/02/22/Nexo-tutorial/#Hexo-%E9%9B%9C%E9%A0%85%E7%AD%86%E8%A8%98</a></p>
<h3 id="Version-Control-w-2-branches-for-Hexo"><a href="#Version-Control-w-2-branches-for-Hexo" class="headerlink" title="Version Control w/ 2 branches for Hexo"></a>Version Control w/ 2 branches for Hexo</h3><p>ref: <a href="https://www.zhihu.com/question/21193762" target="_blank" rel="noopener">https://www.zhihu.com/question/21193762</a></p>
<h3 id="hexo-git-backup"><a href="#hexo-git-backup" class="headerlink" title="hexo-git-backup"></a>hexo-git-backup</h3><hr>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/13/Web/2019-12-13-Hexo%20management%20w:%202%20branches/">Web/2019-12-13-Hexo management w: 2 branches</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-13</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Web/">Web</a></span><div class="content"><p>###</p>
<p>From below: </p>
<p>作者：直上云霄<br>链接：<a href="https://www.zhihu.com/question/21193762/answer/489124966" target="_blank" rel="noopener">https://www.zhihu.com/question/21193762/answer/489124966</a><br>来源：知乎<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
<p><strong>git分支进行多终端工作</strong>问题来了，如果你现在在自己的笔记本上写的博客，部署在了网站上，那么你在家里用台式机，或者实验室的台式机，发现你电脑里面没有博客的文件，或者要换电脑了，最后不知道怎么移动文件，怎么办？在这里我们就可以利用git的分支系统进行多终端工作了，这样每次打开不一样的电脑，只需要进行简单的配置和在github上把文件同步下来，就可以无缝操作了。</p>
<p><strong>机制</strong>机制是这样的，由于<code>hexo d</code>上传部署到github的其实是hexo编译后的文件，是用来生成网页的，不包含源文件。<br><img src="https://pic3.zhimg.com/50/v2-32ab30d0d28b916a204c03de4ed0fc4f_hd.jpg" alt="img">)<img src="https://pic3.zhimg.com/80/v2-32ab30d0d28b916a204c03de4ed0fc4f_hd.jpg" alt="img"></p>
<p>也就是上传的是在本地目录里自动生成的<code>.deploy_git</code>里面。其他文件 ，包括我们写在source 里面的，和配置文件，主题文件，都没有上传到github<br><img src="https://pic4.zhimg.com/50/v2-59bb330178a4e010d9818911f789082b_hd.jpg" alt="img">)<img src="https://pic4.zhimg.com/80/v2-59bb330178a4e010d9818911f789082b_hd.jpg" alt="img"></p>
<p>所以可以利用git的分支管理，将源文件上传到github的另一个分支即可。<br><strong>上传分支</strong>首先，先在github上新建一个hexo分支，如图：<br><img src="https://pic1.zhimg.com/50/v2-ebb3e05632e85ab036663390305caa1c_hd.jpg" alt="img">)<img src="https://pic1.zhimg.com/80/v2-ebb3e05632e85ab036663390305caa1c_hd.jpg" alt="img"></p>
<p>然后在这个仓库的settings中，选择默认分支为hexo分支（这样每次同步的时候就不用指定分支，比较方便）。<br><img src="https://pic2.zhimg.com/50/v2-1899b6219f3787832652813b958b9b3d_hd.jpg" alt="img">)<img src="https://pic2.zhimg.com/80/v2-1899b6219f3787832652813b958b9b3d_hd.jpg" alt="img"></p>
<p>然后在本地的任意目录下，打开git bash，<code>git clone git@github.com:ZJUFangzh/ZJUFangzh.github.io.git</code>将其克隆到本地，因为默认分支已经设成了hexo，所以clone时只clone了hexo。<br>接下来在克隆到本地的<code>ZJUFangzh.github.io</code>中，把除了.git 文件夹外的所有文件都删掉 把之前我们写的博客源文件全部复制过来，除了<code>.deploy_git</code>。这里应该说一句，复制过来的源文件应该有一个<code>.gitignore</code>，用来忽略一些不需要的文件，如果没有的话，自己新建一个，在里面写上如下，表示这些类型文件不需要git：<code>.DS_Store Thumbs.db db.json *.log node_modules/ public/ .deploy*/</code>注意，如果你之前克隆过theme中的主题文件，那么应该把主题文件中的<code>.git</code>文件夹删掉，因为git不能嵌套上传，最好是显示隐藏文件，检查一下有没有，否则上传的时候会出错，导致你的主题文件无法上传，这样你的配置在别的电脑上就用不了了。而后<code>git add . git commit –m &quot;add branch&quot; git push</code>这样就上传完了，可以去你的github上看一看hexo分支有没有上传上去，其中<code>node_modules</code>、<code>public</code>、<code>db.json</code>已经被忽略掉了，没有关系，不需要上传的，因为在别的电脑上需要重新输入命令安装 。<br><img src="https://pic4.zhimg.com/50/v2-a94330ca825f4debde8ce7ceeb8f8394_hd.jpg" alt="img">)<img src="https://pic4.zhimg.com/80/v2-a94330ca825f4debde8ce7ceeb8f8394_hd.jpg" alt="img"></p>
<p>这样就上传完了。<br><strong>更换电脑操作</strong>一样的，跟之前的环境搭建一样，安装git<code>sudo apt-get install git</code>设置git全局邮箱和用户名<code>git config --global user.name &quot;yourgithubname&quot; git config --global user.email &quot;yourgithubemail&quot;</code>设置ssh key<code>ssh-keygen -t rsa -C &quot;youremail&quot; #生成后填到github和coding上（有coding平台的话） #验证是否成功 ssh -T git@github.com ssh -T git@git.coding.net #(有coding平台的话)</code>安装nodejs<code>sudo apt-get install nodejs sudo apt-get install npm</code>安装hexo  <code>sudo npm install hexo-cli -g</code>但是已经不需要初始化了，直接在任意文件夹下，<code>git clone git@………………</code>然后进入克隆到的文件夹：<code>cd xxx.github.io npm install npm install hexo-deployer-git --save</code>生成，部署：<code>hexo g hexo d</code><br>然后就可以开始写你的新博客了<code>hexo new newpage</code><br><strong>Tips:</strong>不要忘了，每次写完最好都把源文件上传一下<code>git add . git commit –m &quot;xxxx&quot; git push</code>如果是在已经编辑过的电脑上，已经有clone文件夹了，那么，每次只要和远端同步一下就行了<code>git pull</code></p>
<p><a href="">发布于 2018-09-10</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/12/CVs/2019-12-11-CNN%20&amp;%20RNN%20Review%20&amp;%20Prep/">CVs/2019-12-11-CNN &amp; RNN Review &amp; Prep</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-12</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/AI/">AI</a></span><div class="content"><blockquote>
<p>Two stages: RPN for localization, then classification &amp; bbox regression on proposals</p>
<p>Single shot: classification + bbox regression at one time</p>
</blockquote>
<h3 id="Faster-RCNN"><a href="#Faster-RCNN" class="headerlink" title="Faster RCNN"></a>Faster RCNN</h3><h4 id="VGG-backbone"><a href="#VGG-backbone" class="headerlink" title="VGG backbone"></a><code>VGG</code> backbone</h4><ul>
<li><p>VGG: Input 224x224, therefore, 224/2^4 = 14, 14x14 for conv-5 (ch-512, same as conv-4),  13 conv, 13 ReLU, 4 Pooling</p>
</li>
<li><p>Faster RCNN’s image size :  ==&gt; 800x600 (image’s input by python ‘s cv2)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># reshape network inputs</span><br><span class="line"> net.blobs[&#39;data&#39;].reshape(*(blobs[&#39;data&#39;].shape))</span><br></pre></td></tr></table></figure>

<p>As we can see, the input blob <code>&#39;data&#39;</code> is reshaped according to the input image size. Once you <code>forward</code> caffe will reshape all consequent blobs according to the input shape；　<code>*</code> means convert passed argument from tuple to positional parameters</p>
</li>
<li><p>RPN: 3x3x512, as each point fuses 3x3 info arounding it. and then calc + &amp; - anchors as well as bbox regression shift, and then calc proposals;</p>
<p><code>ROI Pooling</code> extract <code>proposal feature</code> from <code>feature map</code>for FC and softmax</p>
</li>
<li><p>9 anchors for each point –&gt; + &amp; -</p>
</li>
<li><p>TRAINING: 128 + anchors and 128 - anchors</p>
<ul>
<li>Suitable Anchors:</li>
</ul>
</li>
</ul>
<p><img src="https://www.zhihu.com/equation?tex=%5Ctext%7Bceil%7D(800%2F16)+%5Ctimes+%5Ctext%7Bceil%7D(600%2F16)+%5Ctimes+9%3D50%5Ctimes38+%5Ctimes9%3D17100" alt="[公式]"></p>
<blockquote>
<p><a href="https://github.com/rbgirshick/py-faster-rcnn/tree/master/models/pascal_voc/VGG16/faster_rcnn_end2end" target="_blank" rel="noopener">https://github.com/rbgirshick/py-faster-rcnn/tree/master/models/pascal_voc/VGG16/faster_rcnn_end2end</a></p>
</blockquote>
<p>那么为何要在softmax前后都接一个reshape layer？其实只是为了便于softmax分类，至于具体原因这就要从caffe的实现形式说起了。在caffe基本数据结构blob中以如下形式保存数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blob&#x3D;[batch_size, channel，height，width]</span><br></pre></td></tr></table></figure>

<p>对应至上面的保存positive/negative anchors的矩阵，其在caffe blob中的存储形式为[1, 2x9, H, W]。而在softmax分类时需要进行positive/negative二分类，所以reshape layer会将其变为[1, 2, 9xH, W]大小，即单独“腾空”出来一个维度以便softmax分类，之后再reshape回复原状。贴一段caffe softmax_loss_layer.cpp的reshape函数的解释，非常精辟：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"Number of labels must match number of predictions; "</span></span><br><span class="line"><span class="string">"e.g., if softmax axis == 1 and prediction shape is (N, C, H, W), "</span></span><br><span class="line"><span class="string">"label count (number of labels) must be N*H*W, "</span></span><br><span class="line"><span class="string">"with integer values in &#123;0, 1, ..., C-1&#125;."</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>soomth-L1</li>
<li>ROI pooliing 7x7</li>
</ul>
<h4 id="for-ZF-backbone"><a href="#for-ZF-backbone" class="headerlink" title="*for ZF backbone *"></a>*for <code>ZF</code> backbone *</h4><p>==&gt; ch-256 before RPN</p>
<hr>
<h3 id="YOLO-v1"><a href="#YOLO-v1" class="headerlink" title="YOLO v1"></a>YOLO v1</h3><ul>
<li><p>45FPS</p>
</li>
<li><p>Can we just out bbox (x,y,w,h) and (c) ? But we found as objected to be detected increase, output dimension of model also increase, not able to be determined.</p>
<p>==&gt; YOLO does this by gridding image into grids, within each of which being able to output class and bbox.</p>
</li>
<li><p>7x7 grids on image, 30 channels, as No RPN, just use a big net to catch all fishes</p>
</li>
<li><p>2 predictor for each cell.</p>
</li>
<li><p>Q: If class prediction is not sharing, can one cell predict two obj?</p>
<ul>
<li>No. In this way,  how do the two predictor divide their works?</li>
<li>Faster RCNN OK because of anhchors and IOU w/ GT, which got introduced in YOLO v2</li>
</ul>
</li>
<li><p>Why 2 bounding boxes?</p>
<ul>
<li>Predictor with bigger IOU with GT while training, is responsible for detecting the corresponding object.</li>
</ul>
</li>
<li><p>x, y means shift relative to cell’s upper-left corner; w, h relative to the whole image</p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gamijfkmaej30oy0iy77z.jpg" alt="image-20200106075944588"></p>
</li>
<li><p>confidence = <em>Pr(Object) x IOU</em>,  IOU is calculated during training, Pr(Object) is bool</p>
<p>So, Pr(Classi|Object) x <em>Pr(Object) x IOU</em> , Pr(Classi|Object) is meaningful only when Pr(Object) is not 0.</p>
</li>
</ul>
<p>Ref: <a href="https://zhuanlan.zhihu.com/p/37850811" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/37850811</a></p>
<hr>
<h3 id="YOLO-v2"><a href="#YOLO-v2" class="headerlink" title="YOLO v2"></a>YOLO v2</h3><ul>
<li><p>input: 416x416 ==&gt; 13 x 13</p>
</li>
<li><p>No FC (YOLO v1 has FC to turn 1024x7x7 into 30x7x7)</p>
</li>
<li><p>5 Anchor, so that <strong>able to predict not only one obj for each cell</strong>, but 5</p>
</li>
<li><p>BN – quickly converge, and for regularization</p>
</li>
<li><p>Fully convolutional network architecture, so any size of image.</p>
</li>
<li><p>Skipping <code>reorg</code> layer –  after conv5-5, making gradient able forward. </p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gamo1nin68j30u60700ul.jpg" alt="image-20200106111017191"></p>
</li>
<li><p>Prediction:<br>(4 + 1 + num_class) for <code>each anchor</code>。Use sigmoid to make value btw 0~1. Use exponential for scaling.</p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gamoddpf2zj30um0ta140.jpg" alt="image-20200106112133343"></p>
</li>
<li><p>anchor with largest IOU (by moving both of anchor and GT_box to upper-left corner) to predict correcponding obj</p>
</li>
<li><p>Loss: </p>
<ul>
<li>anchor predicting obj xywh: L2</li>
<li>anchor not predicing obj xywh: for correct anchor’s xywh</li>
<li>anchor predicting obj confidence: IOU btw predicted bbox and GT bbox</li>
<li>anchor not predicing obj confidence: for correct anchor’s xywh</li>
</ul>
</li>
<li><p>Multi-scale:</p>
<p>[320,320]，[416,416]和[512,512]，==&gt; grids: [10,10], [13,13], [16,16]. </p>
<p>During training, every 10 batches, one size btw 320x320 ~ 608x608 is chosen</p>
</li>
</ul>
<p>Ref: <a href="https://zhuanlan.zhihu.com/p/40659490" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/40659490</a></p>
<hr>
<h3 id="SSD"><a href="#SSD" class="headerlink" title="SSD"></a>SSD</h3><p>prototxt: <a href="https://github.com/intel/caffe/blob/master/models/intel_optimized_models/ssd/VGGNet/VOC0712/SSD_300x300/deploy.prototxt" target="_blank" rel="noopener">https://github.com/intel/caffe/blob/master/models/intel_optimized_models/ssd/VGGNet/VOC0712/SSD_300x300/deploy.prototxt</a></p>
<ul>
<li><p>as YOLO, turn <code>detection</code> problem into <code>regression</code> problem</p>
</li>
<li><p>as FasterRCNN’s anchor, proposed <code>prior box</code>,  for each feature map</p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gamqauu7ioj30l402smxd.jpg" alt="image-20200106122821151"></p>
<p>By this formula, Prior Box size could be determined for each feature map together with <code>aspect ratio</code></p>
<p>m: total feature maps adopted</p>
<ul>
<li><p><code>default box</code> : abstract concept of <code>prior box</code></p>
</li>
<li><p><code>prior box</code>: adopted during training, the actually chosen default box for training</p>
</li>
<li><p>for <code>k default box</code> on their own feature maps: k x  (c+4) x  m x n</p>
<ul>
<li><p>for confidence’s output: c x k x m x n,<br>c x m x n for each of the k default box </p>
<p>if 20 classes, then we have </p>
</li>
<li><p>for localization’s output: 4 x k x m x n<br>4 x m x n for each of the k default box </p>
</li>
<li><p>All prior box amount:<br>$$<br>38x38x4 + 19x19x6 +10x10x6 + 5x5x6 + 3x3x4 +1x1x4 = 8732<br>$$<br>k x (20+1), if k is 6 for each prior box; thus, 6x21 = 126 kernels<br>k x 4, if k is 6 for each prior box; thus, 6x4 = 24 kernels</p>
</li>
<li><p>TRAINING to make prior box regress to GT box </p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>as FPN, use Pyramidal Feature Hierarchy</p>
</li>
<li><p>DIDN’T generate RPN, thus speed-up</p>
</li>
<li><p>VGG-16 as backbone, the final 2 FC were turned into conv layers</p>
</li>
<li><p>Permute: 32x19x19x24 ==&gt; 32x24x19x19</p>
<p>Flatten: 32x19x19x24 ==&gt; 32x8664, where 32 is batch_size</p>
<p>mbox_priorbox – for training only</p>
<p>mbox_loc</p>
<p>mbox_conf</p>
</li>
<li><p><strong>Sample augmentation</strong></p>
</li>
<li><p><strong>+/- sampling</strong></p>
<p>Match <code>prior box</code> and <code>GT</code> according to IOU (Jaccard Overlap). </p>
<p>+ prior box  : matching to GT</p>
<p>- prior box : not mathcing to GT</p>
<p>and soft all - prior boxes according to classificatin loss, to control + : -  is around 1 : 3</p>
</li>
<li><p>GT : each GT has it mapping anchor. anchors are mapped into original image to match GT box</p>
<img src="https://tva1.sinaimg.cn/large/006tNbRwly1gams525z5sj30ha0f67ap.jpg" alt="image-20200106133152958" style="zoom:50%;" />
</li>
<li><p>input 300x300, pooling stride 2, thus conv4_3 length is 38, keep all left equals to 19, and final feature-map’s length is 10</p>
</li>
<li><p><strong>Loss</strong></p>
<ul>
<li>loc-loss: smooth-L1 loss as Faster-RCNN</li>
<li>conf-loss: softmax loss for each class</li>
</ul>
</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gampfyf6l8j31200ju46v.jpg" alt="image-20200106115837659"></p>
<p>ref: <a href="https://www.cnblogs.com/xuanyuyt/p/7222867.html" target="_blank" rel="noopener">https://www.cnblogs.com/xuanyuyt/p/7222867.html</a></p>
<hr>
<h3 id="FPN-–-didn’t-dig-into-this-too-much"><a href="#FPN-–-didn’t-dig-into-this-too-much" class="headerlink" title="FPN – didn’t dig into this too much."></a>FPN – didn’t dig into this too much.</h3><h3 id="Focal-Loss"><a href="#Focal-Loss" class="headerlink" title="Focal Loss"></a>Focal Loss</h3><h3 id="Optimization"><a href="#Optimization" class="headerlink" title="Optimization"></a>Optimization</h3><ul>
<li><h3 id="MobileNet"><a href="#MobileNet" class="headerlink" title="MobileNet"></a>MobileNet</h3></li>
<li><p>Explanation:</p>
</li>
</ul>
<h3 id="MobileNet-v2"><a href="#MobileNet-v2" class="headerlink" title="MobileNet v2"></a>MobileNet v2</h3><h3 id="ShuffleNet"><a href="#ShuffleNet" class="headerlink" title="ShuffleNet"></a>ShuffleNet</h3><h3 id="1x1"><a href="#1x1" class="headerlink" title="1x1"></a>1x1</h3><h3 id="ResNet"><a href="#ResNet" class="headerlink" title="ResNet"></a>ResNet</h3><ul>
<li>To solve what problem?</li>
<li>Explanation:</li>
<li>Keywords:<ul>
<li>Downsampling</li>
</ul>
</li>
</ul>
<h3 id="Mask-RCNN"><a href="#Mask-RCNN" class="headerlink" title="Mask RCNN"></a>Mask RCNN</h3><h3 id="RF-Receptive-Field"><a href="#RF-Receptive-Field" class="headerlink" title="RF (Receptive Field)"></a>RF (Receptive Field)</h3><ul>
<li><p>Top-Down (Easy!)</p>
<p>VGG as e.g.</p>
<table>
<thead>
<tr>
<th>Layer</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>1-1</td>
<td>1 + 1x2^1</td>
<td>3</td>
</tr>
<tr>
<td>1-2</td>
<td>1 + 2x2^1</td>
<td>5</td>
</tr>
<tr>
<td>Pooling 1</td>
<td>1 + 2x2^1 + <strong>2^0</strong></td>
<td>6</td>
</tr>
<tr>
<td>2-1</td>
<td>1 + 2x2^1 + <strong>2^0</strong> + 1x2^2</td>
<td>10</td>
</tr>
<tr>
<td>2-2</td>
<td>1 + 2x2^1 + <strong>2^0</strong> + 2x2^2</td>
<td>14</td>
</tr>
<tr>
<td>Pooling 2</td>
<td>1 + 2x2^1 + <strong>2^0</strong> + 2x2^2 + <strong>2^1</strong></td>
<td>16</td>
</tr>
<tr>
<td>3-1</td>
<td>1 + 2x2^1 + <strong>2^0</strong> + 2x2^2 + <strong>2^1</strong> + 1x2^3</td>
<td>24</td>
</tr>
<tr>
<td>3-2</td>
<td>1 + 2x2^1 + <strong>2^0</strong> + 2x2^2 + <strong>2^1</strong> + 2x2^3</td>
<td>32</td>
</tr>
<tr>
<td>3-3</td>
<td>1 + 2x2^1 + <strong>2^0</strong> + 2x2^2 + <strong>2^1</strong> + 3x2^3</td>
<td>40</td>
</tr>
<tr>
<td>Pooling 3</td>
<td>1 + 2x2^1 + <strong>2^0</strong> + 2x2^2 + <strong>2^1</strong> + 3x2^3 + <strong>2^2</strong></td>
<td>44</td>
</tr>
<tr>
<td>4-1</td>
<td>1 + 2x2^1 + <strong>2^0</strong> + 2x2^2 + <strong>2^1</strong> + 3x2^3 + <strong>2^2</strong> + 1x2^4</td>
<td>60</td>
</tr>
<tr>
<td>4-2</td>
<td>1 + 2x2^1 + <strong>2^0</strong> + 2x2^2 + <strong>2^1</strong> + 3x2^3 + <strong>2^2</strong> + 2x2^4</td>
<td>76</td>
</tr>
<tr>
<td>4-3</td>
<td>1 + 2x2^1 + <strong>2^0</strong> + 2x2^2 + <strong>2^1</strong> + 3x2^3 + *<em>2^2 *</em>+ 3x2^4</td>
<td>92</td>
</tr>
<tr>
<td>Pooling 4</td>
<td>1 + 2x2^1 + <strong>2^0</strong> + 2x2^2 + <strong>2^1</strong> + 3x2^3 + <strong>2^2</strong> + 3x2^4 + <strong>2^3</strong></td>
<td>100</td>
</tr>
<tr>
<td>5-1</td>
<td>1 + 2x2^1 + <strong>2^0</strong> + 2x2^2 + <strong>2^1</strong> + 3x2^3 + <strong>2^2</strong> + 3x2^4 + <strong>2^3</strong> + 1x2^5</td>
<td>132</td>
</tr>
<tr>
<td>5-2</td>
<td>1 + 2x2^1 + <strong>2^0</strong> + 2x2^2 + <strong>2^1</strong> + 3x2^3 + <strong>2^2</strong> + 3x2^4 + <strong>2^3</strong> + 2x2^5</td>
<td>164</td>
</tr>
<tr>
<td>5-3</td>
<td>1 + 2x2^1 + <strong>2^0</strong> + 2x2^2 + <strong>2^1</strong> + 3x2^3 + <strong>2^2</strong> + 3x2^4 + <strong>2^3</strong> + 3x2^5</td>
<td>196</td>
</tr>
<tr>
<td>Pooling 5</td>
<td>1 + 2x2^1 + <strong>2^0</strong> + 2x2^2 + <strong>2^1</strong> + 3x2^3 + <strong>2^2</strong> + 3x2^4 + <strong>2^3</strong> + 3x2^5 + <strong>2^4</strong></td>
<td>212</td>
</tr>
</tbody></table>
<p>​    </p>
</li>
<li><p>Bottom Up (Hard..)</p>
</li>
</ul>
<h3 id="Gradient-Vanishing"><a href="#Gradient-Vanishing" class="headerlink" title="Gradient Vanishing"></a>Gradient Vanishing</h3><h3 id="Gradient-Explosion"><a href="#Gradient-Explosion" class="headerlink" title="Gradient Explosion"></a>Gradient Explosion</h3><p>ROI Pooling vs ROI Align</p>
<hr>
<h2 id="Machine-Learning"><a href="#Machine-Learning" class="headerlink" title="Machine Learning"></a>Machine Learning</h2><h3 id="AdaBoost"><a href="#AdaBoost" class="headerlink" title="AdaBoost"></a>AdaBoost</h3><ul>
<li><p>Explanation</p>
<p>The delta btw y_hat and y will be fed into another weak classifier </p>
</li>
</ul>
<h3 id="SVM"><a href="#SVM" class="headerlink" title="SVM"></a>SVM</h3><p><strong>SVM本身是一个二值分类器</strong></p>
<p>　　SVM算法最初是为二值分类问题设计的，当处理多类问题时，就需要构造合适的多类分类器。</p>
<p>　　目前，构造SVM多类分类器的方法主要有两类</p>
<p>　　（1）直接法，直接在目标函数上进行修改，将多个分类面的参数求解合并到一个最优化问题中，通过求解该最优化问题“一次性”实现多类分类。这种方法看似简单，但其计算复杂度比较高，实现起来比较困难，只适合用于小型问题中；</p>
<p>　　（2）间接法，主要是通过组合多个二分类器来实现多分类器的构造，常见的方法有one-against-one和one-against-all两种。</p>
<h3 id="DT"><a href="#DT" class="headerlink" title="DT"></a>DT</h3><p>smaller entropy means less wrongly classified</p>
<ul>
<li><p>ID3 (granually too small), </p>
<p>info gain  = Entropy </p>
</li>
<li><p>C4.5, </p>
</li>
<li><p>CART (binary tree, generally better than previous twos, needs some pruning sometimes)</p>
<p>with gini coefficient</p>
</li>
</ul>
<h2 id="Ensemble"><a href="#Ensemble" class="headerlink" title="Ensemble"></a>Ensemble</h2><h3 id="RF-Random-Forest"><a href="#RF-Random-Forest" class="headerlink" title="RF (Random Forest)"></a>RF (Random Forest)</h3><h3 id="Adaboost"><a href="#Adaboost" class="headerlink" title="Adaboost"></a>Adaboost</h3><ul>
<li><p>Bagging</p>
<p>​    to decrease variance</p>
</li>
<li><p>Boosting </p>
<p>​    to decrease bias</p>
<p>mainly to enhance weak classifier into a strong one. According to the training result from previous classifie, and then train next classifier according to new sample’s distribution.</p>
</li>
<li><p>Adaboost increase wrongly-classifed samples’ weights</p>
</li>
</ul>
<p>Ref: <a href="https://zhuanlan.zhihu.com/p/37358517" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/37358517</a></p>
<hr>
<p>used to eliminate the redundant features</p>
<h3 id="SVM-1"><a href="#SVM-1" class="headerlink" title="SVM"></a>SVM</h3><ul>
<li><p>hinge loss</p>
</li>
<li><p>分类间隔为1/||w||，||w||代表向量的模</p>
</li>
<li><p>当参数C越小时，分类间隔越大，分类错误越多，趋于欠学习</p>
<p>考虑软间隔的时候，C对优化问题的影响就在于把a的范围从[0，+inf]限制到了[0,C]。C越小，那么a就会越小，目标函数拉格朗日函数导数为0可以求出w=求和ai∗yi∗xi，a变小使得w变小，因此间隔2/||w||变大</p>
</li>
</ul>
<h3 id="Decision-Tree"><a href="#Decision-Tree" class="headerlink" title="Decision Tree"></a>Decision Tree</h3><p>copied from : <a href="https://chtseng.wordpress.com/2017/02/10/決策樹-decision-trees/" target="_blank" rel="noopener">https://chtseng.wordpress.com/2017/02/10/%E6%B1%BA%E7%AD%96%E6%A8%B9-decision-trees/</a></p>
<ul>
<li>Entropy definition</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gb23fhkw46j30l710otgs.jpg" alt="image-20200119192602821"></p>
<h2 id="Gini-Index-吉尼係數"><a href="#Gini-Index-吉尼係數" class="headerlink" title="Gini Index (吉尼係數)"></a><strong>Gini Index (吉尼係數)</strong></h2><p>採用GINI Index的代表是CART tree。CART是Classification And Regression Tree的縮寫，從字面上可看出它兼具分類與迴歸兩種功能，同時支援分類(Classification)與數字預測(Regression)，由於不限制應變數與自變數的類型，因此在使用上較具彈性，是目前最為常用的決策樹方法。</p>
<p>GINI係數與INFORMATION GAIN兩者有一個最大的差別：INFORMATION GAIN一次可產生多個不同節點，而GINI係數一次僅能產生兩個，即True或False的Binary分類。</p>
<p>下方一樣以板球為例來說明：（Gini係數公式為p2+q2）</p>
<p><strong>用性別來分類：</strong> </p>
<p><img src="https://chtseng.files.wordpress.com/2017/02/3148_gxdl-o-obg.png?w=1140" alt="img"></p>
<p>Femail節點：十位女性，其中有2位打板球10位不打，Gini係數為<br>(0.2)2+(0.8)2=0.68</p>
<p>Male節點：20位男性，其中有13位打板球7位不打，Gini係數為<br>(0.65)2+(0.35)2=0.55</p>
<p>因此以性別分類的Gini係數加權後為：(10/30)<em>0.68+(20/30)</em>0.55 = 0.59。</p>
<p><strong>用班級來分類：</strong></p>
<p><img src="https://chtseng.files.wordpress.com/2017/02/3148_jsuhhmuveq1.png?w=1140" alt="img"></p>
<p>  Class IX節點：此班14位同學，其中6位打板球8位不打，因此Gini係數為<br>(0.43)2+(0.57)2=0.51</p>
<p>  Class X節點：此班16位同學，其中9位打板球7位不打，因此Gini係數為<br>(0.56)2+(0.44)2=0.51</p>
<p>因此以班級分類的決策樹，其Gini係數加權結果：(14/30)<em>0.51+(16/30)</em>0.51 = 0.51。兩樹相互比較，以性別分類的吉尼係數大於以班級分類，因此系統會採用性別來進行節點的分類。</p>
<h3 id="Naive-Bayes"><a href="#Naive-Bayes" class="headerlink" title="Naive Bayes"></a>Naive Bayes</h3><ul>
<li>特征变量X的各个维度是类别条件独立随机变量</li>
</ul>
<h1 id="決策樹演算法的步驟"><a href="#決策樹演算法的步驟" class="headerlink" title="決策樹演算法的步驟"></a><strong>決策樹演算法的步驟</strong></h1><ol>
<li><strong>資料設定：</strong>將原始資料分成兩組，一部分為訓練資料，一部分為測試資料</li>
<li><strong>決策樹生成：</strong>使用訓練資料來建立決策樹，而在每一個內部節點，則依據屬性選擇指標 (如：資訊理論(Information Theory)…) 來評估選擇哪個屬性做分支的依據。此又稱節點分割 (Splitting Node)</li>
<li><strong>剪枝：</strong>使用測試資料來進行決策樹修剪，將以上1~3步驟不斷重複進行，直到所有的新產生節點都是樹葉節點為止。</li>
</ol>
<p>不過決策樹很容易有「Overfitting（過度擬合）」的問題，因為我們如果沒有對樹的成長作限制，演算法最後就會為每個不同特徵值創建新的分類節點，最後將所有資料作到100%正確的分類，因此為了預防Overfitting，我們會採取下列兩種方式：設限及剪枝。</p>
<h2 id="設限"><a href="#設限" class="headerlink" title="設限"></a><strong>設限</strong></h2><ol>
<li>Minimum samples for a node split：資料數目不得小於多少才能再產生新節點。</li>
<li>Minimum samples for a terminal node (leaf)：要成為葉節點，最少需要多少資料。</li>
<li>Maximum depth of tree (vertical depth)：限制樹的高度最多幾層。</li>
<li>Maximum number of terminal nodes：限制最終葉節點的數目</li>
<li>Maximum features to consider for split：在分離節點時，最多考慮幾種特徵值。</li>
</ol>
<p><img src="https://chtseng.files.wordpress.com/2017/02/3148_vgszibb2dq.png?w=1140" alt="img"></p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gb23urtakpj30g410pdkb.jpg" alt="image-20200119194043890"></p>
<h3 id="Training-Imbalance"><a href="#Training-Imbalance" class="headerlink" title="Training Imbalance"></a>Training Imbalance</h3><ul>
<li><p>Undersampling</p>
</li>
<li><p>Oversampling</p>
</li>
<li><p>SMOTE</p>
</li>
</ul>
<h3 id="Why-Regularization-example"><a href="#Why-Regularization-example" class="headerlink" title="Why Regularization ? example?"></a>Why Regularization ? example?</h3><h3 id="Backward"><a href="#Backward" class="headerlink" title="Backward"></a>Backward</h3><hr>
<h3 id="Comparison"><a href="#Comparison" class="headerlink" title="Comparison:"></a>Comparison:</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gb20p3423tj30kf0b7dhi.jpg" alt="image-20200119175125694"></p>
<h4 id="Contrastive-loss"><a href="#Contrastive-loss" class="headerlink" title="Contrastive loss"></a>Contrastive loss</h4><p>​        2006, Yann LeCun’s paper, mainly adopted for dimension reduction, 即本来相似的样本，在经过降维（特征提取）后，两个样本仍旧相似；而原本不相似的样本，在经过降维后，两个样本仍旧不相似。同样，该损失函数也可以很好的表达成对样本的匹配程度<br>​        F = kX, as SPRING model</p>
<h4 id="Triplet-loss"><a href="#Triplet-loss" class="headerlink" title="Triplet loss"></a>Triplet loss</h4><p>​        2015, Google</p>
<p>​        三元组损失：最小化锚点和具有相同的身份的正例之间的距离，并最大化锚点和不同身份的负例之间的距离。 目标： 相同标签的两个示例使其嵌入在嵌入空间中靠近在一起，不同标签的两个示例的嵌入距离要很远 但不希望推动每个标签的训练嵌入到非常小的簇中。 唯一的要求是给出同一类的两个正例和一个负例，负例应该比正例的距离至少远margin。 这与SVM中使用的margin非常相似，这里希望每个类的簇由margin分隔。        </p>
<p>​    <strong>Triplet的选取</strong></p>
<ul>
<li><p>如何选择triplet，如何用正负例构建triplet，对模型训练的效率有很大影响。easy negative example比较容易识别，没必要训练，否则会严重降低训练效率。若都采用hard negative example，又可能会影响训练效果。</p>
</li>
<li><p>Facenet论文中采用了随机的semi-hard negative构建triplet进行训练。</p>
</li>
<li><p>基于negative example与anchor和positive距离，分为三类三元组：</p>
</li>
<li><ul>
<li>容易三元组(easy triplets)：损失为0的三元组，因为d(a,n)&gt;d(a,p)+margin</li>
<li>困难三元组(hard triplets) ：其中负例比正例更靠近锚点，即d(a,n)&lt;d(a,p)</li>
<li>半困难三元组(semi-hard triplets)：其中负例不比正例更接近锚点，但仍有大于0的损失，d(a,p)&lt;d(a,n)&lt;d(a,p)+margin</li>
</ul>
</li>
</ul>
<h4 id="Center-loss"><a href="#Center-loss" class="headerlink" title="Center loss"></a>Center loss</h4><p>Center Loss源于深圳先研院乔宇、Yandong Wen等在ECCV 2016上发表的 <a href="https://link.zhihu.com/?target=http%3A//ydwen.github.io/papers/WenECCV16.pdf">A Discriminative Feature Learning Approach for Deep Face Recognition</a>。<br><strong>判别性</strong></p>
<ul>
<li>深度学习的特征需要具有discriminative(判别性)和泛化能力，以便在没有标签预测的情况下识别新的未见类别，如一个人脸即便没有训练过也能判断类别。判别性同时表征了紧凑的类内差异和可分离的类间差异。</li>
<li>判别性特征可以通过最近邻（NN）或k近邻（k-NN）算法进行良好分类，其不一定取决于标签预测。</li>
<li>而softmax损失仅鼓励特征的可分离性，所得到的特征对于人脸识别不是足够有效的。</li>
<li>对比损失和三元组损失分别构成图像对和三元组的损失函数，然而与原样本相比，训练对或三元组的数量急剧增加，导致了网络收敛缓慢。</li>
</ul>
<p><strong>中心损失的定义</strong></p>
<ul>
<li>中心损失：为每一个类别提供一个类别中心，最小化min-batch中每个样本与该类别中心的距离，即缩小类内距离。</li>
<li>有效地表征了深度特征的类内距离，提升深度特征的判别能力，在保持不同类别的特征可分离的同时最小化类内距离是关键。公式如下，c_yi就是第yi个类别的特征中心，xi表示全连接层之前的特征，m表示mini-batch的大小</li>
</ul>
<h4 id="ArcFace-loss"><a href="#ArcFace-loss" class="headerlink" title="ArcFace loss"></a>ArcFace loss</h4><ul>
<li><p>性能高，易于编程实现，复杂性低，训练效率高</p>
</li>
<li><p>ArcFace直接优化geodesic distance margin(弧度)，因为归一化超球体中的角和弧度的对应。</p>
</li>
<li><p>为了性能的稳定，ArcFace不需要与其他loss函数实现联合监督，可以很容易地收敛于任何训练数据集。</p>
</li>
<li><p>缺点：W模型很大</p>
</li>
</ul>
<h3 id="GAN"><a href="#GAN" class="headerlink" title="GAN"></a>GAN</h3><ul>
<li>metric</li>
</ul>
<h3 id="seq2seq"><a href="#seq2seq" class="headerlink" title="seq2seq"></a>seq2seq</h3><p><em>Ilya Sutskever, Oriol Vinyals, Quoc V. Le, 2014, “Sequence to Sequence Learning with Neural Networks,” pp. 3104–311 in NIPS 2014</em></p>
<p>Take AlexNet for example, by eliminating softmax, we’ll be able to extract a 4096 dimension embedding.</p>
<p>Now, feed the vector into RNN, as what language translation does, it’ll generate a output sequence, the CAPTION for the image.</p>
<ul>
<li><h5 id="ImageTOseq"><a href="#ImageTOseq" class="headerlink" title="ImageTOseq"></a>ImageTOseq</h5><p>Image Caption, mean</p>
<p><em>Deep Captioning with Multimodal Recurrent Neural Networks (m-RNN) – ICLR2015, San Diego</em><br><em>by Junua Mao</em></p>
<p>Meanwhile, Oriol Vinyals, (Andrej, Fei-Fei Li) also acquired the similar conclusion.</p>
</li>
</ul>
<p>After obtaining this vector, decoder part of the network starts its processing with this fixed vector representation and at <strong>each time step of the decoder network it produces outputs</strong>. <strong>Operation stops when a special token</strong> showing the end of the sentence is produced. Distributed representations of the words are used as inputs to the encoder network. At the output side at each time step, a Word is chosen from a specific vocabulary list. At the decoder side, after decoder part a classifier network is used to produce a Word from the output at each time step. <strong>LSTM networks are used in this paper due to their capability of capturing long term relationships</strong>. Paper also shows experiments on machine translation task, which is from English to French. Simulation results reveal that presented approach outperforms existing studies.</p>
<h3 id="Attention"><a href="#Attention" class="headerlink" title="Attention"></a>Attention</h3><p>The Encoder + Decoder mechanism based on RNN (LSTM or GRU). </p>
<p>For Image caption, it explains different region afftectin the output text series BY</p>
<p>weighing differently in X and therefore extracts important info for model making more precies judgement.</p>
<p><a href="https://zhuanlan.zhihu.com/p/31547842" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/31547842</a></p>
<h3 id="Saliency-Detection"><a href="#Saliency-Detection" class="headerlink" title="Saliency Detection"></a>Saliency Detection</h3><p>The region within the image where user most care about.</p>
<p>![image-20200119174713586](/Users/joe/Library/Application Support/typora-user-images/image-20200119174713586.png)</p>
<h3 id="Reason-of-LR-as-Linear"><a href="#Reason-of-LR-as-Linear" class="headerlink" title="Reason of LR as Linear"></a>Reason of LR as Linear</h3><p>有人說，因為邏輯迴歸不是線性的，這個說法是不對的！因為我們可以把邏輯回歸的模型轉成線性的形式如下：</p>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcx9msq25oj311a0b6411.jpg" alt="螢幕快照 2017-12-22 上午12.41.33"></p>
<p>主要原因很簡單，因為迴歸分析中 <img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcx9mt6yxrj300o00n08d.jpg" alt="Y"> 是已經觀察到的資料，可是邏輯迴歸中 <img src="https://s0.wp.com/latex.php?zoom=2&latex=P%28Y%3D1%7CX%29&bg=ffffff&fg=000&s=0" alt="P(https://tva1.sinaimg.cn/large/00831rSTgy1gcx9mo7366j301q00y0fi.jpg)"> 是資料裡面無法觀察到的，所以我們就沒辦法用傳統的最小平方法估計，而要採用最大概似法 (Maximum Likelihood Estimation)。至於最大概似法的原理是什麼，可以用下面這張圖很清楚的解釋。</p>
<h3 id="关于logit-回归和SVM-不正确的是（A）-机器学习-ML模型-中"><a href="#关于logit-回归和SVM-不正确的是（A）-机器学习-ML模型-中" class="headerlink" title="关于logit 回归和SVM 不正确的是（A） 机器学习 ML模型 中"></a>关于logit 回归和SVM 不正确的是（A） 机器学习 ML模型 中</h3><p>A. Logit回归本质上是一种根据样本对权值进行极大似然估计的方法，而后验概率正比于先验概率和似然函数的乘积。logit仅仅是最大化似然函数，并没有最大化后验概率，更谈不上最小化后验概率。<strong>A错误</strong><br>B. Logit回归的输出就是样本属于正类别的几率，可以计算出概率，正确<br>C. SVM的目标是找到使得训练数据尽可能分开且分类间隔最大的超平面，应该属于结构风险最小化。<br>D. SVM可以通过正则化系数控制模型的复杂度，避免过拟合。<br>@BlackEyes_SGC：<strong>Logit回归目标函数是最小化后验概率，Logit回归可以用于预测事件发生概率的大小，</strong>SVM目标是结构风险最小化，SVM可以有效避免模型过拟合。</p>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcx9mu07mkj314s0u0tjz.jpg" alt="螢幕快照 2017-12-22 上午12.44.31"></p>
<h3 id="为什么xgboost要用泰勒展开，优势在哪里？机器学习-ML模型-难"><a href="#为什么xgboost要用泰勒展开，优势在哪里？机器学习-ML模型-难" class="headerlink" title="为什么xgboost要用泰勒展开，优势在哪里？机器学习 ML模型 难"></a>为什么xgboost要用泰勒展开，优势在哪里？机器学习 ML模型 难</h3><p>@AntZ：xgboost使用了一阶和二阶偏导, 二阶导数有利于梯度下降的更快更准. 使用泰勒展开取得函数做自变量的二阶导数形式, 可以在不选定损失函数具体形式的情况下, 仅仅依靠输入数据的值就可以进行叶子分裂优化计算, 本质上也就把损失函数的选取和模型算法优化/参数选择分开了. 这种去耦合增加了xgboost的适用性, 使得它按需选取损失函数, 可以用于分类, 也可以用于回归。<br>————————————————<br>版权声明：本文为CSDN博主「v_JULY_v」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/v_JULY_v/article/details/78121924" target="_blank" rel="noopener">https://blog.csdn.net/v_JULY_v/article/details/78121924</a> </p>
<h3 id="L1和L2正则先验分别服从什么分布。机器学习-ML基础-易"><a href="#L1和L2正则先验分别服从什么分布。机器学习-ML基础-易" class="headerlink" title="L1和L2正则先验分别服从什么分布。机器学习 ML基础 易"></a>L1和L2正则先验分别服从什么分布。机器学习 ML基础 易</h3><ul>
<li>L1和L2正则先验分别服从什么分布，L1是拉普拉斯分布，L2是高斯分布。</li>
<li>先验就是优化的起跑线, 有先验的好处就是可以在较小的数据集中有良好的泛化性能，当然这是在先验分布是接近真实分布的情况下得到的了，从信息论的角度看，向系统加入了正确先验这个信息，肯定会提高系统的性能。<br>对参数引入高斯正态先验分布相当于L2正则化, 这个大家都熟悉：</li>
</ul>
<h3 id="How-to-choose-K-for-K-Means-Clustering"><a href="#How-to-choose-K-for-K-Means-Clustering" class="headerlink" title="How to choose K for K-Means Clustering"></a>How to choose K for K-Means Clustering</h3><ul>
<li>sqrt(n/2) – bad</li>
<li>elbow method - Y-axis means sum(square errors)</li>
</ul>
<p><a href="https://rpubs.com/skydome20/R-Note9-Clustering" target="_blank" rel="noopener">https://rpubs.com/skydome20/R-Note9-Clustering</a></p>
<p><a href="https://www.biaodianfu.com/k-means-choose-k.html" target="_blank" rel="noopener">https://www.biaodianfu.com/k-means-choose-k.html</a></p>
<h3 id="How-to-choose-K-for-kNN"><a href="#How-to-choose-K-for-kNN" class="headerlink" title="How to choose K for kNN"></a>How to choose K for kNN</h3><ul>
<li>CV error might rise after a specific lowest value of K</li>
</ul>
<p>如果选择较小的K值，就相当于用较小的领域中的训练实例进行预测，“学习”近似误差会减小，只有与输入实例较近或相似的训练实例才会对预测结果起作用，与此同时带来的问题是“学习”的估计误差会增大，换句话说，K值的减小就意味着整体模型变得复杂，容易发生过拟合；<br>如果选择较大的K值，就相当于用较大领域中的训练实例进行预测，其优点是可以减少学习的估计误差，但缺点是学习的近似误差会增大。这时候，与输入实例较远（不相似的）训练实例也会对预测器作用，使预测发生错误，且K值的增大就意味着整体的模型变得简单。<br>K=N，则完全不足取，因为此时无论输入实例是什么，都只是简单的预测它属于在训练实例中最多的累，模型过于简单，忽略了训练实例中大量有用信息。<br>    在实际应用中，K值一般取一个比较小的数值，例如采用交叉验证法（简单来说，就是一部分样本做训练集，一部分做测试集）来选择最优的K值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">K = <span class="number">10</span></span><br><span class="line">batch_size = <span class="number">16</span></span><br><span class="line">epochs = <span class="number">100</span></span><br><span class="line">error_histories = []</span><br><span class="line">num_val_samples = len(train_data) // K</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(K):</span><br><span class="line">    print(<span class="string">'Processing fold #'</span>, i)</span><br><span class="line">    val_data = train_data[i*num_val_samples : (i+<span class="number">1</span>)*num_val_samples]</span><br><span class="line">    val_targets = train_targets[i*num_val_samples : (i+<span class="number">1</span>)*num_val_samples]</span><br><span class="line">    </span><br><span class="line">    partial_train_data = np.concatenate( </span><br><span class="line">                         [train_data[: i*num_val_samples],</span><br><span class="line">                         train_data[(i+<span class="number">1</span>)*num_val_samples :]],</span><br><span class="line">                         axis = <span class="number">0</span>)</span><br><span class="line">    partial_train_targets = np.concatenate(</span><br><span class="line">                         [train_targets[: i*num_val_samples],</span><br><span class="line">                         train_targets[(i+<span class="number">1</span>)*num_val_samples :]],</span><br><span class="line">                         axis = <span class="number">0</span>)</span><br><span class="line">    model = build_model()</span><br><span class="line">    history = model.fit(partial_train_data,</span><br><span class="line">                        partial_train_targets,</span><br><span class="line">                        validation_data = (val_data, val_targets),</span><br><span class="line">                        epochs = epochs,</span><br><span class="line">                        batch_size = batch_size,</span><br><span class="line">                        verbose = <span class="number">1</span>)</span><br><span class="line">    mae_history = history.history[<span class="string">'val_mean_absolute_error'</span>]</span><br><span class="line">    error_histories.append(mae_history)</span><br><span class="line">    average_error = [ np.mean([x[i] <span class="keyword">for</span> x <span class="keyword">in</span> error_histories]) <span class="keyword">for</span> i <span class="keyword">in</span> range(epochs)]</span><br><span class="line"></span><br><span class="line">fr: </span><br><span class="line">  https://jason-chen<span class="number">-1992.</span>weebly.com/home/-cross-validation</span><br></pre></td></tr></table></figure>



<h3 id="防止过拟合"><a href="#防止过拟合" class="headerlink" title="防止过拟合,"></a>防止过拟合,</h3><p>　　过拟合的原因是算法的学习能力过强；一些假设条件（如样本独立同分布）可能是不成立的；训练样本过少不能对整个空间进行分布估计。<br>　　处理方法：</p>
<p>早停止：如在训练中多次迭代后发现模型性能没有显著提高就停止训练<br>数据集扩增：原有数据增加、原有数据加随机噪声、重采样<br>正则化<br>交叉验证<br>特征选择/特征降维<br>创建一个验证集是最基本的防止过拟合的方法。我们最终训练得到的模型目标是要在验证集上面有好的表现，而不训练集。<br>正则化可以限制模型的复杂度。</p>
<p>在训练中，我们希望在中间箭头的位置停止训练。而Early stopping就可以实现该功能，这时获得的模型泛化能力较强，还可以得到一个中等大小的w的弗罗贝尼乌斯范数。其与L2正则化相似，选择参数w范数较小的神经网络。</p>
<p>可以用L2正则化代替early stopping。因为只要训练的时间足够长，多试几个lambda。总可以得到比较好的结果。</p>
<h3 id="Early-stopping"><a href="#Early-stopping" class="headerlink" title="Early stopping:"></a>Early stopping:</h3><p>优点：只运行一次梯度下降，我们就可以找出w的较小值，中间值和较大值。而无需尝试L2正则化超级参数lambda的很多值。</p>
<p>缺点：不能独立地处理以上两个问题，使得要考虑的东西变得复杂。举例如下：</p>
<p>一般机器学习的步骤分为以上两步，第一步我们确定一个成本函数J，然后可以用梯度下降等方法去优化它；第二步我们不希望模型发生过拟合，就有正则化等方式去操作，这是一个动态的过程。但是如果采用early stopping，这就相当于用一种方式来控制两个问题的结束，这会使得问题变得复杂。如图一所示，在中间位置时，模型已经停止训练了，而成本函数还没有下降到合适的区域。</p>
<h3 id="AUC"><a href="#AUC" class="headerlink" title="AUC"></a>AUC</h3><p>二階混淆矩陣</p>
<p>有了混淆矩陣，就可以定義<strong>ROC</strong>曲線了。<strong>ROC</strong>曲線將假陽性率（FPR）定義為 X 軸，真陽性率（TPR）定義為 Y 軸。其中：</p>
<ul>
<li>TPR：在所有實際為陽性的樣本中，被正確地判斷為陽性的樣本比率。</li>
<li>FPR：在所有實際為陰性的樣本中，被錯誤地判斷為陽性的樣本比率。</li>
<li>TPR = TP / (TP + FN)</li>
<li>FPR = FP / (FP + TN)</li>
<li><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcydclzpf2j30hs0csdgb.jpg" alt="img" style="zoom:50%;" />

</li>
</ul>
<h3 id="ML-Flow"><a href="#ML-Flow" class="headerlink" title="ML Flow"></a>ML Flow</h3><p>Abstract as math problem -&gt; acquire data, pca … -&gt; feature selection -&gt; train &amp; optimize model -&gt; analyze model -&gt; deploy (time complexity, resource consumption, stability)</p>
<h3 id="Linear-vs-Non-linear-classifiers"><a href="#Linear-vs-Non-linear-classifiers" class="headerlink" title="Linear vs Non-linear classifiers"></a>Linear vs Non-linear classifiers</h3><p>非线性分类器效果拟合能力较强，不足之处是数据量不足容易过拟合、计算复杂度高、可解释性不好。<br>常见的线性分类器有：LR,贝叶斯分类，单层感知机、线性回归<br>常见的非线性分类器：决策树、RF、GBDT、多层感知机<br>SVM两种都有（看线性核还是高斯核）</p>
<h3 id="参数初始化"><a href="#参数初始化" class="headerlink" title="参数初始化"></a>参数初始化</h3><p>下面几种方式,随便选一个,结果基本都差不多。但是一定要做。否则可能会减慢收敛速度，影响收敛结果，甚至造成Nan等一系列问题。</p>
<p>下面的n_in为网络的输入大小，n_out为网络的输出大小，n为n_in或(n_in+n_out)*0.5</p>
<p>Xavier初始法论文：<a href="http://jmlr.org/proceedings/papers/v9/glorot10a/glorot10a.pdf" target="_blank" rel="noopener">http://jmlr.org/proceedings/papers/v9/glorot10a/glorot10a.pdf</a></p>
<p>He初始化论文：<a href="https://arxiv.org/abs/1502.01852" target="_blank" rel="noopener">https://arxiv.org/abs/1502.01852</a><br>————————————————<br>版权声明：本文为CSDN博主「v_JULY_v」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/v_JULY_v/article/details/78121924" target="_blank" rel="noopener">https://blog.csdn.net/v_JULY_v/article/details/78121924</a></p>
<h3 id="k-d-tree"><a href="#k-d-tree" class="headerlink" title="k-d tree"></a>k-d tree</h3><h3 id="Ave-Pooling"><a href="#Ave-Pooling" class="headerlink" title="Ave Pooling"></a>Ave Pooling</h3><p>但是average-pooling在全局平均池化操作中应用也比较广，在ResNet和Inception结构中最后一层都使用了平均池化。有的时候在模型接近分类器的末端使用全局平均池化还可以代替Flatten操作，使输入数据变成一位向量。</p>
<h3 id="Newton’s-method-for-Optimization"><a href="#Newton’s-method-for-Optimization" class="headerlink" title="Newton’s method for Optimization"></a>Newton’s method for Optimization</h3><p>牛顿法的优缺点总结：</p>
<p>优点：二阶收敛，收敛速度快；</p>
<p>缺点：牛顿法是一种迭代算法，每一步都需要求解目标函数的Hessian矩阵的逆矩阵，计算比较复杂。</p>
<p>什么是拟牛顿法（Quasi-Newton Methods）？机器学习 ML基础 中</p>
<p>@wtq1993，<a href="http://blog.csdn.net/wtq1993/article/details/51607040" target="_blank" rel="noopener">http://blog.csdn.net/wtq1993/article/details/51607040</a><br>拟牛顿法是求解非线性优化问题最有效的方法之一，于20世纪50年代由美国Argonne国家实验室的物理学家W.C.Davidon所提出来。Davidon设计的这种算法在当时看来是非线性优化领域最具创造性的发明之一。不久R. Fletcher和M. J. D. Powell证实了这种新的算法远比其他方法快速和可靠，使得非线性优化这门学科在一夜之间突飞猛进。</p>
<p>拟牛顿法的本质思想是改善牛顿法每次需要求解复杂的Hessian矩阵的逆矩阵的缺陷，它使用正定矩阵来近似Hessian矩阵的逆，从而简化了运算的复杂度。拟牛顿法和最速下降法一样只要求每一步迭代时知道目标函数的梯度。通过测量梯度的变化，构造一个目标函数的模型使之足以产生超线性收敛性。这类方法大大优于最速下降法，尤其对于困难的问题。另外，因为拟牛顿法不需要二阶导数的信息，所以有时比牛顿法更为有效。如今，优化软件中包含了大量的拟牛顿算法用来解决无约束，约束，和大规模的优化问题。</p>
<h3 id="共轭梯度法？"><a href="#共轭梯度法？" class="headerlink" title="共轭梯度法？"></a>共轭梯度法？</h3><p>​    共轭梯度法是介于梯度下降法（最速下降法）与牛顿法之间的一个方法，它仅需利用一阶导数信息，但克服了梯度下降法收敛慢的缺点，又避免了牛顿法需要存储和计算Hessian矩阵并求逆的缺点，共轭梯度法不仅是解决大型线性方程组最有用的方法之一，也是解大型非线性最优化最有效的算法之一。在各种优化算法中，共轭梯度法是非常重要的一种。其优点是所需存储量小，具有逐步收敛性，稳定性高，而且不需要任何外来参数。</p>
<h3 id="直觀理解正定、半正定矩陣-positive-definite和positive-semi-definite"><a href="#直觀理解正定、半正定矩陣-positive-definite和positive-semi-definite" class="headerlink" title="直觀理解正定、半正定矩陣　positive definite和positive semi-definite:"></a>直觀理解正定、半正定矩陣　positive definite和positive semi-definite:</h3><p>半正定与正定矩阵同意用半正定矩阵来事例：<br>首先半正定矩阵定义为: <img src="https://www.zhihu.com/equation?tex=X%5ETMX+%5Cgeq+0" alt="[公式]"><br>其中X 是向量，M 是变换矩阵</p>
<p>我们换一个思路看这个问题，矩阵变换中，<img src="https://www.zhihu.com/equation?tex=MX" alt="[公式]">代表对向量 X进行变换，我们假设变换后的向量为Y，记做<img src="https://www.zhihu.com/equation?tex=Y%3DMX" alt="[公式]">。于是半正定矩阵可以写成：<br><img src="https://www.zhihu.com/equation?tex=X%5ETY+%5Cgeq+0" alt="[公式]"></p>
<p>这个是不是很熟悉呢？ 他是两个向量的内积。 同时我们也有公式：</p>
<p><img src="https://www.zhihu.com/equation?tex=cos(%5Ctheta)+%3D+%5Cfrac%7BX%5ETY%7D%7B%7C%7CX%7C%7C*+%7C%7CY%7C%7C%7D" alt="[公式]"></p>
<p>||X||, ||Y||代表向量 X,Y的长度，<img src="https://www.zhihu.com/equation?tex=%5Ctheta" alt="[公式]">是他们之间的夹角。 于是半正定矩阵意味着<img src="https://www.zhihu.com/equation?tex=cos(%5Ctheta)%5Cgeq+0" alt="[公式]">, 这下明白了么？</p>
<p>正定、半正定矩阵的直觉代表一个向量经过它的变化后的向量与其本身的夹角小于等于90度。</p>
<h3 id="GAN-1"><a href="#GAN-1" class="headerlink" title="GAN"></a>GAN</h3><h3 id="Convolutinon-實現"><a href="#Convolutinon-實現" class="headerlink" title="Convolutinon 實現"></a>Convolutinon 實現</h3><p>img2col</p>
<p>note: <a href="https://zhuanlan.zhihu.com/p/63974249" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/63974249</a></p>
<h3 id="随机森林如何处理缺失值？"><a href="#随机森林如何处理缺失值？" class="headerlink" title="随机森林如何处理缺失值？"></a>随机森林如何处理缺失值？</h3><p>方法一（na.roughfix）简单粗暴，对于训练集,同一个class下的数据，如果是分类变量缺失，用众数补上，如果是连续型变量缺失，用中位数补。<br>方法二（rfImpute）这个方法计算量大，至于比方法一好坏？不好判断。先用na.roughfix补上缺失值，然后构建森林并计算proximity matrix，再回头看缺失值，如果是分类变量，则用没有缺失的观测实例的proximity中的权重进行投票。如果是连续型变量，则用proximity矩阵进行加权平均的方法补缺失值。然后迭代4-6次，这个补缺失值的思想和KNN有些类似12。</p>
<h3 id="Why-Smooth-L1-in-Faster-amp-SSD"><a href="#Why-Smooth-L1-in-Faster-amp-SSD" class="headerlink" title="Why Smooth-L1 in Faster &amp; SSD?"></a>Why Smooth-L1 in Faster &amp; SSD?</h3><h3 id="LSTM"><a href="#LSTM" class="headerlink" title="LSTM"></a>LSTM</h3></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/12/CVs/2019-12-12-Problems%20Collection%20from%20EGN/">CVs/2019-12-12-Problems Collection from EGN</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-12</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/DevOps/">DevOps</a></span><div class="content"><h3 id="LC-46-Permutation"><a href="#LC-46-Permutation" class="headerlink" title="LC 46 - Permutation"></a>LC 46 - Permutation</h3></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/12/NLP/2019-12-12-NLP%20metric%20%3E%20Perplexity/">NLP/2019-12-12-NLP metric &gt; Perplexity</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-12</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/NLP-AI/">NLP, AI</a></span><div class="content"><p>from : <a href="https://blog.csdn.net/index20001/article/details/78884646" target="_blank" rel="noopener">https://blog.csdn.net/index20001/article/details/78884646</a></p>
<h1 id="语言模型评价指标Perplexity"><a href="#语言模型评价指标Perplexity" class="headerlink" title="语言模型评价指标Perplexity"></a>语言模型评价指标Perplexity</h1><p>原创<a href="https://me.csdn.net/index20001" target="_blank" rel="noopener">Joy_Shen</a> 发布于2017-12-24 13:33:02 阅读数 26576 收藏</p>
<p>展开</p>
<p>语言模型（Language Model，LM），给出一句话的前k个词，希望它可以预测第k+1个词是什么，即给出一个第k+1个词可能出现的概率的分布p(xk+1|x1,x2,…,xk)。</p>
<p>在报告里听到用PPL衡量语言模型收敛情况，于是从公式角度来理解一下该指标的意义。</p>
<h2 id="Perplexity定义"><a href="#Perplexity定义" class="headerlink" title="Perplexity定义"></a>Perplexity定义</h2><p>PPL是用在自然语言处理领域（NLP）中，衡量语言模型好坏的指标。它主要是根据每个词来估计一句话出现的概率，并用句子长度作normalize，公式为</p>
<p><img src="https://img-blog.csdn.net/20171224134258243" alt="img"></p>
<p>S代表sentence，N是句子长度，p(wi)是第i个词的概率。第一个词就是 p(w1|w0)，而w0是START，表示句子的起始，是个占位符。</p>
<p>这个式子可以这样理解，PPL越小，p(wi)则越大，一句我们期望的sentence出现的概率就越高。</p>
<p>还有人说，Perplexity可以认为是average branch factor（平均分支系数），即预测下一个词时可以有多少种选择。别人在作报告时说模型的PPL下降到90，可以直观地理解为，在模型生成一句话时下一个词有90个合理选择，可选词数越少，我们大致认为模型越准确。这样也能解释，为什么PPL越小，模型越好。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/12/NLP/2019-12-12-LSTM%20Brief.%20&amp;%20Hamming%20Loss/">NLP/2019-12-12-LSTM Brief. &amp; Hamming Loss</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-12</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/NLP-AI/">NLP, AI</a></span><div class="content"><h3 id="LSTM-Brief"><a href="#LSTM-Brief" class="headerlink" title="LSTM Brief."></a>LSTM Brief.</h3><p>LSTM是SimpleRNN的变体，它解决了梯度消失的问题。怎么解决的那？</p>
<p>LSTM增加了一个可以相隔多个timesteps来传递信息的方法。想想有一个传送带在你处理sequences时一起运转。每个时间节点的信息都可以放到传送带上，或者从传送带上拿下来，当然你也可以更新传送带上的信息。这样就保存了很久之前的信息，防止了信息的丢失。我们把SimpleRNN中的矩阵记为<code>Wo Uo bo</code>，LSTM的结构图如下：</p>
<p><img src="https://pic4.zhimg.com/80/v2-31da92629c2ddbb0a3971d18f1592b03_hd.jpg" alt="img"></p>
<p>我们在SimpleRNN基础上，增加一条传送带（adding a carry track）用来传递信息。传送带上每个时刻的状态我们记为：<code>c t</code> c是carry的意思。</p>
<p>显然，当前时刻的输出就应该收到三个信息的影响</p>
<hr>
<h3 id="Hamming-Distance"><a href="#Hamming-Distance" class="headerlink" title="Hamming Distance"></a>Hamming Distance</h3><p>在<a href="https://zh.wikipedia.org/wiki/信息论" target="_blank" rel="noopener">資訊理論</a>中，兩個等長<a href="https://zh.wikipedia.org/wiki/字符串" target="_blank" rel="noopener">字符串</a>之間的<strong>漢明距離</strong>（英語：Hamming distance）是兩個字符串對應位置的不同字符的個數。換句話說，它就是將一個字符串變換成另外一個字符串所需要<em>替換</em>的字符個數。</p>
<p><strong><a href="https://zh.wikipedia.org/wiki/汉明重量" target="_blank" rel="noopener">漢明重量</a></strong>是字符串相對於同樣長度的零字符串的漢明距離，也就是說，它是字符串中非零的元素個數：對於<a href="https://zh.wikipedia.org/wiki/二进制" target="_blank" rel="noopener">二進位</a><a href="https://zh.wikipedia.org/wiki/字符串" target="_blank" rel="noopener">字符串</a>來說，就是1的個數，所以11101的漢明重量是4。</p>
<p>例如：</p>
<ul>
<li><strong>1011101</strong>與<strong>1001001</strong>之間的漢明距離是2。</li>
<li><strong>2143896</strong>與<strong>2233796</strong>之間的漢明距離是3。</li>
<li>“<strong>toned</strong>“與”<strong>roses</strong>“之間的漢明距離是3。</li>
</ul>
<hr>
<h3 id="Hamming-Loss"><a href="#Hamming-Loss" class="headerlink" title="Hamming Loss"></a>Hamming Loss</h3><p>Hamming Loss 是用来计算多标签分类(Multi-label classification)模型精度的。</p>
<p>HammingLoss=1N∑i=1NXOR(Yi,j,Pi,j)LHammingLoss=1N∑i=1NXOR(Yi,j,Pi,j)L</p>
<p>NN是样本的数量，LL是标签的个数，Yi,jYi,j是第ii个预测结果中第jj个分量的真实值，Pi,jPi,j是第ii个预测结果中第jj个分量的预测值，XORXOR是抑或，XOR(0,1)=XOR(1,0)=1XOR(0,1)=XOR(1,0)=1，XOR(0,0)=XOR(1,1)=0XOR(0,0)=XOR(1,1)=0。</p>
<p>例子：三个样本</p>
<p>Y1=(0,1,1,1,0),P1=(1,1,1,0,0)Y1=(0,1,1,1,0),P1=(1,1,1,0,0)</p>
<p>Y2=(1,0,0,1,1),P2=(1,0,0,0,1)Y2=(1,0,0,1,1),P2=(1,0,0,0,1)</p>
<p>Y3=(1,1,0,0,0),P3=(1,0,1,0,1)Y3=(1,1,0,0,0),P3=(1,0,1,0,1)<br>$$<br>HammingLoss=\frac{1}{3}×\frac{2+1+3}{5}=0.4<br>$$</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/12/Python/2019-12-12-Design%20Prototype/">Python/2019-12-12-Design Prototype</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-12</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Design/">Design</a></span><div class="content"><h3 id="Axure"><a href="#Axure" class="headerlink" title="Axure"></a>Axure</h3></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/12/Python/2019-12-12-MapReduce/">Python/2019-12-12-MapReduce</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-12</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/BigData-Python/">BigData, Python</a></span><div class="content"><p>Ref: <a href="https://zhuanlan.zhihu.com/p/62135686" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/62135686</a></p>
<h1 id="Ref1"><a href="#Ref1" class="headerlink" title="Ref1"></a>Ref1</h1><h2 id="一、MapReduce是什么"><a href="#一、MapReduce是什么" class="headerlink" title="一、MapReduce是什么"></a>一、MapReduce是什么</h2><ol>
<li>MapReduce是一种分布式计算框架 ，以一种可靠的，具有容错能力的方式并行地处理上TB级别的海量数据集。主要用于搜索领域，解决海量数据的计算问题。</li>
<li>MR有两个阶段组成：Map和Reduce，用户只需实现map()和reduce()两个函数，即可实现分布式计算。</li>
</ol>
<h2 id="二、MapReduce做什么"><a href="#二、MapReduce做什么" class="headerlink" title="二、MapReduce做什么"></a>二、MapReduce做什么</h2><ol>
<li>MapReduce框架由Map和Reduce组成。</li>
<li>Map()负责把一个大的block块进行切片并计算。</li>
<li>Reduce() 负责把Map()切片的数据进行汇总、计算。</li>
</ol>
<h2 id="三、MapReduce怎么做"><a href="#三、MapReduce怎么做" class="headerlink" title="三、MapReduce怎么做"></a>三、MapReduce怎么做</h2><p><img src="https://pic1.zhimg.com/80/v2-956054759aea4352a795452e31754ef0_hd.jpg" alt="img"></p>
<ol>
<li>第一步对输入的数据进行切片，每个切片分配一个map()任务，map()对其中的数据进行计算，对每个数据用键值对的形式记录，然后输出到环形缓冲区（图中sort的位置）。</li>
<li>map（）中输出的数据在环形缓冲区内进行快排，每个环形缓冲区默认大小100M，当数据达到80M时（默认），把数据输出到磁盘上。形成很多个内部有序整体无序的小文件。</li>
<li>框架把磁盘中的小文件传到Reduce()中来，然后进行归并排序，最终输出。</li>
</ol>
<h2 id="四、要点是什么"><a href="#四、要点是什么" class="headerlink" title="四、要点是什么"></a>四、要点是什么</h2><ol>
<li>MapReduce将输入的数据进行逻辑切片，一片对应一个Map任务</li>
<li>Map以并行的方式处理切片</li>
<li>框架对Map输出进行排序，然后发给Reduce</li>
<li>MapReduce的输入输出数据处于同一个文件系统（HDFS）</li>
<li>框架负责任务调度、任务监控、失败任务的重新执行</li>
<li>框架会对键和值进行序列化，因此键和值需要实现writable接口，框架会对键排序，因此必须实现writableComparable接口。</li>
</ol>
<h2 id="五、MapReduce原语"><a href="#五、MapReduce原语" class="headerlink" title="五、MapReduce原语"></a>五、MapReduce原语</h2><p>MapReduce原语：“相同”key的键值对为一组调用一次Reduce方法，方法内迭代这组数据进行计算。</p>
<h1 id="Ref2"><a href="#Ref2" class="headerlink" title="Ref2"></a>Ref2</h1><p><a href="https://www.jianshu.com/p/6b6a42a0740c" target="_blank" rel="noopener">https://www.jianshu.com/p/6b6a42a0740c</a></p>
<h5 id="1-mapreduce-简介"><a href="#1-mapreduce-简介" class="headerlink" title="1. mapreduce 简介"></a>1. mapreduce 简介</h5><p>mapreduce源自google的一篇文章，将海量数据处理的过程拆分为map和reduce。mapreduce 成为了最早的分布式计算框架，这样即使不懂的分布式计算框架的内部运行机制的用户，也可以利用分布式的计算框架实现分布式的计算，并在hadoop上面运行。</p>
<h5 id="1-设计思想"><a href="#1-设计思想" class="headerlink" title="1. 设计思想"></a>1. 设计思想</h5><p>hadoop 文件系统 ，提供了一个分布式的文件系统，但是hadoop文件系统读写的操作都涉及到大量的网络的操作，并不能很好的完成实时性比较强的任务。</p>
<p>但是hadoop可以给上面的应用提供一个很好的支持。比如hadoop文件系统上面可以运行mapreduce。mapreduce是一个计算的框架，mapreduce是一个分布式的计算框架，这样mapreduce利用分布式的文件系统，将不同的机器上完成不同的计算，然后就计算结果返回。这样很好的利用了分布式的文件系统。</p>
<p>数据分布式的存储，然后计算的时候，分布式的计算，然后将结果返回。这样的好处就是不会涉及到大量的网络传输数据。</p>
<p>不知道在哪里看见一句话，觉得很好，记了下来。大数据设计的一个基本的思想是<strong>将计算的任务推送到数据所在的地方，而不是反过来。</strong></p>
<h5 id="2-Mapreduce-的架构"><a href="#2-Mapreduce-的架构" class="headerlink" title="2. Mapreduce 的架构"></a>2. Mapreduce 的架构</h5><p>mrappmaster（管理节点）<br> Maptask（多个）<br> reducetask（多个）</p>
<p>mapreduce 的计算过程，举一个例子 wordcount （单词计数的例子）比如说有一个文件 ，文件内容：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">good better best never it rest </span><br><span class="line">till good <span class="keyword">is</span> better and better <span class="keyword">is</span> best</span><br></pre></td></tr></table></figure>

<p>那么第一步 先map，map的流程是，将单词以空格来切分，然后建立一个key-value的map。</p>
<p>得到的结果是：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">good    <span class="number">1</span></span><br><span class="line">better  <span class="number">1</span></span><br><span class="line">best    <span class="number">1</span></span><br><span class="line">never   <span class="number">1</span></span><br><span class="line">it      <span class="number">1</span></span><br><span class="line">rest    <span class="number">1</span></span><br><span class="line">till    <span class="number">1</span></span><br><span class="line">good    <span class="number">1</span></span><br><span class="line"><span class="keyword">is</span>      <span class="number">1</span></span><br><span class="line">better  <span class="number">1</span></span><br><span class="line">and     <span class="number">1</span></span><br><span class="line">better  <span class="number">1</span></span><br><span class="line"><span class="keyword">is</span>      <span class="number">1</span></span><br><span class="line">best    <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>上面这个map的结果，相当于给每一个每一个单词都建立一个字典，key就是单词本身，value是个数。</p>
<p>第二步是reduce：<br> reduce是将一致的单词，发送个同一个reduce节点。在同一个reduce节点上面，这个reduce节点，负责将相同的key合并再一起。</p>
<p>这样就完成的单词的计数。</p>
<p><img src="https:////upload-images.jianshu.io/upload_images/4717565-0afa417b7248b948.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/767/format/webp" alt="img"></p>
<p>image.png</p>
<h6 id="这里存在几个问题："><a href="#这里存在几个问题：" class="headerlink" title="这里存在几个问题："></a>这里存在几个问题：</h6><p><strong>Q1:</strong> reduce的方式是将一个类型的key，送给同一个节点。比如说，把good都送给第一个节点。till送给第二个节点。那么如果做到这一点呢？</p>
<p>答：使用hash表的方式，一个key，放在hash表里面，就会产生一个为一个code（java 里面的数据结构是 hashcode），然后再给它取余数。比如机器有四个节点，做reduce，那么就取余4，这样计算的任务就分给四台机器。这个就是shuffl机制。（shuffl就是洗牌的意思）（这个算法其实就是<strong>哈希取模</strong>的算法）</p>
<p><strong>Q2:</strong> map 执行完成之后，中间结果保存在哪里？<br> map函数输出的中间结果key/value数据在内存中进行缓存，然后周期性的写入磁盘。每个map函数在写入磁盘之前，通过哈希函数，将自己的key/value对分割成R份。（R是reduce的个数 哈希函数一般是 用key对r进行哈希取模，这样将map函数的中间数据分割成r份，每一份分给一个reduce）。<strong>当某个reduce任务的worker接收到master的通知，其通过rpc远程调用 将map任务产生的m份属于自己的文件远程拉取到本地。</strong></p>
<p><strong>mapreduce的计算特点以及不足：</strong><br> mapreduce的计算框架的优点是，极强的扩展能力，可以在数千台机器上并发的执行。其次，有很好的容错性，另外，就是向上的接口简洁。用户只需要写map和reduce函数，即可完成大规模数据的并行处理。</p>
<p><strong>mapreduce的缺点：</strong><br> mapreduce并不适合对实时性要求比较高的场景，比如交互式查询或者是流式计算。另外，也不适合迭代类的计算（比如机器学习类的应用）。</p>
<p>原因：<br> mapreduce的启动时间比较长，对于批处理的任务，这个问题并不算大。但是对于实时性比较高的任务，其启动时间长的缺点就很不合适了。</p>
<p>mapreduce一次执行的过程里面，往往涉及到多出磁盘读写，以及网络的传输。对于迭代的任务，这样很好的开销需要很多次，明显降低了效率。</p>
<p>而Storm和Spark，一个是流式计算的框架，一个是机器学习的框架。他们更适合解决这类型的任务。</p>
<p>Demo：<br> 一个利用mapreduce思想单词计数的实例：<a href="https://www.jianshu.com/p/59ebf5a36ee5" target="_blank" rel="noopener">http://www.jianshu.com/p/59ebf5a36ee5</a></p>
<p>参考：</p>
<ol>
<li>google的mapreduce 论文</li>
<li>《hadoop权威指南》</li>
<li>《hadoop 海量数据处理》</li>
</ol>
<p>作者：zhaozhengcoder<br>链接：<a href="https://www.jianshu.com/p/6b6a42a0740c" target="_blank" rel="noopener">https://www.jianshu.com/p/6b6a42a0740c</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/11/Web/2019-12-11-WSGI/">Web/2019-12-11-WSGI</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-11</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Web/">Web</a></span><div class="content"><h3 id="WSGI"><a href="#WSGI" class="headerlink" title="WSGI"></a>WSGI</h3><p>WSGI describes the protocol between Server and Framework.</p>
<p>WSGI描述了Server与Framework之间通信的规范，简单来说，WSGI规范了以下几项内容：</p>
<ul>
<li>WSGI协议主要包括server和application两部分，server负责接受客户端请求并进行解析，然后将其传入application，客户端处理请求并将响应头和正文返回服务器（严格说来，还有一个模块叫做中间件middleware，但中间件也同样使用上述两种接口进行通讯）</li>
<li>从application的角度来说，它应当是一个可调用的对象（实现了<strong>call</strong> 函数的方法或者类），它接受两个参数：environ和start_response，其主要作用就是根据server传入的environ字典来生成一个“可迭代的”http报文并返回给server</li>
<li>从server的角度来说，其主要工作是解析http请求，生成一个environ字典并将其传递给可调用的application对象；另外，server还要实现一个start_response函数，其作用是生成响应头，start_response作为参数传入application中并被其调用</li>
</ul>
<p><img src="https://pic3.zhimg.com/80/v2-8e57dcd56fe8ae513f23a7855d5f62e6_hd.jpg" alt="v2-8e57dcd56fe8ae513f23a7855d5f62e6_hd"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/11/Web/2019-12-11-sync_db_w_REPLACE/">Web/2019-12-11-sync_db_w_REPLACE</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-11</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Web/">Web</a></span><div class="content"><h3 id="Sync-DB-w-REPLACE"><a href="#Sync-DB-w-REPLACE" class="headerlink" title="Sync DB w/ REPLACE"></a>Sync DB w/ REPLACE</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> HTTPBasicAuth</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConfJsonHandler</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, conf_json_root)</span>:</span></span><br><span class="line">        self.conf_json_root = conf_json_root</span><br><span class="line">        self.serv_b = ServB()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">upload_one_style_w_replace</span><span class="params">(self, style=<span class="string">'ZZZ'</span>)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        Example Below:</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="comment"># obj.serv_b.post_filtering(filter_pat)       # 根据 filter_pat 拿data跟id</span></span><br><span class="line">        <span class="comment"># obj.serv_b.delete_by_filtering(filter_pat)  # 根据 filter_pat 找到的data的id作软删除</span></span><br><span class="line">        <span class="comment"># obj.serv_b.get_all_materials(&#123;'material_type': 'template', 'content.template':'测试测试'&#125;)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># style = 'ZZZ'</span></span><br><span class="line">        local_style = self.style_mapper(style)  <span class="comment"># 'ZZZ' --&gt; '测试测试'</span></span><br><span class="line"></span><br><span class="line">        upload = <span class="literal">True</span>  <span class="comment"># <span class="doctag">TODO:</span> Set to True to upload to mongodb</span></span><br><span class="line">        filter_del = &#123;</span><br><span class="line">            <span class="string">"filter"</span>: &#123;<span class="string">'material_type'</span>: <span class="string">'template'</span>, <span class="string">'content.template'</span>: local_style&#125;&#125;  <span class="comment"># E.g. content.template: '光'</span></span><br><span class="line">        <span class="comment"># filter_del = &#123;"filter":&#123;'content.template':'aaa'&#125;&#125;</span></span><br><span class="line">        self.run_one_style(style, upload, filter_del)</span><br><span class="line"></span><br><span class="line">        filter_pat = filter_del</span><br><span class="line">        res = self.serv_b.post_filtering(filter_pat)</span><br><span class="line">        <span class="keyword">if</span> <span class="number">200</span> != res.status_code:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">"FAILED in upload_one_style_w_replace."</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">style_mapper</span><span class="params">(self, style)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> style == <span class="string">'A'</span>:</span><br><span class="line">            local_style = <span class="string">'AAA'</span></span><br><span class="line">        <span class="keyword">elif</span> style == <span class="string">'B'</span>:</span><br><span class="line">            local_style = <span class="string">'BBB'</span></span><br><span class="line">        <span class="keyword">elif</span> style == <span class="string">'C'</span>:</span><br><span class="line">            local_style = <span class="string">'CCC'</span></span><br><span class="line">        <span class="keyword">elif</span> style == <span class="string">'D'</span>:</span><br><span class="line">            local_style = <span class="string">'DDD'</span></span><br><span class="line">        <span class="keyword">elif</span> style == <span class="string">'G'</span>:</span><br><span class="line">            local_style = <span class="string">'EEE'</span></span><br><span class="line">        <span class="keyword">elif</span> style == <span class="string">'M'</span>:</span><br><span class="line">            local_style = <span class="string">'FFF'</span></span><br><span class="line">        <span class="comment"># elif style == 'E':</span></span><br><span class="line">        <span class="comment">#     local_style = 'GGG'</span></span><br><span class="line">        <span class="keyword">elif</span> style == <span class="string">'ZZZ'</span>:</span><br><span class="line">            local_style = <span class="string">'ZZZZZZZ'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">"&#123;&#125; has no corresponding chinese style"</span>.format(style))</span><br><span class="line">        <span class="keyword">return</span> local_style</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_post</span><span class="params">(self)</span>:</span></span><br><span class="line">        styles_paths = glob.glob(os.path.join(self.conf_json_root, <span class="string">'*'</span>))</span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> styles_paths:      <span class="comment"># [A, B, C]</span></span><br><span class="line">            style = s.split(<span class="string">'/'</span>)[<span class="number">-1</span>]</span><br><span class="line">            self.run_one_style(style)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_one_style</span><span class="params">(self, style, upload, filter_del)</span>:</span></span><br><span class="line">        <span class="comment"># self.serv_b.set_filter_del(filter_del)</span></span><br><span class="line"></span><br><span class="line">        scs_paths = glob.glob(os.path.join(self.conf_json_root, style, <span class="string">'*'</span>))</span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> scs_paths:         <span class="comment"># ['out_jsons/A/3_4_detail_res2_sc4',</span></span><br><span class="line">                                    <span class="comment"># 'out_jsons/A/3_4_detail_res2_sc3',</span></span><br><span class="line">                                    <span class="comment"># 'out_jsons/A/3_4_detail_res2_sc2', ,...]</span></span><br><span class="line">            print()</span><br><span class="line">            print(<span class="string">'-'</span>*<span class="number">20</span>, <span class="string">'Processing &#123;&#125;'</span>.format(s), <span class="string">'-'</span>*<span class="number">20</span>)</span><br><span class="line">            sc = s.split(<span class="string">'/'</span>)[<span class="number">-1</span>]</span><br><span class="line">            self.run_one_sc(style, sc, upload, filter_del)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_one_sc</span><span class="params">(self, style, sc, upload, filter_del)</span>:</span></span><br><span class="line">        conf_path = glob.glob(os.path.join(self.conf_json_root, style, sc, <span class="string">'*'</span>))[<span class="number">0</span>]</span><br><span class="line">                                    <span class="comment"># out_jsons/A/3_4_detail_res2_sc3/3_4_detail_res2_sc3.json</span></span><br><span class="line">        basename = os.path.basename(conf_path)</span><br><span class="line">                                    <span class="comment"># 3_4_detail_res2_sc3.json</span></span><br><span class="line">        basename_split = basename.split(<span class="string">'.'</span>)[<span class="number">0</span>].split(<span class="string">'_'</span>)</span><br><span class="line">        scale = basename_split[<span class="number">0</span>] + <span class="string">':'</span> + basename_split[<span class="number">1</span>]     <span class="comment"># 3_4 --&gt; 3:4</span></span><br><span class="line">        intent = basename_split[<span class="number">2</span>]  <span class="comment"># detail</span></span><br><span class="line">        img = basename_split[<span class="number">-3</span>]    <span class="comment"># img2 <span class="doctag">TODO:</span> use re to support number &gt; 10</span></span><br><span class="line">        vid = basename_split[<span class="number">-2</span>]   <span class="comment"># vid0</span></span><br><span class="line">        sc = basename_split[<span class="number">-1</span>]    <span class="comment"># sc3</span></span><br><span class="line">        <span class="keyword">with</span> open(conf_path, <span class="string">'r+'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            conf = json.load(f)</span><br><span class="line"></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        Info for payload </span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        id = conf_path</span><br><span class="line">        template = self.style_mapper(style)</span><br><span class="line">        pic_num = int(<span class="string">""</span>.join(re.findall(<span class="string">r"\d+"</span>, img)))</span><br><span class="line">        vid_num = int(<span class="string">""</span>.join(re.findall(<span class="string">r"\d+"</span>, vid)))</span><br><span class="line">        config = conf</span><br><span class="line">        stage = self.intent_mapper(intent)</span><br><span class="line">        style = sc</span><br><span class="line">        scale = scale</span><br><span class="line"></span><br><span class="line">        payload = self.pkg_payload(id=id, template=template, pic_num=pic_num, vid_num = vid_num, config=config, stage=stage, style=style, scale=scale)</span><br><span class="line">        <span class="comment"># payload = &#123;"bbb":55, "ccc":999&#125;</span></span><br><span class="line">        <span class="comment"># payload = config</span></span><br><span class="line">        <span class="comment"># exit()</span></span><br><span class="line">        print(<span class="string">'payload to upload: &#123;&#125;'</span>.format(payload))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> filter_del:</span><br><span class="line">            self.serv_b.delete_by_filtering(filter_del)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> set upload to True if going to upload</span></span><br><span class="line">        <span class="keyword">if</span> upload:</span><br><span class="line">            self.serv_b.post(payload)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">intent_mapper</span><span class="params">(self, intent)</span>:</span></span><br><span class="line">        <span class="comment">###</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> d.get(intent, <span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pkg_payload</span><span class="params">(self, id:int, template:str, pic_num:int, vid_num:int, config:json, stage:list, style:str, scale:str)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        print(<span class="string">'in pkg_payload'</span>)</span><br><span class="line">        payload = &#123;</span><br><span class="line">            <span class="string">"id"</span>:id,</span><br><span class="line">            <span class="string">"template"</span>:template,</span><br><span class="line">            <span class="string">"pic_num"</span>:pic_num,</span><br><span class="line">            <span class="string">"vid_num"</span>:vid_num,</span><br><span class="line">            <span class="string">"config"</span>:config,</span><br><span class="line">            <span class="string">"stage"</span>:stage,</span><br><span class="line">            <span class="string">"style"</span>:style,</span><br><span class="line">            <span class="string">"scale"</span>:scale</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServB</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, account=<span class="string">''</span>, pw=<span class="string">''</span>)</span>:</span></span><br><span class="line"></span><br><span class="line">        self.account = <span class="string">'serv_b-admin'</span></span><br><span class="line">        self.pw = <span class="string">'passwd'</span></span><br><span class="line">        self.filter_del = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># self.account = 'user@xxxxxxxxxxxxx.com'</span></span><br><span class="line">        <span class="comment"># if not pw:</span></span><br><span class="line">        <span class="comment">#     fname = 'password.txt'</span></span><br><span class="line">        <span class="comment">#     with open(fname, 'r+') as f:</span></span><br><span class="line">        <span class="comment">#         pw = f.readline().strip()</span></span><br><span class="line">        <span class="comment">#         self.pw = pw</span></span><br><span class="line">        <span class="comment"># else:</span></span><br><span class="line">        <span class="comment">#     self.pw = pw</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_filter_del</span><span class="params">(self, filter_del=None)</span>:</span></span><br><span class="line">        self.filter_del = filter_del</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, payload)</span>:</span></span><br><span class="line">        print(<span class="string">"=== In POST ALL ==="</span>)</span><br><span class="line">        <span class="comment"># POST</span></span><br><span class="line">        <span class="comment"># payload = &#123;"bbb":55, "ccc":88&#125;</span></span><br><span class="line">        res = <span class="string">"/api/v3/add/materials"</span></span><br><span class="line">        res = requests.post(<span class="string">"https://serv_b2.xxxxxxxxxxxxx.com"</span>+res, auth=HTTPBasicAuth(self.account, self.pw),</span><br><span class="line">                        json=&#123;<span class="string">"material_content"</span>:payload, <span class="string">"material_type"</span>:<span class="string">"template"</span>&#125;)</span><br><span class="line">        print(res.status_code)</span><br><span class="line">        print(json.dumps(res.json(), ensure_ascii=<span class="literal">False</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post_one_testing_data</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># POST</span></span><br><span class="line">        payload = &#123;<span class="string">"bbb"</span>:<span class="number">55</span>, <span class="string">"ccc"</span>:<span class="number">88</span>&#125;</span><br><span class="line">        res = <span class="string">"/api/v3/add/materials"</span></span><br><span class="line">        res = requests.post(<span class="string">"https://serv_b2.xxxxxxxxxxxxx.com"</span>+res, auth=HTTPBasicAuth(self.account, self.pw),</span><br><span class="line">                            json=&#123;<span class="string">"material_content"</span>:payload, <span class="string">"material_type"</span>:<span class="string">"helloworld"</span>&#125;)</span><br><span class="line">        print(res.status_code)</span><br><span class="line">        print(json.dumps(res.json(), ensure_ascii=<span class="literal">False</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self, payload, id)</span>:</span></span><br><span class="line">        <span class="comment"># PUT</span></span><br><span class="line">        res = <span class="string">"/api/v3/dp_materials"</span></span><br><span class="line">        res = requests.post(<span class="string">"https://serv_b2.xxxxxxxxxxxxx.com"</span>+res, auth=HTTPBasicAuth(self.account, self.pw),</span><br><span class="line">                            json=&#123;<span class="string">"content"</span>:payload&#125;)</span><br><span class="line">        print(res.status_code)</span><br><span class="line">        print(json.dumps(res.json(), ensure_ascii=<span class="literal">False</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put_one_by_id</span><span class="params">(self, payload, id=<span class="string">'c42f7c9aaf01463f88b01d46e7d0b850'</span>)</span>:</span></span><br><span class="line">        <span class="comment"># PUT</span></span><br><span class="line">        payload = &#123;<span class="string">"bbb"</span>:<span class="number">55</span>, <span class="string">"ccc"</span>:<span class="number">7777</span>&#125;</span><br><span class="line">        res = <span class="string">"/api/v3/dp_materials/"</span> + str(id)</span><br><span class="line">        res = requests.put(<span class="string">"https://serv_b2.xxxxxxxxxxxxx.com"</span>+res, auth=HTTPBasicAuth(self.account, self.pw),</span><br><span class="line">                            json=&#123;<span class="string">"content"</span>:payload&#125;)</span><br><span class="line">        print(res.status_code)</span><br><span class="line">        print(json.dumps(res.json()))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post_filtering</span><span class="params">(self, filter)</span>:</span></span><br><span class="line">        print(<span class="string">"In POST_FILTERING()"</span>)</span><br><span class="line">        res = <span class="string">"/api/v3/search/dp_materials"</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            res = requests.post(<span class="string">"https://serv_b2.xxxxxxxxxxxxx.com"</span>+res, auth=HTTPBasicAuth(self.account, self.pw),</span><br><span class="line">                           json=filter)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">"Invalid filter for post: &#123;&#125;"</span>.format(filter))</span><br><span class="line">        print(res.status_code)</span><br><span class="line">        <span class="comment"># print(res.text)</span></span><br><span class="line">        print(<span class="string">'post filtering: &#123;&#125;'</span>.format(json.dumps(res.json(), ensure_ascii=<span class="literal">False</span>)))</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete_by_id</span><span class="params">(self, id=<span class="string">'f18c4278016643e7b84815279dbef12f'</span>)</span>:</span></span><br><span class="line">        res = <span class="string">"/api/v3/dp_materials/"</span> + str(id)</span><br><span class="line">        res = requests.delete(<span class="string">"https://serv_b2.xxxxxxxxxxxxx.com"</span>+res, auth=HTTPBasicAuth(self.account, self.pw))</span><br><span class="line">        print(res.status_code)</span><br><span class="line">        print(json.dumps(res.json(), ensure_ascii=<span class="literal">False</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_all_materials</span><span class="params">(self, filter)</span>:</span></span><br><span class="line">        res = <span class="string">"/api/v3/dp_materials"</span></span><br><span class="line">        res = requests.get(<span class="string">"https://serv_b2.xxxxxxxxxxxxx.com"</span>+res, auth=HTTPBasicAuth(self.account, self.pw),</span><br><span class="line">                            <span class="comment"># json=filter)</span></span><br><span class="line">                           params=filter)</span><br><span class="line">        print(res.status_code)</span><br><span class="line">        <span class="comment"># print(res.text)</span></span><br><span class="line">        print(json.dumps(res.json(), ensure_ascii=<span class="literal">False</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete_by_filtering</span><span class="params">(self, filter)</span>:</span></span><br><span class="line">        print(<span class="string">"In DELETE_BY_FILTERING()"</span>)</span><br><span class="line">        res = self.post_filtering(filter)</span><br><span class="line">        <span class="keyword">if</span> res.status_code != <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">"Faid filtering existing data to Delete.."</span>)</span><br><span class="line"></span><br><span class="line">        count = res.json().get(<span class="string">'count'</span>, <span class="number">0</span>)</span><br><span class="line">        data = res.json().get(<span class="string">'data'</span>, &#123;&#125;)</span><br><span class="line">        <span class="keyword">assert</span>(count == len(data))</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> == count:</span><br><span class="line">            print(<span class="string">'No data to be deleted..'</span>)</span><br><span class="line"></span><br><span class="line">        ids = []</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> data:</span><br><span class="line">            ids.append(item.get(<span class="string">'material_id'</span>, <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> id <span class="keyword">in</span> ids:</span><br><span class="line">            self.delete_by_id(id)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    run_all = <span class="literal">False</span></span><br><span class="line">    print(<span class="string">'='</span>*<span class="number">40</span>)</span><br><span class="line">    conf_json_root = <span class="string">'out_jsons'</span>    <span class="comment"># <span class="doctag">TODO:</span> use argumentParse</span></span><br><span class="line">    <span class="comment"># conf_json_root = 'trans_jsons'    # <span class="doctag">TODO:</span> use argumentParse</span></span><br><span class="line"></span><br><span class="line">    obj = ConfJsonHandler(conf_json_root)</span><br><span class="line">    <span class="keyword">if</span> run_all:</span><br><span class="line">        obj.run_post()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># obj.serv_b.post_one_testing_data()</span></span><br><span class="line">    <span class="comment"># obj.serv_b.put_one_testing_data(&#123;"bbb":53335, "ccc":666&#125;)   # replace existing data w/ a new one</span></span><br><span class="line"></span><br><span class="line">    obj.upload_one_style_w_replace(<span class="string">'ZZZ'</span>)</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    Example Below:</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="comment"># obj.serv_b.post_filtering(filter_pat)       # 根据 filter_pat 拿data跟id</span></span><br><span class="line">    <span class="comment"># obj.serv_b.delete_by_filtering(filter_pat)  # 根据 filter_pat 找到的data的id作软删除</span></span><br><span class="line">    <span class="comment"># obj.serv_b.get_all_materials(&#123;'material_type': 'template', 'content.template':'测试测试'&#125;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># style = 'ZZZ'</span></span><br><span class="line">    <span class="comment"># local_style = obj.style_mapper(style)  # 'ZZZ' --&gt; '测试测试'</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># upload = True  # <span class="doctag">TODO:</span> Set to True to upload to mongodb</span></span><br><span class="line">    <span class="comment"># filter_del = &#123;</span></span><br><span class="line">    <span class="comment">#     "filter": &#123;'material_type': 'template', 'content.template': local_style&#125;&#125;  # E.g. content.template: '光'</span></span><br><span class="line">    <span class="comment"># obj.run_one_style(style, upload, filter_del)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># filter_pat = filter_del</span></span><br><span class="line">    <span class="comment"># res = obj.serv_b.post_filtering(filter_pat)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> query by content.config.path</span></span><br><span class="line">    <span class="comment"># obj.serv_b.delete_by_id()</span></span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/10/NLP/2019-12-10-Bagging%20vs%20Boosting/">NLP/2019-12-10-Bagging vs Boosting</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-10</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ML/">ML</a></span><div class="content"><p>ref: <a href="https://www.cnblogs.com/liuwu265/p/4690486.html" target="_blank" rel="noopener">https://www.cnblogs.com/liuwu265/p/4690486.html</a></p>
<h3 id="Bagging-vs-Boosting"><a href="#Bagging-vs-Boosting" class="headerlink" title="Bagging vs Boosting"></a>Bagging vs Boosting</h3><p>“　</p>
<p>　Bagging和Boosting都是将已有的分类或回归算法通过一定方式组合起来，形成一个性能更加强大的分类器，更准确的说这是一种分类算法的组装方法。即将弱分类器组装成强分类器的方法。</p>
<p>首先介绍Bootstraping，即自助法：它是一种有放回的抽样方法（可能抽到重复的样本）。</p>
<p>1、Bagging (bootstrap aggregating)</p>
<p>Bagging即套袋法，其算法过程如下：</p>
<p>A）从原始样本集中抽取训练集。每轮从原始样本集中使用Bootstraping的方法抽取n个训练样本（在训练集中，有些样本可能被多次抽取到，而有些样本可能一次都没有被抽中）。共进行k轮抽取，得到k个训练集。（k个训练集之间是相互独立的）</p>
<p>B）每次使用一个训练集得到一个模型，k个训练集共得到k个模型。（注：这里并没有具体的分类算法或回归方法，我们可以根据具体问题采用不同的分类或回归方法，如决策树、感知器等）</p>
<p>C）对分类问题：将上步得到的k个模型采用投票的方式得到分类结果；对回归问题，计算上述模型的均值作为最后的结果。（所有模型的重要性相同）</p>
<p>2、Boosting</p>
<p>其主要思想是将弱分类器组装成一个强分类器。在PAC（概率近似正确）学习框架下，则一定可以将弱分类器组装成一个强分类器。</p>
<p>关于Boosting的两个核心问题：</p>
<p>1）在每一轮如何改变训练数据的权值或概率分布？</p>
<p>通过提高那些在前一轮被弱分类器分错样例的权值，减小前一轮分对样例的权值，来使得分类器对误分的数据有较好的效果。</p>
<p>2）通过什么方式来组合弱分类器？</p>
<p>通过加法模型将弱分类器进行线性组合，比如AdaBoost通过加权多数表决的方式，即增大错误率小的分类器的权值，同时减小错误率较大的分类器的权值。</p>
<p>而提升树通过拟合残差的方式逐步减小残差，将每一步生成的模型叠加得到最终模型。</p>
<p>3、Bagging，Boosting二者之间的区别</p>
<p>Bagging和Boosting的区别：</p>
<p>1）样本选择上：</p>
<p>Bagging：训练集是在原始集中有放回选取的，从原始集中选出的各轮训练集之间是独立的。</p>
<p>Boosting：每一轮的训练集不变，只是训练集中每个样例在分类器中的权重发生变化。而权值是根据上一轮的分类结果进行调整。</p>
<p>2）样例权重：</p>
<p>Bagging：使用均匀取样，每个样例的权重相等</p>
<p>Boosting：根据错误率不断调整样例的权值，错误率越大则权重越大。</p>
<p>3）预测函数：</p>
<p>Bagging：所有预测函数的权重相等。</p>
<p>Boosting：每个弱分类器都有相应的权重，对于分类误差小的分类器会有更大的权重。</p>
<p>4）并行计算：</p>
<p>Bagging：各个预测函数可以并行生成</p>
<p>Boosting：各个预测函数只能顺序生成，因为后一个模型参数需要前一轮模型的结果。</p>
<p>4、总结</p>
<p>这两种方法都是把若干个分类器整合为一个分类器的方法，只是整合的方式不一样，最终得到不一样的效果，将不同的分类算法套入到此类算法框架中一定程度上会提高了原单一分类器的分类效果，但是也增大了计算量。</p>
<p>下面是将决策树与这些算法框架进行结合所得到的新的算法：</p>
<p>1）Bagging + 决策树 = 随机森林</p>
<p>2）AdaBoost + 决策树 = 提升树</p>
<p>3）Gradient Boosting + 决策树 = GBDT</p>
<p> “</p>
<p>参考文献</p>
<p>[1] 林轩田，机器学习技法。</p>
<p>[2] IRLAB, <a href="http://www.cnblogs.com/guolei/archive/2013/05/21/3091301.html" target="_blank" rel="noopener">http://www.cnblogs.com/guolei/archive/2013/05/21/3091301.html</a></p>
<p>[3] 百度技术，<a href="http://baidutech.blog.51cto.com/4114344/743809/" target="_blank" rel="noopener">http://baidutech.blog.51cto.com/4114344/743809/</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/05/Math/2019-12-05-Central%20Limit%20Theorem(Copy)/">Math/2019-12-05-Central Limit Theorem(Copy)</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-05</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Probability/">Probability</a></span><div class="content"><p>Ref: <a href="https://zhuanlan.zhihu.com/p/25241653" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/25241653</a></p>
<p>“ 中心极限定理是统计学中比较重要的一个定理。 本文将通过实际模拟数据的形式，形象地展示中心极限定理是什么，是如何发挥作用的。</p>
<h2 id="什么是中心极限定理（Central-Limit-Theorem）"><a href="#什么是中心极限定理（Central-Limit-Theorem）" class="headerlink" title="什么是中心极限定理（Central Limit Theorem）"></a>什么是中心极限定理（Central Limit Theorem）</h2><blockquote>
<p>中心极限定理指的是给定一个任意分布的总体。我每次从这些总体中随机抽取 n 个抽样，一共抽 m 次。 然后把这 m 组抽样分别求出平均值。 这些平均值的分布接近正态分布。</p>
</blockquote>
<p>我们先举个<strong>栗子?</strong></p>
<p><em>现在我们要统计全国的人的体重，看看我国平均体重是多少。当然，我们把全国所有人的体重都调查一遍是不现实的。所以我们打算一共调查1000组，每组50个人。 然后，我们求出第一组的体重平均值、第二组的体重平均值，一直到最后一组的体重平均值。中心极限定理说：这些平均值是呈现正态分布的。并且，随着组数的增加，效果会越好。 最后，当我们再把1000组算出来的平均值加起来取个平均值，这个平均值会接近全国平均体重。</em></p>
<p>其中要注意的几点：</p>
<ol>
<li><strong>总体本身的分布不要求正态分布</strong><br>上面的例子中，人的体重是正态分布的。但如果我们的例子是掷一个骰子（平均分布），最后每组的平均值也会组成一个正态分布。（神奇！）</li>
<li><strong>样本每组要足够大，但也不需要太大</strong><br>取样本的时候，一般认为，每组大于等于30个，即可让中心极限定理发挥作用。</li>
</ol>
<p>话不多说，我们现在来一步步<strong>看到</strong>中心极限定理是如何起作用的。</p>
<h2 id="用实际数据来展示中心极限定理"><a href="#用实际数据来展示中心极限定理" class="headerlink" title="用实际数据来展示中心极限定理"></a>用实际数据来展示中心极限定理</h2><p><em>注：我们使用python语言以及iPython Notebook来生成和展现数据。不懂的童鞋可以略过代码</em></p>
<h3 id="第一步，-生成数据"><a href="#第一步，-生成数据" class="headerlink" title="第一步， 生成数据"></a>第一步， 生成数据</h3><p>假设我们现在观测一个人掷骰子。这个骰子是公平的，也就是说掷出1~6的概率都是相同的：1/6。他掷了一万次。我们用python来模拟投掷的结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np </span><br><span class="line">random_data &#x3D; np.random.randint(1, 7, 10000)</span><br><span class="line">print random_data.mean() # 打印平均值</span><br><span class="line">print random_data.std()  # 打印标准差</span><br></pre></td></tr></table></figure>

<p>生成出来的平均值：<strong>3.4927*</strong>（每次重新生成都会略有不同）*<br>生成出来的标准差：<strong>1.7079</strong></p>
<p>平均值接近3.5很好理解。 因为每次掷出来的结果是1、2、3、4、5、6。 每个结果的概率是1/6。所以加权平均值就是3.5。</p>
<h3 id="第二步，画出来看看"><a href="#第二步，画出来看看" class="headerlink" title="第二步，画出来看看"></a>第二步，画出来看看</h3><p>我们把生成的数据用直方图画出来直观地感受一下：</p>
<p><img src="https://pic4.zhimg.com/80/v2-0fc5ad0284a58f21083437423b4637ff_hd.png" alt="img"></p>
<p>可以看到1~6分布都比较平均，不错。</p>
<h3 id="第三步，抽一组抽样来试试"><a href="#第三步，抽一组抽样来试试" class="headerlink" title="第三步，抽一组抽样来试试"></a>第三步，抽一组抽样来试试</h3><p>我们接下来随便先拿一组抽样，手动算一下。例如我们先从生成的数据中随机抽取10个数字：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sample1 &#x3D; []</span><br><span class="line">for i in range(0, 10):</span><br><span class="line">    sample1.append(random_data[int(np.random.random() * len(random_data))])</span><br><span class="line"></span><br><span class="line">print sample1 # 打印出来</span><br></pre></td></tr></table></figure>

<p>这10个数字的结果是： <strong>[3, 4, 3, 6, 1, 6, 6, 3, 4, 4]</strong><br>平均值：<strong>4.0</strong><br>标准差：<strong>1.54</strong></p>
<p>可以看到，我们只抽10个的时候，样本的平均值（4.0）会距离总体的平均值（3.5）有所偏差。<br>有时候我们运气不好，抽出来的数字可能偏差很大，比如抽出来10个数字都是6。那平均值就是6了。 为什么会出现都是6的情况呢？因为我比较6…哦不是，因为这就是随机的魅力呀！</p>
<p>不过不要担心，接下去就是见证奇迹的时刻。</p>
<h3 id="第四步，见证奇迹的时刻"><a href="#第四步，见证奇迹的时刻" class="headerlink" title="第四步，见证奇迹的时刻"></a>第四步，见证奇迹的时刻</h3><p>我们让中心极限定理发挥作用。现在我们抽取1000组，每组50个。<br>我们把每组的平均值都算出来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">samples &#x3D; []</span><br><span class="line">samples_mean &#x3D; []</span><br><span class="line">samples_std &#x3D; []</span><br><span class="line"></span><br><span class="line">for i in range(0, 1000):</span><br><span class="line">    sample &#x3D; []</span><br><span class="line">    for j in range(0, 50):</span><br><span class="line">        sample.append(random_data[int(np.random.random() * len(random_data))])</span><br><span class="line">    sample_np &#x3D; np.array(sample)</span><br><span class="line">    samples_mean.append(sample_np.mean())</span><br><span class="line">    samples_std.append(sample_np.std())</span><br><span class="line">    samples.append(sample_np)</span><br><span class="line"></span><br><span class="line">samples_mean_np &#x3D; np.array(samples_mean)</span><br><span class="line">samples_std_np &#x3D; np.array(samples_std)</span><br><span class="line"></span><br><span class="line">print samples_mean_np</span><br></pre></td></tr></table></figure>

<p>这一共1000个平均值大概是这样的：<strong>[3.44, 3.42, 3.22, 3.2, 2.94 … 4.08, 3.74]</strong> （我肯定不会把1000个数字都写完，又没有稿费可以骗）</p>
<p>然后，我们把这1000个数字用直方图画出来：</p>
<p><img src="https://pic3.zhimg.com/80/v2-3d1871cc5a1bbfdd5610b0c070d0a032_hd.png" alt="img"></p>
<p>TADA! 完美地形成了正态分布。</p>
<p>结果打印如下：</p>
<p>平均值：<strong>3.48494</strong><br>标准差：<strong>0.23506</strong></p>
<h3 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h3><p>在实际生活当中，我们不能知道我们想要研究的对象的平均值，标准差之类的统计参数。中心极限定理在理论上保证了我们可以用只抽样一部分的方法，达到推测研究对象统计参数的目的。<br>在上文的例子中，掷骰子这一行为的理论平均值3.5是我们通过数学定理计算出来的。而我们在实际模拟中，计算出来的样本平均值的平均值（3.48494）确实已经和理论值非常接近了。</p>
<p>“</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/05/Python/2019-12-05-Concurrency%20&amp;%20Process%20in%20Python/">Python/2019-12-05-Concurrency &amp; Process in Python</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-05</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Python/">Python</a></span><div class="content"><h3 id="Concurrency-in-Script"><a href="#Concurrency-in-Script" class="headerlink" title="Concurrency in Script"></a>Concurrency in Script</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">err = <span class="number">0</span></span><br><span class="line">suc = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> err</span><br><span class="line">    <span class="keyword">global</span> suc</span><br><span class="line">    ret = os.system(<span class="string">"./tts_name \'使用。\' out.wav 1.2 3.2"</span>)</span><br><span class="line">    <span class="keyword">if</span> ret == <span class="number">0</span>:</span><br><span class="line">        suc += <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        err += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">t = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, int(sys.argv[<span class="number">1</span>])):</span><br><span class="line">    tt = threading.Thread(target=run)</span><br><span class="line">    tt.start()</span><br><span class="line">    t.append(tt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> t:</span><br><span class="line">    i.join()</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="SubProcess-amp-OS"><a href="#SubProcess-amp-OS" class="headerlink" title="SubProcess &amp; OS"></a>SubProcess &amp; OS</h3><h4 id="subprocess-Popen"><a href="#subprocess-Popen" class="headerlink" title="subprocess.Popen"></a>subprocess.Popen</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tts_name = <span class="string">'./aliyuntts'</span></span><br><span class="line">outfile = <span class="string">'out.wav'</span></span><br><span class="line">speed = <span class="number">1.0</span></span><br><span class="line">pause = <span class="number">1.0</span></span><br><span class="line">role = <span class="string">"aixia"</span></span><br><span class="line"></span><br><span class="line">pipes = subprocess.Popen(<span class="string">"&#123;0&#125; &#123;1&#125; &#123;2&#125; &#123;3&#125; &#123;4&#125; &#123;5&#125;"</span>.format(tts_name, content, outfile, <span class="number">1</span>, <span class="number">0</span>, role), stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=<span class="literal">True</span>)</span><br><span class="line">std_o, std_err = pipes.communicate()</span><br><span class="line">print(<span class="string">'std_o: &#123;&#125;\n std_e: &#123;&#125;'</span>.format(std_o.decode(<span class="string">'utf-8'</span>), std_err.decode(<span class="string">'utf-8'</span>)))</span><br></pre></td></tr></table></figure>



<h4 id="os-system"><a href="#os-system" class="headerlink" title="os.system"></a>os.system</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(tts_name)</span><br><span class="line">ret = os.system(<span class="string">"&#123;0&#125; &#123;1&#125; &#123;2&#125; &#123;3&#125; &#123;4&#125; &#123;5&#125;"</span>.format(tts_name, <span class="string">"早安"</span>, outfile, <span class="number">1</span>, <span class="number">0</span>, <span class="string">'sicheng'</span>))</span><br></pre></td></tr></table></figure>

<hr>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/04/CVs/2019-12-04-OpenCV%20Arrangement/">CVs/2019-12-04-OpenCV Arrangement</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-04</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/CV/">CV</a></span><div class="content"><h3 id="Install-sh"><a href="#Install-sh" class="headerlink" title="Install.sh"></a>Install.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mkdir opencv</span><br><span class="line"><span class="built_in">cd</span> opencv</span><br><span class="line">cp /root/3.4.7.zip ./</span><br><span class="line">unzip 3.4.7.zip</span><br><span class="line">apt-get update</span><br><span class="line">apt-get install -y cmake</span><br><span class="line">apt-get install -y build-essential libgtk2.0-dev libavcodec-dev libavformat-dev libjpeg.dev libtiff4.dev libswscale-dev libjasper-dev</span><br><span class="line"><span class="built_in">cd</span> opencv-3.4.7</span><br><span class="line">mkdir build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake -D CMAKE_BUILD_TYPE=Release -D CMAKE_INSTALL_PREFIX=/usr/<span class="built_in">local</span> ..</span><br><span class="line">make install -j8</span><br></pre></td></tr></table></figure></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/01/2019-12-05-hello-world/">2019-12-05-hello-world</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-01</time><div class="content"><hr>
<h2 id="title-Hello-World"><a href="#title-Hello-World" class="headerlink" title="title: Hello World"></a>title: Hello World</h2><p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/12/01/Python/2019-12-01-Rm%20Ad%20logo/">Python/2019-12-01-Rm Ad logo</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-12-01</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Python/">Python</a></span><div class="content"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> moviepy.editor <span class="keyword">import</span> VideoFileClip</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> sklearn.cluster <span class="keyword">import</span> KMeans</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.environ.get(<span class="string">'NAMESPACE'</span>) == <span class="string">'test'</span>:</span><br><span class="line">    logging.basicConfig(level=logging.INFO)</span><br><span class="line">    logger = logging</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">centroid_histogram</span><span class="params">(clt)</span>:</span></span><br><span class="line">    numLabels = np.arange(<span class="number">0</span>, len(np.unique(clt.labels_)) + <span class="number">1</span>)</span><br><span class="line">    (hist, _) = np.histogram(clt.labels_, bins=numLabels)</span><br><span class="line"></span><br><span class="line">    hist = hist.astype(<span class="string">"float"</span>)</span><br><span class="line">    hist /= hist.sum()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> hist</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_colors</span><span class="params">(hist, centroids)</span>:</span>  <span class="comment">## Originally in utils.py</span></span><br><span class="line">    bar = np.zeros((<span class="number">50</span>, <span class="number">300</span>, <span class="number">3</span>), dtype=<span class="string">"uint8"</span>)</span><br><span class="line">    startX = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (percent, color) <span class="keyword">in</span> zip(hist, centroids):</span><br><span class="line">        endX = startX + (percent * <span class="number">300</span>)</span><br><span class="line">        cv2.rectangle(bar, (int(startX), <span class="number">0</span>), (int(endX), <span class="number">50</span>),</span><br><span class="line">                      color.astype(<span class="string">"uint8"</span>).tolist(), <span class="number">-1</span>)</span><br><span class="line">        startX = endX</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bar</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_color_list</span><span class="params">()</span>:</span></span><br><span class="line">    dict_clr = collections.defaultdict(list)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 黑色</span></span><br><span class="line">    lower_black = np.array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">    upper_black = np.array([<span class="number">180</span>, <span class="number">255</span>, <span class="number">46</span>])</span><br><span class="line">    color_list = []</span><br><span class="line">    color_list.append(lower_black)</span><br><span class="line">    color_list.append(upper_black)</span><br><span class="line">    dict_clr[<span class="string">'black'</span>] = color_list</span><br><span class="line"></span><br><span class="line">    <span class="comment"># #灰色</span></span><br><span class="line">    <span class="comment"># lower_gray = np.array([0, 0, 46])</span></span><br><span class="line">    <span class="comment"># upper_gray = np.array([180, 43, 220])</span></span><br><span class="line">    <span class="comment"># color_list = []</span></span><br><span class="line">    <span class="comment"># color_list.append(lower_gray)</span></span><br><span class="line">    <span class="comment"># color_list.append(upper_gray)</span></span><br><span class="line">    <span class="comment"># dict['gray']=color_list</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 白色</span></span><br><span class="line">    lower_white = np.array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">221</span>])</span><br><span class="line">    upper_white = np.array([<span class="number">180</span>, <span class="number">30</span>, <span class="number">255</span>])</span><br><span class="line">    color_list = []</span><br><span class="line">    color_list.append(lower_white)</span><br><span class="line">    color_list.append(upper_white)</span><br><span class="line">    dict_clr[<span class="string">'white'</span>] = color_list</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dict_clr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">has_logo_at_head</span><span class="params">(clip, t_shot=<span class="number">2</span>)</span>:</span></span><br><span class="line">    logger.info(<span class="string">"Checking has_logo_at_head.."</span>)</span><br><span class="line">    duration = clip.duration</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        img = clip.get_frame(t_shot)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">"WARNING: get_frame() FAILED!!!\n \</span></span><br><span class="line"><span class="string">                 CHECK YOUR CLIP's format, WRONG clip!"</span>)</span><br><span class="line">        <span class="comment"># continue</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    kill = remove_ad_logo_by_img(img[:, :, ::<span class="number">-1</span>])  <span class="comment"># RGB--&gt;BGR</span></span><br><span class="line">    <span class="keyword">return</span> kill</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">has_logo_at_tail</span><span class="params">(clip, t_shot=<span class="number">2</span>)</span>:</span></span><br><span class="line">    logger.info(<span class="string">"Checking has_logo_at_tail.."</span>)</span><br><span class="line">    duration = clip.duration</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        img = clip.get_frame(duration - t_shot)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">"WARNING: get_frame() FAILED!!!\n \</span></span><br><span class="line"><span class="string">                 CHECK YOUR CLIP's format, WRONG clip or duration!"</span>)</span><br><span class="line">        <span class="comment"># continue</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    kill = remove_ad_logo_by_img(img[:, :, ::<span class="number">-1</span>])  <span class="comment"># RGB--&gt;BGR</span></span><br><span class="line">    <span class="keyword">return</span> kill</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_valid_interval</span><span class="params">(clip)</span>:</span>  <span class="comment"># previous name : has_logo()</span></span><br><span class="line">    t_shot = <span class="number">2</span></span><br><span class="line">    <span class="comment"># kill = None</span></span><br><span class="line">    ret_t_interval = <span class="literal">None</span></span><br><span class="line">    start = <span class="number">0</span></span><br><span class="line">    end = clip.duration</span><br><span class="line">    print(<span class="string">"length of clip: &#123;&#125;"</span>.format(clip.duration))</span><br><span class="line">    fps = <span class="number">24</span></span><br><span class="line">    checking_margin = <span class="number">1</span>/fps</span><br><span class="line"></span><br><span class="line">    <span class="string">""" Applying Binary Search for better mining """</span></span><br><span class="line">    <span class="comment"># if has_logo_at_head(clip, t_shot=1):</span></span><br><span class="line">    <span class="comment">#     kill = "HEAD"</span></span><br><span class="line">    <span class="comment">#     start = start + (t_shot + t_margin)</span></span><br><span class="line">    hard_bound = <span class="number">6</span></span><br><span class="line">    l, r = <span class="number">0</span>, min(end/<span class="number">2</span>, hard_bound)   <span class="comment"># for HEAD, we detect logo btw [0, min(end/2, hard_bound)]</span></span><br><span class="line">    <span class="keyword">while</span> l &lt; r:</span><br><span class="line">        m = (l + r)/<span class="number">2</span></span><br><span class="line">        logger.info(<span class="string">"l, r, m = &#123;&#125;, &#123;&#125;, &#123;&#125;"</span>.format(l, r, m))</span><br><span class="line">        <span class="keyword">if</span> has_logo_at_head(clip, m):</span><br><span class="line">            l = m + <span class="number">1</span>/fps</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            r = m - <span class="number">1</span>/fps</span><br><span class="line">    <span class="keyword">if</span> l &gt; start + checking_margin:   <span class="comment"># in case there's no ad at the beginning</span></span><br><span class="line">        start = start + (l+r)/<span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="string">""" Applying Binary Search for better mining """</span></span><br><span class="line">    <span class="comment"># if has_logo_at_tail(clip, t_shot=2):</span></span><br><span class="line">    <span class="comment">#     kill = "TAIL"</span></span><br><span class="line">    <span class="comment">#     end = end - (t_shot + t_margin)</span></span><br><span class="line">    l, r = <span class="number">0</span>, min(end/<span class="number">2</span>, hard_bound)    <span class="comment"># for TAIL, we detect logo btw [max(end-end/2, end-hard_bound)]</span></span><br><span class="line">                                        <span class="comment"># r is substracted in has_logo_at_tail, thus we use min(end/2, hard_bound) for r</span></span><br><span class="line">    <span class="keyword">while</span> l &lt; r:</span><br><span class="line">        m = (l + r)/<span class="number">2</span></span><br><span class="line">        logger.info(<span class="string">"l, r, end-m = &#123;&#125;, &#123;&#125;, &#123;&#125;"</span>.format(l, r, end-m))</span><br><span class="line">        <span class="keyword">if</span> has_logo_at_tail(clip, m):</span><br><span class="line">            l = m + <span class="number">1</span>/fps</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            r = m - <span class="number">1</span>/fps</span><br><span class="line">    <span class="keyword">if</span> end - r &lt; end - checking_margin:   <span class="comment"># in case there's no ad at the end</span></span><br><span class="line">        end = end - (l+r)/<span class="number">2</span></span><br><span class="line"></span><br><span class="line">    ret_t_interval = (start, end)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret_t_interval</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rm_video_ad</span><span class="params">(video)</span>:</span></span><br><span class="line">    clip = VideoFileClip(video)</span><br><span class="line">    <span class="keyword">return</span> get_valid_interval(clip)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_ad_logo_by_name</span><span class="params">(fname)</span>:</span></span><br><span class="line">    img = cv2.imread(fname)</span><br><span class="line">    remove_ad_logo_by_img(img, fname)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_ad_logo_by_img</span><span class="params">(img, fname=<span class="string">"Default"</span>)</span>:</span></span><br><span class="line">    <span class="comment">##img = cv2.imread(fname)</span></span><br><span class="line">    text = <span class="string">""</span></span><br><span class="line">    img = img[:, :, ::<span class="number">-1</span>]  <span class="comment"># BGR --&gt; RGB</span></span><br><span class="line"></span><br><span class="line">    img = cv2.resize(img, (<span class="number">300</span>, <span class="number">300</span>))</span><br><span class="line">    img = img[<span class="number">100</span>:<span class="number">225</span>, :, :]  <span class="comment"># get reasonable Logo area</span></span><br><span class="line">    arr = img.reshape((img.shape[<span class="number">0</span>] * img.shape[<span class="number">1</span>], <span class="number">3</span>))</span><br><span class="line">    clt = KMeans(n_clusters=<span class="number">4</span>)</span><br><span class="line">    clt.fit(arr)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    hist = centroid_histogram(clt)</span><br><span class="line">    <span class="comment">##bar = utils.plot_colors(hist, clt.cluster_centers_)  ## no use now</span></span><br><span class="line">    dominant_ratio = np.max(hist)</span><br><span class="line">    dominant_color = clt.cluster_centers_[np.argmax(hist)]</span><br><span class="line">    dominant_color = np.reshape(dominant_color, (<span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>))</span><br><span class="line">    dominant_color = np.round(dominant_color).astype(np.uint8)</span><br><span class="line"></span><br><span class="line">    hsv_pixel = cv2.cvtColor(dominant_color, cv2.COLOR_BGR2HSV)</span><br><span class="line">    dict_color = get_color_list()  <span class="comment"># palette</span></span><br><span class="line"></span><br><span class="line">    is_bin_bg = <span class="literal">False</span>  <span class="comment">## White or Black for Logo's background</span></span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> dict_color:</span><br><span class="line">        <span class="comment"># cv2.inRange(hsv_pixel, np.array([0,0,221]), np.array([180,30,255]))</span></span><br><span class="line">        tmp = cv2.inRange(hsv_pixel, dict_color[d][<span class="number">0</span>], dict_color[d][<span class="number">1</span>])</span><br><span class="line">        <span class="comment"># print("is_plain ", is_plain_bg)</span></span><br><span class="line">        <span class="keyword">if</span> np.squeeze(tmp):</span><br><span class="line">            is_bin_bg = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> is_bin_bg <span class="keyword">and</span> dominant_ratio &gt; <span class="number">0.60</span>:</span><br><span class="line">        text = <span class="string">"KILL Bin LOGO!"</span></span><br><span class="line">    <span class="keyword">elif</span> dominant_ratio &gt; <span class="number">0.75</span>:</span><br><span class="line">        text = <span class="string">"KILL Color LOGO"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        text = <span class="string">"pass"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Display</span></span><br><span class="line">    <span class="comment">###f, (ax1, ax2) = plt.subplots(1, 2)</span></span><br><span class="line">    <span class="comment">###f.suptitle(fname + "\n" + text)</span></span><br><span class="line">    <span class="comment">###ax1.imshow(img)</span></span><br><span class="line">    <span class="comment">###ax2.imshow(bar)</span></span><br><span class="line">    <span class="comment">###plt.pause(0.05)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> text <span class="keyword">is</span> <span class="keyword">not</span> <span class="string">"pass"</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># def test():</span></span><br><span class="line"><span class="comment">#     kill = 'tail'</span></span><br><span class="line"><span class="comment">#     return kill is not None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_get_10_multiple</span><span class="params">(num)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    使num成为10的倍数，向下取整，721变成720</span></span><br><span class="line"><span class="string">    :param num:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    num = int(num)</span><br><span class="line">    num = (num // <span class="number">10</span>) * <span class="number">10</span></span><br><span class="line">    <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">move_dark_side</span><span class="params">(clip)</span>:</span></span><br><span class="line">    img = clip.get_frame(clip.duration // <span class="number">2</span>).copy()</span><br><span class="line">    img = cv2.cvtColor(img, cv2.COLOR_RGB2GRAY)</span><br><span class="line">    x_projection = np.sum(img, axis=<span class="number">0</span>)</span><br><span class="line">    x_range = np.nonzero(x_projection)</span><br><span class="line">    x_start = _get_10_multiple(x_range[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">    x_end = _get_10_multiple(x_range[<span class="number">0</span>][<span class="number">-1</span>] + <span class="number">1</span>)</span><br><span class="line">    y_projectiong = np.sum(img, axis=<span class="number">1</span>)</span><br><span class="line">    y_range = np.nonzero(y_projectiong)</span><br><span class="line">    y_start = _get_10_multiple(y_range[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">    y_end = _get_10_multiple(y_range[<span class="number">0</span>][<span class="number">-1</span>] + <span class="number">1</span>)</span><br><span class="line">    clip = clip.crop(x1=x_start, y1=y_start, x2=x_end, y2=y_end)</span><br><span class="line">    <span class="keyword">return</span> clip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    root_path = <span class="string">"/home/huangjiancong"</span></span><br><span class="line">    video_path = <span class="string">"Movies/shorts/green_tail3.mp4"</span></span><br><span class="line">    video_path = <span class="string">"Movies/shorts/white6_head2.mp4"</span>   <span class="comment"># 只到20秒，后面的(20, 39]无法播</span></span><br><span class="line">    video_path = <span class="string">"Movies/shorts/white8_head2.mp4"</span>   <span class="comment"># also corrupted</span></span><br><span class="line">    video_path = <span class="string">"Movies/shorts/white11_head1.mp4"</span>   <span class="comment"># also corrupted</span></span><br><span class="line">    video_path = <span class="string">"Movies/shorts/cut.mp4"</span>   <span class="comment"># also corrupted</span></span><br><span class="line">    <span class="comment"># video_path = "/home/huangjiancong/Movies/shorts/black_tail2.mp4"</span></span><br><span class="line">    no_ad_interval = rm_video_ad(os.path.join(root_path, video_path))</span><br><span class="line">    print(<span class="string">"Valid Interval : &#123;&#125;"</span>.format(no_ad_interval))</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    clip = VideoFileClip(<span class="string">'test.mp4'</span>)</span><br><span class="line">    move_dark_side(clip)</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/11/23/Math/2019-11-23-Probability%20Review/">Math/2019-11-23-Probability Review</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-23</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Probability/">Probability</a></span><div class="content"><h3 id="Calc"><a href="#Calc" class="headerlink" title="Calc"></a>Calc</h3><p>假设每个靶中率都是相同的，一个人每个都去射，发现连续射 30 个能中的probability是 93.6%， 那么请问连续射 10次能中的概率是多少？</p>
<p>Ans:<br>$$<br>(p^{30})^{1/3} = (6.4％)^{1/3}<br>$$</p>
<h3 id="中央極限定理"><a href="#中央極限定理" class="headerlink" title="中央極限定理"></a>中央極限定理</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9pohhkh7lj318s0owaql.jpg" alt="image-20191208222151340"></p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9prafd63wj310i0hannw.jpg" alt="image-20191208235851948"></p>
<img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9prfrtf57j30we0actm4.jpg" alt="image-20191209000154339" style="zoom:50%;" />

<p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9pronm5amj30t20ly4jg.jpg" alt="image-20191209001233563"></p>
<p><a href="http://onlinestatbook.com/stat_sim/sampling_dist/index.html" target="_blank" rel="noopener">http://onlinestatbook.com/stat_sim/sampling_dist/index.html</a></p>
<p><a href="https://www.zhihu.com/question/22913867" target="_blank" rel="noopener">https://www.zhihu.com/question/22913867</a></p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9prwbrwlij318p0u010k.jpg" alt="image-20191209001955240"></p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9prwxvy3oj31840u0qal.jpg" alt="image-20191209002030933"></p>
<p>我们让中心极限定理发挥作用。现在我们抽取1000组，每组<strong>50</strong>个。<br>我们把每组的平均值都算出来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">samples &#x3D; []</span><br><span class="line">samples_mean &#x3D; []</span><br><span class="line">samples_std &#x3D; []</span><br><span class="line"></span><br><span class="line">for i in range(0, 1000):</span><br><span class="line">    sample &#x3D; []</span><br><span class="line">    for j in range(0, 50):</span><br><span class="line">        sample.append(random_data[int(np.random.random() * len(random_data))])</span><br><span class="line">    sample_np &#x3D; np.array(sample)</span><br><span class="line">    samples_mean.append(sample_np.mean())</span><br><span class="line">    samples_std.append(sample_np.std())</span><br><span class="line">    samples.append(sample_np)</span><br><span class="line"></span><br><span class="line">samples_mean_np &#x3D; np.array(samples_mean)</span><br><span class="line">samples_std_np &#x3D; np.array(samples_std)</span><br><span class="line"></span><br><span class="line">print samples_mean_np</span><br></pre></td></tr></table></figure>

<p>这一共1000个平均值大概是这样的：<strong>[3.44, 3.42, 3.22, 3.2, 2.94 … 4.08, 3.74]</strong> （我肯定不会把1000个数字都写完，又没有稿费可以骗）</p>
<p>然后，我们把这1000个数字用直方图画出来：</p>
<p><img src="https://pic3.zhimg.com/80/v2-3d1871cc5a1bbfdd5610b0c070d0a032_hd.png" alt="img"></p>
<p>TADA! 完美地形成了正态分布。</p>
<p>结果打印如下：</p>
<p>平均值：<strong>3.48494</strong><br>标准差：<strong>0.23506.  (1.7079/sqrt(50))</strong></p>
<h4 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h4><p>在实际生活当中，我们不能知道我们想要研究的对象的平均值，标准差之类的统计参数。中心极限定理在理论上保证了我们可以用只抽样一部分的方法，达到推测研究对象统计参数的目的。<br>在上文的例子中，掷骰子这一行为的理论平均值3.5是我们通过数学定理计算出来的。而我们在实际模拟中，计算出来的样本平均值的平均值（3.48494）确实已经和理论值非常接近了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np </span><br><span class="line">random_data &#x3D; np.random.randint(1, 7, 10000)</span><br><span class="line">print random_data.mean() # 打印平均值</span><br><span class="line">print random_data.std()  # 打印标准差</span><br></pre></td></tr></table></figure>

<p>生成出来的平均值：<strong>3.4927*</strong>（每次重新生成都会略有不同）*<br>生成出来的标准差：<strong>1.7079</strong></p>
<p>平均值接近3.5很好理解。 因为每次</p>
<h3 id="大數定理"><a href="#大數定理" class="headerlink" title="大數定理"></a>大數定理</h3><p>Connect <strong>Expectation of Probabilty</strong> to <strong>Mean in Statistics</strong>.</p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9psliag72j30f00pu3zv.jpg" alt="v2-670e93df4d2c25f52dc407073e017d03_hd"></p>
<p><a href="https://www.zhihu.com/question/19911209/answer/245487255" target="_blank" rel="noopener">https://www.zhihu.com/question/19911209/answer/245487255</a></p>
<p><strong>切比雪夫大数定律</strong><br>在用标准差估计精度的时候用到，类似6sigma那个规律。<br> 由切比雪夫不等式P{|X-EX|&lt;ε}&gt;=1-DX/ε^2<br>可以导出区间(x± k σ)下的概率. K=2时. x± 2σ. 75%；K=3，89%；K=4，94%<br>切比雪夫大数定律是切比雪夫不等式的推论。   </p>
<p><strong>伯努利大数定律</strong><br>证明了在多次相同的条件的重复试验中，频率有越接近一稳定值的趋势。   </p>
<p>也告诉了我们当实验次数很大时，可以用事件发生的频率来代替事件的概率。   </p>
<p><strong>辛钦大数定律</strong><br>需要独立同分布的条件。 切比雪夫大数定律只需相互独立分布。<br>　<br><strong>中心极限定理</strong><br>说明的是在一定条件下，大量独立随机变量的平均数是以正态分布为极限的。<br> 而大数定律只是揭示了大量随机变量的平均结果，但没有涉及到随机变量的分布的问题。    </p>
<p><strong>列维-林德伯格定理</strong><br>是中心极限定理的一种，就是独立同分布的中心极限定理<br>其他中心极限定理还有一个特例棣莫夫-拉普拉斯定理   </p>
<p><strong>棣莫弗—拉普拉斯定理</strong><br>证明的是二项分布的极限分布是正态分布，也告诉了我们实际问题时可以用大样本近似处理。</p>
<h3 id="貝氏"><a href="#貝氏" class="headerlink" title="貝氏"></a>貝氏</h3><h3 id="Pearson’s-correlation-coefficient"><a href="#Pearson’s-correlation-coefficient" class="headerlink" title="Pearson’s correlation coefficient"></a>Pearson’s correlation coefficient</h3><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdamsiqi39j307a03a3yi.jpg" alt="img" style="zoom:50%;" />

<p>correlation coefficient(<em>ρ</em>，有的時候會用<em>r</em>來表示)會落在-1到1之間: -1≤<em>ρ</em>≤1，<em>μx<em>和</em>μy</em> 分別代表變數<em>x</em>和<em>y</em>的平均數。</p>
<p>看公式會很沒有感覺，對於懂得人會覺得簡單，對於不懂的人會覺得是天書。</p>
<p>為什麼這樣設計會稱為相關係數勒，其實相關係數公式等於:</p>
<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdamss07xmj30dp064dgk.jpg" alt="img" style="zoom:50%;" />

<h3 id="selection-bias"><a href="#selection-bias" class="headerlink" title="selection bias"></a>selection bias</h3><p>只聽信某人的話或是相信綴學就是像Steve Jobbs, Bill Gate 那樣</p>
<p><strong>Selection bias</strong> is the <strong>bias</strong> introduced by the <strong>selection</strong> of individuals, groups or data for analysis in such a way that proper randomization is not achieved, thereby ensuring that the sample obtained is not representative of the population intended to be analyzed. It is sometimes referred to as the <strong>selection</strong> effect.</p>
<h3 id="example-of-a-dataset-with-a-non-Gaussian-distribtion"><a href="#example-of-a-dataset-with-a-non-Gaussian-distribtion" class="headerlink" title="example of a dataset with a non -Gaussian distribtion?"></a>example of a dataset with a non -Gaussian distribtion?</h3><p>Here are sample time series for two measured variables: one is Gaussian-distributed (top), and the other is not (bottom).</p>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdanj3szc4j30gq07yq3z.jpg" alt="img"></p>
<p>On the right, I tallied the measurements in a histogram. This can help us check if a variable is Gaussian or not.</p>
<p>Non-Gaussian distributed time series data arise when the mean or noise statistics vary with time.</p>
<p>If the mean varies with time, the variable could be non-stationary / time-varying (its trend changes with time), auto- or cross-correlated (it changes depending on its previous value or the values of other variables), or its value is computed from the values of other Gaussian variables but in a nonlinear way.</p>
<p>I hope this helps.</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/11/20/DevOps/2019-11-20-Meson%20build.txt/">DevOps/2019-11-20-Meson build.txt</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/DevOps/">DevOps</a></span><div class="content"><h3 id="Meson-Build"><a href="#Meson-Build" class="headerlink" title="Meson Build"></a>Meson Build</h3><p>Meson requires that you have a source directory and a build directory and that these two are different. In your source root must exist a file called <code>meson.build</code>. To generate the build system run this command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meson &lt;<span class="built_in">source</span> directory&gt; &lt;build directory&gt;</span><br></pre></td></tr></table></figure>

<p>To compile, cd into your build directory and type <code>ninja</code>. To run unit tests, type <code>ninja test</code>.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">source_file = ['video_decoder_opencv.cpp']</span><br><span class="line"></span><br><span class="line">cc = meson.get_compiler('cpp')</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">video_dep = [cc.find_library('opencv_core',  dirs:['/root/opencv-3.4.7/cvlib/lib']),</span><br><span class="line">             cc.find_library('opencv_videoio',  dirs:['/root/opencv-3.4.7/cvlib/lib']),</span><br><span class="line">             cc.find_library('opencv_imgcodecs',  dirs:['/root/opencv-3.4.7/cvlib/lib']),</span><br><span class="line">             cc.find_library('opencv_imgproc',  dirs:['/root/opencv-3.4.7/cvlib/lib'])]</span><br><span class="line"></span><br><span class="line">video_loader_dep = declare_dependency(</span><br><span class="line">                            include_directories:[include_directories('.'), config_dir, include_directories('/root/opencv-3.4.7/cvlib/include')],</span><br><span class="line">                            dependencies: video_dep,</span><br><span class="line">                            sources: source_file,)</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">root@7a96a548d8fd:~/opencv-3.4.7/cvlib<span class="comment"># tree -L 2</span></span><br><span class="line">.</span><br><span class="line">├── include</span><br><span class="line">│   ├── CMakeLists.txt</span><br><span class="line">│   ├── opencv</span><br><span class="line">│   └── opencv2</span><br><span class="line">└── lib</span><br><span class="line">    ├── libopencv_calib3d.so -&gt; libopencv_calib3d.so.3.4</span><br><span class="line">    ├── libopencv_calib3d.so.3.4 -&gt; libopencv_calib3d.so.3.4.7</span><br><span class="line">    ├── libopencv_calib3d.so.3.4.7</span><br><span class="line">    ├── libopencv_core.so -&gt; libopencv_core.so.3.4</span><br><span class="line">    ├── libopencv_core.so.3.4 -&gt; libopencv_core.so.3.4.7</span><br><span class="line">    ├── libopencv_core.so.3.4.7</span><br><span class="line">    ├── libopencv_dnn.so -&gt; libopencv_dnn.so.3.4</span><br><span class="line">    ├── libopencv_dnn.so.3.4 -&gt; libopencv_dnn.so.3.4.7</span><br><span class="line">    ├── libopencv_dnn.so.3.4.7</span><br><span class="line">    ├── libopencv_features2d.so -&gt; libopencv_features2d.so.3.4</span><br><span class="line">    ├── libopencv_features2d.so.3.4 -&gt; libopencv_features2d.so.3.4.7</span><br><span class="line">    ├── libopencv_features2d.so.3.4.7</span><br><span class="line">    ├── libopencv_flann.so -&gt; libopencv_flann.so.3.4</span><br><span class="line">    ├── libopencv_flann.so.3.4 -&gt; libopencv_flann.so.3.4.7</span><br><span class="line">    ├── libopencv_flann.so.3.4.7</span><br><span class="line">    ├── libopencv_highgui.so -&gt; libopencv_highgui.so.3.4</span><br><span class="line">    ├── libopencv_highgui.so.3.4 -&gt; libopencv_highgui.so.3.4.7</span><br><span class="line">    ├── libopencv_highgui.so.3.4.7</span><br><span class="line">    ├── libopencv_imgcodecs.so -&gt; libopencv_imgcodecs.so.3.4</span><br><span class="line">    ├── libopencv_imgcodecs.so.3.4 -&gt; libopencv_imgcodecs.so.3.4.7</span><br><span class="line">    ├── libopencv_imgcodecs.so.3.4.7</span><br><span class="line">    ├── libopencv_imgproc.so -&gt; libopencv_imgproc.so.3.4</span><br><span class="line">    ├── libopencv_imgproc.so.3.4 -&gt; libopencv_imgproc.so.3.4.7</span><br><span class="line">    ├── libopencv_imgproc.so.3.4.7</span><br><span class="line">    ├── libopencv_ml.so -&gt; libopencv_ml.so.3.4</span><br><span class="line">    ├── libopencv_ml.so.3.4 -&gt; libopencv_ml.so.3.4.7</span><br><span class="line">    ├── libopencv_ml.so.3.4.7</span><br><span class="line">    ├── libopencv_objdetect.so -&gt; libopencv_objdetect.so.3.4</span><br><span class="line">    ├── libopencv_objdetect.so.3.4 -&gt; libopencv_objdetect.so.3.4.7</span><br><span class="line">    ├── libopencv_objdetect.so.3.4.7</span><br><span class="line">    ├── libopencv_photo.so -&gt; libopencv_photo.so.3.4</span><br><span class="line">    ├── libopencv_photo.so.3.4 -&gt; libopencv_photo.so.3.4.7</span><br><span class="line">    ├── libopencv_photo.so.3.4.7</span><br><span class="line">    ├── libopencv_shape.so -&gt; libopencv_shape.so.3.4</span><br><span class="line">    ├── libopencv_shape.so.3.4 -&gt; libopencv_shape.so.3.4.7</span><br><span class="line">    ├── libopencv_shape.so.3.4.7</span><br><span class="line">    ├── libopencv_stitching.so -&gt; libopencv_stitching.so.3.4</span><br><span class="line">    ├── libopencv_stitching.so.3.4 -&gt; libopencv_stitching.so.3.4.7</span><br><span class="line">    ├── libopencv_stitching.so.3.4.7</span><br><span class="line">    ├── libopencv_superres.so -&gt; libopencv_superres.so.3.4</span><br><span class="line">    ├── libopencv_superres.so.3.4 -&gt; libopencv_superres.so.3.4.7</span><br><span class="line">    ├── libopencv_superres.so.3.4.7</span><br><span class="line">    ├── libopencv_videoio.so -&gt; libopencv_videoio.so.3.4</span><br><span class="line">    ├── libopencv_videoio.so.3.4 -&gt; libopencv_videoio.so.3.4.7</span><br><span class="line">    ├── libopencv_videoio.so.3.4.7</span><br><span class="line">    ├── libopencv_video.so -&gt; libopencv_video.so.3.4</span><br><span class="line">    ├── libopencv_video.so.3.4 -&gt; libopencv_video.so.3.4.7</span><br><span class="line">    ├── libopencv_video.so.3.4.7</span><br><span class="line">    ├── libopencv_videostab.so -&gt; libopencv_videostab.so.3.4</span><br><span class="line">    ├── libopencv_videostab.so.3.4 -&gt; libopencv_videostab.so.3.4.7</span><br><span class="line">    └── libopencv_videostab.so.3.4.7</span><br><span class="line"></span><br><span class="line">4 directories, 52 files</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/11/06/CV%20notes/2019-11-06-EGNet%20Eval/">CV notes/2019-11-06-EGNet Eval</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-06</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Graphic/">Graphic</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Deep-Learning/">Deep-Learning</a></span><div class="content"><h2 id="EGNet-Evaluation"><a href="#EGNet-Evaluation" class="headerlink" title="EGNet Evaluation"></a>EGNet Evaluation</h2><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8ol6oj5msj307h0b4wfe.jpg" alt="img"></p>
<h3 id="1-GPU-运行时间测试"><a href="#1-GPU-运行时间测试" class="headerlink" title="1. GPU 运行时间测试"></a><strong>1. GPU 运行时间测试</strong></h3><table>
<thead>
<tr>
<th>Times</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
</tr>
</thead>
<tbody><tr>
<td>preprocess time / s</td>
<td>0.0016</td>
<td>0.0016</td>
<td>0.0023</td>
<td>0.0019</td>
<td>0.0016</td>
<td>0.0023</td>
<td>0.0027</td>
<td>0.0028</td>
<td>0.0024</td>
<td>0.0022</td>
</tr>
<tr>
<td>model time / s</td>
<td>0.1007</td>
<td>0.1011</td>
<td>0.0982</td>
<td>0.1076</td>
<td>0.0945</td>
<td>0.0970</td>
<td>0.0997</td>
<td>0.0948</td>
<td>0.1021</td>
<td>0.1015</td>
</tr>
<tr>
<td>postprocess time / s</td>
<td>0.0017</td>
<td>0.0020</td>
<td>0.0021</td>
<td>0.0022</td>
<td>0.0019</td>
<td>0.0019</td>
<td>0.0027</td>
<td>0.0018</td>
<td>0.0021</td>
<td>0.0022</td>
</tr>
</tbody></table>
<p><strong>preprocessing average time: 0.00214</strong></p>
<p><strong>model average time: 0.09972</strong></p>
<p><strong>postprocessing average time: 0.00206</strong></p>
<h3 id="2-CPU-Time"><a href="#2-CPU-Time" class="headerlink" title="**2. CPU Time"></a>**2. CPU Time</h3><table>
<thead>
<tr>
<th>Times</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
</tr>
</thead>
<tbody><tr>
<td>preprocess time / s</td>
<td>0.0027</td>
<td>0.0029</td>
<td>0.0017</td>
<td>0.0022</td>
<td>0.0016</td>
<td>0.0017</td>
<td>0.0028</td>
<td>0.0024</td>
<td>0.0031</td>
<td>0.0016</td>
</tr>
<tr>
<td>model time / s</td>
<td>8.9851</td>
<td>9.6686</td>
<td>8.6931</td>
<td>9.7251</td>
<td>8.9071</td>
<td>8.9628</td>
<td>8.9946</td>
<td>8.9697</td>
<td>8.9452</td>
<td>9.0649</td>
</tr>
<tr>
<td>postprocess time / s</td>
<td>0.0017</td>
<td>0.0017</td>
<td>0.0023</td>
<td>0.0017</td>
<td>0.0017</td>
<td>0.0018</td>
<td>0.0017</td>
<td>0.0017</td>
<td>0.0018</td>
<td>0.0016</td>
</tr>
</tbody></table>
<p><strong>preprocessing average time: 0.00227</strong></p>
<p><strong>model average time: 9.09162</strong></p>
<p><strong>postprocessing average time: 0.00177</strong></p>
<ol start="3">
<li>Results</li>
</ol>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8ol8on2b6j307h0b4ab1.jpg" alt="img"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8ol8t9igaj307h0b4wed.jpg" alt="img"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/11/05/DevOps/2017-11-05-Git%20Graph/">DevOps/2017-11-05-Git Graph</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-05</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Git/">Git</a></span><div class="content"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[alias]</span><br><span class="line">lg1 &#x3D; log --graph --abbrev-commit --decorate --format&#x3D;format:&#39;%C(bold blue)%h%C(reset) - %C(bold green)(%ar)%C(reset) %C(white)%s%C(reset) %C(dim white)- %an%C(reset)%C(bold yellow)%d%C(reset)&#39; --all</span><br><span class="line">lg2 &#x3D; log --graph --abbrev-commit --decorate --format&#x3D;format:&#39;%C(bold blue)%h%C(reset) - %C(bold cyan)%aD%C(reset) %C(bold green)(%ar)%C(reset)%C(bold yellow)%d%C(reset)%n&#39;&#39;          %C(white)%s%C(reset) %C(dim white)- %an%C(reset)&#39; --all</span><br><span class="line">lg &#x3D; !&quot;git lg1&quot;</span><br></pre></td></tr></table></figure>



<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8mz5ui0t5j31bm0u0b29.jpg" alt="image-20191105105414329"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/11/05/DevOps/2019-11-05-docker%20pycharm%E9%85%8D%E7%BD%AE/">DevOps/2019-11-05-docker pycharm配置</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-11-05</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Docker/">Docker</a></span><div class="content"><h3 id="docker-ssh配置"><a href="#docker-ssh配置" class="headerlink" title="docker ssh配置"></a>docker ssh配置</h3><h5 id="Concept"><a href="#Concept" class="headerlink" title="Concept"></a>Concept</h5><p>进行实验时用挂载的，让本地跟docker内的文件夹一样</p>
<p>#####新建docker container</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nvidia-docker run -it -p [host_port]:[container_port](<span class="keyword">do</span> not use 8888) --name:[container_name] [image_name] -v [container_path]:[host_path] /bin/bash</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nvidia-docker run -p 5592:5592 -p 5593:5593 -p 8022:22 --name=<span class="string">"liuzhen_tf"</span> -v ~/workspace/liuzhen/remote_workspace:/workspace/liuzhen/remote_workspace -it tensorflow/tensorflow:latest-gpu /bin/bash</span><br></pre></td></tr></table></figure>

<h5 id="配置ssh服务"><a href="#配置ssh服务" class="headerlink" title="配置ssh服务"></a>配置ssh服务</h5><p>在新建的容器内配置ssh，安装openssh-server</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ apt update</span><br><span class="line">$ apt install -y openssh-server</span><br></pre></td></tr></table></figure>

<p>P.S. Solve Aliyun problems</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/apt/sources.list.d</span><br><span class="line">cp sources-aliyun-0.list sources-aliyun-0.list.bak   <span class="comment"># 保留原版本以防改错</span></span><br></pre></td></tr></table></figure>

<p><strong>将 sources-aliyun-0.list 内的内容替换成以下内容</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse</span><br><span class="line"><span class="comment">##测试版源</span></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-proposed main restricted universe multiverse</span><br><span class="line"><span class="comment"># 源码</span></span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse</span><br><span class="line"><span class="comment">##测试版源</span></span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial-proposed main restricted universe multiverse</span><br><span class="line"><span class="comment"># Canonical 合作伙伴和附加</span></span><br><span class="line">deb http://archive.canonical.com/ubuntu/ xenial partner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">then</span>, </span><br><span class="line">apt-get update</span><br></pre></td></tr></table></figure>

<p>设置ssh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir /var/run/sshd</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'root:passwd'</span> | chpasswd</span><br><span class="line"><span class="comment"># 这里使用你自己想设置的用户名和密码，passwd是此处设置的密码</span></span><br><span class="line">$ sed -i <span class="string">'s/PermitRootLogin prohibit-password/PermitRootLogin yes/'</span> /etc/ssh/sshd_config</span><br><span class="line">$ sed <span class="string">'s@session\s*required\s*pam_loginuid.so@session optional pam_loginuid.so@g'</span> -i /etc/pam.d/sshd</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"export VISIBLE=now"</span> &gt;&gt; /etc/profile</span><br></pre></td></tr></table></figure>

<h5 id="重启ssh激活配置"><a href="#重启ssh激活配置" class="headerlink" title="重启ssh激活配置"></a>重启ssh激活配置</h5><p>(<u>最常见的问题</u>就是docker容器停了以后里面的SSH服务也会相应停止，因此当你发现自己某一天连不上的时候，记得去docker里重启一下ssh服务：)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ service ssh restart</span><br></pre></td></tr></table></figure>

<p>在服务器（宿主机）上（不是服务器的docker里）测试刚刚新建docker容器中哪个端口转发到了服务器的22端口：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker port [your_container_name] 22</span><br><span class="line"><span class="comment"># 如果前面的配置生效了，你会看到如下输出</span></span><br><span class="line"><span class="comment"># 0.0.0.0:8022</span></span><br></pre></td></tr></table></figure>

<p>最后测试能否用SSH连接到远程docker：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ssh root@[your_host_ip] -p 8022</span><br><span class="line"><span class="comment"># 密码是你前面自己设置的</span></span><br></pre></td></tr></table></figure>

<h3 id="pycharm配置"><a href="#pycharm配置" class="headerlink" title="pycharm配置"></a>pycharm配置</h3><h5 id="打开本地代码"><a href="#打开本地代码" class="headerlink" title="打开本地代码"></a>打开本地代码</h5><p>打开PyCharm<code>Tools &gt; Deployment &gt; Configuration</code></p>
<p>#####新建服务器SFTP</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6gtkcxaeaj315r0u03zh.jpg" alt="image-20190828175349739"></p>
<p>输入如下图配置，注意这里的端口是你刚刚设置的映射到容器22端口的宿主机中的端口，我这里使用的是8022，账号密码是你刚刚自己设置的，这里的Root Path设置一个远程docker容器里的路径。</p>
<p>在Mappings中配置路径，这里的路径是你本地存放代码的路径，与刚刚配置的<em>Root Path</em>相互映射（意思是Mapping里本机的路径映射到远程的Root Path）<em>，</em>方便以后在本地和远程docker中进行代码和其他文件同步。</p>
<p>#####配置远程解释器</p>
<p>打开PyCharm<code>Preferences &gt; Project Interpreter</code></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6gtlykktsj317a0u0q4w.jpg" alt="image-20190828190716498"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6gtrxo163j307705et8o.jpg" alt=""></p>
<p>新建ssh Interpreter</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6gtml7aj1j31d30u0aam.jpg" alt="image-20190828191025481"></p>
<h5 id="配置运行环境变量"><a href="#配置运行环境变量" class="headerlink" title="配置运行环境变量"></a>配置运行环境变量</h5><p><code>run &gt; edit confuriguration</code></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6gtmztm35j30r80sk758.jpg" alt="image-20190828191253964"></p>
<h3 id="docker-jupyter使用"><a href="#docker-jupyter使用" class="headerlink" title="docker jupyter使用"></a>docker jupyter使用</h3><p>jupyter-notebook的默认端口号是8888，映射几个外部端口，如前面的5592</p>
<p>更新apt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br></pre></td></tr></table></figure>

<p>安装jupyter</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install jupyter</span><br></pre></td></tr></table></figure>

<p>(注意pip install jupyter notebook==5.7.5，高版本有bug –&gt; mp4无法播放)</p>
<p>配置jupyter</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">生成jupyter配置文件，这个会生成配置文件.jupyter/jupyter_notebook_config.py</span></span><br><span class="line">jupyter notebook --generate-config</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">使用ipython生成密码</span></span><br><span class="line">In [1]: from notebook.auth import passwd</span><br><span class="line">In [2]: passwd()</span><br><span class="line">Enter password: </span><br><span class="line">Verify password: </span><br><span class="line">Out[2]: 'sha1:38a5ecdf288b:c82dace8d3c7a212ec0bd49bbb99c9af3bae076e'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">去配置文件.jupyter/jupyter_notebook_config.py中修改以下参数</span></span><br><span class="line">c.NotebookApp.ip='*'                          #绑定所有地址</span><br><span class="line">c.NotebookApp.password = u'sha1:38a5ecdf288b:c82dace8d3c7a212ec0bd49bbb99c9af3bae076e'</span><br><span class="line">c.NotebookApp.open_browser = False            #启动后是否在浏览器中自动打开</span><br><span class="line">c.NotebookApp.port =5592                      #指定一个访问端口，默认8888，注意和映射的docker端口对应</span><br><span class="line">c.NotebookApp.allow_remote_access = True</span><br><span class="line">c.NotebookApp.allow_root = True               #allow the user to run the notebook as root</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> jupyter notebook</span></span><br></pre></td></tr></table></figure>



<h4 id="指定源下载"><a href="#指定源下载" class="headerlink" title="指定源下载"></a>指定源下载</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple jupyter notebook==<span class="number">5.7</span><span class="number">.5</span></span><br></pre></td></tr></table></figure>



<h4 id="Check-whether-a-port-it-Listening"><a href="#Check-whether-a-port-it-Listening" class="headerlink" title="Check whether a port it Listening"></a>Check whether a port it Listening</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">huangjiancong@hpc3:~$ ss -tulwn  | grep <span class="number">8023</span></span><br><span class="line">tcp    LISTEN     <span class="number">0</span>      <span class="number">128</span>      :::<span class="number">8023</span>                 :::*</span><br><span class="line">huangjiancong@hpc3:~$ ss -tulwn  | grep <span class="number">8023</span></span><br><span class="line">huangjiancong@hpc3:~$</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/10/25/OpenGL/2019-10-25-OpenGL%20-%20shader%206&amp;7/">OpenGL/2019-10-25-OpenGL - shader 6&amp;7</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-10-25</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/OpenGL/">OpenGL</a></span><div class="content"><h3 id=""><a href="#" class="headerlink" title=""></a></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">vertexSStream &lt;&lt; vertexFile.rdbuf();</span><br><span class="line">fragmentSStream &lt;&lt; fragmentFile.rdbuf();</span><br><span class="line"></span><br><span class="line">vertexString = vertexSStream.str();</span><br><span class="line">fragmentString = fragmentSStream.str();</span><br><span class="line"></span><br><span class="line">vertexSource = vertexString.c_str()</span><br><span class="line">fragmentSource = fragmentString.c_str()</span><br><span class="line"></span><br><span class="line">vertext = glCreateShader(GL_VERTEX_SHADER);</span><br><span class="line">glShaerSource(vertex, <span class="number">1</span>, &amp;vertexSource, <span class="literal">NULL</span>);</span><br><span class="line">glCompileShader(vertex);</span><br><span class="line"></span><br><span class="line">fragment = glCreateShader(GL_FRAGMENT_SHADER);</span><br><span class="line">glShaderSource(fragment, <span class="number">1</span>, &amp;fragmentSource, <span class="literal">NULL</span>);</span><br><span class="line">glCompileShader(fragment);</span><br><span class="line"></span><br><span class="line">ID = glCreateProgram();</span><br><span class="line">glAttachShader(ID, vertex);</span><br><span class="line">glAttachShader(ID, fragment);</span><br><span class="line">glLinkProgram(ID);</span><br><span class="line">glDeleteShader(vertex);</span><br><span class="line">glDeleteShader(fragment);</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Shader::user()&#123;</span><br><span class="line">  glUerProgram(ID);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/10/24/LC/2019-10-24-LC%20224%20Basic%20Calculator/">LC/2019-10-24-LC 224 Basic Calculator</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-10-24</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/F/">F</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/TODO/">TODO</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/ComeO/">ComeO</a></span><div class="content"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calculate</span><span class="params">(self, s: str)</span> -&gt; int:</span></span><br><span class="line">        res, num, sign = <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">        stack = []</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">            <span class="keyword">if</span> c.isdigit():</span><br><span class="line">                num = <span class="number">10</span> * num + int(c)</span><br><span class="line">            <span class="keyword">elif</span> c == <span class="string">"+"</span> <span class="keyword">or</span> c == <span class="string">"-"</span>:</span><br><span class="line">                res = res + sign * num</span><br><span class="line">                num = <span class="number">0</span></span><br><span class="line">                sign = <span class="number">1</span> <span class="keyword">if</span> c == <span class="string">"+"</span> <span class="keyword">else</span> <span class="number">-1</span></span><br><span class="line">            <span class="keyword">elif</span> c == <span class="string">"("</span>:</span><br><span class="line">                stack.append(res)</span><br><span class="line">                stack.append(sign)</span><br><span class="line">                res = <span class="number">0</span></span><br><span class="line">                sign = <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> c == <span class="string">")"</span>:</span><br><span class="line">                res = res + sign * num</span><br><span class="line">                num = <span class="number">0</span></span><br><span class="line">                res *= stack.pop()</span><br><span class="line">                res += stack.pop()</span><br><span class="line">        res = res + sign * num</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>





<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8bwh653lkj30ui0o213v.jpg" alt="image-20191026205957710"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8bx0dz21fj30vy0f2n35.jpg" alt="image-20191026211832001"></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8bx03clc4j30x007wjwk.jpg" alt="image-20191026211814852"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/10/24/LC/2019-10-24-LC%20692%20Top%20K%20Frequent%20Words/">LC/2019-10-24-LC 692 Top K Frequent Words</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-10-24</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/F/">F</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/TODO/">TODO</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/ComeO/">ComeO</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/PriorityQueue/">PriorityQueue</a></span><div class="content"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">topKFrequent</span><span class="params">(self, words: List[str], k: int)</span> -&gt; List[str]:</span></span><br><span class="line">        table = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> words:</span><br><span class="line">        <span class="comment">#     if word in table:</span></span><br><span class="line">        <span class="comment">#         table[word] += 1</span></span><br><span class="line">        <span class="comment">#     else:</span></span><br><span class="line">        <span class="comment">#         table[word] = 1</span></span><br><span class="line">            table[word] = table.get(word, <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line">        <span class="comment"># set up a max heap</span></span><br><span class="line">        heap = []</span><br><span class="line">        heapq.heapify(heap)</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> table:</span><br><span class="line">            heapq.heappush(heap, (-table[key], key))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># pop top k</span></span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(k):</span><br><span class="line">            popped = heapq.heappop(heap)</span><br><span class="line">            res.append(popped)</span><br><span class="line">            print(res)</span><br><span class="line">        <span class="comment"># sort res alphabetically</span></span><br><span class="line">        <span class="comment"># res.sort()</span></span><br><span class="line">        newres = []</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> res:</span><br><span class="line">            newres.append(word[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> newres</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/10/23/LC/2019-10-23-LC%20237%20Delete%20Node%20in%20a%20Linked%20List/">LC/2019-10-23-LC 237 Delete Node in a Linked List</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-10-23</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/F/">F</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/TODO/">TODO</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/ComeO/">ComeO</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Backpack/">Backpack</a></span><div class="content"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">deleteNode</span><span class="params">(self, node)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type node: ListNode</span></span><br><span class="line"><span class="string">        :rtype: void Do not return anything, modify node in-place instead.</span></span><br><span class="line"><span class="string">        """</span> </span><br><span class="line">        node.val = node.next.val</span><br><span class="line">        node.next = node.next.next</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/10/23/LC/2019-10-23-LC%20322%20&amp;%20518%20Coin%20Change%20%E2%85%A0%EF%BC%86%E2%85%A1/">LC/2019-10-23-LC 322 &amp; 518 Coin Change Ⅰ＆Ⅱ</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-10-23</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/F/">F</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/TODO/">TODO</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/ComeO/">ComeO</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Backpack/">Backpack</a></span><div class="content"><p>322</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">coinChange</span><span class="params">(self, coins: List[int], amount: int)</span> -&gt; int:</span></span><br><span class="line">        dp = [<span class="number">0</span>] + [float(<span class="string">'inf'</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(amount)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, amount+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> coin <span class="keyword">in</span> coins:</span><br><span class="line">                <span class="keyword">if</span> i - coin &gt;= <span class="number">0</span>:</span><br><span class="line">                    dp[i] = min(dp[i], dp[i-coin] + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> dp[<span class="number">-1</span>] == float(<span class="string">'inf'</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">-1</span>]</span><br></pre></td></tr></table></figure>



<p>518</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(self, amount: int, coins: List[int])</span> -&gt; int:</span></span><br><span class="line">        dp = [<span class="number">1</span>] + [<span class="number">0</span>] * (amount);    </span><br><span class="line">        <span class="keyword">for</span> coin <span class="keyword">in</span> coins:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(amount - coin + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> dp[i]:</span><br><span class="line">                    dp[i + coin] += dp[i]</span><br><span class="line">        <span class="keyword">return</span> dp[amount]</span><br></pre></td></tr></table></figure>

<p>Explanation:</p>
<p><a href="https://backtobackswe.com/videos/total-unique-ways-to-make-change" target="_blank" rel="noopener">https://backtobackswe.com/videos/total-unique-ways-to-make-change</a></p>
<p><a href="https://www.youtube.com/watch?v=1mtvm2ubHCY" target="_blank" rel="noopener">https://www.youtube.com/watch?v=1mtvm2ubHCY</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/10/22/LC/2019-10-22%20Review%20template%20for%20solving%20all%20substrings%20/">LC/2019-10-22 Review template for solving all substrings </a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-10-22</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Review/">Review</a></span><div class="content"><p>ref:</p>
<p><a href="https://leetcode.com/problems/minimum-window-substring/discuss/26808/Here-is-a-10-line-template-that-can-solve-most-&#39;substring&#39;-problems" target="_blank" rel="noopener">https://leetcode.com/problems/minimum-window-substring/discuss/26808/Here-is-a-10-line-template-that-can-solve-most-&#39;substring&#39;-problems</a></p>
<p>I will first give the solution then show you the magic template.</p>
<p>The code of solving this problem is below. It might be the shortest among all solutions provided in Discuss.</p>
<p>string minWindow(string s, string t) {<br>        vector<int> map(128,0);<br>        for(auto c: t) map[c]++;<br>        int counter=t.size(), begin=0, end=0, d=INT_MAX, head=0;<br>        while(end&lt;s.size()){<br>            if(map[s[end++]]–&gt;0) counter–; //in t<br>            while(counter==0){ //valid<br>                if(end-begin&lt;d)  d=end-(head=begin);<br>                if(map[s[begin++]]++==0) counter++;  //make it invalid<br>            }<br>        }<br>        return d==INT_MAX? “”:s.substr(head, d);<br>    }<br>Here comes the template.</p>
<p>For most substring problem, we are given a string and need to find a substring of it which satisfy some restrictions. A general way is to use a hashmap assisted with two pointers. The template is given below.</p>
<p>int findSubstring(string s){<br>        vector<int> map(128,0);<br>        int counter; // check whether the substring is valid<br>        int begin=0, end=0; //two pointers, one point to tail and one  head<br>        int d; //the length of substring</p>
<pre><code>for() { /* initialize the hash map here */ }

while(end&lt;s.size()){

    if(map[s[end++]]-- ?){  /* modify counter here */ }

    while(/* counter condition */){ 

         /* update d here if finding minimum*/

        //increase begin to make it invalid/valid again

        if(map[s[begin++]]++ ?){ /*modify counter here*/ }
    }  

    /* update d here if finding maximum*/
}
return d;</code></pre><p>  }<br>One thing needs to be mentioned is that when asked to find maximum substring, we should update maximum after the inner while loop to guarantee that the substring is valid. On the other hand, when asked to find minimum substring, we should update minimum inside the inner while loop.</p>
<p>The code of solving Longest Substring with At Most Two Distinct Characters is below:</p>
<p>int lengthOfLongestSubstringTwoDistinct(string s) {<br>        vector<int> map(128, 0);<br>        int counter=0, begin=0, end=0, d=0;<br>        while(end&lt;s.size()){<br>            if(map[s[end++]]++==0) counter++;<br>            while(counter&gt;2) if(map[s[begin++]]–==1) counter–;<br>            d=max(d, end-begin);<br>        }<br>        return d;<br>    }<br>The code of solving Longest Substring Without Repeating Characters is below:</p>
<p>Update 01.04.2016, thanks @weiyi3 for advise.</p>
<p>int lengthOfLongestSubstring(string s) {<br>        vector<int> map(128,0);<br>        int counter=0, begin=0, end=0, d=0;<br>        while(end&lt;s.size()){<br>            if(map[s[end++]]++&gt;0) counter++;<br>            while(counter&gt;0) if(map[s[begin++]]–&gt;1) counter–;<br>            d=max(d, end-begin); //while valid, update d<br>        }<br>        return d;<br>    }<br>I think this post deserves some upvotes! : )</p>
<p>substring</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/10/22/LC/2019-10-22-LC%20114%20Flatten%20Binary%20Tree%20to%20LinkedList/">LC/2019-10-22-LC 114 Flatten Binary Tree to LinkedList</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-10-22</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/F/">F</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Tree/">Tree</a></span><div class="content"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">flatten</span><span class="params">(self, root: TreeNode)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Do not return anything, modify root in-place instead.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        pre = <span class="literal">None</span></span><br><span class="line">        stack = [root]</span><br><span class="line">        <span class="keyword">while</span> stack:</span><br><span class="line">            r = stack.pop()</span><br><span class="line">            <span class="keyword">if</span> pre:</span><br><span class="line">                pre.left = <span class="literal">None</span></span><br><span class="line">                pre.right = r</span><br><span class="line">            pre = r</span><br><span class="line">            <span class="keyword">if</span> r.right:</span><br><span class="line">                stack.append(r.right)</span><br><span class="line">            <span class="keyword">if</span> r.left:</span><br><span class="line">                stack.append(r.left)</span><br></pre></td></tr></table></figure>





<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">    self.prev = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flatten</span><span class="params">(self, root)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    self.flatten(root.right)</span><br><span class="line">    self.flatten(root.left)</span><br><span class="line">    </span><br><span class="line">    root.right = self.prev</span><br><span class="line">    root.left = <span class="literal">None</span></span><br><span class="line">    self.prev = root</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/10/22/LC/2019-10-22-LC%20170%20Two%20Sum%20%E2%85%A2/">LC/2019-10-22-LC 170 Two Sum Ⅲ</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-10-22</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/TODO/">TODO</a></span><div class="content"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TwoSum</span>:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.d = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        self.d[n] = self.d.get(n, <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find</span><span class="params">(self, v)</span>:</span></span><br><span class="line">        d = self.d</span><br><span class="line">        <span class="keyword">for</span> nbr <span class="keyword">in</span> d:</span><br><span class="line">            t = v - nbr</span><br><span class="line">            <span class="keyword">if</span> t <span class="keyword">in</span> d <span class="keyword">and</span> d[t] - (t <span class="keyword">is</span> nbr):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/10/22/LC/2019-10-22-LC%2075%20Sort%20Colors/">LC/2019-10-22-LC 75 Sort Colors</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-10-22</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/F/">F</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/TODO/">TODO</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/ComeO/">ComeO</a></span><div class="content"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sortColors</span><span class="params">(self, nums: List[int])</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Do not return anything, modify nums in-place instead.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        p0 = curr = <span class="number">0</span></span><br><span class="line">        p2 = len(nums) - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> curr &lt;= p2:</span><br><span class="line">            <span class="keyword">if</span> nums[curr] == <span class="number">0</span>:</span><br><span class="line">                nums[curr], nums[p0] = nums[p0], nums[curr]</span><br><span class="line">                p0 += <span class="number">1</span></span><br><span class="line">                curr +=<span class="number">1</span></span><br><span class="line">                <span class="comment"># p0 ~ curr 的 elems 得要是唯一的</span></span><br><span class="line">            <span class="keyword">elif</span> nums[curr] == <span class="number">1</span>:</span><br><span class="line">                curr += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                nums[curr], nums[p2] = nums[p2], nums[curr]</span><br><span class="line">                p2 -= <span class="number">1</span></span><br><span class="line">                <span class="comment"># curr += 1    # for case [1,2,0] ==&gt; [1, 0, 2]</span></span><br><span class="line">            print(nums)</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/10/22/LC/2019-10-22-LC%2076%20Minimum%20Window%20Substring/">LC/2019-10-22-LC 76 Minimum Window Substring</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-10-22</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/F/">F</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/ComeO/">ComeO</a></span><div class="content"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minWindow</span><span class="params">(self, s: str, t: str)</span> -&gt; str:</span></span><br><span class="line">        <span class="keyword">if</span> len(s) &lt; len(t):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">        </span><br><span class="line">        need, missing = collections.Counter(t), len(t)</span><br><span class="line">        i = I = J = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j, c <span class="keyword">in</span> enumerate(s, <span class="number">1</span>):</span><br><span class="line">            missing -= need[c] &gt; <span class="number">0</span></span><br><span class="line">            need[c] -= <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> missing:</span><br><span class="line">                <span class="keyword">while</span> i &lt; j <span class="keyword">and</span> need[s[i]] &lt; <span class="number">0</span>:</span><br><span class="line">                    need[s[i]] += <span class="number">1</span></span><br><span class="line">                    i += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> J <span class="keyword">or</span> j - i &lt;= J - I:</span><br><span class="line">                    I, J = i, j</span><br><span class="line">        <span class="keyword">return</span> s[I:J]</span><br></pre></td></tr></table></figure>





<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g89lynhipfj30es05p75d.jpg" alt="image-20191024212508416"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/10/21/LC/2019-10-21-LC%20105%20&amp;%20106%20Construct%20Binary%20Tree%20from%20Preorder%20and%20Inorder%20Trav;%20Postorder%20&amp;%20Inorder%20Trav/">LC/2019-10-21-LC 105 &amp; 106 Construct Binary Tree from Preorder and Inorder Trav; Postorder &amp; Inorder Trav</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-10-21</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/F/">F</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Tree/">Tree</a></span><div class="content"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"># class TreeNode:</span></span><br><span class="line"><span class="comment">#     def __init__(self, x):</span></span><br><span class="line"><span class="comment">#         self.val = x</span></span><br><span class="line"><span class="comment">#         self.left = None</span></span><br><span class="line"><span class="comment">#         self.right = None</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">buildTree</span><span class="params">(self, preorder: List[int], inorder: List[int])</span> -&gt; TreeNode:</span></span><br><span class="line">        <span class="keyword">if</span> inorder:</span><br><span class="line">            ind = inorder.index(preorder.pop(<span class="number">0</span>))</span><br><span class="line">            root = TreeNode(inorder[ind])</span><br><span class="line">            root.left = self.buildTree(preorder, inorder[<span class="number">0</span>:ind])</span><br><span class="line">            root.right = self.buildTree(preorder, inorder[ind+<span class="number">1</span>:])</span><br><span class="line">            <span class="keyword">return</span> root</span><br></pre></td></tr></table></figure>





<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">buildTree</span><span class="params">(self, inorder: List[int], postorder: List[int])</span> -&gt; TreeNode:</span></span><br><span class="line"><span class="comment">#         if inorder and postorder:</span></span><br><span class="line"><span class="comment">#             ind = inorder.index(postorder.pop())</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#             node = TreeNode(inorder[ind])</span></span><br><span class="line"><span class="comment">#             node.left = self.buildTree(inorder[:ind], postorder)</span></span><br><span class="line"><span class="comment">#             node.right = self.buildTree(inorder[ind+1:], postorder)</span></span><br><span class="line"><span class="comment">#             return node</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> inorder <span class="keyword">or</span> <span class="keyword">not</span> postorder:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">        root = TreeNode(postorder.pop())</span><br><span class="line">        inorderIndex = inorder.index(root.val)</span><br><span class="line"></span><br><span class="line">        root.right = self.buildTree(inorder[inorderIndex+<span class="number">1</span>:], postorder)</span><br><span class="line">        root.left = self.buildTree(inorder[:inorderIndex], postorder)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/10/21/LC/2019-10-21-LC%20108%20&amp;%20109%20Convert%20Sorted%20Array%E3%80%81LinkedList%20to%20BST/">LC/2019-10-21-LC 108 &amp; 109 Convert Sorted Array、LinkedList to BST</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-10-21</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/TODO/">TODO</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Michelle/">Michelle</a></span><div class="content"><h3 id="108"><a href="#108" class="headerlink" title="108"></a>108</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sortedArrayToBST</span><span class="params">(self, nums: List[int])</span> -&gt; TreeNode:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> nums:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">        mid = len(nums)//<span class="number">2</span></span><br><span class="line">        print(mid)</span><br><span class="line">        node = TreeNode(nums[mid])</span><br><span class="line">        node.left = self.sortedArrayToBST(nums[:mid])</span><br><span class="line">        node.right = self.sortedArrayToBST(nums[mid+<span class="number">1</span>:])</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> node</span><br></pre></td></tr></table></figure>

<h3 id="109"><a href="#109" class="headerlink" title="109"></a>109</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sortedListToBST</span><span class="params">(self, head: ListNode)</span> -&gt; TreeNode:</span></span><br><span class="line">        tree = []</span><br><span class="line">        <span class="keyword">while</span> head:</span><br><span class="line">            tree.append(head.val)</span><br><span class="line">            head = head.next</span><br><span class="line">        root = self.constructTree(tree)        </span><br><span class="line">        <span class="keyword">return</span> root</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">constructTree</span><span class="params">(self, tree)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> tree:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        mid = len(tree)//<span class="number">2</span></span><br><span class="line">        root = TreeNode(tree[mid])</span><br><span class="line">        root.left = self.constructTree(tree[:mid])</span><br><span class="line">        root.right = self.constructTree(tree[mid+<span class="number">1</span>:])</span><br><span class="line">        <span class="keyword">return</span> root</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sortedListToBST</span><span class="params">(self, head)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> head:</span><br><span class="line">        <span class="keyword">return</span> </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> head.next:</span><br><span class="line">        <span class="keyword">return</span> TreeNode(head.val)</span><br><span class="line">    <span class="comment"># here we get the middle point,</span></span><br><span class="line">    <span class="comment"># even case, like '1234', slow points to '2',</span></span><br><span class="line">    <span class="comment"># '3' is root, '12' belongs to left, '4' is right</span></span><br><span class="line">    <span class="comment"># odd case, like '12345', slow points to '2', '12'</span></span><br><span class="line">    <span class="comment"># belongs to left, '3' is root, '45' belongs to right</span></span><br><span class="line">    slow, fast = head, head.next.next</span><br><span class="line">    <span class="keyword">while</span> fast <span class="keyword">and</span> fast.next:</span><br><span class="line">        fast = fast.next.next</span><br><span class="line">        slow = slow.next</span><br><span class="line">    <span class="comment"># tmp points to root</span></span><br><span class="line">    tmp = slow.next</span><br><span class="line">    <span class="comment"># cut down the left child</span></span><br><span class="line">    slow.next = <span class="literal">None</span></span><br><span class="line">    root = TreeNode(tmp.val)</span><br><span class="line">    root.left = self.sortedListToBST(head)</span><br><span class="line">    root.right = self.sortedListToBST(tmp.next)</span><br><span class="line">    <span class="keyword">return</span> root</span><br></pre></td></tr></table></figure></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/10/21/LC/2019-10-21-LC%20124%20Binary%20Tree%20Max%20Path%20Sum/">LC/2019-10-21-LC 124 Binary Tree Max Path Sum</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-10-21</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/F/">F</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/TODO/">TODO</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Tree/">Tree</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/ComeO/">ComeO</a></span><div class="content"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"># class TreeNode:</span></span><br><span class="line"><span class="comment">#     def __init__(self, x):</span></span><br><span class="line"><span class="comment">#         self.val = x</span></span><br><span class="line"><span class="comment">#         self.left = None</span></span><br><span class="line"><span class="comment">#         self.right = None</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxPathSum</span><span class="params">(self, root: TreeNode)</span> -&gt; int:</span></span><br><span class="line">    <span class="comment"># def maxPathSum(self, root):</span></span><br><span class="line">        self.max_so_far = float(<span class="string">'-inf'</span>)</span><br><span class="line">        self.helper(root) <span class="comment"># Maximum sum starting from root</span></span><br><span class="line">        <span class="keyword">return</span> self.max_so_far</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(self, root)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type root: TreeNode</span></span><br><span class="line"><span class="string">        :rtype: int</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> root == <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        lresult = self.helper(root.left) <span class="comment"># Maximum sum starting from root.left</span></span><br><span class="line">        rresult = self.helper(root.right) <span class="comment"># Maximum sum starting from root.left</span></span><br><span class="line">        self.max_so_far = max(max(lresult, <span class="number">0</span>) + max(rresult, <span class="number">0</span>) + root.val, self.max_so_far)</span><br><span class="line">        <span class="keyword">return</span> max(lresult, rresult, <span class="number">0</span>) + root.val <span class="comment"># Return maximum sum starting from root</span></span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/10/21/LC/2019-10-21-LC%20339%20Nested%20List%20Weight%20Sum/">LC/2019-10-21-LC 339 Nested List Weight Sum</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-10-21</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/F/">F</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/DFS/">DFS</a></span><div class="content"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">depthSum</span><span class="params">(self, nestedList: List[NestedInteger])</span> -&gt; int:</span></span><br><span class="line">        counter = <span class="number">0</span></span><br><span class="line">        queue = [(<span class="number">1</span>, e) <span class="keyword">for</span> e <span class="keyword">in</span> nestedList]</span><br><span class="line">        <span class="keyword">while</span> queue:</span><br><span class="line">            weight, e = queue.pop(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> e.isInteger():</span><br><span class="line">                counter += e.getInteger()*weight</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">for</span> child_list <span class="keyword">in</span> e.getList():</span><br><span class="line">                    queue.append((weight+<span class="number">1</span>, child_list))</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">return</span> counter</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/10/20/LC/2019-10-20-LC%20155%20Min%20Stack/">LC/2019-10-20-LC 155 Min Stack</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-10-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><div class="content"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinStack</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        initialize your data structure here.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.stack = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, x: int)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        self.stack += [x]        </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(self)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.stack.pop(<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">top</span><span class="params">(self)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> self.stack[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getMin</span><span class="params">(self)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> min(self.stack)</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/10/20/LC/2019-10-20-LC%20783%20Min%20Distance%20btw%20BST%20Nodes/">LC/2019-10-20-LC 783 Min Distance btw BST Nodes</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-10-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/F/">F</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/LC/">LC</a></span><div class="content"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  pre = -float(<span class="string">'inf'</span>)</span><br><span class="line">  res = float(<span class="string">'inf'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">minDiffInBST</span><span class="params">(self, root)</span>:</span></span><br><span class="line">      <span class="keyword">if</span> root <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">      </span><br><span class="line">      self.minDiffInBST(root.left)</span><br><span class="line"><span class="comment"># evaluate and set the current node as the node previously evaluated</span></span><br><span class="line">      self.res = min(self.res, root.val - self.pre)</span><br><span class="line">      self.pre = root.val</span><br><span class="line"></span><br><span class="line">      self.minDiffInBST(root.right)</span><br><span class="line">      <span class="keyword">return</span> self.res</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    pre = -float(<span class="string">'inf'</span>)</span><br><span class="line">    res = float(<span class="string">'inf'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minDiffInBST</span><span class="params">(self, root)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> root.left:</span><br><span class="line">            self.minDiffInBST(root.left)</span><br><span class="line">        self.res = min(self.res, root.val - self.pre)</span><br><span class="line">        self.pre = root.val</span><br><span class="line">        <span class="keyword">if</span> root.right:</span><br><span class="line">            self.minDiffInBST(root.right)</span><br><span class="line">        <span class="keyword">return</span> self.res</span><br></pre></td></tr></table></figure>





<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minDiffInBST</span><span class="params">(self, root)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type root: TreeNode</span></span><br><span class="line"><span class="string">        :rtype: int</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        diff = float(<span class="string">'inf'</span>) <span class="comment"># Largest possible difference</span></span><br><span class="line">        last_visited_node = <span class="literal">None</span> <span class="comment"># Track the last visited node in the sorted sequence to calculate difference in between adjacent elements. </span></span><br><span class="line">        stack = [] <span class="comment"># For Iterative in-order traversal</span></span><br><span class="line">        node = root</span><br><span class="line">        <span class="keyword">while</span> stack <span class="keyword">or</span> node <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> node <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                stack.append(node)</span><br><span class="line">                node = node.left</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                node = stack.pop()</span><br><span class="line">                <span class="keyword">if</span> last_visited_node <span class="keyword">and</span> node.val - last_visited_node.val &lt; diff:</span><br><span class="line">                    diff = node.val - last_visited_node.val  </span><br><span class="line">                last_visited_node = node</span><br><span class="line">                node = node.right</span><br><span class="line">        <span class="keyword">return</span> diff</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/10/20/LC/2019-10-20-LC%20938%20Range%20Sum%20of%20BST/">LC/2019-10-20-LC 938 Range Sum of BST</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-10-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/F/">F</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Tree/">Tree</a></span><div class="content"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"># class TreeNode:</span></span><br><span class="line"><span class="comment">#     def __init__(self, x):</span></span><br><span class="line"><span class="comment">#         self.val = x</span></span><br><span class="line"><span class="comment">#         self.left = None</span></span><br><span class="line"><span class="comment">#         self.right = None</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rangeSumBST</span><span class="params">(self, root: TreeNode, L: int, R: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root: </span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        ret = self.rangeSumBST(root.left, L, R)</span><br><span class="line">        <span class="keyword">if</span> L &lt;= root.val &lt;= R:</span><br><span class="line">            ret += root.val </span><br><span class="line">        ret += self.rangeSumBST(root.right, L, R)</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ret</span><br></pre></td></tr></table></figure>

</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By Joe Huang</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>