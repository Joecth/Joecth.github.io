<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="Joe Huang"><meta name="copyright" content="Joe Huang"><title>Awaken Desparado</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-180692466-1', 'auto');
ga('send', 'pageview');</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Joe Huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">406</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">26</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">73</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Awaken Desparado</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Awaken Desparado</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2023/05/29/AI-System/2%20AI%20Compiler/">AI-System/2 AI Compiler</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-05-29</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/AI-System/">AI-System</a></span><div class="content"><h1 id="Why-we-need-AI-Compiler"><a href="#Why-we-need-AI-Compiler" class="headerlink" title="Why we need AI Compiler"></a>Why we need AI Compiler</h1><ul>
<li>OPs ↑</li>
<li>HW vendors release similar libs, e.g. CuDNN, MKL-DNN for their own chips</li>
<li>Transplanation issue, e.g. CPU &amp; GPU’s existing  Pass hard to be transplanted to NPU</li>
</ul>
<h1 id="AI-Compiler"><a href="#AI-Compiler" class="headerlink" title="AI Compiler"></a>AI Compiler</h1><ul>
<li>auto optimize the process/code</li>
<li>Introduce Pass</li>
<li>FE -&gt; Opt -&gt; BE</li>
<li>Main purpose –&gt; Optiize the performance, and then make coding easier</li>
</ul>
<img src="https://p.ipic.vip/hvdjk2.png" alt="image-20230602171205297" style="zoom:33%;" />



<h3 id="Difference-from-Traditional-Compiler"><a href="#Difference-from-Traditional-Compiler" class="headerlink" title="Difference from Traditional Compiler"></a>Difference from Traditional Compiler</h3><p><img src="https://p.ipic.vip/vsjbeo.png" alt="image-20230602171410674"></p>
<ul>
<li>IR <ul>
<li>for AI<ul>
<li>High-level IR, to describe the computational graph</li>
</ul>
</li>
<li>for Traditional IR<ul>
<li>Low-level IR, e.g. load, store</li>
</ul>
</li>
</ul>
</li>
<li>Pass<ul>
<li>for AI<ul>
<li>OPs fusion</li>
<li>able for Quantization</li>
</ul>
</li>
<li>for Traditional <ul>
<li>no Quantization</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="AI-Compiler-Architecture"><a href="#AI-Compiler-Architecture" class="headerlink" title="AI Compiler Architecture"></a>AI Compiler Architecture</h1><p>Purposes: Inference or Train?!</p>
<ul>
<li>Python as FE interpreter</li>
<li>Multilevel IR, including graph-compilzation, OP compilation, code-gen</li>
<li>for NN</li>
<li>DSA for chips</li>
</ul>
<h3 id="History"><a href="#History" class="headerlink" title="History"></a>History</h3><p><img src="https://p.ipic.vip/o4kzrn.png" alt="image-20230602171958136"></p>
<p>I had experiences in Stage I in 2017~early2019</p>
<p>and now being involved in Stage II</p>
<h4 id="Stage-II"><a href="#Stage-II" class="headerlink" title="Stage II"></a>Stage II</h4><img src="https://p.ipic.vip/6y3qzh.png" alt="image-20230602172529020" style="zoom:67%;" />



<h4 id="Stage-III"><a href="#Stage-III" class="headerlink" title="Stage III"></a>Stage III</h4><p><img src="https://p.ipic.vip/vgjo4j.png" alt="image-20230602172708408"></p>
<p>ref: <a href="https://youtu.be/bW3gsz9AjPY" target="_blank" rel="noopener">AI videos series</a> on YT  </p>
<h3 id="General-Architecture"><a href="#General-Architecture" class="headerlink" title="General Architecture"></a>General Architecture</h3><p><img src="https://p.ipic.vip/gr6gg4.png" alt="image-20230602190537524"></p>
<p>From paper – <u><em>The Deep LearningCompiler: A Comprehensive Survey</em></u></p>
<ul>
<li><p>IR - </p>
<ol>
<li><p>High-level</p>
</li>
<li><p>Low-level</p>
</li>
</ol>
</li>
<li><p>FE Opti.</p>
<p>compose graph with python language</p>
<ol>
<li>Nodes level –  zero-dim-tensor elimination, Nop elimination</li>
<li>Block level – algebraic simplify, constant folding ,op fusion</li>
<li>Data Stream level –  Common sub-expression elimination, DCE(data communcation equip.)</li>
</ol>
</li>
<li><p>BE Opti.</p>
<ol>
<li>Spefific hardware<ul>
<li>low-level IR –&gt; LLVM IR –&gt; GPU/CPU codegen</li>
<li>Domain knowhow</li>
</ul>
</li>
<li>Auto-adjustment<ul>
<li>Halide/TVM allows the <strong>Separatino of Scheduleing and Compute</strong></li>
<li><u>Polyhedral model</u> for param adjustment</li>
</ul>
</li>
<li>Kernel libs<ul>
<li>from libs, e.g. NVidia’s lib</li>
</ul>
</li>
</ol>
</li>
</ul>
<p><img src="https://p.ipic.vip/3orvbk.png" alt="image-20230602191320979"></p>
<h1 id="Challenges-amp-Future"><a href="#Challenges-amp-Future" class="headerlink" title="Challenges &amp; Future"></a>Challenges &amp; Future</h1><ol>
<li><p>Dynamic Shape problems</p>
</li>
<li><p>Python Static<br><img src="https://p.ipic.vip/j07i81.png" alt="image-20230602192507040"></p>
<p><img src="https://p.ipic.vip/agcvp6.png" alt="image-20230602192610709"></p>
</li>
<li><p>Specific Optimization </p>
<ul>
<li>auto parallel<ul>
<li>Scale out </li>
<li>Scale up</li>
</ul>
</li>
<li>HPC for Jacobian matrix, for Hessian matrix</li>
</ul>
</li>
<li><p>Transparency </p>
</li>
<li><p>Compiling cost、Overhead</p>
</li>
</ol>
<ul>
<li>Umifying representation of graph?</li>
<li>Umifying optimization for compilation?</li>
</ul>
<p><img src="https://p.ipic.vip/ypwr0w.png" alt="image-20230602193127645"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/05/27/AI-System/1%20Traditional%20Compilers%20/">AI-System/1 Traditional Compilers </a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-05-27</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/AI-System/">AI-System</a></span><div class="content"><p>Interpreter VS Compiler</p>
<p>JIT vs AOT</p>
<p>Pass &amp; IR</p>
<h2 id="History-of-Compilers-–-GCC-VS-LLVM"><a href="#History-of-Compilers-–-GCC-VS-LLVM" class="headerlink" title="History of Compilers – GCC VS LLVM"></a>History of Compilers – GCC VS LLVM</h2><p><img src="https://p.ipic.vip/wjd955.png" alt="image-20230602161322366"></p>
<p>Compiler –  e.g. turn hello.c to hello.o(binary)</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Sourcecode --&gt; 		Compiler --&gt; 		exe binary</span><br><span class="line">​						(FE, IR Optimizer, BE)</span><br><span class="line">(to AST)												(MachineCode)</span><br><span class="line">Abstract Syntax Tree</span><br></pre></td></tr></table></figure>





<p>GCC 1.0 @ 1987</p>
<img src="https://p.ipic.vip/5y76rq.png" alt="image-20230602160844823" style="zoom:50%;" />

<p>​                        Free the Free!</p>
<p>(Richard Matthew Stallman)</p>
<p>Apple – Free! but OS kernel pretty closed</p>
<p><img src="https://p.ipic.vip/mxxzdg.png" alt="image-20230602161010238"></p>
<h3 id="Apple-met-LLVM"><a href="#Apple-met-LLVM" class="headerlink" title="Apple met LLVM"></a>Apple met LLVM</h3><img src="https://p.ipic.vip/lm33h3.png" alt="image-20230602161146709" style="zoom: 25%;" />





<h3 id="GCC"><a href="#GCC" class="headerlink" title="GCC"></a>GCC</h3><img src="https://p.ipic.vip/bcso75.png" alt="image-20230602161456787" style="zoom: 50%;" />

<img src="https://p.ipic.vip/eht8wd.png" alt="image-20230602161738949" style="zoom:67%;" />





<h3 id="LLVM"><a href="#LLVM" class="headerlink" title="LLVM"></a>LLVM</h3><p>low level VM</p>
<p>Compiler Toolchain</p>
<img src="https://p.ipic.vip/wwjwth.png" alt="image-20230602161604175" style="zoom: 67%;" />





<p>Introduced IR! bettern than GCC</p>
<img src="https://p.ipic.vip/4jgjjm.png" alt="image-20230602161815300" style="zoom:67%;" />





<h2 id="CLANG-VS-GCC"><a href="#CLANG-VS-GCC" class="headerlink" title="CLANG VS GCC"></a>CLANG VS GCC</h2><p><img src="https://p.ipic.vip/cqugk4.png" alt="image-20230602162331702"></p>
<p><img src="https://p.ipic.vip/304pgi.png" alt="image-20230602162406871"></p>
<p><img src="https://p.ipic.vip/n0rsd7.png" alt="image-20230602162448009"></p>
<p><img src="https://p.ipic.vip/rtj8ia.png" alt="image-20230602162529839"></p>
<p>​    - *.ll  – huan readable</p>
<ul>
<li><pre><code class="bash">&gt; clang -emit-llvm hello.i -c -o hello.bc
&gt; code hello.bc
&gt; od -b hello.bc

$ clang -ccc-print-phases hello.cpp
               +- 0: input, <span class="string">"hello.cpp"</span>, c++
            +- 1: preprocessor, {0}, c++-cpp-output
         +- 2: compiler, {1}, ir
      +- 3: backend, {2}, assembler
   +- 4: assembler, {3}, object
+- 5: linker, {4}, image
6: <span class="built_in">bind</span>-arch, <span class="string">"arm64"</span>, {5}, image

(base)
<span class="comment"># joe @ J-M1-Pro-16 in ~/exp [16:35:49]</span>
$ cat hello.s | less
    .cfi_endproc
                                        ; -- End <span class="keyword">function</span>
    .p2align    2                               ; -- Begin <span class="keyword">function</span> _ZNSt3__18ios_base8setstateEj
__ZNSt3__18ios_base8setstateEj:         ; @_ZNSt3__18ios_base8setstateEj
    .cfi_startproc
; %bb.0:
    sub    sp, sp, <span class="comment">#32</span>
    stp    x29, x30, [sp, <span class="comment">#16]             ; 16-byte Folded Spill</span>
        .section        __TEXT,__text,regular,pure_instructions
        .build_version macos, 12, 0     sdk_version 12, 3
        .globl  _main                           ; -- Begin <span class="keyword">function</span> main
        .p2align        2
_main:                                  ; @main
        .cfi_startproc
; %bb.0:
        stp     x29, x30, [sp, <span class="comment">#-16]!           ; 16-byte Folded Spill</span>
        mov     x29, sp
        .cfi_def_cfa w29, 16
        .cfi_offset w30, -8
        .cfi_offset w29, -16
        adrp    x0, l_.str@PAGE
        add     x0, x0, l_.str@PAGEOFF
        bl      _printf
        adrp    x0, __ZNSt3__14coutE@GOTPAGE
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### LLVM IR★</span><br><span class="line"></span><br><span class="line">![image-20230602163418928](https:&#x2F;&#x2F;p.ipic.vip&#x2F;e85fsn.png)</span><br><span class="line"></span><br><span class="line">- SSA - Static Single Assignment </span><br><span class="line">  - ~  RISC ISA</span><br><span class="line">  - 3-address-code</span><br><span class="line">    - &lt;img src&#x3D;&quot;https:&#x2F;&#x2F;p.ipic.vip&#x2F;jwvvo5.png&quot; alt&#x3D;&quot;image-20230602163826992&quot; style&#x3D;&quot;zoom:33%;&quot; &#x2F;&gt;</span><br><span class="line">  - inf registers</span><br><span class="line">- Structure</span><br><span class="line">  - Module -&gt; Function -&gt; Basicblock -&gt; Instruction</span><br><span class="line">- Concepts</span><br><span class="line">  - Value, Use, User, </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### LLVM FE</span><br><span class="line"></span><br><span class="line">&lt;img src&#x3D;&quot;https:&#x2F;&#x2F;p.ipic.vip&#x2F;qtr860.png&quot; alt&#x3D;&quot;image-20230602164519532&quot; style&#x3D;&quot;zoom: 50%;&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">- Lexical Analysis --&gt; Syntatical Analysis --&gt; Semantic Analysis</span><br><span class="line"></span><br><span class="line">  - &#96;&#96;&#96;&#96;bash</span><br><span class="line">    10018  clang -cc1 -dump-tokens hello.cpp</span><br><span class="line">    10019  clang -fsyntax-only -Xclang -ast-dump hello.cpp</span><br><span class="line">    10020  clang -c hello.cpp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### LLVM Optimizer</span><br><span class="line"></span><br><span class="line">- Finding PASS</span><br><span class="line"></span><br><span class="line">  - Analysis Pass</span><br><span class="line"></span><br><span class="line">  - Transform pass</span><br><span class="line"></span><br><span class="line">  - &#96;&#96;&#96;	bash</span><br><span class="line">    &gt; opt hello.bc -instcount -time-passes -domtree -o hello-tmp.bc -stats</span><br></pre></td></tr></table></figure>

- [LLVM’s Analysis and Transform Passes — LLVM 17.0.0git documentation](https://llvm.org/docs/Passes.html)

  - e.g. -adce: Aggressive Dead Code Elimination
  - e.g.  -constmerge: Merge Duplicate Global Constants

- ModulePass, FunctionPass, BasicBlockPass


</code></pre>
</li>
</ul>
<h3 id="LLVM-BE"><a href="#LLVM-BE" class="headerlink" title="LLVM BE"></a>LLVM BE</h3><img src="/Users/joe/Library/Application Support/typora-user-images/image-20230602165508513.png" alt="image-20230602165508513" style="zoom: 40%;" />



<h4 id="SelectionDAG-gt-Scheduling"><a href="#SelectionDAG-gt-Scheduling" class="headerlink" title="SelectionDAG -&gt; Scheduling"></a>SelectionDAG -&gt; Scheduling</h4><p><img src="https://p.ipic.vip/3r23t5.png" alt="image-20230602165708989"></p>
<p>Topological sort to know nodes that are able to run parallelly</p>
<h4 id="MCInst-gt-Code-Emission"><a href="#MCInst-gt-Code-Emission" class="headerlink" title="MCInst -&gt; Code Emission"></a>MCInst -&gt; Code Emission</h4><h4 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h4><p><img src="https://p.ipic.vip/gtnep5.png" alt="image-20230602165926323"></p>
<h2 id="OnGoing-History"><a href="#OnGoing-History" class="headerlink" title="OnGoing History"></a>OnGoing History</h2><p>Chris start his bizness at “Modular”</p>
<h2 id="LLVM-Related-AI-Compilers"><a href="#LLVM-Related-AI-Compilers" class="headerlink" title="LLVM Related AI Compilers"></a>LLVM Related AI Compilers</h2><p>built on LLVM, including</p>
<ul>
<li>XLA in TF,  by Google</li>
<li>JAX, autograd + XLA, by Google</li>
<li>TensorFlow, on XLA, then on LLVM</li>
<li>TVM for different hardwares</li>
<li>Julia, for HPC, using LLVM JIT</li>
</ul>
<p>ref to </p>
<ul>
<li>series of <a href="https://youtu.be/i5_BptwCBHA" target="_blank" rel="noopener">AI videos</a> on YT</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/05/25/Concurrency/2023-05-25%20HighConcurrency%20VS%20MultiThreading/">Concurrency/2023-05-25 HighConcurrency VS MultiThreading</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-05-25</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Concurrency/">Concurrency</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Concurrency/">Concurrency</a></span><div class="content"><h1 id="High-Concurrency"><a href="#High-Concurrency" class="headerlink" title="High Concurrency"></a>High Concurrency</h1><p>High concurrency refers to a situation where a system encounters a large number of operation requests in a short period of time, mainly occurring in web systems with concentrated access and receiving a large number of requests (e.g., ticket grabbing on 12306; Second-Kill event). This situation leads to the system performing a large number of operations during a pretty short time, such as requests on services, apps, and database operations.</p>
<h3 id="Performance-Metrics"><a href="#Performance-Metrics" class="headerlink" title="Performance Metrics"></a>Performance Metrics</h3><p>including: response time, throughput, queries per second (QPS), and concurrent user count.</p>
<ul>
<li><code>Response Time</code><br> The time it takes for the system to respond to a request. For example, if it takes 200ms for the system to process an HTTP request, that 200ms is the system’s response time. </li>
<li><code>Throughput</code><br> The number of requests processed per unit of time. </li>
<li><code>Queries Per Second (QPS)</code> The # of requests responded to per second. In the Internet domain, this metric is not as clearly distinguished from throughput. </li>
<li><code>Concurrent User Count</code> The number of users who can simultaneously use the system’s features normally. E.g., in an instant messaging system, the number of users online at the same time to some extent represents the system’s concurrent user count.</li>
</ul>
<h3 id="High-Concurrency-Solutions"><a href="#High-Concurrency-Solutions" class="headerlink" title="High Concurrency Solutions"></a>High Concurrency Solutions</h3><ul>
<li>Use CDN for static resources to handle image file access.</li>
<li>Distributed caching: Redis, Memcached, etc.</li>
<li>Message queue middleware: ActiveMQ, etc., to solve the asynchronous processing capability of a large number of messages.</li>
<li>Application splitting: A single project is split into multiple projects for deployment, using Dubbo to solve communication between multiple projects.</li>
<li>Vertical and horizontal database splitting (sharding).</li>
<li>Database read-write separation to solve large data query problems.</li>
<li>Use NoSQL, such as MongoDB, in combination with MySQL.</li>
<li>Establish service degradation and flow control mechanisms under high data access conditions.</li>
</ul>
<p>In sum, high concurrency refers to a system’s ability to handle a large number of concurrent requests or transactions simultaneously. It refers to the system’s capability to process multiple user requests or transactions at the same time. High concurrency performance is an important measure of a system’s load capacity and responsiveness. Multithreading is often used as a common technique for achieving high concurrency. By using multithreading, concurrent requests or transactions can be assigned to different threads for processing, thus enhancing the system’s concurrent processing capability.</p>
<h1 id="Multithreading"><a href="#Multithreading" class="headerlink" title="Multithreading"></a>Multithreading</h1><p>A program can have multiple threads running in parallel internally. The execution of a thread can be considered as a CPU executing the program. When a program runs with multiple threads, it’s as if multiple CPUs are executing the program simultaneously.</p>
<p>In summary, multithreading can be understood as follows: <u>Multithreading is a programming method for handling high concurrency, meaning that concurrency needs to be implemented using multiple threads,</u> e.g. 1) Stress-tested Aliyun’s audio generation API with C++’s multithread library<br>2) Adopted multithreading &amp; coroutine to build “Automatic Video Generation System” and “Async Web Service for Adobe Application”, from my experiences.</p>
<p>In sum, multi-threading refers to the execution of multiple threads simultaneously within a program, where each thread can run independently and perform different tasks. The main purpose of multithreading is to improve program performance and resource utilization. By dividing tasks into multiple threads, the parallel computing capabilities of multi-core processors can be fully utilized, enabling tasks to be executed in parallel. Multithreading is commonly used in scenarios involving simultaneous execution of multiple tasks, I/O-intensive operations, and parallel computing.</p>
<h1 id="Relationship-btw-The-2-Terms"><a href="#Relationship-btw-The-2-Terms" class="headerlink" title="Relationship btw The 2 Terms"></a>Relationship btw The 2 Terms</h1><p>Though they are usually mentioned together and are related, giving the impression that they are equal, but in fact, <code>high concurrency ≠ multithreading</code> ,</p>
<p>Therefore, it can be said that multithreading is one of the commonly used techniques for achieving high concurrency. <u>However</u>, high concurrency performance is also influenced by other factors such as system architecture, resource management, locking mechanisms, and algorithm design. Hence, multithreading and high concurrency are related but not exactly the same concepts..</p>
<h3 id="Scenarios"><a href="#Scenarios" class="headerlink" title="Scenarios"></a>Scenarios</h3><ol>
<li>High concurrency scenarios –  When we have a Java web project, and after it goes live, a large number of users log in to the system, which is considered high concurrency. For the system, there will be <u>a large number of requests coming in</u>, each request corresponding to a thread, and each thread is independent (Tomcat supports 200-300). Although it is the same code, it is executed in different threads without affecting each other.</li>
<li>Multithreading scenarios – Multithreading is used either for <u>asynchronous tasks</u> or for running <u>subtasks</u>. Each user thread is the main thread. Asynchronous tasks involve opening another thread. The purpose of running subtasks is to handle large data sets. Single-threaded processing would be slow, so the task is split into multiple subtasks, and multiple threads run them, making it faster.</li>
</ol>
<p>ref: </p>
<p><a href="https://cloud.tencent.com/developer/article/1477818" target="_blank" rel="noopener">怎么理解分布式、高并发、多线程？（含面试题和答案解析）-腾讯云开发者社区-腾讯云 (tencent.com)</a></p>
<p><a href="https://juejin.cn/post/6964748689382326280" target="_blank" rel="noopener">美团面试官：哟！你对高并发与多线程的解决思路了解的还挺深！ - 掘金 (juejin.cn)</a></p>
<p><a href="https://juejin.cn/post/6947966434748301326#_35" target="_blank" rel="noopener">【多线程与高并发】告诉你二者的区别 - 掘金 (juejin.cn)</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/05/22/ParallelProg/Parallel%20Acceleration%20--%20Laws%20&amp;%20PerfStat%20&amp;%20AVX/">ParallelProg/Parallel Acceleration -- Laws &amp; PerfStat &amp; AVX</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-05-22</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/SIMD/">SIMD</a></span><div class="content"><p>Numerical Algs –&gt; Optimizing for Performance –&gt; Writing Parallel Algs</p>
<h1 id="Law"><a href="#Law" class="headerlink" title="Law"></a>Law</h1><h2 id="1-Amdahl’s-Law"><a href="#1-Amdahl’s-Law" class="headerlink" title="1. Amdahl’s Law"></a>1. Amdahl’s Law</h2><p>   阿姆达尔定律是一个计算机科学界的经验法则，因IBM公司计算机架构师吉恩·阿姆达尔而得名。吉恩·阿姆达尔在1967年发表的论文中提出了这个重要定律。<br>   阿姆达尔定律主要用于发现仅仅系统的部分得到改进，整体系统可以得到的最大期望改进。它经常用于并行计算领域，用来预测适用多个处理器时理论上的最大加速比。在我们的性能调优领域，我们利用此定律有助于我们解决或者缓解性能瓶颈问题。<br>   阿姆达尔定律的模型阐释了我们现实生产中串行资源争用时候的现象。如下图模型，一个系统中，不可避免有一些资源必须串行访问，这限制了我们的加速比，即使我们增加了并发数（横轴），但取得效果并不理想，难以获得线性扩展能力(图中直线)。</p>
<h2 id="2-Gustafson’s-Law"><a href="#2-Gustafson’s-Law" class="headerlink" title="2. Gustafson’s Law"></a>2. Gustafson’s Law</h2><p>   Gustafson定律(Gustafson’s law)阐述了数据并行带来的影响。Gustafson 定律是由 John L. Gustafson 在1988年提出的。是并行计算领域除了 Amdahl 定律之后又一个重要定律。Gustafson定律看待加速比的角度会有所不同，其站在对于大量数据流处理过程中，针对重复工作的分布式运算带来的加速特性，而不仅仅局限在一个单一的程序进程&amp;单一的计算机上，串行的部分主要在于数据的分配预处理以及计算结果的收集汇总处理上。</p>
<p>compiler optimization </p>
<p>Options: -O1~ -O3, Ofast</p>
<p><img src="https://p.ipic.vip/qb9bbd.png" alt="image-20230606203406991"></p>
<p><img src="https://p.ipic.vip/8gn0if.png" alt="image-20230606203539104"></p>
<p><img src="https://p.ipic.vip/njwuzm.png" alt="Visual representation of latencies"></p>
<p>Pipeline and HW oriented Design</p>
<ul>
<li>sudo apt install linux-tools-generic</li>
</ul>
<h1 id="Perf-Stat"><a href="#Perf-Stat" class="headerlink" title="Perf Stat"></a>Perf Stat</h1><p>Branch prediction failed if unpredictable pattern in code would make the task-clock longer</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">(venv-py311) jo@fossa4gb:~/repo/V10793_C/Section 3/video2$ sudo perf <span class="built_in">stat</span> ./spec</span><br><span class="line"></span><br><span class="line"> Performance counter stats <span class="keyword">for</span> <span class="string">'./spec'</span>:</span><br><span class="line"></span><br><span class="line">            342.40 msec task-clock                <span class="comment">#    0.996 CPUs utilized          </span></span><br><span class="line">                16      context-switches          <span class="comment">#    0.047 K/sec                  </span></span><br><span class="line">                 0      cpu-migrations            <span class="comment">#    0.000 K/sec                  </span></span><br><span class="line">             19574      page-faults               <span class="comment">#    0.057 M/sec                  </span></span><br><span class="line">   &lt;not supported&gt;      cycles                                                      </span><br><span class="line">   &lt;not supported&gt;      instructions                                                </span><br><span class="line">   &lt;not supported&gt;      branches                                                    </span><br><span class="line">   &lt;not supported&gt;      branch-misses                                               </span><br><span class="line"></span><br><span class="line">       0.343925345 seconds time elapsed</span><br><span class="line"></span><br><span class="line">       0.243236000 seconds user</span><br><span class="line">       0.099686000 seconds sys</span><br><span class="line">       </span><br><span class="line">(venv-py311) jo@fossa4gb:~/repo/V10793_C/Section 3/video2$ sudo perf <span class="built_in">stat</span> ./spec2</span><br><span class="line"></span><br><span class="line"> Performance counter stats <span class="keyword">for</span> <span class="string">'./spec2'</span>:</span><br><span class="line"></span><br><span class="line">            465.56 msec task-clock                <span class="comment">#    0.986 CPUs utilized          </span></span><br><span class="line">                53      context-switches          <span class="comment">#    0.114 K/sec                  </span></span><br><span class="line">                 2      cpu-migrations            <span class="comment">#    0.004 K/sec                  </span></span><br><span class="line">             19574      page-faults               <span class="comment">#    0.042 M/sec                  </span></span><br><span class="line">   &lt;not supported&gt;      cycles                                                      </span><br><span class="line">   &lt;not supported&gt;      instructions                                                </span><br><span class="line">   &lt;not supported&gt;      branches                                                    </span><br><span class="line">   &lt;not supported&gt;      branch-misses                                               </span><br><span class="line"></span><br><span class="line">       0.472287268 seconds time elapsed</span><br><span class="line"></span><br><span class="line">       0.348851000 seconds user</span><br><span class="line">       0.117635000 seconds sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(j=0;j&lt;MAX;j++) &#123;</span><br><span class="line">        // i = rand() % 3;</span><br><span class="line">        i = j % 3;      //spec1</span><br><span class="line">        i = rand() % 3; //spec2</span><br><span class="line">        switch(i) &#123;</span><br></pre></td></tr></table></figure>



<ul>
<li>unroll also makes faster</li>
</ul>
<h1 id="AVX"><a href="#AVX" class="headerlink" title="AVX"></a>AVX</h1><p><a href="https://www.intel.com/content/www/us/en/docs/intrinsics-guide/index.html" target="_blank" rel="noopener">Intel® Intrinsics Guide</a></p>
<p>x86 SIMD History</p>
<ul>
<li>MMX-SSE4 (1997-2006)<br>O Early SIMD was integer-only, later extended to floating point</li>
<li>AVX (2008)<br>O 128 and 256 bit SIMD instructions with 16 new registers</li>
<li>AVX2 (2013)<br>O Introduced with Haswell, extends AVX to 256 bit, adds FMA</li>
<li>AVX-512 (2015)<br>O Originally in Xeon Phi KNL, extended to Skylake+: 512 bit extensions</li>
</ul>
<p><img src="https://p.ipic.vip/s60b9d.png" alt="image-20230606211435215"></p>
<p>Explore caches, branching, and memory speeds</p>
<p>Superscalar &amp; pipelining</p>
<p>Staying out of the compiler’s way</p>
<p>Vectorization code</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/04/22/LC/0_note/">LC/0_note</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-04-22</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Languages/">Languages</a></span><div class="content"><p>[toc]</p>
<h1 id="Cross-Language-Table"><a href="#Cross-Language-Table" class="headerlink" title="Cross Language Table"></a>Cross Language Table</h1><table>
<thead>
<tr>
<th></th>
<th>Python3★</th>
<th>Cpp</th>
<th>JS</th>
<th>Java</th>
</tr>
</thead>
<tbody><tr>
<td><strong>dict</strong></td>
<td></td>
<td>include <unordered_map>, //Similar to defaultdict() in python3</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>d = {}</td>
<td>unordered_map&lt;Node*&gt; d;</td>
<td>d = {}; new Map();</td>
<td>Map&lt;Node, Node&gt; visited = new HashMap();</td>
</tr>
<tr>
<td></td>
<td>d[k] = v;</td>
<td>d[k] = v;</td>
<td>d[k]=v; map.<strong>set</strong>(0,1)</td>
<td>visited.<strong>put</strong>(k, v)</td>
</tr>
<tr>
<td></td>
<td>d[k]; d.get(k,0)</td>
<td>d[k];</td>
<td>d[k]; map.get(k)</td>
<td>visited.get(cur_O)</td>
</tr>
<tr>
<td></td>
<td>k not in d</td>
<td>(d.find(k)==d.end())</td>
<td>!(nbr_O.val in visited)</td>
<td>!visited.containsKey(nbr_O)</td>
</tr>
<tr>
<td></td>
<td>k in d</td>
<td>(d.find(k)!=d.end())</td>
<td>nbr_O.val in visited; (map.<strong>has</strong>(sum-k))</td>
<td>visited.<strong>containsKey</strong>(nbr_O)</td>
</tr>
<tr>
<td></td>
<td>del d[k]</td>
<td>d.<strong>erase</strong>(key)</td>
<td>this.d.<strong>delete</strong>(key);</td>
<td>this.d.<strong>remove</strong>(key);</td>
</tr>
<tr>
<td></td>
<td>len(d)</td>
<td>size()</td>
<td>d.<strong>size</strong></td>
<td>d.size()</td>
</tr>
<tr>
<td></td>
<td></td>
<td>d.empty()  //true; false</td>
<td></td>
<td></td>
</tr>
<tr>
<td>NotOK</td>
<td></td>
<td></td>
<td>{k:v} in Initialization</td>
<td></td>
</tr>
<tr>
<td>Special APIs</td>
<td></td>
<td>reserve(capacity)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Iterate</td>
<td>for k in d.keys():</td>
<td>for (auto k: d)</td>
<td>for (var key in dict){}</td>
<td>for(char c:  ransomNote.toCharArray()) {</td>
</tr>
<tr>
<td><strong>Ordered_dict</strong></td>
<td>self.od.popitem(last=False)<br /><a href="https://www.pythonf.cn/read/89970" target="_blank" rel="noopener">https://www.pythonf.cn/read/89970</a><br /><a href="https://gist.github.com/joequery/12332f410a05e6c7c949" target="_blank" rel="noopener">https://gist.github.com/joequery/12332f410a05e6c7c949</a></td>
<td></td>
<td>d = new Map(); APIs↑↑ //ref: <a href="https://stackoverflow.com/questions/2798893/ordered-hash-in-javascript" target="_blank" rel="noopener">https://stackoverflow.com/questions/2798893/ordered-hash-in-javascript</a></td>
<td>LinkedHashMap&lt;Integer, Integer&gt; d;<br />this.d = new LinkedHashMap&lt;&gt;();</td>
</tr>
<tr>
<td></td>
<td>first = next(iter(self.od))</td>
<td></td>
<td></td>
<td>Integer first = this.d.keySet().iterator().next();</td>
</tr>
<tr>
<td><strong>queue</strong></td>
<td>from collections import deque</td>
<td>include<code>&lt;deque&gt;</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>deque();</td>
<td>deque&lt;Node*&gt;</td>
<td>let Q = [];</td>
<td>Queue<code>&lt;Node&gt;</code> Q = new LinkedList(); //LinkedList<code>&lt;Node&gt;</code> Q = new LinkedList<code>&lt;Node&gt;</code>(); //雙向</td>
</tr>
<tr>
<td></td>
<td>Q.append(cur); v=Q.popleft()</td>
<td>Q.push_back(cur); v=Q.front(),Q.pop_front()</td>
<td>Q.push(cur); v=Q.shift(); // O(n)</td>
<td>Q.add(nbr_O);//Q.push(nbr_O); Q.poll();</td>
</tr>
<tr>
<td></td>
<td>while d</td>
<td>while (!Q.empty())</td>
<td>while (Q.length != 0)</td>
<td>while (!Q.isEmpty())</td>
</tr>
<tr>
<td><strong>deque</strong></td>
<td></td>
<td></td>
<td></td>
<td>ArrayDeque雙向實現了DEque的interface</td>
</tr>
<tr>
<td><strong>pq</strong></td>
<td>heapq.heappush()</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>vector</strong></td>
<td></td>
<td>include<code>&lt;vector&gt;</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>self.res = []</td>
<td>vector&lt;vector<code>&lt;int&gt;</code>&gt; result;</td>
<td>res = [];</td>
<td>List&lt;List<code>&lt;Integer&gt;</code>&gt; res = new ArrayList&lt;List<code>&lt;Integer&gt;</code>&gt;();</td>
</tr>
<tr>
<td></td>
<td>item.append(nums[idx])</td>
<td>item.push_back(nums[idx]);</td>
<td>item.push(nums[idx]);</td>
<td>item.add(nums[idx]);</td>
</tr>
<tr>
<td></td>
<td>item.pop()</td>
<td>item.pop_back();</td>
<td>item.pop();</td>
<td>item.remove(item.size()-1);</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>l.length; // 注意！跟dict不同，這邊是 length</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>for</td>
<td>for (<strong><em>let</em></strong> i=0; i&lt;l.length; i++)</td>
<td></td>
</tr>
<tr>
<td></td>
<td>l = [False] * 3</td>
<td>vector<code>&lt;bool&gt;</code> dp(3, false);</td>
<td>const dp = new Array(3).fill(false);</td>
<td>List<code>&lt;Boolean&gt;</code> dp = new ArrayList(Collections.nCopies(s.length(), false));</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>int[] nums;, nums.length</td>
</tr>
<tr>
<td><strong>Doublely LinkedList</strong></td>
<td></td>
<td><strong>std::list</strong><br /><strong>List</strong> stores elements at non contiguous memory location i.e. it internally uses a doubly linked list i.e.</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>back(); front();</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>pop_back(); pop_front();</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>db_ll.erase(d[key])</td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>APIs</strong></td>
<td>from collections import Counter<br />Counter(l)</td>
<td>X</td>
<td>_.countBy(l)</td>
<td>X</td>
</tr>
<tr>
<td></td>
<td>max</td>
<td>max</td>
<td>Math.max</td>
<td>Math.max</td>
</tr>
<tr>
<td><strong>String</strong></td>
<td>len(s)</td>
<td>s.length()</td>
<td>s.length</td>
<td>s.length()</td>
</tr>
<tr>
<td></td>
<td>s[i]</td>
<td>s[i]</td>
<td>s[i]</td>
<td>s.charAt(i)</td>
</tr>
<tr>
<td></td>
<td>s[3:5]</td>
<td>token = s.substr(start, i-start+1);</td>
<td>s.slice(3, 5);</td>
<td>s.substring(start, i+1);</td>
</tr>
<tr>
<td><strong>Set</strong></td>
<td>ws = set(wD)</td>
<td>unordered_set<code>&lt;string&gt;</code> ws;<code></code>        for (auto s: wordDict){<code>ws.insert(s);</code>        }</td>
<td>let ws = new Set(wD)</td>
<td>HashSet<code>&lt;String&gt;</code> ws = new HashSet(wordDict);</td>
</tr>
<tr>
<td></td>
<td>token in ws</td>
<td>ws.find(token) != ws.end()</td>
<td>ws.has(token)</td>
<td>ws.contains(token)</td>
</tr>
<tr>
<td><strong>MAX</strong></td>
<td>float(‘-inf’)</td>
<td>INT_MIN;</td>
<td>-Number.MAX_VALUE;</td>
<td>Integer.MIN_VALUE;</td>
</tr>
<tr>
<td><strong>2D Init</strong></td>
<td>[[0 for j in range(n)] for i in range(m)]</td>
<td></td>
<td></td>
<td>[…Array(3)].map(x=&gt;Array(5).fill(0))</td>
</tr>
<tr>
<td><strong>1D sort</strong></td>
<td>l.sort(reverse=True)</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Node</strong></td>
<td>if not head</td>
<td>if (!head); if (nullputr == head)</td>
<td>if (!root); if (head == null)</td>
<td>if (head == null)</td>
</tr>
</tbody></table>
<h2 id="Special-issues"><a href="#Special-issues" class="headerlink" title="Special issues:"></a>Special issues:</h2><ul>
<li>Java &amp; js</li>
</ul>
<h2 id="C-Syntax-Review"><a href="#C-Syntax-Review" class="headerlink" title="C++ Syntax Review"></a>C++ Syntax Review</h2><ul>
<li><p>APIS:</p>
<ul>
<li><p>isalnum(s[i])</p>
</li>
<li><pre><code class="cpp"><span class="keyword">if</span> (board[i][j] == <span class="string">'.'</span>) <span class="keyword">continue</span>;

<span class="comment">// int val = int(board[i][j]);         // WRONG</span>
<span class="keyword">int</span> val = <span class="keyword">int</span>(board[i][j] - <span class="string">'0'</span>);    

<span class="comment">// if (used &amp; (1 &lt;&lt; val) &gt; 0) return false;    // WRONG</span>
<span class="keyword">if</span> ((used &amp; (<span class="number">1</span> &lt;&lt; val)) &gt; <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</code></pre>
</li>
<li><p>INT_MIN, isalnum(str[i]), swap(matrix[i][j], matrix[j][i]); reverse(matrix[i].begin(), matrix[i].end());</p>
</li>
<li><p>int end = upper_bound(nums.begin(), nums.end(), target - x) - nums.begin();</p>
</li>
<li><p>const size_t n;</p>
</li>
<li><p>auto max_num = *max_element(candies.begin(), candies.end())</p>
</li>
</ul>
</li>
<li><p>OVERFLOW:</p>
<ul>
<li><p>res += ((long long)pow(2, end_cnt) % M);  <strong>FIX</strong> in ↓</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; p(n, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++)&#123;</span><br><span class="line">  p[i] = p[i - <span class="number">1</span>] * <span class="number">2</span>  % M;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res += p[end_cnt];</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Hash</p>
<ul>
<li><p>unordered_map&lt;int, int&gt; lookup;</p>
</li>
<li><p>unordered_map&lt;char, char&gt; m = { {‘(‘, ‘)’}, {‘[‘, ‘]’}, {‘{‘, ‘}’} }; // 注意用的是逗號不是冒號!</p>
</li>
<li><p>if (lookup.find(target - nums[i]) != lookup.end()){</p>
</li>
<li><p>for (auto item: m){</p>
<p>​        res.push_back(item.second);  // 注意！是second, 不是 second()</p>
<p>}</p>
</li>
<li><p>private:</p>
<p>​        unordered_set<code>&lt;int&gt;</code> s;</p>
</li>
<li><p>s.erase(key);</p>
</li>
<li><p>unordered_set<code>&lt;string&gt;</code> lookup(wordDict.begin(), wordDict.end());</p>
</li>
<li><p>unordered_set&lt;pair&lt;int, int&gt;, #SHOULD PROVIDE HASH HERE…&gt; visited; // so, change to use</p>
</li>
<li><p>Map</p>
<ul>
<li><pre><code class="cpp">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt;&gt;updates;
<span class="keyword">int</span> idx = upper_bound(updates[index].begin(), updates[index].end(), make_pair(snap_id,INT_MAX)) - updates[index].begin();
&lt;!--￼<span class="number">1</span>--&gt;


</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>DP</p>
<ul>
<li>vector<code>&lt;int&gt;</code> dp = {1, 1, 2};</li>
<li>vector<code>&lt;int&gt;</code> dp(n + 1);</li>
<li>vector&lt;vector<code>&lt;int&gt;</code>&gt; dp(n, vector<code>&lt;int&gt;</code>(2));</li>
</ul>
</li>
<li><p>Bits</p>
<ul>
<li><p>uint32_t x = n;</p>
</li>
<li><pre><code class="cpp"><span class="keyword">int</span> num = <span class="number">5</span>;
<span class="keyword">bool</span> a = <span class="literal">false</span>;
<span class="built_in">cout</span> &lt;&lt; <span class="keyword">typeid</span>(a).name() &lt;&lt; <span class="built_in">endl</span>;
<span class="built_in">std</span>::<span class="built_in">bitset</span>&lt;8&gt; binary(num);  <span class="comment">// 將數字轉換為8位元的二進制</span>
<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Binary representation of "</span> &lt;&lt; num &lt;&lt; <span class="string">": "</span> &lt;&lt; binary &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;
<span class="comment">// printf("%s", binary.to_string());</span>
<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; binary.size(); i++){
    <span class="keyword">if</span> (binary.test(i))
        <span class="built_in">printf</span>(<span class="string">"i: %d,  \n"</span>, i);
}

<span class="built_in">string</span> s = binary.to_string();
<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.size(); i++){
    <span class="keyword">if</span> (s[i] == <span class="string">'1'</span>)
        <span class="built_in">printf</span>(<span class="string">"i: %d,  \n"</span>, i);
}  

<span class="keyword">return</span> <span class="number">0</span>;

---------------------------------------------
Hello world!b
Binary representation of <span class="number">5</span>: <span class="number">00000101</span>
i: <span class="number">0</span>,  
i: <span class="number">2</span>,  
i: <span class="number">5</span>,  
i: <span class="number">7</span>,  

<span class="function"><span class="keyword">int</span> <span class="title">minFlips</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c)</span> </span>{
  <span class="built_in">bitset</span>&lt;32&gt; bin_a(a), bin_b(b), bin_c(c);
  <span class="keyword">size_t</span> cnt = <span class="number">0</span>;
  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++){
    <span class="keyword">if</span> ((bin_a.test(i) | bin_b.test(i)) != bin_c.test(i)){
      <span class="keyword">if</span> (bin_c.test(i) == <span class="number">1</span>) cnt += <span class="number">1</span>;
      <span class="keyword">else</span> cnt += bin_a.test(i) + bin_b.test(i);
    }
  }
  <span class="keyword">return</span> cnt;
}
&lt;!--￼<span class="number">2</span>--&gt;</code></pre>
</li>
</ul>
</li>
<li><p>LINEAR – String, or Arr, with Vector as Stack, prefer to just use vector to make API name easier</p>
<ul>
<li><p>Vector</p>
<ul>
<li><p>v.push_back(x)</p>
</li>
<li><p>v.back() // 注意，API 不是top(); v.pop_back() // 注意，不是pop()</p>
</li>
<li><p>// vector<code>&lt;int&gt;</code> right(n) = {1}; // WRONG!</p>
<p>vector<code>&lt;int&gt;</code> left(n, 1);</p>
</li>
<li><p>string dfs_and_compare(TreeNode* root, string sub_pat, vector<code>&lt;bool&gt;</code> &amp;res){. // Don’t Forget <code>&amp;</code>!</p>
</li>
<li><pre><code class="cpp"><span class="keyword">private</span>:
    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; p;<span class="comment">//(3); 宣告不可指定大小</span>
<span class="keyword">public</span>:
    ParkingSystem(<span class="keyword">int</span> big, <span class="keyword">int</span> medium, <span class="keyword">int</span> small) {
        p = {big, medium, small};
    }
&lt;!--￼<span class="number">3</span>--&gt;</code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li><p>PQ, Top-K &amp; Comparator</p>
<ul>
<li><p>// printf(“%d %d\n”, x.first, x.second);</p>
</li>
<li><p>private:</p>
<pre><code>priority_queue`&lt;int&gt;` pq;

int sz;</code></pre></li>
<li><pre><code class="cpp"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int,int&gt;</span></span>
<span class="meta">#<span class="meta-keyword">define</span> tii tuple<span class="meta-string">&lt;int,int&gt;</span></span>

<span class="class"><span class="keyword">class</span> <span class="title">Solution</span> {</span>
<span class="keyword">public</span>:
    <span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&amp; m, pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&amp; n)</span> </span>{
        <span class="keyword">return</span> m.second &gt; n.second;
    }  
    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; topKFrequent(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> k) {
        <span class="comment">// return sol_20230523(nums, k);</span>
        <span class="keyword">return</span> py_20230523(nums, k);
    }

    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; sol_20230523(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> k) {    <span class="comment">// AC!</span>
        <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; counter;
        <span class="keyword">for</span> (<span class="keyword">auto</span> x: nums) counter[x]++;

        <span class="keyword">int</span> n = nums.size();

        <span class="comment">// priority_queue&lt;pair&lt;int, int&gt;, vector&lt;pair&lt;int, int&gt;&gt;, decltype(cmp)&gt; pq(cmp);</span>
        <span class="comment">// auto cmp = [](const pair&lt;int, int&gt;&amp; a, const pair&lt;int, int&gt;&amp; b) {</span>
        <span class="comment">//     return a.second &gt; b.second; // Sort in descending order of frequency</span>
        <span class="comment">// };      </span>

        <span class="comment">// priority_queue&lt;pair&lt;int, int&gt;, vector&lt;pair&lt;int, int&gt;&gt;, decltype(&amp;cmp)&gt; pq(cmp);</span>
          <span class="comment">//auto cmp = [](ListNode * left, ListNode * right){</span>
                <span class="comment">//        return left-&gt;val &gt; right-&gt;val;</span>
                <span class="comment">//};</span>
                <span class="comment">//priority_queue&lt;ListNode *, vector&lt;ListNode*&gt;, decltype(cmp)&gt; heap(cmp);</span>

          priority_queue&lt;pii, <span class="built_in">vector</span>&lt;pii&gt;, <span class="keyword">decltype</span>(&amp;cmp)&gt; pq(cmp);
        <span class="keyword">for</span> (<span class="keyword">auto</span> x: counter){
            <span class="comment">// printf("%d %d\n", x.first, x.second);</span>
            pq.push(x);
            <span class="keyword">if</span> (pq.size() &gt; k) pq.pop();
        }
        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; res;
        <span class="keyword">while</span> (!pq.empty()){
            res.push_back(pq.top().first);
            pq.pop();
        }

        <span class="keyword">return</span> res;
    }

    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; py_20230523(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> k) {     <span class="comment">// AC!</span>
        <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; counter;
        <span class="keyword">for</span> (<span class="keyword">auto</span> x: nums) counter[x]++;

        <span class="keyword">int</span> n = nums.size();

        <span class="comment">// priority_queue&lt;pii&gt; pq;</span>
        priority_queue&lt;tii&gt; pq;
        <span class="keyword">for</span> (<span class="keyword">auto</span> x: counter){
            <span class="comment">// printf("%d %d\n", x.first, x.second);</span>
            <span class="comment">// pq.push(pair(-x.second, x.first));</span>
            <span class="comment">// if (pq.size() &gt; k) pq.pop();</span>
            pq.push(tuple(-x.second, x.first));
            <span class="keyword">if</span> (pq.size() &gt; k) pq.pop();
        }

        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; res;
        <span class="keyword">while</span> (!pq.empty()){
            <span class="comment">// res.push_back(pq.top().second);</span>
            res.push_back(get&lt;<span class="number">1</span>&gt;(pq.top()));
            pq.pop();
        }

        <span class="keyword">return</span> res;
    }  
};

    <span class="function">ListNode* <span class="title">mergeKLists</span><span class="params">(<span class="built_in">vector</span>&lt;ListNode*&gt;&amp; lists)</span> </span>{
        <span class="comment">// write your code here</span>
        <span class="keyword">int</span> n = lists.size();
        <span class="keyword">if</span> (n == <span class="number">0</span>){
            <span class="keyword">return</span> <span class="literal">NULL</span>;
        }
        <span class="keyword">auto</span> cmp = [](ListNode * left, ListNode * right){
            <span class="keyword">return</span> left-&gt;val &gt; right-&gt;val;
        };
        priority_queue&lt;ListNode *, <span class="built_in">vector</span>&lt;ListNode*&gt;, <span class="keyword">decltype</span>(cmp)&gt; heap(cmp);
        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++){
            <span class="keyword">if</span> (lists[i] != <span class="literal">NULL</span>){
                heap.push(lists[i]);
            }
        }
        <span class="comment">// ListNode DummyNode(0);</span>
        ListNode * DummyNode = <span class="keyword">new</span> ListNode(<span class="number">0</span>);
        ListNode * tail = DummyNode;
        <span class="keyword">while</span>(!heap.empty()){
            ListNode * node = heap.top();
            heap.pop();
            tail-&gt;next = node;
            tail = tail-&gt;next;
            <span class="keyword">if</span> (node-&gt;next){
                heap.push(node-&gt;next);
            }
        }
        <span class="keyword">return</span> DummyNode-&gt;next;
    }</code></pre>
</li>
<li><p>auto cmp = [](ListNode * left, ListNode * right){</p>
<p>​        return left-&gt;val &gt; right-&gt;val;</p>
<p>};</p>
<p>priority_queue&lt;ListNode <em>, vector&lt;ListNode</em>&gt;, decltype(cmp)&gt; heap(cmp);</p>
</li>
</ul>
</li>
<li><p>Interval</p>
<ul>
<li>int s = interval[0], e = interval[1];</li>
</ul>
</li>
<li><p>LinkedList</p>
<ul>
<li><p>printf(“var[%d] = %x\n”, i - 1, ptr);</p>
</li>
<li><p>printf(“var[%d] = %d\n”, i - 1, *ptr);</p>
</li>
<li><p>if (!head || !head-&gt;next) return head;</p>
</li>
<li><p>// ListNode* my_20230520_recursive(ListNode* prev, ListNode* head, vector&lt;ListNode*&gt; res) { // ERROR!</p>
<p>ListNode* my_20230520_recursive(ListNode* prev, ListNode* head, vector&lt;ListNode*&gt; &amp;res) {   // FIX by adding &amp; for <code>res</code></p>
</li>
<li><p>// vector&lt;ListNode*&gt; res; //runtime error: reference binding to null pointer of type ‘ListNode *’ (stl_vector.h)</p>
<p>vector&lt;ListNode*&gt; res(1);    // FIX</p>
</li>
</ul>
</li>
<li><p>Tree</p>
<ul>
<li>bool ans = dfs(root, LONG_MIN, LONG_MAX);<br>bool dfs(TreeNode* root, long lo, long hi){        // FIX!, 別用 INT_MIN, INT_MAX</li>
</ul>
</li>
<li><p>Graph</p>
<ul>
<li>vector&lt;vector<code>&lt;int&gt;</code>&gt; g(numCourses);</li>
<li>Node* tmp = new Node(node-&gt;val);    // FIX!, dont’ forget <code>new</code> to create the “pointer”</li>
<li>void dfs(vector&lt;vector<code>&lt;int&gt;</code>&gt; &amp;graph, int node, unordered_set<code>&lt;int&gt;</code> &amp;visited){    // FIX! copy of the graph in every dfs call will lead to TLE!</li>
<li>vector&lt;vector<code>&lt;int&gt;</code>&gt; graph(n); // WRONG –&gt; vector&lt;vector<code>&lt;int&gt;</code>&gt; graph(n, vector<code>&lt;int&gt;</code>);</li>
<li><code>&lt;u&gt;</code>to be a tree<code>&lt;/u&gt;</code>, shoud be (edges.size() + 1 != n)</li>
</ul>
</li>
</ul>
<h1 id="Best-Record"><a href="#Best-Record" class="headerlink" title="Best Record"></a>Best Record</h1><p><img src="https://p.ipic.vip/z75ght.png" alt="image-20230602210901526"></p>
</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/82/">82</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2024 By Joe Huang</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>