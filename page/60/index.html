<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="Joe Huang"><meta name="copyright" content="Joe Huang"><title>Awaken Desparado</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-180692466-1', 'auto');
ga('send', 'pageview');</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Joe Huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">382</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">25</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">65</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Awaken Desparado</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Awaken Desparado</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2019/06/25/FFmpeg/2019-06-25-ffmpeg-cmds/">ffmpeg_cmds!</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-06-25</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ffmpeg/">ffmpeg</a></span><div class="content"><h2 id="rm-black-sides"><a href="#rm-black-sides" class="headerlink" title="rm black sides"></a>rm black sides</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">╰─○ ffplay -i vn_hflip.mp4 -t 5 -vf cropdetect</span><br><span class="line">╰─○ ffplay -i vn_hflip.mp4 -t 5 -vf crop=1280:528:0:96</span><br></pre></td></tr></table></figure>

<h2 id="save-to-json"><a href="#save-to-json" class="headerlink" title="save to json"></a>save to json</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffprobe -hide_banner -print_format json -show_streams -i vn_hflip.mp4 &gt; vn_json_streams.log</span><br></pre></td></tr></table></figure>

<h2 id="check-error"><a href="#check-error" class="headerlink" title="check error"></a>check error</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffprobe -show_frames vn_hflip.mp4 &gt; vn_show_frames.log</span><br></pre></td></tr></table></figure>

<h2 id="video-to-pics"><a href="#video-to-pics" class="headerlink" title="video to pics"></a>video to pics</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i vn_hflip.mp4 -r 40 -f image2         -t 1 my%d.jpg        <span class="comment">## 跟下一行比會多了幾張重覆的，因為比來的video就25fps而已</span></span><br><span class="line"><span class="string">""</span><span class="string">"2938"</span><span class="string">""</span>  ffmpeg -i vn_hflip.mp4 -r 25 -f image2 -t 1 my25_%d.jpg <span class="comment">## 跟上一行几乎一样，就是正常的25 rate</span></span><br><span class="line">ffmpeg -i vn_hflip.mp4 -vcodec mjpeg -ss 0:0:2 -t 0:0:1 0m%04d.jpg  <span class="comment">## 跟上面比主要就是从第二秒开始</span></span><br><span class="line"></span><br><span class="line">2937  ffmpeg -i vn_hflip.mp4 -r 40 -f image2 -t 1 my25_%d.jpg</span><br><span class="line">★★★ -r, -ss, -t  本来的video要变成的rate，开始、抓多久</span><br><span class="line"></span><br><span class="line">ffmpeg -i vn_hflip.mp4 -ss 00:00:14.435 -vframes 1 out.png</span><br><span class="line">★★★ -vframes 抓几张</span><br></pre></td></tr></table></figure>

<h2 id="pics-to-video"><a href="#pics-to-video" class="headerlink" title="pics to video"></a>pics to video</h2><p>把多个图像文件使用h264编码封装成avi文件，如有my0.jpg, my1.jpg … my99.jpg</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i my%d.jpg  -vcodec h264 my.avi</span><br></pre></td></tr></table></figure>



<p>-r 选项的用法：</p>
<p>预设是</p>
<p>以25FPS读入所有图片，所以len(Images[])会是输出的video的duration. </p>
<p>作出25FPS的video, 所以如果 -r加在 output前面，会进行插帧、删帧。</p>
<p>如果-r加在 input前面，就是每秒读进来几张图片</p>
<p>如果　ffmpeg -r 10 -i z-%5d.jpeg -vcodec h264 -r 60 out10in60out.mp4</p>
<p>那么因为每秒读进来10张而已，硬做成60fps的video，也是没用，因为中间只是内插成了60fps</p>
<h2 id="video-to-gif"><a href="#video-to-gif" class="headerlink" title="video to gif"></a>video to gif</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i vn_hflip.mp4 -ss 0 -r 1 -vframes 6 vn.gif</span><br><span class="line">ffmpeg -i vn_hflip.mp4 -ss 0 -vf fps=1 -vframes 6 vn_fps.gif <span class="comment"># 这个似乎比上面的好一些</span></span><br></pre></td></tr></table></figure>




<p>##EXTRACTION !!!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> 2999  ffmpeg -i ../vn_hflip.mp4 -ss 00:00:00 -t 10 -vf fps=1 fps1_%d.png</span><br><span class="line">(joe_py36) ┌─[joe@JoeMBP2] - [~/Movies/exp/tmp] - [3003]</span><br><span class="line">└─[$] <span class="built_in">history</span> | grep r1                                                                                                                                                                           [22:06:04]</span><br><span class="line"> 2975  ffmpeg -i ../vn_hflip.mp4 -r 1 r1_%d.png</span><br><span class="line"> 2977  ffmpeg -i ../vn_hflip.mp4 -r 1 -vframes 6 r1_vframes_%d.png</span><br></pre></td></tr></table></figure>







<h2 id="add-logo"><a href="#add-logo" class="headerlink" title="add logo"></a>add logo</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i vn_hflip.mp4 -i ~/Pictures/Sackboy_0.jpeg -filter_complex overlay=W-w:H-h vn_logo.avi</span><br><span class="line">    如右下角: ffmpeg -i God.rm -i logo.png -filter_complex overlay=W-w:H-h my.avi</span><br><span class="line">    如居中:  ffmpeg -i God.rm -i logo.png -filter_complex overlay=W/2-w/2:H/2-h/2 my.avi</span><br></pre></td></tr></table></figure>



</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/06/24/Algo.%20Ult./seminar_9/">Algo. Ult./seminar_9</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-06-24</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/AlgoUlt/">AlgoUlt.</a></span><div class="content"><h1 id="DP"><a href="#DP" class="headerlink" title="DP"></a>DP</h1><ul>
<li>子問題們</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg34on0q2bj30ny0h8jy8.jpg" alt="image-20200624093637867" style="zoom:50%;" />



<h3 id="什麼題目可以用DP"><a href="#什麼題目可以用DP" class="headerlink" title="什麼題目可以用DP?"></a>什麼題目可以用DP?</h3><ul>
<li>方案數</li>
<li>最大最小值（如求收益），當二分不行時</li>
<li>可行性（能不能）</li>
</ul>
<h3 id="107-Word-Break"><a href="#107-Word-Break" class="headerlink" title="107. Word Break"></a>107. Word Break</h3><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389y8h7a0j20jy0o40ui.jpg" alt="image-20200624094830531" style="zoom:67%;" />



<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg352pwxqfj30p80e40xw.jpg" alt="image-20200624095014072" style="zoom:67%;" />

<ul>
<li><p>填表的顺序是一样的对吧?!　</p>
<ul>
<li>大方向是</li>
</ul>
</li>
<li><p>記憶化不需要考慮求解順序</p>
</li>
<li><p>DP的for循環的順序重要，錯的時候會導致答案錯誤</p>
</li>
</ul>
<h3 id="91-最小調整代價"><a href="#91-最小調整代價" class="headerlink" title="91. 最小調整代價"></a>91. 最小調整代價</h3><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg357xm6stj30u00di0vm.jpg" alt="image-20200624095514358" style="zoom:67%;" />

<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389zaoj4fj20q00tiacz.jpg" alt="image-20200624101830924" style="zoom:67%;" />



<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389yid9p8j20po0qstbg.jpg" alt="image-20200624102212142" style="zoom:67%;" />

<h2 id=""><a href="#" class="headerlink" title=""></a></h2><ul>
<li>什麼時候能用？<ul>
<li>i -&gt; i-1, i-2</li>
</ul>
</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg3621higdj30n605kq4m.jpg" alt="image-20200624102410875" style="zoom:67%;" />



<h3 id="274-Make-binary-tree-average"><a href="#274-Make-binary-tree-average" class="headerlink" title="274. Make binary tree average"></a>274. Make binary tree average</h3><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389yo1n0kj20e60fu0td.jpg" alt="image-20200624104138269" style="zoom:67%;" />

<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389z390uvj20cq05w74e.jpg" alt="image-20200624104943995" style="zoom:67%;" />

<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg36u9jmd4j30um0dw432.jpg" alt="image-20200624105118707" style="zoom:67%;" />

<ul>
<li><p>離散化</p>
</li>
<li><p>dp: map, 把以node為根的子樹全部修改完成後，根節點的值為value的最小花費</p>
</li>
<li><p>{node: ({value: 把node修改成value的最小花費}}, a neted map</p>
</li>
<li><p>dp = {</p>
<ul>
<li>5 -&gt; {5: 0}</li>
<li>3 -&gt; {3: 1, 5: 1}</li>
<li>2 -&gt; {3:2, 5:2, 2:2}</li>
</ul>
<p>}</p>
</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg37c6jqawj31oc0u0qol.jpg" alt="image-20200624110829530"></p>
<h5 id="Super-Hard"><a href="#Super-Hard" class="headerlink" title="Super Hard"></a>Super Hard</h5><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389z71iz9j20le08qaam.jpg" alt="image-20200624113724685" style="zoom:50%;" />

<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389yslhs6j20y60qkadq.jpg" alt="image-20200624114245275" style="zoom:67%;" />





<h1 id="多重背包的通用及優化"><a href="#多重背包的通用及優化" class="headerlink" title="多重背包的通用及優化"></a>多重背包的通用及優化</h1><h3 id="798-背包問題VII"><a href="#798-背包問題VII" class="headerlink" title="798.背包問題VII"></a>798.背包問題VII</h3><ul>
<li>非無限取，每種有限取</li>
</ul>
<h5 id="方法一：拆開轉成0-1背包"><a href="#方法一：拆開轉成0-1背包" class="headerlink" title="方法一：拆開轉成0/1背包"></a>方法一：拆開轉成0/1背包</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solution</span><span class="params">(self, n, prices, weight, amounts)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># n: 背包容量</span></span><br><span class="line">    <span class="comment"># prices: 等效 0/1 背包的物品體積</span></span><br><span class="line">    <span class="comment"># weight: 等效 0/1 背包的物品價值</span></span><br><span class="line">    <span class="comment"># m: 總共的物品個數 (原來的)</span></span><br><span class="line">    </span><br><span class="line">    m = len(prices)</span><br><span class="line">    </span><br><span class="line">    processed_prices = []</span><br><span class="line">    processed_weight = []</span><br><span class="line">    </span><br><span class="line">    dp = [<span class="number">0</span>] * (n+<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> range(amounts[i]):</span><br><span class="line">            processed_weight.append(weight[i])</span><br><span class="line">            processed_prices.append(prices[i])</span><br><span class="line">    </span><br><span class="line">    processed_item_number = len(processed_weight)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(processed_item_number):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n, processed_prices[i] - <span class="number">1</span>, <span class="number">-1</span>):</span><br><span class="line">            dp[j] = max(dp[j], dp[j - processed_prices[i]] + processed_weight[i])</span><br><span class="line">    <span class="keyword">return</span> dp[n]</span><br></pre></td></tr></table></figure>

<ul>
<li>Follow up: 如果 amounts[i] &lt;= 10 ^9怎辦？</li>
</ul>
<h5 id="方法二-優化物品數量"><a href="#方法二-優化物品數量" class="headerlink" title="方法二: 優化物品數量"></a>方法二: 優化物品數量</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># amounts[i] &lt;= 10**9 很大時, 減少物品數量到lg級別</span></span><br><span class="line"><span class="comment"># m * log(K) * n</span></span><br><span class="line"><span class="comment"># 未優化的話是 m * K * n</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solution_opt</span><span class="params">(self, n, prices, weight, amounts)</span>:</span></span><br><span class="line">    <span class="comment"># n: 背包容量</span></span><br><span class="line">    <span class="comment"># prices: 等效 0/1 背包的物品體積</span></span><br><span class="line">    <span class="comment"># weight: 等效 0/1 背包的物品價值</span></span><br><span class="line">    <span class="comment"># m: 總共的物品個數 (原來的)</span></span><br><span class="line">    </span><br><span class="line">    m = len(prices)</span><br><span class="line">    </span><br><span class="line">    processed_prices = []</span><br><span class="line">    processed_weight = []</span><br><span class="line">    </span><br><span class="line">    dp = [<span class="number">0</span>] * (n+<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">        base = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> amounts[i] &gt;= base:</span><br><span class="line">        <span class="comment"># for k in range(amounts[i]):</span></span><br><span class="line">            processed_weight.append(weight[i] * base)</span><br><span class="line">            processed_prices.append(prices[i] * base)</span><br><span class="line">            amounts[i] -= base</span><br><span class="line">            base *= <span class="number">2</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> amounts[i] &gt; <span class="number">0</span>:</span><br><span class="line">            processed_weight.append(weight[i] * amounts[i])</span><br><span class="line">            processed_prices.append(prices[i] * amounts[i])</span><br><span class="line">    </span><br><span class="line">    processed_item_number = len(processed_weight)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(processed_item_number):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n, processed_prices[i] - <span class="number">1</span>, <span class="number">-1</span>):</span><br><span class="line">            dp[j] = max(dp[j], dp[j - processed_prices[i]] + processed_weight[i])</span><br><span class="line">    <span class="keyword">return</span> dp[n]</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/06/16/Algo.%20Ult./seminar_6&amp;7&amp;8/">Algo. Ult./seminar_6&amp;7&amp;8</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-06-16</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/AlgoUlt/">AlgoUlt.</a></span><div class="content"><h1 id="Seminar-6-BFS-Advanced"><a href="#Seminar-6-BFS-Advanced" class="headerlink" title="Seminar 6. BFS Advanced"></a>Seminar 6. BFS Advanced</h1><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gftvn216ofj310c0jgdn3.jpg" alt="image-20200616093336824"></p>
<ul>
<li>什麼時候用BFS而不用DFS?</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gftvozc29sj310809q421.jpg" alt="image-20200616093533547"></p>
<ul>
<li>Topological Sort</li>
</ul>
<h2 id="630-騎士的最短路徑-II"><a href="#630-騎士的最短路徑-II" class="headerlink" title="630. 騎士的最短路徑 II"></a>630. 騎士的最短路徑 II</h2><ul>
<li><p>BFS 模版</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Queue = colleciton.deque()</span><br><span class="line">distance = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> start_point <span class="keyword">in</span> start_points:</span><br><span class="line">  Q.append(start_point)</span><br><span class="line">  distance(start_point) = <span class="number">0</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span> Q:</span><br><span class="line">  now = queue.popleft()</span><br><span class="line">  <span class="keyword">for</span> neighbor <span class="keyword">in</span> neighbors[now]:</span><br><span class="line">    <span class="keyword">if</span> self.is_valid(neightbor):</span><br><span class="line">      Q.append(neighbor)</span><br><span class="line">      distance[neighbor] = distance[now] + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> diatance[destination]</span><br></pre></td></tr></table></figure>
</li>
<li><p>Follow up:</p>
<ul>
<li><p>輸出路徑的題，在BFS, DFS, DP中都有，其中DFS最常見</p>
</li>
<li><p>BFS和DP中，輸出路徑 -&gt; 數據結構存儲</p>
</li>
<li><p>存什麼？</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> A. 每個點的上一個點？最後從終點不斷往前找前一個點</li>
<li><input disabled="" type="checkbox"> B. 每個點的下一個點？最後從起點一直往後找下一個點</li>
</ul>
</li>
<li><p>雙向BFS</p>
<ul>
<li><p>相遇時得到了答案</p>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389vfseitj20cs0ccq30.jpg" alt="image-20200616100657736" style="zoom: 25%;" />
</li>
<li><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gftwmqhbxvj30um0gc0vy.jpg" alt="image-20200616100800150" style="zoom:25%;" />

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> </span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="1516-異或和-X"><a href="#1516-異或和-X" class="headerlink" title="1516. 異或和 X"></a>1516. 異或和 X</h2><h2 id="892-外星人詞典"><a href="#892-外星人詞典" class="headerlink" title="892. 外星人詞典"></a>892. 外星人詞典</h2><ul>
<li><p>wrt, wrf, er, ett, erftt</p>
<ul>
<li><p>t -&gt; f</p>
</li>
<li><p>w -&gt; e</p>
</li>
<li><p>e -&gt; r</p>
</li>
<li><p>r -&gt; t</p>
</li>
<li><p>So, </p>
<ul>
<li>t -&gt; f</li>
<li>w -&gt; e -&gt; r<ul>
<li>wertf</li>
</ul>
</li>
</ul>
</li>
<li><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gftxa5yc1zj30gq0nogr5.jpg" alt="image-20200616103030839"  />

<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gftxcd54ggj30gk0do0xd.jpg" alt="image-20200616103238325"></p>
</li>
<li><p>舉列有環時不會進while，直接空 return</p>
</li>
<li><p>（abc, ab）得早期return處理掉</p>
</li>
<li><p>Time: </p>
</li>
<li><p><a href="https://paste.ubuntu.com/p/W2J52HPVwq/" target="_blank" rel="noopener">https://paste.ubuntu.com/p/W2J52HPVwq/</a></p>
</li>
</ul>
</li>
</ul>
<h2 id="1565-飛行棋-I"><a href="#1565-飛行棋-I" class="headerlink" title="1565. 飛行棋 I "></a>1565. 飛行棋 I <img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfty5hccf5j30h40lggpf.jpg" alt="image-20200616110036736"></h2><p>WRONG!</p>
<p>Reason: didn’t check whether “9” can be directly transmitted</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gftyeoh6ebj30d6030q3i.jpg" alt="image-20200616110926749"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gftygxs7okj30h80n8gqj.jpg" alt="image-20200616111137543"></p>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gftyibb8b7j308402wweq.jpg" alt="image-20200616111256890" style="zoom: 50%;" />

<p>how to fix?</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gftyjr3kyuj30ea0awdi5.jpg" alt="image-20200616111419729"></p>
<ul>
<li>SPFA 最短路算法, 被淘汰，因為太慢了，但用起來夠了</li>
</ul>
<ul>
<li><p>Dij, Floyd, 這兩個可以拿來替換，他們都帶人名的，大不了可以不會</p>
</li>
<li><p>可做1364</p>
</li>
<li><p>放後面也可以</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gftypnbvbyj30xk0kswme.jpg" alt="image-20200616111955720"></p>
</li>
</ul>
<ul>
<li><h3 id="DP"><a href="#DP" class="headerlink" title="DP"></a>DP</h3><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389vr4tjij20ho0padh8.jpg" alt="image-20200616113300330" style="zoom:67%;" />





</li>
</ul>
<ul>
<li><p>push vs pull in DP</p>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gftz5g5zsnj30f60m4782.jpg" alt="image-20200616113511064" style="zoom:67%;" />



</li>
</ul>
<h2 id="拓展知識"><a href="#拓展知識" class="headerlink" title="拓展知識"></a>拓展知識</h2><h3 id="1364-最短路徑-as-飛行棋"><a href="#1364-最短路徑-as-飛行棋" class="headerlink" title="1364.最短路徑, as 飛行棋"></a>1364.最短路徑, as 飛行棋</h3><ul>
<li><input disabled="" type="checkbox"> TODO…, not yet finished</li>
</ul>
<h3 id="1515-異或和"><a href="#1515-異或和" class="headerlink" title="1515.異或和"></a>1515.異或和</h3><ul>
<li><p>競賽題。。。</p>
</li>
<li><p>雙向BFS</p>
<ul>
<li>降時間，但有時不一定能降，像騎士就無法降時間</li>
<li>但這題在中間會和就可以在中間會和</li>
</ul>
</li>
<li><p>1 &lt;= n, m &lt;= 20</p>
<ul>
<li><p>組合數 C(20, 40) ==&gt; 非常大</p>
</li>
<li><p>約2^(n+m)，2^40 次方　再小一點</p>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfufb10aywj30aq094wgf.jpg" alt="image-20200616205407495" style="zoom:33%;" />
</li>
<li><p>2^40是2^12，稳爆；2^20约10^6，可接受<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfuge4qs73j30k40ks7b0.jpg" alt="image-20200616213141875"></p>
</li>
</ul>
</li>
</ul>
<h3 id="794-滑動拼圖-II"><a href="#794-滑動拼圖-II" class="headerlink" title="794.滑動拼圖 II"></a>794.滑動拼圖 II</h3><h1 id="Seminar-7"><a href="#Seminar-7" class="headerlink" title="Seminar 7"></a>Seminar 7</h1><h2 id="Preview"><a href="#Preview" class="headerlink" title="Preview"></a>Preview</h2><h3 id="1181-二叉樹的直徑"><a href="#1181-二叉樹的直徑" class="headerlink" title="1181.二叉樹的直徑"></a>1181.二叉樹的直徑</h3><ul>
<li><p>分治</p>
</li>
<li><p>遞歸</p>
</li>
<li><p>Root    -&gt; root.left</p>
<p>​            -&gt; root.right</p>
</li>
<li><p>M_D = max_diameter; M_C = max_chain</p>
<ul>
<li><p>return max(M_D_root, M_C_root)</p>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfu9xow74tj30ma0b249p.jpg" alt="image-20200616174814887" style="zoom:80%;" />
</li>
</ul>
</li>
<li><p>定義、出口、拆解</p>
<ul>
<li><p>def dfs(root):</p>
<pre><code>if not root:
      return [0, 0]
  left_M_D, left_M_C = self.dfs(root.L)
  right_M_D, right_M_C = self.dfs(root.R)
  M_D = max(left_M_D, right_M_D, left_M_C + right_M_C)
  M_C = max(right_M_C, right_M_C) + 1    </code></pre><p>​    return [M_D, M_C]</p>
</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfud9xokowj30eu0d4tby.jpg" alt="image-20200616194351449"></p>
</li>
</ul>
<h2 id="1469-樹上最長路徑-dfs解法"><a href="#1469-樹上最長路徑-dfs解法" class="headerlink" title="1469.樹上最長路徑-dfs解法"></a>1469.樹上最長路徑-dfs解法</h2><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfzsh05ytnj30ws0jm4qp.jpg" alt="image-20200621121725802"></p>
<p>Time: O(N), 10^5</p>
<p>Space: O(N), 10^5</p>
<ul>
<li><h4 id="DFS-gt-爆-Stack"><a href="#DFS-gt-爆-Stack" class="headerlink" title="DFS ==&gt; 爆 Stack"></a>DFS ==&gt; 爆 Stack</h4></li>
</ul>
<h4 id="BFS"><a href="#BFS" class="headerlink" title="BFS"></a>BFS</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfztcm972yj30le02w40h.jpg" alt="image-20200621124751035"></p>
<h2 id="START"><a href="#START" class="headerlink" title="START"></a>START</h2><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389vv7a10j20ys0ksjty.jpg" alt="image-20200618093143030" style="zoom:67%;" />

<h3 id="分治"><a href="#分治" class="headerlink" title="分治"></a>分治</h3><ul>
<li><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfw6ut4teij30ou01ut9g.jpg" alt="image-20200618093252701" style="zoom:67%;" />
</li>
<li><p>把整棵樹的問題分解成左右子樹的問題，用相同的方法去解決它們</p>
</li>
<li><p>分治是思想，</p>
<ul>
<li>遞歸是實現藉由調用自己實現</li>
<li>也可以棧實現</li>
</ul>
</li>
</ul>
<h3 id="94-Binary-Tree-Maximum-Path-SumFollow"><a href="#94-Binary-Tree-Maximum-Path-SumFollow" class="headerlink" title="94.Binary Tree Maximum Path SumFollow"></a>94.Binary Tree Maximum Path SumFollow</h3><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389xpqy1vj20i40ccaba.jpg" alt="image-20200618094817945" style="zoom:67%;" />



<ul>
<li><strong>要初始化为 -sys.maxsize，不然会这样挂掉</strong></li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfw7ndkm8tj30tu0d642s.jpg" alt="image-20200618100018499"></p>
<h3 id="535-打劫房屋-II"><a href="#535-打劫房屋-II" class="headerlink" title="535.打劫房屋 II"></a>535.打劫房屋 II</h3><ul>
<li>强行分治不行，未考虑相邻的房子无法打劫的问题</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389vyk6ehj20go0a8my7.jpg" alt="image-20200618101046235" style="zoom:67%;" />

<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfw7z6khqqj30l00f6k2e.jpg" alt="image-20200618101136307"></p>
<ul>
<li>指数级了！下面這些才是必需要枚舉的情況，這題不需要<ul>
<li>子集</li>
<li>全排列</li>
<li>ｎ皇后</li>
</ul>
</li>
<li>如果無法得出正確答案，說明什麼？<ul>
<li>返回的info不夠</li>
</ul>
</li>
<li>增加返回值的種類<ul>
<li>Max_not_in_profit_L</li>
<li>Max_in_profit_L</li>
<li>Max_not_in_profit_R</li>
<li>Max_in_profit_R</li>
</ul>
</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfw85whozwj30l40emaic.jpg" alt="image-20200618101806841" style="zoom:80%;" />

<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389wdcrdgj205a042dfo.jpg" alt="image-20200618102718964"></p>
<h5 id="只返回一个值行不行？"><a href="#只返回一个值行不行？" class="headerlink" title="只返回一个值行不行？"></a>只返回一个值行不行？</h5><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfw8j2otn7j31080mgtkg.jpg" alt="image-20200618103046363"></p>
<p>全局不推薦，不好！</p>
<p>全局可能被其他的function影響，對多線程也不好</p>
<h3 id="453-二叉樹拆成鏈表"><a href="#453-二叉樹拆成鏈表" class="headerlink" title="453.二叉樹拆成鏈表"></a>453.二叉樹拆成鏈表</h3><ul>
<li>TODO:<ul>
<li>1.right = 2</li>
<li>4.right = 5</li>
</ul>
</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389wh73o2j20gc0iu75b.jpg" alt="image-20200618104542919" style="zoom:67%;" />

<ul>
<li>通過考慮怎麼合上，思考要傳什麼進去</li>
</ul>
<h3 id="262-Heir-Tree-繼承人樹"><a href="#262-Heir-Tree-繼承人樹" class="headerlink" title="262. Heir Tree 繼承人樹"></a>262. Heir Tree 繼承人樹</h3><ul>
<li>不真的删，前是建標記，所以別修改father’s child list</li>
<li>Lazy Delete: 晚點再刪, 同 <strong>859.Max Stack</strong></li>
<li>設計的意味，設計data base了</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389wkkgsqj20tq0fswfv.jpg" alt="image-20200618110201357" style="zoom:67%;" />

<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389wnca0sj20dk0oadhe.jpg" alt="image-20200618110244262" style="zoom:67%;" />



<h3 id="915-BST的中序前驅節點"><a href="#915-BST的中序前驅節點" class="headerlink" title="915.BST的中序前驅節點"></a>915.BST的中序前驅節點</h3><ul>
<li><input disabled="" type="checkbox"> A. O(N)</li>
<li><input disabled="" type="checkbox"> B. O(logN)</li>
<li><input checked="" disabled="" type="checkbox"> <strong>C. O(h)</strong> 未必要平衡，所以比B合適 </li>
</ul>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389wqyoswj204e05y3yd.jpg" alt="image-20200618110810029" style="zoom:50%;" />

<ul>
<li><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfw9r6qw21j30qg0bin0j.jpg" alt="image-20200618111311048"></p>
</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389ww65suj20f80cmgm0.jpg" alt="image-20200618111652378" style="zoom:67%;" />

<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389wzx39rj20hg0moq4a.jpg" alt="image-20200618111735472"></p>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfw9y0qo8qj30jo09ctba.jpg" alt="image-20200618111945429" style="zoom:80%;" />



<h3 id="106-有序鏈表轉化為二叉搜索樹"><a href="#106-有序鏈表轉化為二叉搜索樹" class="headerlink" title="106.有序鏈表轉化為二叉搜索樹"></a>106.有序鏈表轉化為二叉搜索樹</h3><ul>
<li>操作型，很自閉</li>
</ul>
<h4 id="方法一-O-NlogN"><a href="#方法一-O-NlogN" class="headerlink" title="方法一 O(NlogN)"></a>方法一 O(NlogN)</h4><ul>
<li><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389x43l4ij20yy08umyd.jpg" alt="image-20200618112325499" style="zoom:67%;" />

<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfwa3qor9xj30oo0eytbq.jpg" alt="image-20200618112515315" style="zoom:67%;" />
</li>
<li><p>N個中點，合併N次，所以N次</p>
<ul>
<li>但每次要 N/2 去找 n/2這位置，所以 lg(N)，也就是層數</li>
</ul>
</li>
</ul>
<h4 id="方法二-O-N"><a href="#方法二-O-N" class="headerlink" title="方法二 O(N)"></a>方法二 O(N)</h4><ul>
<li>優化成 O(N)</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfwa9s2vuqj30rc0em0ys.jpg" alt="image-20200618113102707"></p>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfwae3w36aj30kk0p4tfp.jpg" alt="image-20200618113512990" style="zoom:67%;" />





<h1 id="Seminar-8-DFS-Advanced"><a href="#Seminar-8-DFS-Advanced" class="headerlink" title="Seminar 8.DFS Advanced"></a>Seminar 8.DFS Advanced</h1><h3 id="427-生成括號"><a href="#427-生成括號" class="headerlink" title="427.生成括號"></a>427.生成括號</h3><h3 id="780-删除無效的括號-–-FB-經典考察題"><a href="#780-删除無效的括號-–-FB-經典考察題" class="headerlink" title="780.删除無效的括號 – FB 經典考察題"></a>780.删除無效的括號 – FB 經典考察題</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg1zshzimlj31910u0alx.jpg" alt="image-20200623100145480"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2005je5tj30nc0bignm.jpg" alt="image-20200623100911708"></p>
<h3 id="107-單詞拆分-DFS"><a href="#107-單詞拆分-DFS" class="headerlink" title="107.單詞拆分 - DFS"></a>107.單詞拆分 - DFS</h3><h3 id="582-單詞拆分-II-DFS"><a href="#582-單詞拆分-II-DFS" class="headerlink" title="582.單詞拆分 II - DFS"></a>582.單詞拆分 II - DFS</h3><h3 id="683-單詞拆分-III"><a href="#683-單詞拆分-III" class="headerlink" title="683.單詞拆分 III"></a>683.單詞拆分 III</h3><h3 id="652-因式分解"><a href="#652-因式分解" class="headerlink" title="652.因式分解"></a>652.因式分解</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg20ul2zsnj310w0fg0w4.jpg" alt="image-20200623103826795"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg21e2tradj30ta0nqn5g.jpg" alt="image-20200623105709890"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg21ezqmakj30bg0g6di2.jpg" alt="image-20200623105804188"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg21j5vjkmj30kq0qw44h.jpg" alt="image-20200623110202303"></p>
<h3 id="815-課程表-IV-–-所有方案"><a href="#815-課程表-IV-–-所有方案" class="headerlink" title="815 課程表 IV – 所有方案"></a>815 課程表 IV – 所有方案</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg21rbnu6xj30lq0uwaka.jpg" alt="image-20200623110952163"></p>
<p>NxN!  ==&gt; Nx2^N</p>
<h3 id="1514-掃地機器人"><a href="#1514-掃地機器人" class="headerlink" title="1514.掃地機器人"></a>1514.掃地機器人</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg223ybw6kj30f60pcdkn.jpg" alt="image-20200623112202612"></p>
<h3 id="121-Word-Ladder-II"><a href="#121-Word-Ladder-II" class="headerlink" title="121. Word Ladder II"></a>121. Word Ladder II</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg226xmki6j30jy0eggom.jpg" alt="image-20200623112455008"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg228pez4qj30oi0sadp2.jpg" alt="image-20200623112636438"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg22abpwmxj30ok0i8wkt.jpg" alt="image-20200623112809693"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg22fsi2c7j31030u019s.jpg" alt="image-20200623113321163"></p>
<p>K: 字符串長度</p>
<p>O(N + 26*K) # V+E</p>
<h2 id="A-–-794-Sliding-Puzzle-II"><a href="#A-–-794-Sliding-Puzzle-II" class="headerlink" title="A* – 794.Sliding Puzzle II"></a>A* – 794.Sliding Puzzle II</h2><ul>
<li><p>g(x): 離起點的距離</p>
<p>h(x): 離終點的距離 (估算)</p>
<p>f(x): = g(x) + h(x)</p>
</li>
<li><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389xu0fo4j20qo0s876f.jpg" alt="image-20200627115533364" style="zoom:67%;" />
</li>
<li><p>定義起發式函數一般是固有招，定義得好，走得快</p>
</li>
<li><p>優先隊列, 用heap存狀態</p>
</li>
<li><p>Heap: (f(x), g(x), state, start_x, start_y)</p>
</li>
<li><p>while heap:</p>
<ul>
<li>now_state… = heappop(heap)</li>
<li>if …<ul>
<li>return 最短距離 (g)</li>
</ul>
</li>
<li>for next_state in self.find_next_states:<ul>
<li>加入heap = (f(new_te))</li>
</ul>
</li>
</ul>
</li>
<li><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389xlivmfj20hk0dedgi.jpg" alt="image-20200627121024702" style="zoom:67%;" />

</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg6qzyi8blj30ri0eater.jpg" alt="image-20200627124522973"></p>
<ul>
<li>要更快就得這樣早期return, 不然就回到了原始BFS了</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg6r3eq3qsj30q40haqch.jpg" alt="image-20200627124844371"></p>
<ul>
<li>解法一</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg6r90w359j318l0u0kc6.jpg" alt="image-20200627125408859"></p>
<ul>
<li>解法二<ul>
<li>As SPFA used in 飛行棋</li>
</ul>
</li>
<li>但都是highly dependent on <strong>get_h</strong>, 所以這題用這算法還是可能有CASE錯。<br>實際運用時，可以允許小偏差</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">DIRECTIONS = [(<span class="number">0</span>, <span class="number">1</span>), (<span class="number">0</span>, <span class="number">-1</span>), (<span class="number">1</span>, <span class="number">0</span>), (<span class="number">-1</span>, <span class="number">0</span>)]</span><br><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    @param init_state: the initial state of chessboard</span></span><br><span class="line"><span class="string">    @param final_state: the final state of chessboard</span></span><br><span class="line"><span class="string">    @return: return an integer, denote the number of minimum moving</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minMoveStep</span><span class="params">(self, init_state, final_state)</span>:</span></span><br><span class="line">        <span class="comment"># write your code here</span></span><br><span class="line">        <span class="keyword">if</span> len(init_state) == <span class="number">0</span> <span class="keyword">or</span> len(init_state[<span class="number">0</span>]) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span> </span><br><span class="line">        </span><br><span class="line">        n = len(init_state)</span><br><span class="line">        m = len(init_state[<span class="number">0</span>])</span><br><span class="line">        </span><br><span class="line">        open_set = []</span><br><span class="line">        close_set = set()</span><br><span class="line">        value_to_index = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># find init 0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(m):</span><br><span class="line">                <span class="keyword">if</span> init_state[i][j] == <span class="number">0</span>:</span><br><span class="line">                    start_x, start_y = i, j</span><br><span class="line">                value_to_index[final_state[i][j]] = (i, j)</span><br><span class="line">                    </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># final_state中每个值所在的位置</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># (f(x), g(x), state, start_x, start_y)</span></span><br><span class="line">        open_set.append((<span class="number">0</span>, <span class="number">0</span>, self.list_to_tuple(init_state), start_x, start_y))</span><br><span class="line">        close_set.add(self.list_to_tuple(init_state))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> open_set:</span><br><span class="line">            f, g, now_state, x, y = heapq.heappop(open_set)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> self.tuple_to_list(now_state) == final_state:</span><br><span class="line">                <span class="keyword">return</span> g</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> next_state, next_x, next_y <span class="keyword">in</span> \</span><br><span class="line">            self.find_next_state(now_state, x, y, close_set):</span><br><span class="line">                heapq.heappush(open_set, </span><br><span class="line">                (g + <span class="number">1</span> + self.get_h(next_state,value_to_index), </span><br><span class="line">                g + <span class="number">1</span>, next_state, next_x, next_y))</span><br><span class="line">                close_set.add(now_state)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span> </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_next_state</span><span class="params">(self, now_state, x, y, close_set)</span>:</span></span><br><span class="line">        next_state_list = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> delta_x, delta_y <span class="keyword">in</span> DIRECTIONS:</span><br><span class="line">            next_x = x + delta_x</span><br><span class="line">            next_y = y + delta_y </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.is_valid(next_x, next_y, now_state):</span><br><span class="line">                <span class="keyword">continue</span> </span><br><span class="line">        </span><br><span class="line">            <span class="comment"># deep copy</span></span><br><span class="line">            next_state = self.tuple_to_list(now_state)</span><br><span class="line">            next_state[x][y], next_state[next_x][next_y] = \</span><br><span class="line">            next_state[next_x][next_y], next_state[x][y]</span><br><span class="line">            </span><br><span class="line">            next_state = self.list_to_tuple(next_state)</span><br><span class="line">            <span class="keyword">if</span> next_state <span class="keyword">in</span> close_set:</span><br><span class="line">                <span class="keyword">continue</span> </span><br><span class="line">        </span><br><span class="line">            next_state_list.append((next_state, next_x, next_y))</span><br><span class="line">        <span class="keyword">return</span> next_state_list   </span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_h</span><span class="params">(self, now_state, value_to_index)</span>:</span></span><br><span class="line">        <span class="comment"># sigma（每个数字所在的位置的dx+dy）</span></span><br><span class="line">        h = <span class="number">0</span></span><br><span class="line">        n = len(now_state)</span><br><span class="line">        m = len(now_state[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(m):</span><br><span class="line">                final_x, final_y = value_to_index[now_state[i][j]]</span><br><span class="line">                h += abs(final_x - i) + abs(final_y - j)</span><br><span class="line">        <span class="keyword">return</span> h </span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">get_h2</span><span class="params">(self, now_state, value_to_index)</span>:</span></span><br><span class="line">      	<span class="keyword">return</span> random.randint(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_valid</span><span class="params">(self, x, y, now_state)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> x &lt; <span class="number">0</span> <span class="keyword">or</span> y &lt; <span class="number">0</span> <span class="keyword">or</span> x &gt;= len(now_state) <span class="keyword">or</span> y &gt;= len(now_state[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span> </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">list_to_tuple</span><span class="params">(self, l)</span>:</span></span><br><span class="line">        result = [tuple(x) <span class="keyword">for</span> x <span class="keyword">in</span> l]</span><br><span class="line">        <span class="keyword">return</span> tuple(result)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tuple_to_list</span><span class="params">(self, t)</span>:</span></span><br><span class="line">        result = [list(x) <span class="keyword">for</span> x <span class="keyword">in</span> t]</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<ul>
<li>get_h：必須要是一個能作正確引導的，不然答案不見得正確的, 如，用get_h2時，肯定就是完了</li>
<li>全走時會比較差</li>
</ul>
<h5 id="解法1-min-dist-w-打擂台"><a href="#解法1-min-dist-w-打擂台" class="headerlink" title="解法1, min_dist w/ 打擂台"></a>解法1, min_dist w/ 打擂台</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">DIRECTIONS = [(<span class="number">0</span>, <span class="number">1</span>), (<span class="number">0</span>, <span class="number">-1</span>), (<span class="number">1</span>, <span class="number">0</span>), (<span class="number">-1</span>, <span class="number">0</span>)]</span><br><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    @param init_state: the initial state of chessboard</span></span><br><span class="line"><span class="string">    @param final_state: the final state of chessboard</span></span><br><span class="line"><span class="string">    @return: return an integer, denote the number of minimum moving</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minMoveStep</span><span class="params">(self, init_state, final_state)</span>:</span></span><br><span class="line">        <span class="comment"># write your code here</span></span><br><span class="line">        <span class="keyword">if</span> len(init_state) == <span class="number">0</span> <span class="keyword">or</span> len(init_state[<span class="number">0</span>]) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span> </span><br><span class="line">        </span><br><span class="line">        n = len(init_state)</span><br><span class="line">        m = len(init_state[<span class="number">0</span>])</span><br><span class="line">        </span><br><span class="line">        open_set = []</span><br><span class="line">        close_set = set()</span><br><span class="line">        value_to_index = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># find init 0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(m):</span><br><span class="line">                <span class="keyword">if</span> init_state[i][j] == <span class="number">0</span>:</span><br><span class="line">                    start_x, start_y = i, j</span><br><span class="line">                value_to_index[final_state[i][j]] = (i, j)</span><br><span class="line">                    </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># final_state中每个值所在的位置</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># (f(x), g(x), state, start_x, start_y)</span></span><br><span class="line">        open_set.append((<span class="number">0</span>, <span class="number">0</span>, self.list_to_tuple(init_state), start_x, start_y))</span><br><span class="line">        close_set.add(self.list_to_tuple(init_state))</span><br><span class="line">				count = <span class="number">0</span></span><br><span class="line">        min_dist = sys.maxsize</span><br><span class="line">        <span class="keyword">while</span> open_set:</span><br><span class="line">            f, g, now_state, x, y = heapq.heappop(open_set)</span><br><span class="line">            </span><br><span class="line">            <span class="string">""" 解法一 """</span></span><br><span class="line">            <span class="keyword">if</span> g &gt; min_dist:</span><br><span class="line">              	<span class="keyword">continue</span></span><br><span class="line">                </span><br><span class="line">            <span class="keyword">if</span> self.tuple_to_list(now_state) == final_state:</span><br><span class="line">                <span class="comment"># return g</span></span><br><span class="line">                min_dist = min(min_dist, g)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="string">""" 解法一 END """</span>            </span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> next_state, next_x, next_y <span class="keyword">in</span> \</span><br><span class="line">            self.find_next_state(now_state, x, y, close_set):</span><br><span class="line">                heapq.heappush(open_set, </span><br><span class="line">                (g + <span class="number">1</span> + self.get_h(next_state,value_to_index), </span><br><span class="line">                g + <span class="number">1</span>, next_state, next_x, next_y))</span><br><span class="line">                close_set.add(now_state)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span> </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_next_state</span><span class="params">(self, now_state, x, y, close_set)</span>:</span></span><br><span class="line">        next_state_list = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> delta_x, delta_y <span class="keyword">in</span> DIRECTIONS:</span><br><span class="line">            next_x = x + delta_x</span><br><span class="line">            next_y = y + delta_y </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.is_valid(next_x, next_y, now_state):</span><br><span class="line">                <span class="keyword">continue</span> </span><br><span class="line">        </span><br><span class="line">            <span class="comment"># deep copy</span></span><br><span class="line">            next_state = self.tuple_to_list(now_state)</span><br><span class="line">            next_state[x][y], next_state[next_x][next_y] = \</span><br><span class="line">            next_state[next_x][next_y], next_state[x][y]</span><br><span class="line">            </span><br><span class="line">            next_state = self.list_to_tuple(next_state)</span><br><span class="line">            <span class="keyword">if</span> next_state <span class="keyword">in</span> close_set:</span><br><span class="line">                <span class="keyword">continue</span> </span><br><span class="line">        </span><br><span class="line">            next_state_list.append((next_state, next_x, next_y))</span><br><span class="line">        <span class="keyword">return</span> next_state_list   </span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_h</span><span class="params">(self, now_state, value_to_index)</span>:</span></span><br><span class="line">        <span class="comment"># sigma（每个数字所在的位置的dx+dy）</span></span><br><span class="line">        h = <span class="number">0</span></span><br><span class="line">        n = len(now_state)</span><br><span class="line">        m = len(now_state[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(m):</span><br><span class="line">                final_x, final_y = value_to_index[now_state[i][j]]</span><br><span class="line">                h += abs(final_x - i) + abs(final_y - j)</span><br><span class="line">        <span class="keyword">return</span> h </span><br><span class="line">        </span><br><span class="line">		<span class="function"><span class="keyword">def</span> <span class="title">get_h2</span><span class="params">(self, now_state, value_to_index)</span>:</span></span><br><span class="line">      	<span class="keyword">return</span> random.randint(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_valid</span><span class="params">(self, x, y, now_state)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> x &lt; <span class="number">0</span> <span class="keyword">or</span> y &lt; <span class="number">0</span> <span class="keyword">or</span> x &gt;= len(now_state) <span class="keyword">or</span> y &gt;= len(now_state[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span> </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">list_to_tuple</span><span class="params">(self, l)</span>:</span></span><br><span class="line">        result = [tuple(x) <span class="keyword">for</span> x <span class="keyword">in</span> l]</span><br><span class="line">        <span class="keyword">return</span> tuple(result)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tuple_to_list</span><span class="params">(self, t)</span>:</span></span><br><span class="line">        result = [list(x) <span class="keyword">for</span> x <span class="keyword">in</span> t]</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>



<h5 id="解法1-2-加上SPFA"><a href="#解法1-2-加上SPFA" class="headerlink" title="解法1+2, 加上SPFA"></a>解法1+2, 加上SPFA</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">DIRECTIONS = [(<span class="number">0</span>, <span class="number">1</span>), (<span class="number">0</span>, <span class="number">-1</span>), (<span class="number">1</span>, <span class="number">0</span>), (<span class="number">-1</span>, <span class="number">0</span>)]</span><br><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    @param init_state: the initial state of chessboard</span></span><br><span class="line"><span class="string">    @param final_state: the final state of chessboard</span></span><br><span class="line"><span class="string">    @return: return an integer, denote the number of minimum moving</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minMoveStep</span><span class="params">(self, init_state, final_state)</span>:</span></span><br><span class="line">        <span class="comment"># write your code here</span></span><br><span class="line">        <span class="keyword">if</span> len(init_state) == <span class="number">0</span> <span class="keyword">or</span> len(init_state[<span class="number">0</span>]) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span> </span><br><span class="line">        </span><br><span class="line">        n = len(init_state)</span><br><span class="line">        m = len(init_state[<span class="number">0</span>])</span><br><span class="line">        </span><br><span class="line">        open_set = []</span><br><span class="line">        <span class="comment"># close_set = set()</span></span><br><span class="line">        close_set = &#123;&#125;</span><br><span class="line">        value_to_index = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># find init 0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(m):</span><br><span class="line">                <span class="keyword">if</span> init_state[i][j] == <span class="number">0</span>:</span><br><span class="line">                    start_x, start_y = i, j</span><br><span class="line">                value_to_index[final_state[i][j]] = (i, j)</span><br><span class="line">                    </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># final_state中每个值所在的位置</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># (f(x), g(x), state, start_x, start_y)</span></span><br><span class="line">        open_set.append((<span class="number">0</span>, <span class="number">0</span>, self.list_to_tuple(init_state), start_x, start_y))</span><br><span class="line">        <span class="comment"># close_set.add(self.list_to_tuple(init_state))</span></span><br><span class="line">        close_set[self.list_to_tuple(init_state)] = <span class="number">0</span></span><br><span class="line">				count = <span class="number">0</span></span><br><span class="line">        min_dist = sys.maxsize</span><br><span class="line">        <span class="keyword">while</span> open_set:</span><br><span class="line">            f, g, now_state, x, y = heapq.heappop(open_set)</span><br><span class="line">            </span><br><span class="line">            <span class="string">""" 解法一 """</span></span><br><span class="line">            <span class="keyword">if</span> g &gt; min_dist:</span><br><span class="line">              	<span class="keyword">continue</span></span><br><span class="line">                </span><br><span class="line">            <span class="keyword">if</span> self.tuple_to_list(now_state) == final_state:</span><br><span class="line">                <span class="comment"># return g</span></span><br><span class="line">                min_dist = min(min_dist, g)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="string">""" 解法一 END """</span>            </span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> next_state, next_x, next_y <span class="keyword">in</span> \</span><br><span class="line"></span><br><span class="line">            <span class="string">""" 解法二 修改 find_next_state裡的條件，並傳入 g"""</span></span><br><span class="line">            self.find_next_state(now_state, x, y, close_set, g):</span><br><span class="line">                heapq.heappush(open_set, </span><br><span class="line">                (g + <span class="number">1</span> + self.get_h(next_state,value_to_index), </span><br><span class="line">                g + <span class="number">1</span>, next_state, next_x, next_y))</span><br><span class="line">                <span class="comment"># close_set.add(now_state)</span></span><br><span class="line">                close_set[next_state] = g + <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> min_dist == sys.maxsize:</span><br><span class="line">          <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">        <span class="keyword">return</span> min_dist</span><br><span class="line">        <span class="comment"># return -1 </span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_next_state</span><span class="params">(self, now_state, x, y, close_set, g)</span>:</span></span><br><span class="line">        next_state_list = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> delta_x, delta_y <span class="keyword">in</span> DIRECTIONS:</span><br><span class="line">            next_x = x + delta_x</span><br><span class="line">            next_y = y + delta_y </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.is_valid(next_x, next_y, now_state):</span><br><span class="line">                <span class="keyword">continue</span> </span><br><span class="line">        </span><br><span class="line">            <span class="comment"># deep copy</span></span><br><span class="line">            next_state = self.tuple_to_list(now_state)</span><br><span class="line">            next_state[x][y], next_state[next_x][next_y] = \</span><br><span class="line">            next_state[next_x][next_y], next_state[x][y]</span><br><span class="line">            </span><br><span class="line">            next_state = self.list_to_tuple(next_state)</span><br><span class="line">            <span class="keyword">if</span> next_state <span class="keyword">in</span> close_set <span class="keyword">and</span> close_set[next_state] &gt;= g + <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">continue</span> </span><br><span class="line">        </span><br><span class="line">            next_state_list.append((next_state, next_x, next_y))</span><br><span class="line">        <span class="keyword">return</span> next_state_list   </span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_h</span><span class="params">(self, now_state, value_to_index)</span>:</span></span><br><span class="line">        <span class="comment"># sigma（每个数字所在的位置的dx+dy）</span></span><br><span class="line">        h = <span class="number">0</span></span><br><span class="line">        n = len(now_state)</span><br><span class="line">        m = len(now_state[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(m):</span><br><span class="line">                final_x, final_y = value_to_index[now_state[i][j]]</span><br><span class="line">                h += abs(final_x - i) + abs(final_y - j)</span><br><span class="line">        <span class="keyword">return</span> h </span><br><span class="line">        </span><br><span class="line">		<span class="function"><span class="keyword">def</span> <span class="title">get_h2</span><span class="params">(self, now_state, value_to_index)</span>:</span></span><br><span class="line">      	<span class="keyword">return</span> random.randint(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_valid</span><span class="params">(self, x, y, now_state)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> x &lt; <span class="number">0</span> <span class="keyword">or</span> y &lt; <span class="number">0</span> <span class="keyword">or</span> x &gt;= len(now_state) <span class="keyword">or</span> y &gt;= len(now_state[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span> </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">list_to_tuple</span><span class="params">(self, l)</span>:</span></span><br><span class="line">        result = [tuple(x) <span class="keyword">for</span> x <span class="keyword">in</span> l]</span><br><span class="line">        <span class="keyword">return</span> tuple(result)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tuple_to_list</span><span class="params">(self, t)</span>:</span></span><br><span class="line">        result = [list(x) <span class="keyword">for</span> x <span class="keyword">in</span> t]</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>



<ul>
<li>實際用的時候可以有點小偏差</li>
</ul>
<h2 id="單調隊列-1507-和至少為K的最短子數組"><a href="#單調隊列-1507-和至少為K的最短子數組" class="headerlink" title="單調隊列 - 1507.和至少為K的最短子數組"></a>單調隊列 - 1507.和至少為K的最短子數組</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    @param A: the array</span></span><br><span class="line"><span class="string">    @param K: sum</span></span><br><span class="line"><span class="string">    @return: the length</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">shortestSubarray</span><span class="params">(self, A, K)</span>:</span></span><br><span class="line">        <span class="comment"># Write your code here.</span></span><br><span class="line">        <span class="comment"># return self.O_N3_TLE(A, K)</span></span><br><span class="line">        <span class="comment"># return self.mono_Q(A, K)</span></span><br><span class="line">        <span class="keyword">return</span> self.my_mono_Q(A, K)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">my_mono_Q</span><span class="params">(self, A, K)</span>:</span></span><br><span class="line">        N = len(A)</span><br><span class="line">        pre_sum = [<span class="number">0</span>] * (N+<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(N):</span><br><span class="line">            pre_sum[i+<span class="number">1</span>] = pre_sum[i] + A[i]</span><br><span class="line">            </span><br><span class="line">        Q = collections.deque()</span><br><span class="line">        ans = sys.maxsize</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(N+<span class="number">1</span>):</span><br><span class="line">            <span class="comment"># 考慮A裡有負數的情況, pre_sum就會下降了；它對 pre_sum 造成了一個山谷</span></span><br><span class="line">            <span class="comment"># 1. 到山谷才能拿到的值，經過山谷之前只會更小，所以前面不會再是答案</span></span><br><span class="line">            <span class="comment"># 2. 山谷之前只是讓長度更長不會更短</span></span><br><span class="line">            <span class="keyword">while</span> Q <span class="keyword">and</span> pre_sum[j] &lt;= pre_sum[Q[<span class="number">-1</span>]]:</span><br><span class="line">                Q.pop() <span class="comment"># 塞的時候從右邊check</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 都是正數的情況</span></span><br><span class="line">            <span class="keyword">while</span> Q <span class="keyword">and</span> pre_sum[j] - pre_sum[Q[<span class="number">0</span>]] &gt;= K:</span><br><span class="line">                i = Q.popleft() <span class="comment"># 找答案時候從左邊</span></span><br><span class="line">                ans = min(ans, j - i)</span><br><span class="line">                </span><br><span class="line">            Q.append(j)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ans <span class="keyword">if</span> ans &lt; sys.maxsize <span class="keyword">else</span> <span class="number">-1</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mono_Q</span><span class="params">(self, A, K)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        [(0,-1), (3,0), (7,1), (13,2), (14,3), (9,4), (19,?)]</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        # K = 10</span></span><br><span class="line"><span class="string">        i:      0,  1,  2,  3,  4</span></span><br><span class="line"><span class="string">        A[i]    3,  4,  6,  1,  -5</span></span><br><span class="line"><span class="string">        sum:    3,  7,  13, 14, 9</span></span><br><span class="line"><span class="string">        now_sum = 13</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Q.popleft()</span></span><br><span class="line"><span class="string">        1. now_sum - 0 &gt;= K?</span></span><br><span class="line"><span class="string">        ans = min(ans, 2 - (-1))</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        2. now_sum - 3 &gt;= K? √</span></span><br><span class="line"><span class="string">        ans = min(ans, 2 - (0))</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        3. now_sum - 7 &gt;= K? x</span></span><br><span class="line"><span class="string">        break</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        ★ 第二部分</span></span><br><span class="line"><span class="string">        2. (9, 4)</span></span><br><span class="line"><span class="string">        - 9 &lt; 14?</span></span><br><span class="line"><span class="string">        pop()</span></span><br><span class="line"><span class="string">        - 9 &lt; 13?  </span></span><br><span class="line"><span class="string">        pop()</span></span><br><span class="line"><span class="string">        - 9 &lt; 7?</span></span><br><span class="line"><span class="string">        break</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">    </span><br><span class="line">        N = len(A)</span><br><span class="line">        pre_sum = [<span class="number">0</span>] * (N+<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># for i in range(len(A)):</span></span><br><span class="line">        <span class="comment">#     pre_sum[i+1] = pre_sum[i] + A[i]</span></span><br><span class="line">        <span class="keyword">for</span> i, n <span class="keyword">in</span> enumerate(A):</span><br><span class="line">            pre_sum[i+<span class="number">1</span>] = pre_sum[i] + n</span><br><span class="line">        </span><br><span class="line">        ans = N + <span class="number">1</span></span><br><span class="line">        Q = collections.deque()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(N + <span class="number">1</span>):</span><br><span class="line">            <span class="string">"""★ 第二部分"""</span></span><br><span class="line">            <span class="keyword">while</span> Q <span class="keyword">and</span> pre_sum[Q[<span class="number">-1</span>]] &gt;= pre_sum[j]:</span><br><span class="line">                Q.pop()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">while</span> Q <span class="keyword">and</span> pre_sum[j] - pre_sum[Q[<span class="number">0</span>]] &gt;= K:</span><br><span class="line">                i = Q.popleft()</span><br><span class="line">                ans = min(ans, j - i)</span><br><span class="line">            </span><br><span class="line">            Q.append(j)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ans <span class="keyword">if</span> ans &lt; N+<span class="number">1</span> <span class="keyword">else</span> <span class="number">-1</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">O_N3_TLE</span><span class="params">(self, A, K)</span>:</span></span><br><span class="line">        n = len(A)</span><br><span class="line">        <span class="comment"># pre_sum = [0] * (N-1)</span></span><br><span class="line">        min_len = sys.maxsize</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">if</span> A[i] &gt;= K:   <span class="comment"># 要的是至少為K，不是剛好等於K</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(i+<span class="number">1</span>, n+<span class="number">1</span>):</span><br><span class="line">                cur_sum = sum(A[i:j])</span><br><span class="line">                <span class="keyword">if</span> cur_sum &gt;= K:   <span class="comment"># 要的是至少為K，不是剛好等於K</span></span><br><span class="line">                    min_len = min(min_len, j-i)</span><br><span class="line">                <span class="comment"># print(i, j, cur_sum)</span></span><br><span class="line">                </span><br><span class="line">        <span class="keyword">if</span> min_len == sys.maxsize:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">        <span class="keyword">return</span> min_len</span><br></pre></td></tr></table></figure>

<ul>
<li>若二分答案還得再多一個 logN</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/06/09/Algo.%20Ult./seminar_4&amp;5/">Algo. Ult./seminar_4&amp;5</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-06-09</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/AlgoUlt/">AlgoUlt.</a></span><div class="content"><p>思考何時用雙指針</p>
<h1 id="Seminar-4"><a href="#Seminar-4" class="headerlink" title="Seminar 4"></a>Seminar 4</h1><h2 id="1849-Grumpy-Bookstore-Owner"><a href="#1849-Grumpy-Bookstore-Owner" class="headerlink" title="1849. Grumpy Bookstore Owner"></a>1849. Grumpy Bookstore Owner</h2><ol>
<li><p>枚舉脾氣變好的開始日期，再計算所有好脾氣的顧客</p>
</li>
<li><p>用一個滑窗來處理當前sliding window內的情況</p>
<ul>
<li><input disabled="" type="checkbox"> <p>​    A. 紀錄sliding window 內customers 的個數</p>
</li>
<li><input disabled="" type="checkbox"> <p>​    B. 紀錄sliding window 內好評customers 的個數 </p>
</li>
<li><input checked="" disabled="" type="checkbox"> <p>​    C. <strong>紀錄sliding window 內差評customers 的個數. V</strong>    </p>
</li>
</ul>
<p>​            答案怎麼打擂台？！</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataType</span>:</span></span><br><span class="line">    GOOD = <span class="number">0</span></span><br><span class="line">    BAD = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    @param customers: the number of customers</span></span><br><span class="line"><span class="string">    @param grumpy: the owner's temper every day</span></span><br><span class="line"><span class="string">    @param X: X days</span></span><br><span class="line"><span class="string">    @return: calc the max satisfied customers</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxSatisfied</span><span class="params">(self, customers, grumpy, X)</span>:</span></span><br><span class="line">        <span class="comment"># write your code here</span></span><br><span class="line">        <span class="comment"># 1. sliding window 紀錄區間內差評人數的個數</span></span><br><span class="line">        <span class="comment"># 2. 找所有天中原本就是好評人的個數</span></span><br><span class="line">        <span class="comment"># 3. 原本好評+區間內最好差評人數 = 答案</span></span><br><span class="line">        n = len(customers)</span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">            </span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = X - <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        now_sum = <span class="number">0</span> <span class="comment"># 當前區間的差評人數</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(X):</span><br><span class="line">            <span class="keyword">if</span> grumpy[i] == DataType.BAD:</span><br><span class="line">                now_sum += customers[i]</span><br><span class="line">        </span><br><span class="line">        maximum_bad_number = now_sum</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> right + <span class="number">1</span> &lt; n:</span><br><span class="line">            right += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> grumpy[right] == DataType.BAD:</span><br><span class="line">                now_sum += customers[right]</span><br><span class="line">        </span><br><span class="line">            <span class="keyword">if</span> grumpy[left] == DataType.BAD:</span><br><span class="line">                now_sum -= customers[left]</span><br><span class="line">            </span><br><span class="line">            left += <span class="number">1</span></span><br><span class="line">            maximum_bad_number = max(maximum_bad_number, now_sum)</span><br><span class="line">            </span><br><span class="line">        satisfied_number = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">if</span> grumpy[i] == DataType.GOOD:</span><br><span class="line">                satisfied_number += customers[i]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> satisfied_number + maximum_bad_number</span><br></pre></td></tr></table></figure>





<h2 id="1850-撿蘋果"><a href="#1850-撿蘋果" class="headerlink" title="1850. 撿蘋果"></a>1850. 撿蘋果</h2><ul>
<li>目的：枚舉兩個區間</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gflt4ayfi1j30ys0gc44n.jpg" alt="image-20200609100156524"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gflt8o6v50j30zm0huwlh.jpg" alt="image-20200609100606181"></p>
<p>當已知隔板，可知左邊最大、右邊最大是多少，ref: penbox</p>
<h2 id="1375-Substring-With-At-Least-K-Distinct-CharactersFollow"><a href="#1375-Substring-With-At-Least-K-Distinct-CharactersFollow" class="headerlink" title="1375. Substring With At Least K Distinct CharactersFollow"></a>1375. Substring With At Least K Distinct CharactersFollow</h2><ul>
<li>Description</li>
<li>Leaderboard</li>
<li>Note</li>
<li>Discuss</li>
<li>Solution</li>
<li></li>
<li>My Submissions</li>
<li>Open IDE</li>
</ul>
<h3 id="雙指針的變式-–-計數型雙指針"><a href="#雙指針的變式-–-計數型雙指針" class="headerlink" title="雙指針的變式 – 計數型雙指針"></a>雙指針的變式 – 計數型雙指針</h3><h4 id="雙指針的類型："><a href="#雙指針的類型：" class="headerlink" title="雙指針的類型："></a>雙指針的類型：</h4><h5 id="同向雙指針"><a href="#同向雙指針" class="headerlink" title="同向雙指針"></a>同向雙指針</h5><ul>
<li>sliding window</li>
</ul>
<h5 id="相向雙指針"><a href="#相向雙指針" class="headerlink" title="相向雙指針"></a>相向雙指針</h5><ul>
<li>Two sum 類型問題</li>
</ul>
<h5 id="背向雙指針"><a href="#背向雙指針" class="headerlink" title="背向雙指針"></a>背向雙指針</h5><ul>
<li>最長回文子串</li>
</ul>
<h5 id="計數型雙指針"><a href="#計數型雙指針" class="headerlink" title="計數型雙指針"></a>計數型雙指針</h5><ul>
<li>通過雙指針解決計數問題</li>
<li>問法：滿足某條件的….有多少個</li>
</ul>
<h5 id="模擬型雙指針"><a href="#模擬型雙指針" class="headerlink" title="模擬型雙指針"></a>模擬型雙指針</h5><ul>
<li>通過雙</li>
</ul>
<ul>
<li>判斷是否為「好串」</li>
<li>判斷以區間為前綴是否滿足條件</li>
</ul>
<h2 id="1219-加熱器"><a href="#1219-加熱器" class="headerlink" title="1219. 加熱器"></a>1219. 加熱器</h2><ol>
<li>二分：對每個房屋的位置在加熱器數組中用二分，找到最后一个比你小的加热器一個半徑　nlogn</li>
</ol>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389upjud9j20og0ik0uh.jpg" alt="image-20200609105609685" style="zoom:67%;" />



<ol start="2">
<li><p>优化一：直接雙指針貪心</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gflv0ebmj9j30vy0agdis.jpg" alt="image-20200609110723097"></p>
</li>
</ol>
<ol start="3">
<li>优化二：二分「加热器的半径」+ 双指针，有機會更好想</li>
</ol>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gflv4llibmj30pe0b2ju2.jpg" alt="image-20200609111124815"></p>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389uthm90j20ti0ugwgy.jpg" alt="image-20200609111225705" style="zoom:67%;" />

<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gflv922yz9j30q60oqaiw.jpg" alt="image-20200609111539663"></p>
<h2 id="1879-twoSumVII"><a href="#1879-twoSumVII" class="headerlink" title="1879.twoSumVII"></a>1879.twoSumVII</h2><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gflvki9wvxj30le09wtb1.jpg" alt="image-20200609112642341"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gflvt4k12kj30qi0ooqb6.jpg" alt="image-20200609113454765"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gflvu9fq9vj30u40fmq9m.jpg" alt="image-20200609113602841"></p>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h389uxyvzjj20p403s74g.jpg" alt="image-20200609113733945" style="zoom:67%;" />





<h1 id="Seminar-5"><a href="#Seminar-5" class="headerlink" title="Seminar 5"></a>Seminar 5</h1><h2 id="677-大島的數量"><a href="#677-大島的數量" class="headerlink" title="677.大島的數量"></a>677.大島的數量</h2><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo3ph93a1j30he0buq5n.jpg" alt="image-20200611093923800"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo3zcfmkkj30u00ub165.jpg" alt="image-20200611094851670"></p>
<h2 id="598-僵屍矩陣"><a href="#598-僵屍矩陣" class="headerlink" title="598.僵屍矩陣"></a>598.僵屍矩陣</h2><ul>
<li>爛橘子感染</li>
<li>程序員的病毒</li>
<li>「感染的起點」，從僵屍開始 BFS</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo4692l8uj30r80ruwli.jpg" alt="image-20200611095527541"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo49emrm0j30t40vcamu.jpg" alt="image-20200611095832430"></p>
<h4 id="加now-day"><a href="#加now-day" class="headerlink" title="加now_day"></a>加now_day</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo4idhzguj30ti0v2wpg.jpg" alt="image-20200611100705633"></p>
<h4 id="也可以内嵌算human-number"><a href="#也可以内嵌算human-number" class="headerlink" title="也可以内嵌算human number"></a>也可以内嵌算human number</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo4m9fqsjj30x20qo7br.jpg" alt="image-20200611101052102"></p>
<h2 id="573-郵局的建立II"><a href="#573-郵局的建立II" class="headerlink" title="573.郵局的建立II"></a>573.郵局的建立II</h2><p>visited 非共享的，</p>
<p>每次的</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo4ttxr3rj30qk10utix.jpg" alt="image-20200611101757179"></p>
<p>但這樣會是 O(n^4)的</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo4zjyz5bj30ta0su4co.jpg" alt="image-20200611102340291"></p>
<p><strong>１１４line这样写的话，可能一个房子被经过多次</strong></p>
<p>so, better as following</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo54r3786j30ug0k0jz5.jpg" alt="image-20200611102837431"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo57o772oj30vk0qwtht.jpg" alt="image-20200611103125603"></p>
<p>倒過來！從房子找空地！</p>
<h4 id="該怎麼從房子數來BFS"><a href="#該怎麼從房子數來BFS" class="headerlink" title="該怎麼從房子數來BFS?"></a>該怎麼從房子數來BFS?</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo5nhua62j30pu0l4436.jpg" alt="image-20200611104641237"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo5p6k3e0j30sm0vuaqb.jpg" alt="image-20200611104818468"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo5ttq9oqj30u00w07f1.jpg" alt="image-20200611105245274"></p>
<h2 id="616-課程安排"><a href="#616-課程安排" class="headerlink" title="616.課程安排"></a>616.課程安排</h2><ul>
<li><p>拓展較少，一般都就裸題</p>
</li>
<li><p>預處理所有課程的入度，將所有入度為０的點入隊，並逐漸出隊，並將出隊相連的節點的入度減１</p>
</li>
<li><p>若一節點入度變為０，則將其入隊</p>
</li>
<li><p>BFS 結束後，ans序列長度若與課程總數相等，則是一個拓撲序</p>
</li>
<li><p>否則不存在拓撲序</p>
</li>
</ul>
<h4 id="BAD-O-VE-or-O-n-m"><a href="#BAD-O-VE-or-O-n-m" class="headerlink" title="BAD, O(VE) or O(n*m)"></a>BAD, O(VE) or O(n*m)</h4><p>一般要求 O(V+E) or O(n+m)</p>
<p>所以</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo65sexw1j30mk0modme.jpg" alt="image-20200611110413633"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo68h2646j30fe01edg7.jpg" alt="image-20200611110653860"></p>
<h4 id="Better↓，O-V-E-or-O-n-m"><a href="#Better↓，O-V-E-or-O-n-m" class="headerlink" title="Better↓，O(V+E) or O(n+m)"></a>Better↓，O(V+E) or O(n+m)</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo67rdcv6j30sm0vcn53.jpg" alt="image-20200611110609155"></p>
<h2 id="434-島個數II"><a href="#434-島個數II" class="headerlink" title="434.島個數II"></a>434.島個數II</h2><h3 id="BFS"><a href="#BFS" class="headerlink" title="BFS"></a>BFS</h3><ul>
<li>O(n^2) * len(queue)</li>
</ul>
<h3 id="並查集"><a href="#並查集" class="headerlink" title="並查集"></a>並查集</h3><ul>
<li></li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo6gomjm4j31nk0k4zsl.jpg" alt="image-20200611111435222"></p>
<h4 id=""><a href="#" class="headerlink" title=""></a><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo6mwtnb3j31nk0quan3.jpg" alt="image-20200611112039152"></h4><p>這寫法不具壓縮</p>
<h4 id="壓縮路徑"><a href="#壓縮路徑" class="headerlink" title="壓縮路徑"></a>壓縮路徑</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo6nqyrutj31d20iwqbd.jpg" alt="image-20200611112128985"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo6qtvn7wj30gw0iwada.jpg" alt="image-20200611112428660"></p>
<p>「之後找就都是O(1)的操作了」，是個均攤O(1)的操作</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo6u94fakj30n20dcalx.jpg" alt="image-20200611112740580"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo6vft814j30vf0u0n8i.jpg" alt="image-20200611112850990"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo6x56v7qj30re0qa0zj.jpg" alt="image-20200611113032781"></p>
<p>把s改為is_ialand</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo6xlfmyvj30u00yu13v.jpg" alt="image-20200611113056937"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo72y8ny8j30pw0voqbt.jpg" alt="image-20200611113609070"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfo75oajyfj30u00vgn6j.jpg" alt="image-20200611113842739"></p>
<h1 id="雙指針的其它實現討論"><a href="#雙指針的其它實現討論" class="headerlink" title="雙指針的其它實現討論"></a>雙指針的其它實現討論</h1><h3 id="Grumpy-bookstore"><a href="#Grumpy-bookstore" class="headerlink" title="Grumpy bookstore"></a>Grumpy bookstore</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfpqsr818cj30x60ien3w.jpg" alt="image-20200612194355441"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfpqvauwoej30aw0323z6.jpg" alt="image-20200612194622939"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfpqzk8vfnj30uo0g6dl4.jpg" alt="image-20200612195027886"></p>
<h1 id="BFS-Discussion"><a href="#BFS-Discussion" class="headerlink" title="BFS Discussion"></a>BFS Discussion</h1><h3 id="1828-湖面逃跑-★★★"><a href="#1828-湖面逃跑-★★★" class="headerlink" title="1828.湖面逃跑 ★★★"></a>1828.湖面逃跑 ★★★</h3><p>from Akuna Capital</p>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfprwqg1euj30gs0gmakw.jpg" alt="image-20200612202220431" style="zoom:50%;" />

<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfps0o2al5j30i407a407.jpg" alt="image-20200612202608173"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfps9p40caj30lk0ca0wk.jpg" alt="image-20200612203448516"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfpsbhalxsj30da04kab2.jpg" alt="image-20200612203632013"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfpsojt083j30gq0baq6i.jpg" alt="image-20200612204903384"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfpskkym5vj30t20duaey.jpg" alt="image-20200612204516486"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfpsla2e9oj30gu02c3z9.jpg" alt="image-20200612204556569"></p>
<h3 id="1070-Merge-Account-★★★"><a href="#1070-Merge-Account-★★★" class="headerlink" title="1070.Merge Account ★★★"></a>1070.Merge Account ★★★</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfptxvu73bj30cq0bwq6x.jpg" alt="image-20200612213238736"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfpucl36woj30dq08a416.jpg" alt="image-20200612214646335"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/06/07/Web/2019-06-07-Requests'%20secret:%20pool_connections%20and%20pool_maxsize/">Web/2019-06-07-Requests' secret: pool_connections and pool_maxsize</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-06-07</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Web/">Web</a></span><div class="content"><p>from: <a href="https://www.cnblogs.com/pengyusong/p/5802929.html" target="_blank" rel="noopener">https://www.cnblogs.com/pengyusong/p/5802929.html</a></p>
<p>and <a href="https://laike9m.com/blog/requests-secret-pool_connections-and-pool_maxsize,89/" target="_blank" rel="noopener">https://laike9m.com/blog/requests-secret-pool_connections-and-pool_maxsize,89/</a></p>
<h1 id="Requests’-secret-pool-connections-and-pool-maxsize"><a href="#Requests’-secret-pool-connections-and-pool-maxsize" class="headerlink" title="Requests’ secret: pool_connections and pool_maxsize"></a><strong>Requests’ secret: pool_connections and pool_maxsize</strong></h1><p><a href="http://docs.python-requests.org/en/latest/" target="_blank" rel="noopener">Requests</a> 是一个python开发者众所周知的第三方库。因其简单的API和高性能，大多数人倾向于使用requests而不是urllib2作为访问http的标准库。然而很多使用requests库的人可能不知道内部原因，今天我就来解释以下俩个概念: <code>pool_connections</code> 和<code>pool_maxsize</code>.</p>
<p>从 <code>Session 开始</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line">s.get(<span class="string">'https://www.google.com'</span>)</span><br></pre></td></tr></table></figure>

<p>这很简单，你可能知道requests’ <code>Session</code> 持有cookie. 但你知道 <code>Session</code> 有一个 <a href="http://docs.python-requests.org/en/latest/api/#requests.Session.mount" target="_blank" rel="noopener"><code>mount</code></a> 方法吗?</p>
<blockquote>
<p><code>mount(prefix, adapter)</code><br>Registers a connection adapter to a prefix.<br>Adapters are sorted in descending order by key length.</p>
</blockquote>
<p>不知道？很好，实际上你已经使用了这个方法当你初始化一个session对象时:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Session</span><span class="params">(SessionRedirectMixin)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        ...</span><br><span class="line">        <span class="comment"># Default connection adapters.</span></span><br><span class="line">        self.adapters = OrderedDict()</span><br><span class="line">        self.mount(<span class="string">'https://'</span>, HTTPAdapter())</span><br><span class="line">        self.mount(<span class="string">'http://'</span>, HTTPAdapter())</span><br></pre></td></tr></table></figure>

<p>现在，到了有趣的部分。如果你阅读过 Ian Cordasco’s 文章 <a href="http://www.coglib.com/~icordasc/blog/2014/12/retries-in-requests.html" target="_blank" rel="noopener">Retries in Requests</a>, 你应该知道 <code>HTTPAdapter</code> 可以提供重试功能. 但一个 <code>HTTPAdapter</code> 真实是什么? Quoted from <a href="http://docs.python-requests.org/en/latest/api/#requests.adapters.HTTPAdapter" target="_blank" rel="noopener">doc</a>:</p>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">requests</span>.<span class="title">adapters</span>.<span class="title">HTTPAdapter</span><span class="params">(pool_connections=<span class="number">10</span>, pool_maxsize=<span class="number">10</span>, max_retries=<span class="number">0</span>, pool_block=False)</span></span></span><br></pre></td></tr></table></figure>

<p>The built-in HTTP Adapter for urllib3.</p>
<p>Provides a general-case interface for Requests sessions to contact HTTP and HTTPS urls by implementing the Transport Adapter interface. This class will usually be created by the Session class under the covers.</p>
<p>Parameters:</p>
<ul>
<li><code>pool_connections</code> – The number of urllib3 connection pools to cache.</li>
<li><code>pool_maxsize</code> – The maximum number of connections to save in the pool.</li>
<li><code>max_retries(int)</code> – The maximum number of retries each connection should attempt. Note, this applies only to failed DNS lookups, socket connections and connection timeouts, never to requests where data has made it to the server. By default, Requests does not retry failed connections. If you need granular control over the conditions under which we retry a request, import urllib3’s Retry class and pass that instead.</li>
<li><code>pool_block</code> – Whether the connection pool should block for connections. Usage:</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; <span class="keyword">import</span> requests</span><br><span class="line">&gt;&gt; s = requests.Session()</span><br><span class="line">&gt;&gt; a = requests.adapters.HTTPAdapter(max_retries=<span class="number">3</span>)</span><br><span class="line">&gt;&gt; s.mount(<span class="string">'http://'</span>, a)</span><br></pre></td></tr></table></figure>
</blockquote>
<p>如果上面的文档使你迷惑，这里是我的解释: HTTP Adapter 所做的就是：根据不同的目标url，对每个不同的请求提供不同的配置，还记得上面的代码吗？</p>
<p>　　　　what HTTP Adapter does is simply <strong>providing different configurations for different requests according to target url</strong>. Remember the code above?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">self.mount(<span class="string">'https://'</span>, HTTPAdapter())</span><br><span class="line">self.mount(<span class="string">'http://'</span>, HTTPAdapter())</span><br></pre></td></tr></table></figure>

<p>它创建了俩个 <code>HTTPAdapter</code> 对象使用默认的参数：<code>pool_connections=10, pool_maxsize=10, max_retries=0, pool_block=False</code>, 并且挂载到 <code>https://</code> 和 <code>http:// 相对路径</code>, 意思是第一个配置在你访问 <code>http://xxx 会使用到， 第二个会在你访问 ``https://xxx</code>. 尽管上面俩个配置是相同的，请求http和https仍然是隔离的。我们会在下面看到说明。</p>
<p>就像我说的，这篇文章的目的主要是解释 <code>pool_connections</code> and <code>pool_maxsize</code>.</p>
<p>首先，让我们看看 <code>pool_connections</code>. 昨天我在stackoverflow提出了一个问题：<a href="http://stackoverflow.com/questions/34837026/whats-the-meaning-of-pool-connections-in-requests-adapters-httpadapter" target="_blank" rel="noopener">question</a> ，因为我不确定我是否理解正确，这个问题的回答消除了我的不确定性。HTTP，众所周知，是基于TCP协议，一个HTTP连接也是一个TCP连接，它是由一个五元组唯一标识:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&lt;protocol&gt;, &lt;src addr&gt;, &lt;src port&gt;, &lt;dest addr&gt;, &lt;dest port&gt;)</span><br></pre></td></tr></table></figure>

<p>就是说，你针对 <code>www.example.com 建立了一个HTTP/TCP连接</code>, 假设服务器支持 <code>Keep-Alive</code>, 下一次你发送请求到 <code>www.example.com/a</code> or <code>www.example.com/b</code>, 你可以使用相同的连接，因为五元组没有改变. 实际上, <a href="http://docs.python-requests.org/en/latest/user/advanced/#keep-alive" target="_blank" rel="noopener">requests’ Session 自动会帮你处理</a> 并且重用连接，只要它能.</p>
<p>这个问题是，什么决定了你是否可以重用老的连接？是的，就是 <code>pool_connections</code>!</p>
<blockquote>
<p>pool_connections – The number of urllib3 connection pools to cache.</p>
</blockquote>
<p>我知道，我知道，我也不想引入很多术语, 这是最后一个，我发誓. 简单的理解它， 一个host对应的一个连接池：<strong>one connection pool corresponds to one host</strong>, 嗯，就是这个意思.</p>
<p>这是一个例子，无关的行已被忽略:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line">s.mount(<span class="string">'https://'</span>, HTTPAdapter(pool_connections=1))</span><br><span class="line">s.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">s.get(<span class="string">'https://www.zhihu.com'</span>)</span><br><span class="line">s.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">""</span><span class="string">"output</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.baidu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 None</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.zhihu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 2621</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.baidu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 None</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br></pre></td></tr></table></figure>

<p><code>HTTPAdapter(pool_connections=1)</code> 被映射到 <code>https://</code>, 他意思是在同一时间仅有一个连接池. 在调用 <code>s.get(&#39;https://www.baidu.com&#39;)</code>, 缓存的连接池是 <code>connectionpool(&#39;https://www.baidu.com&#39;)</code>. 现在 <code>s.get(&#39;https://www.zhihu.com&#39;)</code> 来了，这个session发现他不能使用缓存的连接，因为他不是相同的host(one connection pool corresponds to one host, remember?). 因此session不得不创建一个新的连接池. 因为 <code>pool_connections=1</code>, session不能在同一时间持有俩个连接池, 因此他丢弃了旧的连接池： <code>connectionpool(&#39;https://www.baidu.com&#39;)</code> 并且保存了新的：<code>connectionpool(&#39;https://www.zhihu.com&#39;)</code>. 下一次get同样如此Next <code>get</code> is the same. 这就是我们看见三个 <code>Starting new HTTPS connection</code> 日志行的原因</p>
<p>如果我们设置 <code>pool_connections</code> 为 2:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line">s.mount(<span class="string">'https://'</span>, HTTPAdapter(pool_connections=2))</span><br><span class="line">s.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">s.get(<span class="string">'https://www.zhihu.com'</span>)</span><br><span class="line">s.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line"><span class="string">""</span><span class="string">"output</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.baidu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 None</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.zhihu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 2623</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 None</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br></pre></td></tr></table></figure>

<p>很好，现在我们可以创建连接俩次了并且保持连接活跃</p>
<p>最后, <code>pool_maxsize</code>.</p>
<p>首先, 仅当你在多线程环境下使用session，你才应该关心 <code>pool_maxsize</code> , 例如，从多个线程使用同一个session发出并发请求.</p>
<p>实际上，<code>pool_maxsize</code> 是一个用来初始化urllib3’s <code>HTTPConnectionPool的参数</code>, 它才是真正含义上的连接池. <code>HTTPConnectionPool</code> 是一个容器，针对于特定的host保存连接的集合, 且 <code>pool_maxsize</code> 是这个集合的最大值. 如果你运行你的代码在同一个线程，它是不可能针对多个主机创建多个连接的，因为 requests library 是阻塞的, 因此HTTP请求总是一个接着一个发送.</p>
<p>如果使用多线程就会不一样.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">def thread_get(url):</span><br><span class="line">    s.get(url)</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line">s.mount(<span class="string">'https://'</span>, HTTPAdapter(pool_connections=1, pool_maxsize=2))</span><br><span class="line">t1 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com'</span>,))</span><br><span class="line">t2 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/36612174'</span>,))</span><br><span class="line">t1.start();t2.start()</span><br><span class="line">t1.join();t2.join()</span><br><span class="line">t3 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/39420364'</span>,))</span><br><span class="line">t4 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/21362402'</span>,))</span><br><span class="line">t3.start();t4.start()</span><br><span class="line"><span class="string">""</span><span class="string">"output</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.zhihu.com</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (2): www.zhihu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/36612174 HTTP/1.1<span class="string">" 200 21906</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 2606</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/21362402 HTTP/1.1<span class="string">" 200 57556</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/39420364 HTTP/1.1<span class="string">" 200 28739</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br></pre></td></tr></table></figure>

<p>看见了吗? 它为相同的host建立了俩个连接： <code>www.zhihu.com</code>, 就像我说的, 这个仅发生在多线程环境下. 在这个例子中，我们创建了一个连接池，使用了参数 <code>pool_maxsize=2</code>, 发现同一时间不会超过俩个连接，因此这是足够的，我们看到<code>t3</code> 和 <code>t4</code> 没有创建新的连接，他们重用了就的连接.</p>
<p>如果没有足够的大小呢?</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line">s.mount(<span class="string">'https://'</span>, HTTPAdapter(pool_connections=1, pool_maxsize=1))</span><br><span class="line">t1 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com'</span>,))</span><br><span class="line">t2 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/36612174'</span>,))</span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line">t1.join();t2.join()</span><br><span class="line">t3 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/39420364'</span>,))</span><br><span class="line">t4 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/21362402'</span>,))</span><br><span class="line">t3.start();t4.start()</span><br><span class="line">t3.join();t4.join()</span><br><span class="line"><span class="string">""</span><span class="string">"output</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.zhihu.com</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (2): www.zhihu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/36612174 HTTP/1.1<span class="string">" 200 21906</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 2606</span></span><br><span class="line"><span class="string">WARNING:requests.packages.urllib3.connectionpool:Connection pool is full, discarding connection: www.zhihu.com</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (3): www.zhihu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/39420364 HTTP/1.1<span class="string">" 200 28739</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/21362402 HTTP/1.1<span class="string">" 200 57556</span></span><br><span class="line"><span class="string">WARNING:requests.packages.urllib3.connectionpool:Connection pool is full, discarding connection: www.zhihu.com</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br></pre></td></tr></table></figure>

<p>现在, <code>pool_maxsize=1</code>，会打印警告日志如下，就像下面的:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Connection pool is full, discarding connection: www.zhihu.com</span><br></pre></td></tr></table></figure>

<p>可以注意到仅有一个连接被保存在连接池中, 为t3或者t4创建一个新的连接. 很明显这是不够的. 这就是为什么在 urllib3’s 文档中说明如下:</p>
<blockquote>
<p>如果你计划在连接池环境下使用一个连接池, 你应该设置连接池最大数量为一个比较高的值，例如和线程的数量相同.</p>
</blockquote>
<p>最后, <code>HTTPAdapter</code> 实例映射到不同的前缀是相互独立的.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line">s.mount(<span class="string">'https://'</span>, HTTPAdapter(pool_connections=1, pool_maxsize=2))</span><br><span class="line">s.mount(<span class="string">'https://baidu.com'</span>, HTTPAdapter(pool_connections=1, pool_maxsize=1))</span><br><span class="line">t1 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com'</span>,))</span><br><span class="line">t2 =Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/36612174'</span>,))</span><br><span class="line">t1.start();t2.start()</span><br><span class="line">t1.join();t2.join()</span><br><span class="line">t3 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/39420364'</span>,))</span><br><span class="line">t4 = Thread(target=thread_get, args=(<span class="string">'https://www.zhihu.com/question/21362402'</span>,))</span><br><span class="line">t3.start();t4.start()</span><br><span class="line">t3.join();t4.join()</span><br><span class="line"><span class="string">""</span><span class="string">"output</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): www.zhihu.com</span></span><br><span class="line"><span class="string">INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (2): www.zhihu.com</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/36612174 HTTP/1.1<span class="string">" 200 21906</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET / HTTP/1.1<span class="string">" 200 2623</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/39420364 HTTP/1.1<span class="string">" 200 28739</span></span><br><span class="line"><span class="string">DEBUG:requests.packages.urllib3.connectionpool:"</span>GET /question/21362402 HTTP/1.1<span class="string">" 200 57669</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br></pre></td></tr></table></figure>

<p>上面的代码很容易，不需要再次解释了.</p>
<p>就这样了，希望这篇文章帮助你更好的理解requests库. 顺便说一下，我创建了一个gist <a href="https://gist.github.com/laike9m/ead19c65a416c7022c00" target="_blank" rel="noopener">here</a> 这里包含这篇文章的测试代码. 随便下载并尝试吧</p>
<h2 id="Appendix"><a href="#Appendix" class="headerlink" title="Appendix"></a>Appendix</h2><ol>
<li><p>For https, requests uses urllib3’s <a href="http://urllib3.readthedocs.org/en/latest/pools.html#urllib3.connectionpool.HTTPSConnectionPool" target="_blank" rel="noopener">HTTPSConnectionPool</a>, but it’s pretty much the same as HTTPConnectionPool so I didn’t differeniate them in this article.</p>
</li>
<li><p><code>Session</code>‘s <code>mount</code> method ensures the longest prefix gets matched first. Its implementation is pretty interesting so I posted it here.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mount</span><span class="params">(self, prefix, adapter)</span>:</span></span><br><span class="line">    <span class="string">"""Registers a connection adapter to a prefix.</span></span><br><span class="line"><span class="string">    Adapters are sorted in descending order by key length."""</span></span><br><span class="line">    self.adapters[prefix] = adapter</span><br><span class="line">    keys_to_move = [k <span class="keyword">for</span> k <span class="keyword">in</span> self.adapters <span class="keyword">if</span> len(k) &lt; len(prefix)]</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> keys_to_move:</span><br><span class="line">        self.adapters[key] = self.adapters.pop(key)</span><br></pre></td></tr></table></figure>

<p>Note that <code>self.adapters</code> is an <code>OrderedDict</code>.</p>
</li>
</ol>
</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/59/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/59/">59</a><span class="page-number current">60</span><a class="page-number" href="/page/61/">61</a><span class="space">&hellip;</span><a class="page-number" href="/page/77/">77</a><a class="extend next" rel="next" href="/page/61/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2023 By Joe Huang</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>