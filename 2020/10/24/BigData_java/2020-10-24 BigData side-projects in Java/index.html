<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="BigData_java/2020-10-24 BigData side-projects in Java"><meta name="keywords" content=""><meta name="author" content="Joe Huang"><meta name="copyright" content="Joe Huang"><title>BigData_java/2020-10-24 BigData side-projects in Java | Awaken Desparado</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-180692466-1', 'auto');
ga('send', 'pageview');</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Kafka"><span class="toc-number">1.</span> <span class="toc-text">Kafka</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Demo-創建一個-Topic"><span class="toc-number">1.1.</span> <span class="toc-text">Demo: 創建一個 Topic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Back-door-我可優化的"><span class="toc-number">1.2.</span> <span class="toc-text">Back-door 我可優化的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#On-IntelliJ"><span class="toc-number">1.3.</span> <span class="toc-text">On IntelliJ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Maven"><span class="toc-number">1.3.1.</span> <span class="toc-text">Maven</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Producer-Keyhash"><span class="toc-number">1.3.2.</span> <span class="toc-text">Producer Keyhash</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Producer-onCompletion"><span class="toc-number">1.3.3.</span> <span class="toc-text">Producer onCompletion</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Consumer"><span class="toc-number">1.3.4.</span> <span class="toc-text">Consumer</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kafka-再論"><span class="toc-number">1.4.</span> <span class="toc-text">Kafka 再論</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AWS"><span class="toc-number"></span> <span class="toc-text">AWS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Charging"><span class="toc-number">1.</span> <span class="toc-text">Charging</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AWS-Create-Kafka-Producer"><span class="toc-number">2.</span> <span class="toc-text">AWS, Create Kafka Producer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Amazon-MSK"><span class="toc-number">2.1.</span> <span class="toc-text">Amazon MSK</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Config"><span class="toc-number">2.1.1.</span> <span class="toc-text">Config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Network"><span class="toc-number">2.1.2.</span> <span class="toc-text">Network</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Brokers"><span class="toc-number">2.1.3.</span> <span class="toc-text">Brokers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tag"><span class="toc-number">2.1.4.</span> <span class="toc-text">Tag</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Storage"><span class="toc-number">2.1.5.</span> <span class="toc-text">Storage</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Encryption"><span class="toc-number">2.1.6.</span> <span class="toc-text">Encryption</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Encrypt-data-at-rest"><span class="toc-number">2.1.7.</span> <span class="toc-text">Encrypt data at rest</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Authentication"><span class="toc-number">2.1.8.</span> <span class="toc-text">Authentication</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Monitoring"><span class="toc-number">2.1.9.</span> <span class="toc-text">Monitoring</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#CloudWatch"><span class="toc-number">2.1.9.1.</span> <span class="toc-text">CloudWatch</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Broker-log-delivery"><span class="toc-number">2.1.9.2.</span> <span class="toc-text">Broker log delivery</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Log-Group"><span class="toc-number">2.1.9.3.</span> <span class="toc-text">Log Group</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#CloudWatch-Log"><span class="toc-number">2.1.9.3.1.</span> <span class="toc-text">CloudWatch Log</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Create-cluster"><span class="toc-number">2.1.10.</span> <span class="toc-text">Create cluster!</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AWS-建EC2-還缺新的機器做P-amp-C-So-create-another-client"><span class="toc-number">3.</span> <span class="toc-text">AWS - 建EC2, 還缺新的機器做P &amp; C, So, create another client</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EC2-Service"><span class="toc-number">3.1.</span> <span class="toc-text">EC2 Service</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Access-遠程的EC2機器"><span class="toc-number">3.1.1.</span> <span class="toc-text">Access 遠程的EC2機器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#bin-sh-都是好練習"><span class="toc-number">3.1.1.1.</span> <span class="toc-text">bin&#x2F;*.sh, 都是好練習</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MSK-Go"><span class="toc-number">4.</span> <span class="toc-text">MSK, Go!</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#EC2-connects-to-MSK"><span class="toc-number">4.0.1.</span> <span class="toc-text">EC2 connects to MSK</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#TIMEOUT-ISSUE"><span class="toc-number">4.0.1.0.1.</span> <span class="toc-text">TIMEOUT ISSUE</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Producer-Send-msg-amp-Consumer-Read-msg"><span class="toc-number">5.</span> <span class="toc-text">Producer Send msg &amp; Consumer Read msg</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Check-Metrics-amp-Close-machines"><span class="toc-number">6.</span> <span class="toc-text">Check Metrics &amp; Close machines</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CloudWatch-1"><span class="toc-number">6.0.1.</span> <span class="toc-text">CloudWatch</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Mine"><span class="toc-number">6.0.1.1.</span> <span class="toc-text">Mine:</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#kafka-–-can-only-be-deleted-and-then-reconfigured-next-time"><span class="toc-number">6.0.1.1.1.</span> <span class="toc-text">kafka – can only be deleted, and then reconfigured next time</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Qs"><span class="toc-number">7.</span> <span class="toc-text">Qs</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Joe Huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">362</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">25</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">60</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Awaken Desparado</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">BigData_java/2020-10-24 BigData side-projects in Java</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-10-24</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/BigData-java/">BigData_java</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h2><p><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk04dmxpk5j3102032di4.jpg" alt="image-20201024083045739" style="zoom:50%;" /><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk04idtk1hj30zw0480vt.jpg" alt="image-20201024083519950"></p>
<img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk04j5lnuhj30zg0b8k1x.jpg" alt="image-20201024083605168" style="zoom:50%;" />



<img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk04jvx04vj30zm04wte3.jpg" alt="image-20201024083647240" style="zoom:50%;" />



<h3 id="Demo-創建一個-Topic"><a href="#Demo-創建一個-Topic" class="headerlink" title="Demo: 創建一個 Topic"></a>Demo: 創建一個 Topic</h3><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h38a1rd9iij20vm05emyc.jpg" alt="image-20201024085524024" style="zoom: 50%;" />

<ul>
<li>未發送 key，按默認的 round-robin</li>
<li>Offset 就是個 id，跟 訊息長短沒關</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk056hkxnkj30vu03gacf.jpg" alt="image-20201024085829960" style="zoom:50%;" />



<h3 id="Back-door-我可優化的"><a href="#Back-door-我可優化的" class="headerlink" title="Back-door 我可優化的"></a>Back-door 我可優化的</h3><p>Kafka 其中一台掛了怎辦？備份</p>
<ul>
<li>兩個放在同個機房(rack) –&gt; latency不會過大</li>
<li>另一個在不同城市，我要replicate的時候比較慢，但ok</li>
<li>所以在latency、reliability找了平衡</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk05k9xsnfj30vi0f8wpp.jpg" alt="image-20201024091144456" style="zoom:67%;" />



<ul>
<li>TERMs: ack、latency、Throughput</li>
</ul>
<h3 id="On-IntelliJ"><a href="#On-IntelliJ" class="headerlink" title="On IntelliJ"></a>On IntelliJ</h3><ul>
<li>Zookeeper要先在背后起来</li>
<li>機器之間一定是通過network，network時就只能序列化變一個個地byte，<ul>
<li>int serializer</li>
<li>string serializer.  –&gt; 大多數情況都是這傢伙</li>
</ul>
</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk0735ftpqj30xs06c79h.jpg" alt="image-20201024100429381" style="zoom:50%;" />

<ul>
<li>producer.flush() – 會幫把數據直接沖到kafka queue裡去<ul>
<li>存在問題! </li>
<li>只是個blocking call，但不是同步</li>
<li>就跟你这个info绑定了，要是你没跟我说你成功，我就会有个线程，一是在盯你，我一直浪费</li>
</ul>
</li>
<li>Producer.send(recordNoKey) 一定是 Async的</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h38a1unxh2j219e0esjuf.jpg" alt="image-20201024101109235" style="zoom:50%;" />

<ul>
<li>Producer 自己就是個 client之一</li>
<li>三次握手也不需我們實現不然太蝦</li>
</ul>
<ul>
<li>那个是partition id，不是replica 的id</li>
</ul>
<h4 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h4><p>軟體管理工具 – FB、Uber都有用</p>
<p>項目管理工具</p>
<h4 id="Producer-Keyhash"><a href="#Producer-Keyhash" class="headerlink" title="Producer Keyhash"></a>Producer Keyhash</h4><ul>
<li>key如果被detect到是有東西，就會有hash去hash 去決定把這個partition發送到哪個 broker上面去；否則就是 round-robin</li>
</ul>
<h4 id="Producer-onCompletion"><a href="#Producer-onCompletion" class="headerlink" title="Producer onCompletion"></a>Producer onCompletion</h4><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h38a1yw56xj20zs0l840w.jpg" alt="image-20201025230649208" style="zoom: 67%;" />

<ul>
<li>production 不要用! 會變單線程<ul>
<li>難道因為一個人的login失敗了，我就要stop整個producer嗎？</li>
<li>我要做的事應該是producer不傻</li>
</ul>
</li>
<li>一般是async時也過陣子來查看</li>
<li>一般在prod不需要知道發去了哪裡，在roundrobin裡不需要知道<ul>
<li>如果想知道話，也不是好奇；而是假設consumer的處理性特殊 – groupby key – 要是roundrobin就會分到10台機器，現在的shuffle洗牌才能把它們放到一台機器上去；要是很常，我的處理就意味不高效! 為了高效，我就會不再roundrobin，而是hashbykey!<ul>
<li>所有的bigdata key 都在一台機器上，就不再要洗牌，雖然是全局的groupby；一旦沒有全局的groupby，我就很快</li>
<li>即然我指定了我的key，我就可以很有信心知道這條要去哪台機器，因為kafka會去handle</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Consumer"><a href="#Consumer" class="headerlink" title="Consumer"></a>Consumer</h4><ul>
<li>比 producer 的設置裡多了一個 GroupID</li>
</ul>
<h3 id="Kafka-再論"><a href="#Kafka-再論" class="headerlink" title="Kafka 再論"></a>Kafka 再論</h3><ul>
<li><p>Kafka 啟動時會設定這個cluster要幾台機器組成</p>
</li>
<li><p>Kafka 是個 Pull 模型，因為</p>
<ul>
<li><p>Scalibility : 它是個很好的decouple的作用，把 producer、consumer很好地分開了；各自壞了不會影響到對方。</p>
<ul>
<li>如果這個Topic很多下游在訂閱，kafka要是push的話，它會忙死，而且下游搞不好還沒要你這更新</li>
<li>它忙壞了，根本無法 scale-up</li>
</ul>
</li>
<li><p>Diversity : – LEVERAGE &amp; STALIBILITY</p>
<ul>
<li><p>每個consumer都有自己的配置、自己的處理方式和節奏，kafka應該把處理信息的能動性(Leverage) 給 consumer。</p>
</li>
<li><p>要是這個組比較窮，或他們的priority低，他們處理數據不來，而且也沒budget；或許可以48hr再生一個結果就好。</p>
<p>consumer可更穩定 (STALIBILITY)</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>每次我的好友建tweet時，該pull or push？</p>
</li>
<li><p>consumer 跟 partition有綁定的關係！只會給一個consumer去讀</p>
<ul>
<li>consumer去監聽partition</li>
<li>平行就一定會有race condition<ol>
<li>第 0 條該誰去讀？consumer0還是consumer4?</li>
<li>假設真的通過層層複雜的設計，各自讀一條<ul>
<li>我讀完時我要是早處理完時？</li>
<li>我讀0時你讀1，你又不去commit，一方面在race了，一台機器上是idempotency，跨機器時呢？consumer不知道1號partition有沒有被讀成，怎辦？那consumer0跟consumer4還要有一個交流的體系</li>
<li>交替讀的時候還是會出現問題</li>
</ul>
</li>
</ol>
</li>
<li>所以沒必要多台consumer監聽一個partion的必要</li>
<li>系統裡不是最快就是最好的，當數據小時沒差。要是平行時的overhead大時，開一台就ok啦</li>
</ul>
</li>
<li><p>中轉，一週後刪了；它的作用就不是保持數據的，才能scalible<br>往上強堆機器又要花錢!</p>
</li>
<li><p>問題就是: 工程師寫consumer會處理錯</p>
</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk1yqkmwomj30rq0agwks.jpg" alt="image-20201025224640508" style="zoom: 67%;" />



<h1 id="AWS"><a href="#AWS" class="headerlink" title="AWS"></a>AWS</h1><h2 id="Charging"><a href="#Charging" class="headerlink" title="Charging"></a>Charging</h2><p>MSK: <a href="https://aws.amazon.com/msk/pricing/" target="_blank" rel="noopener">https://aws.amazon.com/msk/pricing/</a><br> EC2: <a href="https://aws.amazon.com/ec2/pricing/on-demand/" target="_blank" rel="noopener">https://aws.amazon.com/ec2/pricing/on-demand/</a></p>
<h2 id="AWS-Create-Kafka-Producer"><a href="#AWS-Create-Kafka-Producer" class="headerlink" title="AWS, Create Kafka Producer"></a>AWS, Create Kafka Producer</h2><h3 id="Amazon-MSK"><a href="#Amazon-MSK" class="headerlink" title="Amazon MSK"></a>Amazon MSK</h3><p>service - MSK</p>
<ul>
<li>2.2.1 (recommended)</li>
</ul>
<h4 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h4><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h38a21llf0j20mw0p6n0d.jpg" alt="image-20201030211156060" style="zoom: 33%;" />

<h4 id="Network"><a href="#Network" class="headerlink" title="Network"></a>Network</h4><ul>
<li>被建在網路集群中</li>
<li>VPC – vertual private cloud 虛擬的網路環境<ol>
<li>一個具有安全性的網路集群，跟外界隔離<ul>
<li>如果通過amazon別的service或我自己的電腦要去訪問其中的節點是做不到的，因為不屬於 security network的。</li>
</ul>
</li>
<li>cluster裡的所有機器之間可以進行「安全」的相互通信，是有保證的</li>
</ol>
</li>
</ul>
<ol start="3">
<li><p>VPC 會有個默認的</p>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h38a23uydbj20bq04l0st.jpg" alt="image-20210303154906134" style="zoom: 50%;" /></li>
</ol>
<ul>
<li><p>Number of Availability Zones</p>
<ul>
<li>Seattle, Australia, … </li>
<li>假設我的機器集群活躍在兩個地方，SF斷電了，Seattle還可以提供服務</li>
<li>其實<strong>２</strong>就很夠了，AWS不會掛的啦。。人家大公司</li>
</ul>
</li>
<li><p>Zones &amp; Subnet</p>
<ul>
<li><p>就直接選吧</p>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h38a25s6ydj20l90iaq40.jpg" alt="image-20210303155659042" style="zoom:50%;" />



</li>
</ul>
</li>
</ul>
<h4 id="Brokers"><a href="#Brokers" class="headerlink" title="Brokers"></a>Brokers</h4><ul>
<li><p>對於 kafka一定是要多台機器來組成多線程的一個機器群體，所以在當前的kafa cluster裡，一定有多台機器。每台都被稱作broker，多台在一起就是brokers。</p>
</li>
<li><p>我在cluster裡，這個instance要有多大？如果預測每台都比較累，就是選大的</p>
</li>
<li><p>kafka.t3.small，ok了，可做小實驗</p>
<img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk7oycisrej30vo09agmw.jpg" alt="image-20201030214136615" style="zoom:50%;" />
</li>
<li><p>共四台目前在兩個不同的區域上</p>
</li>
</ul>
<h4 id="Tag"><a href="#Tag" class="headerlink" title="Tag"></a>Tag</h4><p>好區分名而已</p>
<h4 id="Storage"><a href="#Storage" class="headerlink" title="Storage"></a>Storage</h4><ul>
<li>1000GB 很很夠了</li>
</ul>
<h4 id="Encryption"><a href="#Encryption" class="headerlink" title="Encryption"></a>Encryption</h4><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h38a291fvrj20ny06edgg.jpg" alt="image-20201030214316835" style="zoom:50%;" />

<ul>
<li>這次懶得加密也OK啦. 所以選擇了Both</li>
</ul>
<h4 id="Encrypt-data-at-rest"><a href="#Encrypt-data-at-rest" class="headerlink" title="Encrypt data at rest"></a>Encrypt data at rest</h4><p><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk7p0wno8zj313a09k40f.jpg" alt="image-20201030214403963"></p>
<h4 id="Authentication"><a href="#Authentication" class="headerlink" title="Authentication"></a>Authentication</h4><p>暫時還不需要</p>
<h4 id="Monitoring"><a href="#Monitoring" class="headerlink" title="Monitoring"></a>Monitoring</h4><h5 id="CloudWatch"><a href="#CloudWatch" class="headerlink" title="CloudWatch"></a>CloudWatch</h5><ul>
<li><p>監測系統</p>
</li>
<li><p>會把當前在Amazon雲上所run的每一個服務，幫單獨地拽出來，幫分析</p>
<ul>
<li><p>traffic</p>
</li>
<li><p>throughput</p>
</li>
<li><p>input/outputs</p>
</li>
<li><p>弄成一張很美美的圖表，知做了什麼事，在哪些時間做了事</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>Basic Monitoring</p>
</li>
<li><p>Broker 可能有多個 Topic, 各自的Topic有它們自己的partition</p>
<ul>
<li>可知道每個Topic都 go through了什麼數據</li>
</ul>
</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h38a2bffr1j20r60aedh6.jpg" alt="image-20201030214910491" style="zoom:50%;" />





<h5 id="Broker-log-delivery"><a href="#Broker-log-delivery" class="headerlink" title="Broker log delivery"></a>Broker log delivery</h5><ul>
<li><p>當我們在run服務時，每個操作都會發個log給我；如發送數據了、發送成功了、consumer去讀了、consumer讀成功了，它話超多的！如果我一天發幾百萬條，一定是存log不能全念給我聽。透過log來分析的，找「10分鐘前發來，我在９分鐘前就該收到，但到了現在都還沒有收到」，這時候，我需要去找log才能分析，需要地方存我的 log</p>
<ol>
<li><p>CloudWatch</p>
<ul>
<li><p>有自己的 log group</p>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk7p99b9w0j31co0oan2e.jpg" alt="image-20201030215205786"></p>
</li>
<li><p>好處就是當我的這些log我可以直接搜索，類似grep！</p>
</li>
</ul>
<h5 id="Log-Group"><a href="#Log-Group" class="headerlink" title="Log Group"></a>Log Group</h5><ul>
<li>足夠強了，一般而言, 我可以去蒐當時的這個log<br><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk7pfwi9gsj313o0e8dm5.jpg" alt="image-20201030215829133"></li>
</ul>
</li>
<li><p>S3 -文件系統</p>
<ul>
<li>大批量</li>
<li>好處是S3大，可以dump去離線如本地的大批量處理，去做bulk分析</li>
</ul>
</li>
<li><p>Data Firehouse</p>
<ul>
<li>可以對數據轉化，最後再發去 elasticsearch, 讓我作更細化的分析</li>
<li>太 overkill</li>
</ul>
</li>
</ol>
<img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk7pi4vbcvj312k0lo3zz.jpg" alt="image-20201030220038315" style="zoom:33%;" />

</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk7pihdpfhj315k0h475n.jpg" alt="image-20201030220058590" style="zoom:33%;" />

<ul>
<li>data warehouse - 每天數據進來了，如用戶的post進來了，觸發API到FB去。只是個concept都收進到寫到<strong>HDFS</strong>，有些已有結構化了，如手機上的SDK已定義好了schema (這已經比較像 Data Lake了)、<strong>hive</strong> table</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk7pk4nilvj31j60lktc7.jpg" alt="image-20201030220232929" style="zoom: 50%;" />



<h6 id="CloudWatch-Log"><a href="#CloudWatch-Log" class="headerlink" title="CloudWatch Log"></a>CloudWatch Log</h6><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h38a2dw2vpj20oh0nnacn.jpg" alt="image-20210303165153271" style="zoom:50%;" />



<h4 id="Create-cluster"><a href="#Create-cluster" class="headerlink" title="Create cluster!"></a>Create cluster!</h4><h2 id="AWS-建EC2-還缺新的機器做P-amp-C-So-create-another-client"><a href="#AWS-建EC2-還缺新的機器做P-amp-C-So-create-another-client" class="headerlink" title="AWS - 建EC2, 還缺新的機器做P &amp; C, So, create another client"></a>AWS - 建EC2, 還缺新的機器做P &amp; C, So, create another client</h2><ul>
<li>還缺 producer, consumer去做事！需要創建他們！</li>
</ul>
<h3 id="EC2-Service"><a href="#EC2-Service" class="headerlink" title="EC2 Service"></a>EC2 Service</h3><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h38a2gmm8oj210n0u0793.jpg" alt="image-20201030220808970" style="zoom:50%;" />    



<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h38a2jdvjnj20zc0ct76r.jpg" alt="image-20210303172849633" style="zoom:50%;" />



<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h38a2lrp50j21g40tktdp.jpg" alt="image-20201030221432582" style="zoom: 67%;" />





<h4 id="Access-遠程的EC2機器"><a href="#Access-遠程的EC2機器" class="headerlink" title="Access 遠程的EC2機器"></a>Access 遠程的EC2機器</h4><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1go6ukkgr91j20wf0u04qp.jpg" alt="image-20201030222232631" style="zoom:50%;" />

<ul>
<li>通信，得要去找kafka的代理產生的，kafka的client就是這個代理<ul>
<li>要下載 kafka client代理的包</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-16-188 ~]$ curl https://downloads.apache.org/kafka/2.3.1/kafka_2.12-2.3.1.tgz -o kafka.tgz</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100 59.4M  100 59.4M    0     0  11.0M      0  0:00:05  0:00:05 --:--:-- 12.6M</span><br><span class="line">[ec2-user@ip-172-31-16-188 ~]$ targ -xvzf kafka.tgz</span><br><span class="line">-bash: targ: <span class="built_in">command</span> not found</span><br><span class="line">[ec2-user@ip-172-31-16-188 ~]$ tar -xvzf kafka.tgz</span><br></pre></td></tr></table></figure>

<h5 id="bin-sh-都是好練習"><a href="#bin-sh-都是好練習" class="headerlink" title="bin/*.sh, 都是好練習"></a>bin/*.sh, 都是好練習</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-16-188 bin]$ <span class="built_in">pwd</span></span><br><span class="line">/home/ec2-user/kafka_2.12-2.3.1/bin</span><br><span class="line">[ec2-user@ip-172-31-16-188 bin]$ ls</span><br><span class="line">connect-distributed.sh               kafka-reassign-partitions.sh</span><br><span class="line">connect-standalone.sh                kafka-replica-verification.sh</span><br><span class="line">kafka-acls.sh                        kafka-run-class.sh</span><br><span class="line">kafka-broker-api-versions.sh         kafka-server-start.sh</span><br><span class="line">kafka-configs.sh                     kafka-server-stop.sh</span><br><span class="line">kafka-console-consumer.sh            kafka-streams-application-reset.sh</span><br><span class="line">kafka-console-producer.sh            kafka-topics.sh</span><br><span class="line">kafka-consumer-groups.sh             kafka-verifiable-consumer.sh</span><br><span class="line">kafka-consumer-perf-test.sh          kafka-verifiable-producer.sh</span><br><span class="line">kafka-delegation-tokens.sh           trogdor.sh</span><br><span class="line">kafka-delete-records.sh              windows</span><br><span class="line">kafka-dump-log.sh                    zookeeper-security-migration.sh</span><br><span class="line">kafka-log-dirs.sh                    zookeeper-server-start.sh</span><br><span class="line">kafka-mirror-maker.sh                zookeeper-server-stop.sh</span><br><span class="line">kafka-preferred-replica-election.sh  zookeeper-shell.sh</span><br><span class="line">kafka-producer-perf-test.sh</span><br></pre></td></tr></table></figure>

<ul>
<li>要記得下載dependency</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-16-188 bin]$ sudo yum install java</span><br></pre></td></tr></table></figure>





<h2 id="MSK-Go"><a href="#MSK-Go" class="headerlink" title="MSK, Go!"></a>MSK, Go!</h2><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h38a2rmlolj21fg0tgtd4.jpg" alt="image-20201030223315509" style="zoom:50%;" />

<h4 id="EC2-connects-to-MSK"><a href="#EC2-connects-to-MSK" class="headerlink" title="EC2 connects to MSK"></a>EC2 connects to MSK</h4><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h38a2v6y0mj20u00u278k.jpg" alt="image-20201030223418415" style="zoom:50%;" />

<ul>
<li><p>當前這麼多kafka機器的地址、端口分別是多少，有四個ip address</p>
</li>
<li><p>我任選一個</p>
</li>
<li><p>先簡單跟Kafka cluster talk一下，問他當前機器有幾個topic呢？</p>
<h6 id="TIMEOUT-ISSUE"><a href="#TIMEOUT-ISSUE" class="headerlink" title="TIMEOUT ISSUE"></a>TIMEOUT ISSUE</h6><ul>
<li><p>為何超超超慢，卡了？</p>
<ul>
<li><p>不是Kafka cluster有問題，也不是client 機器有問題</p>
</li>
<li><p>問題在哪？</p>
<ul>
<li>vpc 內可以自由通信，但地外的沒資格進行對話！– 在創建 MSK時的事！MSK裡的VPC可以幫完成當前的集群四台機器無阻的要求。</li>
<li>後來的EC2，是地外的機器，是沒資格作交流的！so, timeout</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-16-188 bin]$ ./kafka-topics.sh --bootstrap-server b-3.testkafka.dt6pwu.c2.kafka.us-east-2.amazonaws.com:9092 --list</span><br><span class="line">Error <span class="keyword">while</span> executing topic <span class="built_in">command</span> : org.apache.kafka.common.errors.TimeoutException: Timed out waiting <span class="keyword">for</span> a node assignment.</span><br><span class="line">[2020-10-30 14:42:15,234] ERROR java.util.concurrent.ExecutionException: org.apache.kafka.common.errors.TimeoutException: Timed out waiting <span class="keyword">for</span> a node assignment.</span><br><span class="line">	at org.apache.kafka.common.internals.KafkaFutureImpl.wrapAndThrow(KafkaFutureImpl.java:45)</span><br><span class="line">	at org.apache.kafka.common.internals.KafkaFutureImpl.access<span class="variable">$000</span>(KafkaFutureImpl.java:32)</span><br><span class="line">	at org.apache.kafka.common.internals.KafkaFutureImpl<span class="variable">$SingleWaiter</span>.await(KafkaFutureImpl.java:89)</span><br><span class="line">	at org.apache.kafka.common.internals.KafkaFutureImpl.get(KafkaFutureImpl.java:260)</span><br><span class="line">	at kafka.admin.TopicCommand<span class="variable">$AdminClientTopicService</span>.getTopics(TopicCommand.scala:272)</span><br><span class="line">	at kafka.admin.TopicCommand<span class="variable">$AdminClientTopicService</span>.listTopics(TopicCommand.scala:197)</span><br><span class="line">	at kafka.admin.TopicCommand$.main(TopicCommand.scala:64)</span><br><span class="line">	at kafka.admin.TopicCommand.main(TopicCommand.scala)</span><br><span class="line">Caused by: org.apache.kafka.common.errors.TimeoutException: Timed out waiting <span class="keyword">for</span> a node assignment.</span><br><span class="line"> (kafka.admin.TopicCommand$)</span><br></pre></td></tr></table></figure>
</li>
<li><p>也要允許 EC2 過來！加額外的 permission</p>
</li>
</ul>
</li>
<li><p>改變 kafka 的 default Security Group 所允許的網路的traffic!<br><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk7qu5kgboj31la0gsjuy.jpg" alt="image-20201030224646396"></p>
<ul>
<li><strong>加到 inbound, 這樣EC2的request 才能夠進去到 MSK</strong></li>
<li>outbound: 我想出去</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk7qyreomij317g0u0jw3.jpg" alt="image-20201030225110743" style="zoom:67%;" />





</li>
</ul>
</li>
</ul>
<ul>
<li><p>重 run 剛剛的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-16-188 bin]$ ./kafka-topics.sh --bootstrap-server b-3.testkafka.dt6pwu.c2.kafka.us-east-2.amazonaws.com:9092 --list</span><br><span class="line"></span><br><span class="line">[ec2-user@ip-172-31-16-188 bin]$</span><br></pre></td></tr></table></figure>

<ul>
<li>連結上了！！！</li>
</ul>
</li>
</ul>
<ul>
<li><p>創建 Topic!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-16-188 bin]$ ./kafka-topics.sh --bootstrap-server b-3.testkafka.dt6pwu.c2.kafka.us-east-2.amazonaws.com:9092 --create --topic <span class="built_in">test</span>-kafka --partition 4 --replication-factor 2</span><br><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> joptsimple.UnrecognizedOptionException: partition is not a recognized option</span><br><span class="line">	at joptsimple.OptionException.unrecognizedOption(OptionException.java:108)</span><br><span class="line">	at joptsimple.OptionParser.handleLongOptionToken(OptionParser.java:510)</span><br><span class="line">	at joptsimple.OptionParserState<span class="variable">$2</span>.handleArgument(OptionParserState.java:56)</span><br><span class="line">	at joptsimple.OptionParser.parse(OptionParser.java:396)</span><br><span class="line">	at kafka.admin.TopicCommand<span class="variable">$TopicCommandOptions</span>.&lt;init&gt;(TopicCommand.scala:578)</span><br><span class="line">	at kafka.admin.TopicCommand$.main(TopicCommand.scala:49)</span><br><span class="line">	at kafka.admin.TopicCommand.main(TopicCommand.scala)</span><br><span class="line">[ec2-user@ip-172-31-16-188 bin]$ ./kafka-topics.sh --bootstrap-server b-3.testkafka.dt6pwu.c2.kafka.us-east-2.amazonaws.com:9092 --create --topic <span class="built_in">test</span>-kafka --partitions 4 --replication-factor 2</span><br><span class="line">[ec2-user@ip-172-31-16-188 bin]$ ./kafka-topics.sh --bootstrap-server b-3.testkafka.dt6pwu.c2.kafka.us-east-2.amazonaws.com:9092 --list</span><br><span class="line"><span class="built_in">test</span>-kafka</span><br><span class="line">[ec2-user@ip-172-31-16-188 bin]$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-----</span><br><span class="line">[ec2-user@ip-172-31-37-109 bin]$ ./kafka-topics.sh --bootstrap-server b-1.bigdata-msk-0305.e95lct.c3.kafka.us-east-2.amazonaws.com:9092 --list</span><br><span class="line">__amazon_msk_canary</span><br><span class="line">__consumer_offsets</span><br><span class="line">[ec2-user@ip-172-31-37-109 bin]$ ./kafka-topics.sh --bootstrap-server b-1.bigdata-msk-0305.e95lct.c3.kafka.us-east-2.amazonaws.com:9092 --create --topic <span class="built_in">test</span>-kafka-0305 --partitions 4 --replication-factor 2</span><br><span class="line">[ec2-user@ip-172-31-37-109 bin]$ ./kafka-topics.sh --bootstrap-server b-1.bigdata-msk-0305.e95lct.c3.kafka.us-east-2.amazonaws.com:9092 --list</span><br><span class="line">__amazon_msk_canary</span><br><span class="line">__consumer_offsets</span><br><span class="line"><span class="built_in">test</span>-kafka-0305</span><br></pre></td></tr></table></figure>

<p>​    </p>
</li>
</ul>
<h2 id="Producer-Send-msg-amp-Consumer-Read-msg"><a href="#Producer-Send-msg-amp-Consumer-Read-msg" class="headerlink" title="Producer Send msg &amp; Consumer Read msg"></a>Producer Send msg &amp; Consumer Read msg</h2><p>如何來模擬 producer &amp; consumer</p>
<ul>
<li>先基於腳本作操作就 OK</li>
<li>–producer-props 指的是 producer的 properties 最重要的就是我得告诉他我要發送data的cluster它的IP或地址，它得知道bootstrap.servers地址、選ack機制</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-16-188 bin]$ ./kafka-producer-perf-test.sh --topic <span class="built_in">test</span>-kafka --num-records 10 --throughput 10 --producer-props bootstrap.servers=b-3.testkafka.dt6pwu.c2.kafka.us-east-2.amazonaws.com:9092 acks=all --record-size 128</span><br><span class="line">10 records sent, 10.741139 records/sec (0.00 MB/sec), 163.70 ms avg latency, 483.00 ms max latency, 181 ms 50th, 483 ms 95th, 483 ms 99th, 483 ms 99.9th.</span><br><span class="line">[ec2-user@ip-172-31-16-188 bin]$ ./kafka-consumer-perf-test.sh --broker-list b-3.testkafka.dt6pwu.c2.kafka.us-east-2.amazonaws.com:9092 --messages 10 --<span class="built_in">print</span>-metrics --show-detailed-stats --topic <span class="built_in">test</span>-kafka</span><br><span class="line">time, threadId, data.consumed.in.MB, MB.sec, data.consumed.in.nMsg, nMsg.sec, rebalance.time.ms, fetch.time.ms, fetch.MB.sec, fetch.nMsg.sec</span><br><span class="line"></span><br><span class="line">Metric Name                                                                                             Value</span><br><span class="line">consumer-coordinator-metrics:assigned-partitions:&#123;client-id=consumer-1&#125;                               : 4.000</span><br><span class="line">consumer-coordinator-metrics:commit-latency-avg:&#123;client-id=consumer-1&#125;                                : 31.000</span><br><span class="line">consumer-coordinator-metrics:commit-latency-max:&#123;client-id=consumer-1&#125;                                : 31.000</span><br><span class="line">consumer-coordinator-metrics:commit-rate:&#123;client-id=consumer-1&#125;                                       : 0.033</span><br><span class="line">consumer-coordinator-metrics:commit-total:&#123;client-id=consumer-1&#125;                                      : 1.000</span><br><span class="line">consumer-coordinator-metrics:heartbeat-rate:&#123;client-id=consumer-1&#125;                                    : 0.000</span><br><span class="line">consumer-coordinator-metrics:heartbeat-response-time-max:&#123;client-id=consumer-1&#125;                       : NaN</span><br><span class="line">consumer-coordinator-metrics:heartbeat-total:&#123;client-id=consumer-1&#125;                                   : 0.000</span><br><span class="line">consumer-coordinator-metrics:join-rate:&#123;client-id=consumer-1&#125;                                         : 0.033</span><br><span class="line">consumer-coordinator-metrics:join-time-avg:&#123;client-id=consumer-1&#125;                                     : 3034.000</span><br><span class="line">consumer-coordinator-metrics:join-time-max:&#123;client-id=consumer-1&#125;                                     : 3034.000</span><br><span class="line">consumer-coordinator-metrics:join-total:&#123;client-id=consumer-1&#125;                                        : 1.000</span><br><span class="line">consumer-coordinator-metrics:last-heartbeat-seconds-ago:&#123;client-id=consumer-1&#125;                        : 1604070397.000</span><br><span class="line">consumer-coordinator-metrics:sync-rate:&#123;client-id=consumer-1&#125;                                         : 0.033</span><br><span class="line">consumer-coordinator-metrics:sync-time-avg:&#123;client-id=consumer-1&#125;                                     : 57.000</span><br><span class="line">consumer-coordinator-metrics:sync-time-max:&#123;client-id=consumer-1&#125;                                     : 57.000</span><br><span class="line">consumer-coordinator-metrics:sync-total:&#123;client-id=consumer-1&#125;                                        : 1.000</span><br><span class="line">consumer-fetch-manager-metrics:bytes-consumed-rate:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka&#125;           : 45.415</span><br><span class="line">consumer-fetch-manager-metrics:bytes-consumed-rate:&#123;client-id=consumer-1&#125;                             : 45.412</span><br><span class="line">consumer-fetch-manager-metrics:bytes-consumed-total:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka&#125;          : 1371.000</span><br><span class="line">consumer-fetch-manager-metrics:bytes-consumed-total:&#123;client-id=consumer-1&#125;                            : 1371.000</span><br><span class="line">consumer-fetch-manager-metrics:fetch-latency-avg:&#123;client-id=consumer-1&#125;                               : 21.750</span><br><span class="line">consumer-fetch-manager-metrics:fetch-latency-max:&#123;client-id=consumer-1&#125;                               : 32.000</span><br><span class="line">consumer-fetch-manager-metrics:fetch-rate:&#123;client-id=consumer-1&#125;                                      : 0.132</span><br><span class="line">consumer-fetch-manager-metrics:fetch-size-avg:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka&#125;                : 342.750</span><br><span class="line">consumer-fetch-manager-metrics:fetch-size-avg:&#123;client-id=consumer-1&#125;                                  : 342.750</span><br><span class="line">consumer-fetch-manager-metrics:fetch-size-max:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka&#125;                : 412.000</span><br><span class="line">consumer-fetch-manager-metrics:fetch-size-max:&#123;client-id=consumer-1&#125;                                  : 412.000</span><br><span class="line">consumer-fetch-manager-metrics:fetch-throttle-time-avg:&#123;client-id=consumer-1&#125;                         : 0.000</span><br><span class="line">consumer-fetch-manager-metrics:fetch-throttle-time-max:&#123;client-id=consumer-1&#125;                         : 0.000</span><br><span class="line">consumer-fetch-manager-metrics:fetch-total:&#123;client-id=consumer-1&#125;                                     : 4.000</span><br><span class="line">consumer-fetch-manager-metrics:records-consumed-rate:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka&#125;         : 0.331</span><br><span class="line">consumer-fetch-manager-metrics:records-consumed-rate:&#123;client-id=consumer-1&#125;                           : 0.331</span><br><span class="line">consumer-fetch-manager-metrics:records-consumed-total:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka&#125;        : 10.000</span><br><span class="line">consumer-fetch-manager-metrics:records-consumed-total:&#123;client-id=consumer-1&#125;                          : 10.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lag-avg:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=0&#125;  : 0.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lag-avg:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=1&#125;  : 0.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lag-avg:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=2&#125;  : 0.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lag-avg:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=3&#125;  : 0.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lag-max:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=0&#125;  : 0.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lag-max:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=1&#125;  : 0.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lag-max:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=2&#125;  : 0.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lag-max:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=3&#125;  : 0.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lag-max:&#123;client-id=consumer-1&#125;                                 : 0.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lag:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=0&#125;      : 0.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lag:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=1&#125;      : 0.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lag:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=2&#125;      : 0.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lag:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=3&#125;      : 0.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lead-avg:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=0&#125; : 2.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lead-avg:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=1&#125; : 3.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lead-avg:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=2&#125; : 3.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lead-avg:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=3&#125; : 2.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lead-min:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=0&#125; : 2.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lead-min:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=1&#125; : 3.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lead-min:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=2&#125; : 3.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lead-min:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=3&#125; : 2.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lead-min:&#123;client-id=consumer-1&#125;                                : 2.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lead:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=0&#125;     : 2.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lead:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=1&#125;     : 3.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lead:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=2&#125;     : 3.000</span><br><span class="line">consumer-fetch-manager-metrics:records-lead:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka, partition=3&#125;     : 2.000</span><br><span class="line">consumer-fetch-manager-metrics:records-per-request-avg:&#123;client-id=consumer-1, topic=<span class="built_in">test</span>-kafka&#125;       : 2.500</span><br><span class="line">consumer-fetch-manager-metrics:records-per-request-avg:&#123;client-id=consumer-1&#125;                         : 2.500</span><br><span class="line">kafka-metrics-count:count:&#123;client-id=consumer-1&#125;                                                      : 64.000</span><br><span class="line">[ec2-user@ip-172-31-16-188 bin]$</span><br></pre></td></tr></table></figure>

<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h38a2zlnw2j20z10u0wn6.jpg" alt="image-20201030231046314" style="zoom: 50%;" />

<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h38a335dbsj21830u0k3a.jpg" alt="image-20201030231059776" style="zoom:67%;" />



<h2 id="Check-Metrics-amp-Close-machines"><a href="#Check-Metrics-amp-Close-machines" class="headerlink" title="Check Metrics &amp; Close machines"></a>Check Metrics &amp; Close machines</h2><h4 id="CloudWatch-1"><a href="#CloudWatch-1" class="headerlink" title="CloudWatch"></a>CloudWatch</h4><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h38a36ygn5j213f0u00ye.jpg" alt="image-20201030231615009" style="zoom:67%;" />





<img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk7rrtvyaoj31c60boq5s.jpg" alt="image-20201030231908873" style="zoom:67%;" />



<h5 id="Mine"><a href="#Mine" class="headerlink" title="Mine:"></a>Mine:</h5><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1glt8qicv2cj314l0u0qd2.jpg" alt="image-20201219162312374" style="zoom:50%;" />



<h6 id="kafka-–-can-only-be-deleted-and-then-reconfigured-next-time"><a href="#kafka-–-can-only-be-deleted-and-then-reconfigured-next-time" class="headerlink" title="kafka – can only be deleted, and then reconfigured next time"></a>kafka – can only be deleted, and then reconfigured next time</h6><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1glt8yk8kuyj31f40fkdlf.jpg" alt="image-20201219163057742" style="zoom:50%;" />



<h2 id="Qs"><a href="#Qs" class="headerlink" title="Qs"></a>Qs</h2></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Joe Huang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/10/24/BigData_java/2020-10-24%20BigData%20side-projects%20in%20Java/">http://yoursite.com/2020/10/24/BigData_java/2020-10-24%20BigData%20side-projects%20in%20Java/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/11/01/BigData_java/2020-11-1%20Twitter%20on%20AWS/"><i class="fa fa-chevron-left">  </i><span>BigData_java/2020-11-1 Twitter on AWS</span></a></div><div class="next-post pull-right"><a href="/2020/10/23/BigData_java/2020-10-23%20Kafka%20Infrastructure%20&amp;%20Details/"><span>BigData_java/2020-10-23 Kafka Infrastructure &amp; Details</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2022 By Joe Huang</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>