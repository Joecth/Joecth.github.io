<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="SQL/2020-02-21-SQL-analyzation"><meta name="keywords" content=""><meta name="author" content="Joe Huang"><meta name="copyright" content="Joe Huang"><title>SQL/2020-02-21-SQL-analyzation | Awaken Desparado</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.1.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Analyze-Data-with-SQL"><span class="toc-number">1.</span> <span class="toc-text">Analyze Data with SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1"><span class="toc-number">1.0.1.</span> <span class="toc-text">1.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2"><span class="toc-number">1.0.2.</span> <span class="toc-text">2.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3"><span class="toc-number">1.0.3.</span> <span class="toc-text">3.</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-Metropolitan-Museum-of-Art"><span class="toc-number">2.</span> <span class="toc-text">The Metropolitan Museum of Art</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hacker-News"><span class="toc-number">3.</span> <span class="toc-text">Hacker News</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Which-sites-feed-Hacker-News"><span class="toc-number">3.0.1.</span> <span class="toc-text">Which sites feed Hacker News?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#What’s-the-best-time-to-post-a-story"><span class="toc-number">3.0.2.</span> <span class="toc-text">What’s the best time to post a story?</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Joe Huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">274</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">25</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">40</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Awaken Desparado</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">SQL/2020-02-21-SQL-analyzation</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-20</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/SQL/">SQL</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="Analyze-Data-with-SQL"><a href="#Analyze-Data-with-SQL" class="headerlink" title="Analyze Data with SQL"></a>Analyze Data with SQL</h1><h3 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h3><p>The UX Research team wants to see a distribution of watch durations. They want the result to contain:</p>
<ul>
<li><code>duration</code>, which is the watch event duration, rounded to the closest minute</li>
<li><code>count</code>, the number of watch events falling into this “bucket”</li>
</ul>
<p>Your result should look like:</p>
<table>
<thead>
<tr>
<th>duration</th>
<th>count</th>
</tr>
</thead>
<tbody><tr>
<td>1.0</td>
<td>9</td>
</tr>
<tr>
<td>2.0</td>
<td>21</td>
</tr>
<tr>
<td>3.0</td>
<td>19</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Use <code>COUNT()</code>, <code>GROUP BY</code>, and <code>ORDER BY</code> to create this result and order this data by increasing <code>duration</code>.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">round</span>(watch_duration_in_minutes, <span class="number">0</span>) </span><br><span class="line"><span class="keyword">from</span> watch_history </span><br><span class="line"><span class="keyword">limit</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  <span class="keyword">ROUND</span>(watch_duration_in_minutes, <span class="number">0</span>) <span class="keyword">as</span> <span class="keyword">duration</span>,</span><br><span class="line">  <span class="keyword">COUNT</span>(*) <span class="keyword">as</span> <span class="keyword">count</span></span><br><span class="line"><span class="keyword">FROM</span> watch_history</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">duration</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">duration</span> <span class="keyword">ASC</span> <span class="keyword">limit</span> <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">round</span>(watch_duration_in_minutes, <span class="number">0</span>) <span class="keyword">as</span> <span class="keyword">duration</span>, </span><br><span class="line"><span class="keyword">count</span>(*) <span class="keyword">as</span> <span class="keyword">count</span></span><br><span class="line"><span class="keyword">from</span> watch_history</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">duration</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">duration</span> <span class="keyword">asc</span> <span class="keyword">limit</span> <span class="number">20</span>;</span><br><span class="line"><span class="comment">-- order by count(*) asc limit 20;</span></span><br></pre></td></tr></table></figure>



<h3 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h3><p>Find all the users that have successfully made a payment to Codeflix and find their total amount paid.</p>
<p>Sort them by their total payments (from high to low).</p>
<p>Use <code>SUM()</code>, <code>WHERE</code>, <code>GROUP BY</code>, and <code>ORDER BY</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> user_id, <span class="keyword">SUM</span>(amount)</span><br><span class="line"><span class="keyword">FROM</span> payments</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">status</span> = <span class="string">'paid'</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> user_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">SUM</span>(amount) <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> user_id, <span class="keyword">SUM</span>(amount) <span class="keyword">AS</span> <span class="string">'total'</span></span><br><span class="line"><span class="keyword">FROM</span> payments</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">status</span> = <span class="string">'paid'</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">2</span> <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>



<p>The <code>watch_history</code> table has the following columns:</p>
<ul>
<li><code>id</code></li>
<li><code>user_id</code></li>
<li><code>watch_date</code></li>
<li><code>watch_duration_in_minutes</code></li>
</ul>
<p>Click <a href="https://s3.amazonaws.com/codecademy-content/courses/learn-sql-aggregates-code-challenge/user-payments-history.png" target="_blank" rel="noopener">here</a> for the table diagram.</p>
<p>Instructions</p>
<p>Generate a table of user ids and total watch duration for users who watched more than 400 minutes of content.</p>
<p>Use <code>SUM()</code>, <code>GROUP BY</code>, and <code>HAVING</code> to achieve this.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> user_id, <span class="keyword">SUM</span>(watch_duration_in_minutes) </span><br><span class="line"><span class="keyword">from</span> watch_history </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> user_id</span><br><span class="line"><span class="keyword">having</span> <span class="keyword">SUM</span>(watch_duration_in_minutes) &gt; <span class="number">400</span>;</span><br></pre></td></tr></table></figure>



<h3 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h3><p>Which days in this period did Codeflix collect the most money?</p>
<p>Your result should have two columns, <code>pay_date</code> and total <code>amount</code>, sorted by the latter descending.</p>
<p>This should only include successful payments (<code>status = &#39;paid&#39;</code>).</p>
<p>Use <code>SUM()</code>, <code>GROUP BY</code>, and <code>ORDER BY</code>.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> pay_date, <span class="keyword">sum</span>(amount)</span><br><span class="line"><span class="keyword">from</span> payments</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">status</span> = <span class="string">'paid'</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> pay_date</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">sum</span>(amount) <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>





<h1 id="The-Metropolitan-Museum-of-Art"><a href="#The-Metropolitan-Museum-of-Art" class="headerlink" title="The Metropolitan Museum of Art"></a>The Metropolitan Museum of Art</h1><p>First, let’s find the “lowest” year:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT MIN(date)</span><br><span class="line">FROM met;</span><br></pre></td></tr></table></figure>

<p>The result is 1600-1700.</p>
<p>Now, let’s try this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT date, title, medium</span><br><span class="line">FROM met</span><br><span class="line">WHERE date LIKE &#39;%1600%&#39;;</span><br></pre></td></tr></table></figure>

<p>Woah! <a href="https://www.metmuseum.org/art/collection/search/507" target="_blank" rel="noopener">Betty Lamp</a>, <a href="https://www.metmuseum.org/art/collection/search/1194" target="_blank" rel="noopener">Candlestick</a>, and <a href="https://www.metmuseum.org/art/collection/search/1458" target="_blank" rel="noopener">Casement Window</a> are among the oldest pieces in the collection.</p>
<p><strong>7.</strong></p>
<p>Lastly, let’s look at some bling!</p>
<p>Count the number of pieces where the <code>medium</code> contains ‘gold’ or ‘silver’.</p>
<p>And sort in descending order.</p>
<p>Hint</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ★★★ 7 </span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">medium</span>, <span class="keyword">count</span>(*)</span><br><span class="line"><span class="keyword">from</span> met</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">medium</span> <span class="keyword">like</span> <span class="string">'%gold%'</span> <span class="keyword">or</span> <span class="string">'%silver%'</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">medium</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">count</span>(*) <span class="keyword">desc</span>;</span><br><span class="line"><span class="comment">-- 可以做得再更往大分類去，要用到 CASE!如這裡</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">CASE</span></span><br><span class="line">    <span class="keyword">WHEN</span> <span class="keyword">medium</span> <span class="keyword">like</span> <span class="string">'%gold%'</span> <span class="keyword">THEN</span> <span class="string">'GOLD'</span></span><br><span class="line">    <span class="keyword">WHEN</span> <span class="keyword">medium</span> <span class="keyword">like</span> <span class="string">'%silver%'</span> <span class="keyword">THEN</span> <span class="string">'SILVER'</span></span><br><span class="line">    <span class="keyword">ELSE</span> <span class="literal">NULL</span></span><br><span class="line">  <span class="keyword">END</span> <span class="keyword">AS</span> <span class="string">'Bling'</span>, </span><br><span class="line">  <span class="keyword">count</span>(*)</span><br><span class="line"><span class="keyword">from</span> met</span><br><span class="line"><span class="comment">-- where medium like '%gold%' or '%silver%'</span></span><br><span class="line"><span class="comment">-- group by medium</span></span><br><span class="line"><span class="keyword">where</span> Bling <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> Bling</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">count</span>(*) <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>



<h1 id="Hacker-News"><a href="#Hacker-News" class="headerlink" title="Hacker News"></a>Hacker News</h1><h3 id="Which-sites-feed-Hacker-News"><a href="#Which-sites-feed-Hacker-News" class="headerlink" title="Which sites feed Hacker News?"></a>Which sites feed Hacker News?</h3><p><strong>6.</strong></p>
<p>Hacker News stories are essentially links that take users to other websites.</p>
<p><em>Which of these sites feed Hacker News the most</em>:</p>
<p><em><a href="https://www.github.com/" target="_blank" rel="noopener">GitHub</a>, <a href="https://www.medium.com/" target="_blank" rel="noopener">Medium</a>, or <a href="https://www.nytimes.com/" target="_blank" rel="noopener">New York Times</a>?</em></p>
<p>First, we want to categorize each story based on their source.</p>
<p>We can do this using a <code>CASE</code> statement:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT CASE</span><br><span class="line">   WHEN url LIKE &#39;%github.com%&#39; THEN &#39;GitHub&#39;</span><br><span class="line">   -- WHEN statement here</span><br><span class="line">   -- WHEN statement here</span><br><span class="line">   -- ELSE statement here</span><br><span class="line">  END AS &#39;Source&#39;</span><br><span class="line">FROM hacker_news;</span><br></pre></td></tr></table></figure>

<p>Fill in the other <code>WHEN</code> statements and the <code>ELSE</code> statement.</p>
<p>Stuck? Get a hint</p>
<p><strong>7.</strong></p>
<p>Next, build on the previous query:</p>
<p>Add a column for the number of stories from each URL using <code>COUNT()</code>.</p>
<p>Also, <code>GROUP BY</code> the <code>CASE</code> statement.</p>
<p>Remember that you can refer to a column in <code>GROUP BY</code> using a number.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 6, 7</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span></span><br><span class="line">  <span class="keyword">WHEN</span> <span class="keyword">url</span> <span class="keyword">LIKE</span> <span class="string">'%github%'</span> <span class="keyword">THEN</span> <span class="string">'GitHub'</span></span><br><span class="line">  <span class="keyword">WHEN</span> <span class="keyword">url</span> <span class="keyword">LIKE</span> <span class="string">'%medium.com%'</span> <span class="keyword">THEN</span> <span class="string">'Medium'</span></span><br><span class="line">  <span class="keyword">WHEN</span> <span class="keyword">url</span> <span class="keyword">LIKE</span> <span class="string">'%nytimes.com%'</span> <span class="keyword">THEN</span> <span class="string">'New York Times'</span></span><br><span class="line">  <span class="keyword">ELSE</span> <span class="string">'Other'</span></span><br><span class="line"><span class="keyword">END</span> <span class="keyword">AS</span> three_urls, <span class="keyword">count</span>(*)</span><br><span class="line"><span class="keyword">from</span> hacker_news </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> three_urls</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">count</span>(*);</span><br></pre></td></tr></table></figure>



<h3 id="What’s-the-best-time-to-post-a-story"><a href="#What’s-the-best-time-to-post-a-story" class="headerlink" title="What’s the best time to post a story?"></a>What’s the best time to post a story?</h3><p><strong>8.</strong></p>
<p>Every submitter wants their story to get a high score so that the story makes it to the front page, but…</p>
<p><em>What’s the best time of the day to post a story on Hacker News?</em></p>
<p>Before we get started, let’s run this query and take a look at the <code>timestamp</code> column:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT timestamp</span><br><span class="line">FROM hacker_news</span><br><span class="line">LIMIT 10;</span><br></pre></td></tr></table></figure>

<p>Notice that the values are formatted like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2018-05-08T12:30:00Z</span><br></pre></td></tr></table></figure>

<p>If you ignore the <code>T</code> and <code>Z</code>, the format is:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YYYY-MM-DD HH:MM:SS</span><br></pre></td></tr></table></figure>

<p>Stuck? Get a hint</p>
<p><strong>9.</strong></p>
<p>SQLite comes with a <code>strftime()</code> function - a very powerful function that allows you to return a formatted date.</p>
<p>It takes two arguments:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strftime(format, column)</span><br></pre></td></tr></table></figure>

<p>Let’s test this function out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT timestamp,</span><br><span class="line">   strftime(&#39;%H&#39;, timestamp)</span><br><span class="line">FROM hacker_news</span><br><span class="line">GROUP BY 1</span><br><span class="line">LIMIT 20;</span><br></pre></td></tr></table></figure>

<p>What do you think this does? Open the hint if you’d like to learn more.</p>
<p>Stuck? Get a hint</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 8, 9</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">timestamp</span></span><br><span class="line"><span class="keyword">from</span> hacker_news</span><br><span class="line"><span class="keyword">limit</span> <span class="number">15</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">timestamp</span>,</span><br><span class="line">  strftime(<span class="string">'%H'</span>, <span class="built_in">timestamp</span>)</span><br><span class="line"><span class="keyword">from</span> hacker_news</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line"><span class="comment">-- order by </span></span><br><span class="line"><span class="keyword">limit</span> <span class="number">15</span>;</span><br><span class="line"><span class="comment">-- This returns the hour, HH, of the timestamp column!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- For strftime(__, timestamp):</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- %Y returns the year (YYYY)</span></span><br><span class="line"><span class="comment">-- %m returns the month (01-12)</span></span><br><span class="line"><span class="comment">-- %d returns the day of the month (1-31)</span></span><br><span class="line"><span class="comment">-- %H returns 24-hour clock (00-23)</span></span><br><span class="line"><span class="comment">-- %M returns the minute (00-59)</span></span><br><span class="line"><span class="comment">-- %S returns the seconds (00-59)</span></span><br><span class="line"><span class="comment">-- if timestamp format is YYYY-MM-DD HH:MM:SS.</span></span><br></pre></td></tr></table></figure>



<p><strong>10.</strong></p>
<p>Okay, now we understand how <code>strftime()</code> works. Let’s write a query that returns three columns:</p>
<ol>
<li>The hours of the <code>timestamp</code></li>
<li>The <em>average</em> <code>score</code> for each hour</li>
<li>The <em>count</em> of stories for each hour</li>
</ol>
<p>Stuck? Get a hint</p>
<p><strong>11.</strong></p>
<p>Let’s edit a few things in the previous query:</p>
<ul>
<li>Round the average <code>score</code>s (<code>ROUND()</code>).</li>
<li>Rename the columns to make it more readable (<code>AS</code>).</li>
<li>Add a <code>WHERE</code> clause to filter out the <code>NULL</code> values in <code>timestamp</code>.</li>
</ul>
<p>Take a look at the result again:</p>
<p>What are the best hours to post a story on Hacker News?</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 10 ●○●○● </span></span><br><span class="line"><span class="keyword">select</span> strftime(<span class="string">'%H'</span>, <span class="built_in">timestamp</span>), <span class="keyword">avg</span>(score) ,<span class="keyword">count</span>(*)</span><br><span class="line"><span class="keyword">from</span> hacker_news</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="number">1</span> </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- limit 15;</span></span><br><span class="line"><span class="comment">-- having sum(score)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 11</span></span><br><span class="line"><span class="keyword">select</span> strftime(<span class="string">'%H'</span>, <span class="built_in">timestamp</span>) <span class="keyword">AS</span> <span class="keyword">Hour</span>, <span class="keyword">round</span>(<span class="keyword">avg</span>(score), <span class="number">2</span>) <span class="keyword">AS</span> <span class="string">'Average Score'</span>,<span class="keyword">count</span>(*) <span class="keyword">AS</span> <span class="string">'# of Stories'</span></span><br><span class="line"><span class="keyword">from</span> hacker_news</span><br><span class="line"><span class="keyword">where</span> <span class="built_in">timestamp</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>  <span class="comment">-- 注意！！　這裡不能寫１，而要用本來的column名</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="number">1</span> </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>



<img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc5jrvpb7ij30fi0bq3yv.jpg" alt="image-20200222222825218" style="zoom:50%;" />

<img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc5k2mxbs4j31520hitmq.jpg" alt="image-20200222223832094" style="zoom:67%;" />



<img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc5ka80insj31b00caqf3.jpg" alt="image-20200222224606164" style="zoom:67%;" /></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Joe Huang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/02/20/SQL/2020-02-21-SQL-analyzation/">http://yoursite.com/2020/02/20/SQL/2020-02-21-SQL-analyzation/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/02/20/SQL/2020-02-21-SQL-analyzation,%20Funnel%20&amp;%20Churn%20Rate/"><i class="fa fa-chevron-left">  </i><span>SQL/2020-02-21-SQL-analyzation, Funnel &amp; Churn Rate</span></a></div><div class="next-post pull-right"><a href="/2020/02/18/SQL/2020-02-18-SQL-Cases/"><span>SQL/2020-02-18-SQL-Cases</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By Joe Huang</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>