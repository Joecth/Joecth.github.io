<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="System-Design/ACE/2021-01-08 1&amp;2 Intro &amp; Components Review"><meta name="keywords" content=""><meta name="author" content="Joe Huang"><meta name="copyright" content="Joe Huang"><title>System-Design/ACE/2021-01-08 1&amp;2 Intro &amp; Components Review | Awaken Desparado</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-180692466-1', 'auto');
ga('send', 'pageview');</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#System-Desing-vs-OOD"><span class="toc-number">1.</span> <span class="toc-text">System Desing vs OOD</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Product-Design-System-Design-Scalability"><span class="toc-number">1.0.0.0.1.</span> <span class="toc-text">Product Design &#x3D; System Design - Scalability</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misunderstandings"><span class="toc-number">2.</span> <span class="toc-text">Misunderstandings</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Ignored-Non-functional-Req"><span class="toc-number">2.1.</span> <span class="toc-text">1) Ignored Non-functional Req</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Ignored-some-data-stream"><span class="toc-number">2.2.</span> <span class="toc-text">2) Ignored some data stream</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#e-g-corner-case"><span class="toc-number">2.2.1.</span> <span class="toc-text">e.g. corner case</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-背書"><span class="toc-number">2.3.</span> <span class="toc-text">3) 背書</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Trade-off"><span class="toc-number">2.4.</span> <span class="toc-text">4) Trade-off</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-過度依賴Tips-Guides"><span class="toc-number">2.5.</span> <span class="toc-text">5) 過度依賴Tips&#x2F;Guides</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-答題不分主次"><span class="toc-number">2.6.</span> <span class="toc-text">6) 答題不分主次</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-過度強調技術選型"><span class="toc-number">2.7.</span> <span class="toc-text">7) 過度強調技術選型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-混亂的系統設計圖"><span class="toc-number">2.8.</span> <span class="toc-text">8) 混亂的系統設計圖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-答得過慢"><span class="toc-number">2.9.</span> <span class="toc-text">9) 答得過慢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-忽略流量模式"><span class="toc-number">2.10.</span> <span class="toc-text">10) 忽略流量模式!</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DB"><span class="toc-number">3.</span> <span class="toc-text">DB</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#kafka-topics數量不能太大；但也是看它怎麼用，topics可以分partition就可以很大-10萬或Million這級別；每個partition都是有順序"><span class="toc-number">3.0.0.0.1.</span> <span class="toc-text">kafka topics數量不能太大；但也是看它怎麼用，topics可以分partition就可以很大 10萬或Million這級別；每個partition都是有順序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Data-lake-可能可以是hive-offline-data就是相對於stream-溪流-而言、etl-raw-data可是個data-lake部分，比較是包含很多技術的總稱"><span class="toc-number">3.0.0.0.2.</span> <span class="toc-text">Data lake(可能可以是hive): offline data就是相對於stream (溪流)而言、etl raw data可是個data lake部分，比較是包含很多技術的總稱</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Data-warehouse不能立即返回，他用的是跟sql類似的言語；hive不含sql所有功能，傾向是map-reduce去處理，而不是都在ram裡處理掉，時間跑得長，不能立即返回結果；不是文件系統，HIVE是HDFS上包裏了一層，提供了一個固定的schema表格的型式去存data的機制，並提供了語言去處理如跟map-reduce結合處理"><span class="toc-number">3.0.0.0.3.</span> <span class="toc-text">Data warehouse不能立即返回，他用的是跟sql類似的言語；hive不含sql所有功能，傾向是map-reduce去處理，而不是都在ram裡處理掉，時間跑得長，不能立即返回結果；不是文件系統，HIVE是HDFS上包裏了一層，提供了一個固定的schema表格的型式去存data的機制，並提供了語言去處理如跟map-reduce結合處理</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#怎選"><span class="toc-number">3.1.</span> <span class="toc-text">怎選</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-是否要ACID"><span class="toc-number">3.1.1.</span> <span class="toc-text">1) 是否要ACID?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-是否需要JOIN"><span class="toc-number">3.1.2.</span> <span class="toc-text">2) 是否需要JOIN?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-是否要scalability"><span class="toc-number">3.1.3.</span> <span class="toc-text">3) 是否要scalability</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-data-model"><span class="toc-number">3.1.4.</span> <span class="toc-text">4) data model?</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#mongo這兩年可以join，从一個table拿出field再去query另個table，不是面試中要關心的"><span class="toc-number">3.1.4.0.1.</span> <span class="toc-text">mongo這兩年可以join，从一個table拿出field再去query另個table，不是面試中要關心的</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#捨棄P-–-gt-無法多機了。。就只有CA了"><span class="toc-number">3.1.4.0.2.</span> <span class="toc-text">捨棄P –&gt; 無法多機了。。就只有CA了</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#sql即使有sharding也是讀寫比較不如nosql因為有鎖"><span class="toc-number">3.1.4.0.3.</span> <span class="toc-text">sql即使有sharding也是讀寫比較不如nosql因為有鎖</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#c的cae-DB的改寫並不會去通知到要改cache"><span class="toc-number">3.1.4.0.4.</span> <span class="toc-text">c的cae: DB的改寫並不會去通知到要改cache</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#availability-指的不是容災，而是可被有正確值丟出-lt-TODO-11-56"><span class="toc-number">3.1.4.0.5.</span> <span class="toc-text">availability: 指的不是容災，而是可被有正確值丟出 &lt;&#x3D;&#x3D; TODO: 11:56</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CAP"><span class="toc-number">3.2.</span> <span class="toc-text">CAP</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#mongodb-我們不覺得他會常當機無法訪問"><span class="toc-number">3.2.0.0.1.</span> <span class="toc-text">mongodb 我們不覺得他會常當機無法訪問</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Document-Store"><span class="toc-number">3.2.1.</span> <span class="toc-text">Document Store</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#KV-Store"><span class="toc-number">3.2.2.</span> <span class="toc-text">KV Store</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Wide-Column-Store"><span class="toc-number">3.2.3.</span> <span class="toc-text">Wide-Column Store</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Graph-Store"><span class="toc-number">3.2.4.</span> <span class="toc-text">Graph Store</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#SQL-amp-NoSQL界線正在變模糊"><span class="toc-number">3.2.4.0.1.</span> <span class="toc-text">SQL &amp; NoSQL界線正在變模糊</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cache"><span class="toc-number">4.</span> <span class="toc-text">Cache</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#熱點data"><span class="toc-number">4.0.1.</span> <span class="toc-text">熱點data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Session-storage"><span class="toc-number">4.0.2.</span> <span class="toc-text">Session storage</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#低latency-reading"><span class="toc-number">4.0.3.</span> <span class="toc-text">低latency reading</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#custermer-side’s-cache"><span class="toc-number">4.0.4.</span> <span class="toc-text">custermer side’s cache</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#讀"><span class="toc-number">4.1.</span> <span class="toc-text">讀</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Cache-Aside-TODO-12-18"><span class="toc-number">4.1.1.</span> <span class="toc-text">Cache-Aside TODO:12:18</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#"><span class="toc-number">4.2.</span> <span class="toc-text"></span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Read-Through"><span class="toc-number">4.2.1.</span> <span class="toc-text">Read-Through</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#寫"><span class="toc-number">4.3.</span> <span class="toc-text">寫</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Write-Through"><span class="toc-number">4.3.1.</span> <span class="toc-text">Write-Through</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Write-Back"><span class="toc-number">4.3.2.</span> <span class="toc-text">Write-Back</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Write-Around"><span class="toc-number">4.3.3.</span> <span class="toc-text">Write-Around</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#TODO-12-33"><span class="toc-number">4.3.3.0.1.</span> <span class="toc-text">TODO: 12:33</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis-永久化方案"><span class="toc-number">4.3.4.</span> <span class="toc-text">Redis 永久化方案</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#MySQL本來就在DB，不需要討論持久化"><span class="toc-number">4.3.4.0.1.</span> <span class="toc-text">MySQL本來就在DB，不需要討論持久化</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CDN"><span class="toc-number">4.4.</span> <span class="toc-text">CDN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MQ"><span class="toc-number">4.5.</span> <span class="toc-text">MQ</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#TODO"><span class="toc-number">4.5.0.0.1.</span> <span class="toc-text">TODO:!!!</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Joe Huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">399</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">26</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">70</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Awaken Desparado</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">System-Design/ACE/2021-01-08 1&amp;2 Intro &amp; Components Review</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-01-08</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/SystemDesign/">SystemDesign</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="System-Desing-vs-OOD"><a href="#System-Desing-vs-OOD" class="headerlink" title="System Desing vs OOD"></a>System Desing vs OOD</h2><table>
<thead>
<tr>
<th></th>
<th>Points</th>
<th>Format</th>
<th>Problems</th>
</tr>
</thead>
<tbody><tr>
<td>System Design</td>
<td>Dataflow<br />Architecture<br />Scalability</td>
<td>系统設計圖<br />DB設計<br />API設計</td>
<td>Instagram</td>
</tr>
<tr>
<td>OOD (不是個web service)</td>
<td>Class Interface<br />Inheritance</td>
<td>Code<br />Data Structure</td>
<td>停車場</td>
</tr>
</tbody></table>
<h6 id="Product-Design-System-Design-Scalability"><a href="#Product-Design-System-Design-Scalability" class="headerlink" title="Product Design = System Design - Scalability"></a>Product Design = System Design - Scalability</h6><h2 id="Misunderstandings"><a href="#Misunderstandings" class="headerlink" title="Misunderstandings"></a>Misunderstandings</h2><h3 id="1-Ignored-Non-functional-Req"><a href="#1-Ignored-Non-functional-Req" class="headerlink" title="1) Ignored Non-functional Req"></a>1) Ignored Non-functional Req</h3><h3 id="2-Ignored-some-data-stream"><a href="#2-Ignored-some-data-stream" class="headerlink" title="2) Ignored some data stream"></a>2) Ignored some data stream</h3><h4 id="e-g-corner-case"><a href="#e-g-corner-case" class="headerlink" title="e.g. corner case"></a>e.g. corner case</h4><ul>
<li><p>e.g. Whatsapp裡的四條data streaming</p>
</li>
<li><p>e.g. celebrity 需要去區分不同的data streaming 作優化 &lt;= 普通人 vs 名人</p>
</li>
</ul>
<h3 id="3-背書"><a href="#3-背書" class="headerlink" title="3) 背書"></a>3) 背書</h3><ul>
<li>自己把info作長篇大論作背誦；–&gt; better to used in “deep-dive”</li>
</ul>
<h3 id="4-Trade-off"><a href="#4-Trade-off" class="headerlink" title="4) Trade-off"></a>4) Trade-off</h3><ul>
<li><p>黑客版的網爬，我們可以做出五種不同的構件 &lt;= 權衡做好並作利弊</p>
</li>
<li><p>Ins’s Push(low latency) vs Pull(Normalization in SQL)</p>
</li>
</ul>
<h3 id="5-過度依賴Tips-Guides"><a href="#5-過度依賴Tips-Guides" class="headerlink" title="5) 過度依賴Tips/Guides"></a>5) 過度依賴Tips/Guides</h3><ul>
<li><p>自己得要想問題去問 –&gt;<br>一般人會follower多少人? 會有幾個人follower他?</p>
</li>
<li><p>多少人看每天？多久po文一次? –&gt; 去了解讀跟寫</p>
</li>
</ul>
<h3 id="6-答題不分主次"><a href="#6-答題不分主次" class="headerlink" title="6) 答題不分主次"></a>6) 答題不分主次</h3><ul>
<li>自己未把「abtraction」、「encapsulation」分清楚</li>
<li>Level-wised details, to know how to deep-dive</li>
<li>e.g. 網爬 –&gt; 網爬’s details</li>
</ul>
<h3 id="7-過度強調技術選型"><a href="#7-過度強調技術選型" class="headerlink" title="7) 過度強調技術選型"></a>7) 過度強調技術選型</h3><ul>
<li><p>只知某種原理的細節 –&gt; 只知某種特定的Cache &lt;== 容易被深挖就尷了。。</p>
</li>
<li><p>不同種之間的廣度對比作優劣判斷</p>
</li>
<li><p>結論: 會把自己繞坑</p>
</li>
<li><p>e.g. SQL vs NoSQL</p>
<ul>
<li>NoSQL: Wide column! 别特定進去到 Cassandra</li>
</ul>
</li>
</ul>
<h3 id="8-混亂的系統設計圖"><a href="#8-混亂的系統設計圖" class="headerlink" title="8) 混亂的系統設計圖"></a>8) 混亂的系統設計圖</h3><ul>
<li>如果無法修復好的話，會很亂!</li>
<li>要清晰，不然看的人會忘</li>
</ul>
<h3 id="9-答得過慢"><a href="#9-答得過慢" class="headerlink" title="9) 答得過慢"></a>9) 答得過慢</h3><ul>
<li>時間不夠用，但別糾在末節<ul>
<li>e.g. Non-fn req: 沒到10mins, 就 3mins</li>
<li>e.g. resource estimation:別到誇張到 8 mins </li>
</ul>
</li>
<li>節奏得要是穩步向前，所以時間得able to control</li>
</ul>
<h3 id="10-忽略流量模式"><a href="#10-忽略流量模式" class="headerlink" title="10) 忽略流量模式!"></a>10) 忽略流量模式!</h3><p>Ins - 大v</p>
<p>Memcached: 只是kv store; </p>
<p>Kafka 难被替代</p>
<p>: </p>
<h2 id="DB"><a href="#DB" class="headerlink" title="DB"></a>DB</h2><ul>
<li>DB是存儲實時訪問數據的永久存儲 vs warehouse &lt;== 非實時訪問 (Hive QL 類似map reduce，apache的一個項目，幫大家去存大量的歷史data)，存在hard disk裡作長期存儲，一般在服務不會去訪問它</li>
<li>SQL vs NoSQL<ul>
<li>SQL : hd是很稀缺的，注重把data壓到很少，因為hd很貴。所以 JOIN<ul>
<li>好懂 –&gt; 2D表格表示事務 –&gt; 符合大腦 vs NoSQL(有時有3D)</li>
<li>好維護 –&gt; Consistency!!! 歷經實踐檢驗、慢慢掛 vs NoSQL cascaded 地全掛</li>
<li>靈活 –&gt; 語言強大，一些事在DB層就可用 vs NoSQL都只能在應用層來做</li>
<li>CONS:<ul>
<li>鎖 -&gt; 慢</li>
<li>不靈活，表難擴展、結構難改</li>
<li>只有partition:單機分到不同地方，没有sharding:機器間的分配<ul>
<li>Proxy SQL可以幫sql起到sharding，讓proxy去協調哪個機器存什麼</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h6 id="kafka-topics數量不能太大；但也是看它怎麼用，topics可以分partition就可以很大-10萬或Million這級別；每個partition都是有順序"><a href="#kafka-topics數量不能太大；但也是看它怎麼用，topics可以分partition就可以很大-10萬或Million這級別；每個partition都是有順序" class="headerlink" title="kafka topics數量不能太大；但也是看它怎麼用，topics可以分partition就可以很大 10萬或Million這級別；每個partition都是有順序"></a>kafka topics數量不能太大；但也是看它怎麼用，topics可以分partition就可以很大 10萬或Million這級別；每個partition都是有順序</h6><pre><code>- event in topic 看什麼是partition key --&gt; 分partition
- E.G. img post : img `topics`; user_id as `partition`</code></pre><h6 id="Data-lake-可能可以是hive-offline-data就是相對於stream-溪流-而言、etl-raw-data可是個data-lake部分，比較是包含很多技術的總稱"><a href="#Data-lake-可能可以是hive-offline-data就是相對於stream-溪流-而言、etl-raw-data可是個data-lake部分，比較是包含很多技術的總稱" class="headerlink" title="Data lake(可能可以是hive): offline data就是相對於stream (溪流)而言、etl raw data可是個data lake部分，比較是包含很多技術的總稱"></a>Data lake(可能可以是hive): offline data就是相對於stream (溪流)而言、etl raw data可是個data lake部分，比較是包含很多技術的總稱</h6><h6 id="Data-warehouse不能立即返回，他用的是跟sql類似的言語；hive不含sql所有功能，傾向是map-reduce去處理，而不是都在ram裡處理掉，時間跑得長，不能立即返回結果；不是文件系統，HIVE是HDFS上包裏了一層，提供了一個固定的schema表格的型式去存data的機制，並提供了語言去處理如跟map-reduce結合處理"><a href="#Data-warehouse不能立即返回，他用的是跟sql類似的言語；hive不含sql所有功能，傾向是map-reduce去處理，而不是都在ram裡處理掉，時間跑得長，不能立即返回結果；不是文件系統，HIVE是HDFS上包裏了一層，提供了一個固定的schema表格的型式去存data的機制，並提供了語言去處理如跟map-reduce結合處理" class="headerlink" title="Data warehouse不能立即返回，他用的是跟sql類似的言語；hive不含sql所有功能，傾向是map-reduce去處理，而不是都在ram裡處理掉，時間跑得長，不能立即返回結果；不是文件系統，HIVE是HDFS上包裏了一層，提供了一個固定的schema表格的型式去存data的機制，並提供了語言去處理如跟map-reduce結合處理"></a>Data warehouse不能立即返回，他用的是跟sql類似的言語；hive不含sql所有功能，傾向是map-reduce去處理，而不是都在ram裡處理掉，時間跑得長，不能立即返回結果；不是文件系統，HIVE是HDFS上包裏了一層，提供了一個固定的schema表格的型式去存data的機制，並提供了語言去處理如跟map-reduce結合處理</h6><ul>
<li><ul>
<li>NoSQL<ul>
<li>讀寫強! &lt;== lock用得少</li>
<li>存儲機制靈活多樣 &lt;== 四種大樣，且支持靈活的 schema</li>
<li>原生支持高併發 &lt;== 易橫向擴展<ul>
<li>横(用多台機器)、縱(單一台)有特定含義的!</li>
</ul>
</li>
<li>cons:</li>
<li>較低的一致性</li>
<li>性能理解不足，cassandra易一串failure，如其consistent hash ring易加減機器，但系統一旦有1/4機器出包，系統會連續愈來愈多掛掉，讓一個系統很快degrade… <ul>
<li>當時多台就是為了想stable，缺乏在大量req下deploy 服務的經驗</li>
</ul>
</li>
<li>不支持JOIN –&gt; 提倡 denormalization</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="怎選"><a href="#怎選" class="headerlink" title="怎選"></a>怎選</h3><h4 id="1-是否要ACID"><a href="#1-是否要ACID" class="headerlink" title="1) 是否要ACID?"></a>1) 是否要ACID?</h4><ul>
<li>a:原子性 –&gt; 两個寫的要求，打包發生</li>
<li>c:一致 &lt;==有一些沒一致是ok的  –&gt; data寫的時候是準確的，讀出來還是要同個data，沒有打包這個含義 </li>
<li>i:不同data不互影響</li>
<li>d:長期在db</li>
</ul>
<h4 id="2-是否需要JOIN"><a href="#2-是否需要JOIN" class="headerlink" title="2) 是否需要JOIN?"></a>2) 是否需要JOIN?</h4><ul>
<li>E.g. 設計db去解決要不要JOIN的問題</li>
</ul>
<h4 id="3-是否要scalability"><a href="#3-是否要scalability" class="headerlink" title="3) 是否要scalability"></a>3) 是否要scalability</h4><ul>
<li>Nosql 就是可以橫向擴展</li>
</ul>
<h4 id="4-data-model"><a href="#4-data-model" class="headerlink" title="4) data model?"></a>4) data model?</h4><ul>
<li>如果是個friend graph 如fb上<ul>
<li>想找到跟用戶A有在3個結點都找到 &lt;– neo4j graph DB 可原生解決它<ul>
<li>SQL也可以寫三層、六層XD… 很累啊</li>
</ul>
</li>
<li>如果kv就ok那就是簡單的memcache就ok</li>
</ul>
</li>
</ul>
<h6 id="mongo這兩年可以join，从一個table拿出field再去query另個table，不是面試中要關心的"><a href="#mongo這兩年可以join，从一個table拿出field再去query另個table，不是面試中要關心的" class="headerlink" title="mongo這兩年可以join，从一個table拿出field再去query另個table，不是面試中要關心的"></a>mongo這兩年可以join，从一個table拿出field再去query另個table，不是面試中要關心的</h6><h6 id="捨棄P-–-gt-無法多機了。。就只有CA了"><a href="#捨棄P-–-gt-無法多機了。。就只有CA了" class="headerlink" title="捨棄P –&gt; 無法多機了。。就只有CA了"></a>捨棄P –&gt; 無法多機了。。就只有CA了</h6><h6 id="sql即使有sharding也是讀寫比較不如nosql因為有鎖"><a href="#sql即使有sharding也是讀寫比較不如nosql因為有鎖" class="headerlink" title="sql即使有sharding也是讀寫比較不如nosql因為有鎖"></a>sql即使有sharding也是讀寫比較不如nosql因為有鎖</h6><h6 id="c的cae-DB的改寫並不會去通知到要改cache"><a href="#c的cae-DB的改寫並不會去通知到要改cache" class="headerlink" title="c的cae: DB的改寫並不會去通知到要改cache"></a>c的cae: DB的改寫並不會去通知到要改cache</h6><h6 id="availability-指的不是容災，而是可被有正確值丟出-lt-TODO-11-56"><a href="#availability-指的不是容災，而是可被有正確值丟出-lt-TODO-11-56" class="headerlink" title="availability: 指的不是容災，而是可被有正確值丟出 &lt;== TODO: 11:56"></a>availability: 指的不是容災，而是可被有正確值丟出 &lt;== TODO: 11:56</h6><h3 id="CAP"><a href="#CAP" class="headerlink" title="CAP"></a>CAP</h3><h6 id="mongodb-我們不覺得他會常當機無法訪問"><a href="#mongodb-我們不覺得他會常當機無法訪問" class="headerlink" title="mongodb 我們不覺得他會常當機無法訪問"></a>mongodb 我們不覺得他會常當機無法訪問</h6><h4 id="Document-Store"><a href="#Document-Store" class="headerlink" title="Document Store"></a>Document Store</h4><p>Relational VS MongoDB(靈活 json)</p>
<h4 id="KV-Store"><a href="#KV-Store" class="headerlink" title="KV Store"></a>KV Store</h4><p>現今都是redis over memcached</p>
<ul>
<li>memcached: value只能是simple string，非常簡單的system，source code很短，10w行以下<ul>
<li>比較簡單的in memory 的kv</li>
</ul>
</li>
<li>redis: 可以是一堆特別的data structure、還有transaction、sharding、監控、lock的系統<ul>
<li>還會用一些disk、可以persistency</li>
</ul>
</li>
</ul>
<h4 id="Wide-Column-Store"><a href="#Wide-Column-Store" class="headerlink" title="Wide-Column Store"></a>Wide-Column Store</h4><ul>
<li>來自  Big-Table 論文，<ul>
<li>一個cell可以對應一堆時間!</li>
<li>column family(少的): column(多的)</li>
<li>Sparse DB &lt;== 後話</li>
</ul>
</li>
</ul>
<h4 id="Graph-Store"><a href="#Graph-Store" class="headerlink" title="Graph Store"></a>Graph Store</h4><ul>
<li>Neo4j 比較好query</li>
</ul>
<h6 id="SQL-amp-NoSQL界線正在變模糊"><a href="#SQL-amp-NoSQL界線正在變模糊" class="headerlink" title="SQL &amp; NoSQL界線正在變模糊"></a>SQL &amp; NoSQL界線正在變模糊</h6><h2 id="Cache"><a href="#Cache" class="headerlink" title="Cache"></a>Cache</h2><h4 id="熱點data"><a href="#熱點data" class="headerlink" title="熱點data"></a>熱點data</h4><ul>
<li>LRU</li>
</ul>
<h4 id="Session-storage"><a href="#Session-storage" class="headerlink" title="Session storage"></a>Session storage</h4><ul>
<li>instagram預加載分頁</li>
</ul>
<h4 id="低latency-reading"><a href="#低latency-reading" class="headerlink" title="低latency reading"></a>低latency reading</h4><ul>
<li>whatsapp上線後快速讀到別人發來的</li>
</ul>
<h4 id="custermer-side’s-cache"><a href="#custermer-side’s-cache" class="headerlink" title="custermer side’s cache"></a>custermer side’s cache</h4><ul>
<li>Autocomplete <code>客戶端預載</code>補全結果，本地解决，減少server壓力</li>
</ul>
<h3 id="讀"><a href="#讀" class="headerlink" title="讀"></a>讀</h3><h4 id="Cache-Aside-TODO-12-18"><a href="#Cache-Aside-TODO-12-18" class="headerlink" title="Cache-Aside TODO:12:18"></a>Cache-Aside TODO:12:18</h4><p>先讀cache(並不在主流程中，就算cache掛了，也會去db讀)，再讀db，</p>
<p>cache當了不會讓整個當</p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h4 id="Read-Through"><a href="#Read-Through" class="headerlink" title="Read-Through"></a>Read-Through</h4><h3 id="寫"><a href="#寫" class="headerlink" title="寫"></a>寫</h3><h4 id="Write-Through"><a href="#Write-Through" class="headerlink" title="Write-Through"></a>Write-Through</h4><p>寫時先寫到cache，cache再寫去db，兩個綁在一起叫完成</p>
<h4 id="Write-Back"><a href="#Write-Back" class="headerlink" title="Write-Back"></a>Write-Back</h4><p>Cache你何時寫給db你的事，我寫給你我ok就好了!</p>
<h4 id="Write-Around"><a href="#Write-Around" class="headerlink" title="Write-Around"></a>Write-Around</h4><p>我直接寫給DB，Cache在旁邊</p>
<table>
<thead>
<tr>
<th></th>
<th>Write-Through</th>
<th>Write-Around</th>
<th>Write-Back</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Cache-Aside</strong></td>
<td>N/A</td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Read-Through</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h6 id="TODO-12-33"><a href="#TODO-12-33" class="headerlink" title="TODO: 12:33"></a>TODO: 12:33</h6><h4 id="Redis-永久化方案"><a href="#Redis-永久化方案" class="headerlink" title="Redis 永久化方案"></a>Redis 永久化方案</h4><table>
<thead>
<tr>
<th></th>
<th>全稱</th>
<th>優點</th>
</tr>
</thead>
<tbody><tr>
<td>RDB 記狀態<br />snapshot</td>
<td>Redis DB Backup File</td>
<td>file小，不影響讀寫速度，快速災後修復</td>
</tr>
<tr>
<td>AOF 記過程<br />會降低讀寫效率</td>
<td>Append-Only File</td>
<td>最大程度降低data丟失，紀錄每次讀寫</td>
</tr>
</tbody></table>
<h6 id="MySQL本來就在DB，不需要討論持久化"><a href="#MySQL本來就在DB，不需要討論持久化" class="headerlink" title="MySQL本來就在DB，不需要討論持久化"></a>MySQL本來就在DB，不需要討論持久化</h6><h3 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h3><p>E.g. Netflix 我覺得他肯定在某個地方會變超popular，諾蘭的新片會很熱門! 離永戶愈近愈好!</p>
<p>降低consume file 的成本、提高讀大文件的效率、減慢latency</p>
<h3 id="MQ"><a href="#MQ" class="headerlink" title="MQ"></a>MQ</h3><h6 id="TODO"><a href="#TODO" class="headerlink" title="TODO:!!!"></a>TODO:!!!</h6></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Joe Huang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/01/08/System-Design/ACE/2021-01-08%201&amp;2%20Intro%20&amp;%20Components%20Review/">http://yoursite.com/2020/01/08/System-Design/ACE/2021-01-08%201&amp;2%20Intro%20&amp;%20Components%20Review/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/01/08/Design-Patterns/%E2%80%9C2019-01-08-Design%20Patterns%20-%20Observer%E2%80%9D/"><i class="fa fa-chevron-left">  </i><span>Design-Patterns/“2019-01-08-Design Patterns - Observer”</span></a></div><div class="next-post pull-right"><a href="/2019/12/22/Web/2019-12-19-Self-defined%20JSON%20serialization%20for%20json%20dump/"><span>Web/2019-12-19-Self-defined JSON serialization for json dump</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2023 By Joe Huang</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>