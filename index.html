<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="Joe Huang"><meta name="copyright" content="Joe Huang"><title>Awaken Desparado</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-180692466-1', 'auto');
ga('send', 'pageview');</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Joe Huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">395</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">26</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">69</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Awaken Desparado</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Awaken Desparado</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2023/06/15/ParallelProg/SIMD%20on%20x86_64/">ParallelProg/SIMD on x86_64</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-06-15</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/SIMD/">SIMD</a></span><div class="content"><h1 id="SIMD-on-X86-64"><a href="#SIMD-on-X86-64" class="headerlink" title="SIMD on X86_64"></a>SIMD on X86_64</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">/content/drive/MyDrive/mySIMD<span class="comment"># lscpu </span></span><br><span class="line">Architecture:                    x86_64</span><br><span class="line">CPU op-mode(s):                  32-bit, 64-bit</span><br><span class="line">Byte Order:                      Little Endian</span><br><span class="line">Address sizes:                   46 bits physical, 48 bits virtual</span><br><span class="line">CPU(s):                          2</span><br><span class="line">On-line CPU(s) list:             0,1</span><br><span class="line">Thread(s) per core:              2</span><br><span class="line">Core(s) per socket:              1</span><br><span class="line">Socket(s):                       1</span><br><span class="line">NUMA node(s):                    1</span><br><span class="line">Vendor ID:                       GenuineIntel</span><br><span class="line">CPU family:                      6</span><br><span class="line">Model:                           79</span><br><span class="line">Model name:                      Intel(R) Xeon(R) CPU @ 2.20GHz</span><br><span class="line">Stepping:                        0</span><br><span class="line">CPU MHz:                         2199.998</span><br><span class="line">BogoMIPS:                        4399.99</span><br><span class="line">Hypervisor vendor:               KVM</span><br><span class="line">Virtualization <span class="built_in">type</span>:             full</span><br><span class="line">L1d cache:                       32 KiB</span><br><span class="line">L1i cache:                       32 KiB</span><br><span class="line">L2 cache:                        256 KiB</span><br><span class="line">L3 cache:                        55 MiB</span><br><span class="line">NUMA node0 CPU(s):               0,1</span><br><span class="line">Vulnerability Itlb multihit:     Not affected</span><br><span class="line">Vulnerability L1tf:              Mitigation; PTE Inversion</span><br><span class="line">Vulnerability Mds:               Vulnerable; SMT Host state unknown</span><br><span class="line">Vulnerability Meltdown:          Vulnerable</span><br><span class="line">Vulnerability Mmio stale data:   Vulnerable</span><br><span class="line">Vulnerability Retbleed:          Vulnerable</span><br><span class="line">Vulnerability Spec store bypass: Vulnerable</span><br><span class="line">Vulnerability Spectre v1:        Vulnerable: __user pointer sanitization and usercopy </span><br><span class="line">                                 barriers only; no swapgs barriers</span><br><span class="line">Vulnerability Spectre v2:        Vulnerable, IBPB: disabled, STIBP: disabled, PBRSB-eI</span><br><span class="line">                                 BRS: Not affected</span><br><span class="line">Vulnerability Srbds:             Not affected</span><br><span class="line">Vulnerability Tsx async abort:   Vulnerable</span><br><span class="line">Flags:                           fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge </span><br><span class="line">                                 mca cmov pat pse36 clflush mmx fxsr sse sse2 ss ht sy</span><br><span class="line">                                 scall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl</span><br><span class="line">                                  xtopology nonstop_tsc cpuid tsc_known_freq pni pclmu</span><br><span class="line">                                 lqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe p</span><br><span class="line">                                 opcnt aes xsave avx f16c rdrand hypervisor lahf_lm ab</span><br><span class="line">                                 m 3dnowprefetch invpcid_single ssbd ibrs ibpb stibp f</span><br><span class="line">                                 sgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpc</span><br><span class="line">                                 id rtm rdseed adx smap xsaveopt arat md_clear arch_ca</span><br><span class="line">                                 pabilities</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br></pre></td><td class="code"><pre><span class="line">~<span class="comment"># gcc -march=native -c -Q --help=target</span></span><br><span class="line">The following options are target specific:</span><br><span class="line">  -m128bit-long-double                  [enabled]</span><br><span class="line">  -m16                                  [disabled]</span><br><span class="line">  -m32                                  [disabled]</span><br><span class="line">  -m3dnow                               [disabled]</span><br><span class="line">  -m3dnowa                              [disabled]</span><br><span class="line">  -m64                                  [enabled]</span><br><span class="line">  -m80387                               [enabled]</span><br><span class="line">  -m8bit-idiv                           [disabled]</span><br><span class="line">  -m96bit-long-double                   [disabled]</span><br><span class="line">  -mabi=                                sysv</span><br><span class="line">  -mabm                                 [enabled]</span><br><span class="line">  -maccumulate-outgoing-args            [disabled]</span><br><span class="line">  -maddress-mode=                       long</span><br><span class="line">  -madx                                 [enabled]</span><br><span class="line">  -maes                                 [enabled]</span><br><span class="line">  -malign-data=                         compat</span><br><span class="line">  -malign-double                        [disabled]</span><br><span class="line">  -malign-functions=                    0</span><br><span class="line">  -malign-jumps=                        0</span><br><span class="line">  -malign-loops=                        0</span><br><span class="line">  -malign-stringops                     [enabled]</span><br><span class="line">  -mandroid                             [disabled]</span><br><span class="line">  -march=                               broadwell</span><br><span class="line">  -masm=                                att</span><br><span class="line">  -mavx                                 [enabled]</span><br><span class="line">  -mavx2                                [enabled]</span><br><span class="line">  -mavx256-split-unaligned-load         [disabled]</span><br><span class="line">  -mavx256-split-unaligned-store        [disabled]</span><br><span class="line">  -mavx5124fmaps                        [disabled]</span><br><span class="line">  -mavx5124vnniw                        [disabled]</span><br><span class="line">  -mavx512bitalg                        [disabled]</span><br><span class="line">  -mavx512bw                            [disabled]</span><br><span class="line">  -mavx512cd                            [disabled]</span><br><span class="line">  -mavx512dq                            [disabled]</span><br><span class="line">  -mavx512er                            [disabled]</span><br><span class="line">  -mavx512f                             [disabled]</span><br><span class="line">  -mavx512ifma                          [disabled]</span><br><span class="line">  -mavx512pf                            [disabled]</span><br><span class="line">  -mavx512vbmi                          [disabled]</span><br><span class="line">  -mavx512vbmi2                         [disabled]</span><br><span class="line">  -mavx512vl                            [disabled]</span><br><span class="line">  -mavx512vnni                          [disabled]</span><br><span class="line">  -mavx512vpopcntdq                     [disabled]</span><br><span class="line">  -mbionic                              [disabled]</span><br><span class="line">  -mbmi                                 [enabled]</span><br><span class="line">  -mbmi2                                [enabled]</span><br><span class="line">  -mbranch-cost=&lt;0,5&gt;                   3</span><br><span class="line">  -mcall-ms2sysv-xlogues                [disabled]</span><br><span class="line">  -mcet-switch                          [disabled]</span><br><span class="line">  -mcld                                 [disabled]</span><br><span class="line">  -mcldemote                            [disabled]</span><br><span class="line">  -mclflushopt                          [disabled]</span><br><span class="line">  -mclwb                                [disabled]</span><br><span class="line">  -mclzero                              [disabled]</span><br><span class="line">  -mcmodel=                             [default]</span><br><span class="line">  -mcpu=                      </span><br><span class="line">  -mcrc32                               [disabled]</span><br><span class="line">  -mcx16                                [enabled]</span><br><span class="line">  -mdispatch-scheduler                  [disabled]</span><br><span class="line">  -mdump-tune-features                  [disabled]</span><br><span class="line">  -mf16c                                [enabled]</span><br><span class="line">  -mfancy-math-387                      [enabled]</span><br><span class="line">  -mfentry                              [disabled]</span><br><span class="line">  -mfentry-name=              </span><br><span class="line">  -mfentry-section=           </span><br><span class="line">  -mfma                                 [enabled]</span><br><span class="line">  -mfma4                                [disabled]</span><br><span class="line">  -mforce-drap                          [disabled]</span><br><span class="line">  -mforce-indirect-call                 [disabled]</span><br><span class="line">  -mfp-ret-in-387                       [enabled]</span><br><span class="line">  -mfpmath=                             sse</span><br><span class="line">  -mfsgsbase                            [enabled]</span><br><span class="line">  -mfunction-return=                    keep</span><br><span class="line">  -mfused-madd                </span><br><span class="line">  -mfxsr                                [enabled]</span><br><span class="line">  -mgeneral-regs-only                   [disabled]</span><br><span class="line">  -mgfni                                [disabled]</span><br><span class="line">  -mglibc                               [enabled]</span><br><span class="line">  -mhard-float                          [enabled]</span><br><span class="line">  -mhle                                 [enabled]</span><br><span class="line">  -miamcu                               [disabled]</span><br><span class="line">  -mieee-fp                             [enabled]</span><br><span class="line">  -mincoming-stack-boundary=            0</span><br><span class="line">  -mindirect-branch-register            [disabled]</span><br><span class="line">  -mindirect-branch=                    keep</span><br><span class="line">  -minline-all-stringops                [disabled]</span><br><span class="line">  -minline-stringops-dynamically        [disabled]</span><br><span class="line">  -minstrument-return=                  none</span><br><span class="line">  -mintel-syntax              </span><br><span class="line">  -mlarge-data-threshold=&lt;number&gt;       65536</span><br><span class="line">  -mlong-double-128                     [disabled]</span><br><span class="line">  -mlong-double-64                      [disabled]</span><br><span class="line">  -mlong-double-80                      [enabled]</span><br><span class="line">  -mlwp                                 [disabled]</span><br><span class="line">  -mlzcnt                               [enabled]</span><br><span class="line">  -mmanual-endbr                        [disabled]</span><br><span class="line">  -mmemcpy-strategy=          </span><br><span class="line">  -mmemset-strategy=          </span><br><span class="line">  -mmitigate-rop                        [disabled]</span><br><span class="line">  -mmmx                                 [enabled]</span><br><span class="line">  -mmovbe                               [enabled]</span><br><span class="line">  -mmovdir64b                           [disabled]</span><br><span class="line">  -mmovdiri                             [disabled]</span><br><span class="line">  -mmpx                                 [disabled]</span><br><span class="line">  -mms-bitfields                        [disabled]</span><br><span class="line">  -mmusl                                [disabled]</span><br><span class="line">  -mmwaitx                              [disabled]</span><br><span class="line">  -mno-align-stringops                  [disabled]</span><br><span class="line">  -mno-default                          [disabled]</span><br><span class="line">  -mno-fancy-math-387                   [disabled]</span><br><span class="line">  -mno-push-args                        [disabled]</span><br><span class="line">  -mno-red-zone                         [disabled]</span><br><span class="line">  -mno-sse4                             [disabled]</span><br><span class="line">  -mnop-mcount                          [disabled]</span><br><span class="line">  -momit-leaf-frame-pointer             [disabled]</span><br><span class="line">  -mpc32                                [disabled]</span><br><span class="line">  -mpc64                                [disabled]</span><br><span class="line">  -mpc80                                [disabled]</span><br><span class="line">  -mpclmul                              [enabled]</span><br><span class="line">  -mpcommit                             [disabled]</span><br><span class="line">  -mpconfig                             [disabled]</span><br><span class="line">  -mpku                                 [disabled]</span><br><span class="line">  -mpopcnt                              [enabled]</span><br><span class="line">  -mprefer-avx128             </span><br><span class="line">  -mprefer-vector-width=                none</span><br><span class="line">  -mpreferred-stack-boundary=           0</span><br><span class="line">  -mprefetchwt1                         [disabled]</span><br><span class="line">  -mprfchw                              [enabled]</span><br><span class="line">  -mptwrite                             [disabled]</span><br><span class="line">  -mpush-args                           [enabled]</span><br><span class="line">  -mrdpid                               [disabled]</span><br><span class="line">  -mrdrnd                               [enabled]</span><br><span class="line">  -mrdseed                              [enabled]</span><br><span class="line">  -mrecip                               [disabled]</span><br><span class="line">  -mrecip=                    </span><br><span class="line">  -mrecord-mcount                       [disabled]</span><br><span class="line">  -mrecord-return                       [disabled]</span><br><span class="line">  -mred-zone                            [enabled]</span><br><span class="line">  -mregparm=                            6</span><br><span class="line">  -mrtd                                 [disabled]</span><br><span class="line">  -mrtm                                 [enabled]</span><br><span class="line">  -msahf                                [enabled]</span><br><span class="line">  -msgx                                 [disabled]</span><br><span class="line">  -msha                                 [disabled]</span><br><span class="line">  -mshstk                               [disabled]</span><br><span class="line">  -mskip-rax-setup                      [disabled]</span><br><span class="line">  -msoft-float                          [disabled]</span><br><span class="line">  -msse                                 [enabled]</span><br><span class="line">  -msse2                                [enabled]</span><br><span class="line">  -msse2avx                             [disabled]</span><br><span class="line">  -msse3                                [enabled]</span><br><span class="line">  -msse4                                [enabled]</span><br><span class="line">  -msse4.1                              [enabled]</span><br><span class="line">  -msse4.2                              [enabled]</span><br><span class="line">  -msse4a                               [disabled]</span><br><span class="line">  -msse5                      </span><br><span class="line">  -msseregparm                          [disabled]</span><br><span class="line">  -mssse3                               [enabled]</span><br><span class="line">  -mstack-arg-probe                     [disabled]</span><br><span class="line">  -mstack-protector-guard-offset= </span><br><span class="line">  -mstack-protector-guard-reg= </span><br><span class="line">  -mstack-protector-guard-symbol= </span><br><span class="line">  -mstack-protector-guard=              tls</span><br><span class="line">  -mstackrealign                        [disabled]</span><br><span class="line">  -mstringop-strategy=                  [default]</span><br><span class="line">  -mstv                                 [enabled]</span><br><span class="line">  -mtbm                                 [disabled]</span><br><span class="line">  -mtls-dialect=                        gnu</span><br><span class="line">  -mtls-direct-seg-refs                 [enabled]</span><br><span class="line">  -mtune-ctrl=                </span><br><span class="line">  -mtune=                               broadwell</span><br><span class="line">  -muclibc                              [disabled]</span><br><span class="line">  -mvaes                                [disabled]</span><br><span class="line">  -mveclibabi=                          [default]</span><br><span class="line">  -mvect8-ret-in-mem                    [disabled]</span><br><span class="line">  -mvpclmulqdq                          [disabled]</span><br><span class="line">  -mvzeroupper                          [enabled]</span><br><span class="line">  -mwaitpkg                             [disabled]</span><br><span class="line">  -mwbnoinvd                            [disabled]</span><br><span class="line">  -mx32                                 [disabled]</span><br><span class="line">  -mxop                                 [disabled]</span><br><span class="line">  -mxsave                               [enabled]</span><br><span class="line">  -mxsavec                              [disabled]</span><br><span class="line">  -mxsaveopt                            [enabled]</span><br><span class="line">  -mxsaves                              [disabled]</span><br><span class="line"></span><br><span class="line">  Known assembler dialects (<span class="keyword">for</span> use with the -masm= option):</span><br><span class="line">    att intel</span><br><span class="line"></span><br><span class="line">  Known ABIs (<span class="keyword">for</span> use with the -mabi= option):</span><br><span class="line">    ms sysv</span><br><span class="line"></span><br><span class="line">  Known code models (<span class="keyword">for</span> use with the -mcmodel= option):</span><br><span class="line">    32 kernel large medium small</span><br><span class="line"></span><br><span class="line">  Valid arguments to -mfpmath=:</span><br><span class="line">    387 387+sse 387,sse both sse sse+387 sse,387</span><br><span class="line"></span><br><span class="line">  Known indirect branch choices (<span class="keyword">for</span> use with the -mindirect-branch=/-mfunction-return= options):</span><br><span class="line">    keep thunk thunk-extern thunk-inline</span><br><span class="line"></span><br><span class="line">  Known choices <span class="keyword">for</span> <span class="built_in">return</span> instrumentation with -minstrument-return=:</span><br><span class="line">    call none nop5</span><br><span class="line"></span><br><span class="line">  Known data alignment choices (<span class="keyword">for</span> use with the -malign-data= option):</span><br><span class="line">    abi cacheline compat</span><br><span class="line"></span><br><span class="line">  Known vectorization library ABIs (<span class="keyword">for</span> use with the -mveclibabi= option):</span><br><span class="line">    acml svml</span><br><span class="line"></span><br><span class="line">  Known address mode (<span class="keyword">for</span> use with the -maddress-mode= option):</span><br><span class="line">    long short</span><br><span class="line"></span><br><span class="line">  Known preferred register vector length (to use with the -mprefer-vector-width= option):</span><br><span class="line">    128 256 512 none</span><br><span class="line"></span><br><span class="line">  Known stack protector guard (<span class="keyword">for</span> use with the -mstack-protector-guard= option):</span><br><span class="line">    global tls</span><br><span class="line"></span><br><span class="line">  Valid arguments to -mstringop-strategy=:</span><br><span class="line">    byte_loop libcall loop rep_4byte rep_8byte rep_byte unrolled_loop vector_loop</span><br><span class="line"></span><br><span class="line">  Known TLS dialects (<span class="keyword">for</span> use with the -mtls-dialect= option):</span><br><span class="line">    gnu gnu2</span><br><span class="line"></span><br><span class="line">  Known valid arguments <span class="keyword">for</span> -march= option:</span><br><span class="line">    i386 i486 i586 pentium lakemont pentium-mmx winchip-c6 winchip2 c3 samuel-2 c3-2 nehemiah c7 esther i686 pentiumpro pentium2 pentium3 pentium3m pentium-m pentium4 pentium4m prescott nocona core2 nehalem corei7 westmere sandybridge corei7-avx ivybridge core-avx-i haswell core-avx2 broadwell skylake skylake-avx512 cannonlake icelake-client icelake-server cascadelake tigerlake bonnell atom silvermont slm goldmont goldmont-plus tremont knl knm intel geode k6 k6-2 k6-3 athlon athlon-tbird athlon-4 athlon-xp athlon-mp x86-64 eden-x2 nano nano-1000 nano-2000 nano-3000 nano-x2 eden-x4 nano-x4 k8 k8-sse3 opteron opteron-sse3 athlon64 athlon64-sse3 athlon-fx amdfam10 barcelona bdver1 bdver2 bdver3 bdver4 znver1 znver2 btver1 btver2 generic native</span><br><span class="line"></span><br><span class="line">  Known valid arguments <span class="keyword">for</span> -mtune= option:</span><br><span class="line">    generic i386 i486 pentium lakemont pentiumpro pentium4 nocona core2 nehalem sandybridge haswell bonnell silvermont goldmont goldmont-plus tremont knl knm skylake skylake-avx512 cannonlake icelake-client icelake-server cascadelake tigerlake intel geode k6 athlon k8 amdfam10 bdver1 bdver2 bdver3 bdver4 btver1 btver2 znver1 znver2</span><br></pre></td></tr></table></figure>





<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">/content/drive/MyDrive/mySIMD#</span><span class="bash"> g++ -o build_vec_avx2 -mavx2 build_vec.cc</span></span><br><span class="line"><span class="meta">/content/drive/MyDrive/mySIMD#</span><span class="bash"> ./build_vec_avx2 </span></span><br><span class="line">v0: [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]</span><br><span class="line">v1: [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]</span><br><span class="line">v0 = v0 + 1: [ 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 ]</span><br><span class="line">v1 = v1 + 2: [ 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 ]</span><br><span class="line">v0 = v0 + v1: [ 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 ]</span><br><span class="line">v1 = v0 * v1: [ 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 ]</span><br><span class="line"></span><br><span class="line">v16si a = &#123;0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15&#125;;</span><br><span class="line">v16si b = &#123;0, 2, 4, 6, 8, 1, 3, 5, 7, 9, 10, 11, 12, 13, 14, 15&#125;;</span><br><span class="line">c = a &gt; b: [ 0 0 0 0 0 -1 -1 -1 -1 0 0 0 0 0 0 0 ]</span><br><span class="line">d = (a &gt; b) ? v0 : v1: [ 6 6 6 6 6 3 3 3 3 6 6 6 6 6 6 6 ]</span><br><span class="line"><span class="meta">/content/drive/MyDrive/mySIMD#</span><span class="bash"> g++ -o build_vec_avx512f -mavx512f build_vec.cc</span></span><br><span class="line"><span class="meta">/content/drive/MyDrive/mySIMD#</span><span class="bash"> ./build_vec_avx512f </span></span><br><span class="line">v0: [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]</span><br><span class="line">v1: [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ]</span><br><span class="line">Illegal instruction (core dumped)</span><br><span class="line"><span class="meta">/content/drive/MyDrive/mySIMD#</span><span class="bash"> </span></span><br><span class="line"></span><br><span class="line">Other options: -mmmx、-msse、-msse2、-msse3、-mssse3、-msse4.1、-msse4.2、-msse4、-mavx、-mavx2、-mavx512f、-mavx512pf、-mavx512er、-mavx512cd、-mavx512vl、-mavx512bw、-mavx512dq、-mavx512ifma、-mavx512vbmi。</span><br></pre></td></tr></table></figure>





<p><a href="https://www.intel.com/content/www/us/en/docs/cpp-compiler/developer-guide-reference/2021-8/intrinsics.html" target="_blank" rel="noopener">Intel Manual</a></p>
<p><img src="https://p.ipic.vip/nblx24.jpg" alt="img"></p>
<h2 id="Hardware-Aspects"><a href="#Hardware-Aspects" class="headerlink" title="Hardware Aspects"></a>Hardware Aspects</h2><p><img src="https://p.ipic.vip/98sfm8.png" alt="image-20230524114039763"></p>
<p><img src="https://p.ipic.vip/0ba5i2.png" alt="image-20230524114127909"></p>
<p><img src="https://p.ipic.vip/4i3ul1.png" alt="image-20230524114230862"></p>
<blockquote>
<p>•性能提升更多依赖体系结构改进<br>•提高流水线效率<br>提高Cache效率<br>向量指令，提高向量长度<br>引入多核<br>以Intel为例<br>MMx 11993<br>MMX (64-bit)<br>wl vector re<br>supports<br>SSE、 SSE2、 (128-bit)<br>indeger ope<br>•<br>AVX. AVx2 (256-bit)<br>AVX-512 (512-bit)<br>ARM Neon指令集<br>当前ARM V8的向量化指令集<br>128-bit向量宽度<br>ARM SVE指令集<br>• ARM下-代向量化指令集<br>向量长度可伸缩，从128-bit 到2048-bit<br>与RISC-V V扩展类似<br>RISC-V ISA指令集架构，<br>精简的基础指令集，RV321 , RV641<br>•扩展指令集<br>• M,A,F,D,QC<br>讨论状态：V，B，J等等<br>RISC-V “V” Vector Extension<br>•当前版本1.0<br><a href="https://github.com/riscv/riscv-V-spec" target="_blank" rel="noopener">https://github.com/riscv/riscv-V-spec</a></p>
</blockquote>
<h2 id="Software-Aspects"><a href="#Software-Aspects" class="headerlink" title="Software Aspects"></a>Software Aspects</h2><p><img src="https://p.ipic.vip/nd1dy4.png" alt="image-20230524114212963"></p>
<p>VS</p>
<h2 id="AVX512-VS-GPU"><a href="#AVX512-VS-GPU" class="headerlink" title="AVX512 VS GPU"></a>AVX512 VS GPU</h2><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>CPU + AVX512</td>
<td>big RAM, low Latency, Cache strong</td>
<td>High Power, Bandwidth low..</td>
</tr>
<tr>
<td>GPU</td>
<td>Scaling! CUDA</td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>Intel want “generalization” + “super high computing power”… many other people instead seek solution in ASIC or more core HW</li>
</ul>
<h2 id="AVX-amp-SSE"><a href="#AVX-amp-SSE" class="headerlink" title="AVX &amp; SSE"></a>AVX &amp; SSE</h2><p><a href="https://www.intel.com/content/www/us/en/docs/intrinsics-guide/index.html#text=_mm256_loadu_pd&amp;ig_expand=4122" target="_blank" rel="noopener">https://www.intel.com/content/www/us/en/docs/intrinsics-guide/index.html#text=_mm256_loadu_pd&amp;ig_expand=4122</a></p>
<p>in 2007, AMD announced SSE5 (previously SSE1~SSE4 all announced by Intel), so in 2008, Intel announced AVX, which owns some more distinct features</p>
<p>1 Float length doubled</p>
<p>2 Support 3OPs instruction for old version SSEs</p>
<p><img src="https://p.ipic.vip/qomm14.png" alt="image-20230606224503357"></p>
<p><img src="https://p.ipic.vip/n6fj6m.png" alt="image-20230606224622809"></p>
<blockquote>
<p>誰是最有效率就是軟件遊戲沒有動力學優化軟體覺得我花費大量的人力物理優化提升30%的性能還不如直接等1年後的我根本就沒有用畫的東西很多錢可能會想和背景新市區有直接等過兩天是一個新的提醒我就可能是目前也不好多錢目前來看他用你</p>
</blockquote>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/05/29/AI-System/2%20AI%20Compiler/">AI-System/2 AI Compiler</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-05-29</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/AI-System/">AI-System</a></span><div class="content"><h1 id="Why-we-need-AI-Compiler"><a href="#Why-we-need-AI-Compiler" class="headerlink" title="Why we need AI Compiler"></a>Why we need AI Compiler</h1><ul>
<li>OPs ↑</li>
<li>HW vendors release similar libs, e.g. CuDNN, MKL-DNN for their own chips</li>
<li>Transplanation issue, e.g. CPU &amp; GPU’s existing  Pass hard to be transplanted to NPU</li>
</ul>
<h1 id="AI-Compiler"><a href="#AI-Compiler" class="headerlink" title="AI Compiler"></a>AI Compiler</h1><ul>
<li>auto optimize the process/code</li>
<li>Introduce Pass</li>
<li>FE -&gt; Opt -&gt; BE</li>
<li>Main purpose –&gt; Optiize the performance, and then make coding easier</li>
</ul>
<img src="https://p.ipic.vip/hvdjk2.png" alt="image-20230602171205297" style="zoom:33%;" />



<h3 id="Difference-from-Traditional-Compiler"><a href="#Difference-from-Traditional-Compiler" class="headerlink" title="Difference from Traditional Compiler"></a>Difference from Traditional Compiler</h3><p><img src="https://p.ipic.vip/vsjbeo.png" alt="image-20230602171410674"></p>
<ul>
<li>IR <ul>
<li>for AI<ul>
<li>High-level IR, to describe the computational graph</li>
</ul>
</li>
<li>for Traditional IR<ul>
<li>Low-level IR, e.g. load, store</li>
</ul>
</li>
</ul>
</li>
<li>Pass<ul>
<li>for AI<ul>
<li>OPs fusion</li>
<li>able for Quantization</li>
</ul>
</li>
<li>for Traditional <ul>
<li>no Quantization</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="AI-Compiler-Architecture"><a href="#AI-Compiler-Architecture" class="headerlink" title="AI Compiler Architecture"></a>AI Compiler Architecture</h1><p>Purposes: Inference or Train?!</p>
<ul>
<li>Python as FE interpreter</li>
<li>Multilevel IR, including graph-compilzation, OP compilation, code-gen</li>
<li>for NN</li>
<li>DSA for chips</li>
</ul>
<h3 id="History"><a href="#History" class="headerlink" title="History"></a>History</h3><p><img src="https://p.ipic.vip/o4kzrn.png" alt="image-20230602171958136"></p>
<p>I had experiences in Stage I in 2017~early2019</p>
<p>and now being involved in Stage II</p>
<h4 id="Stage-II"><a href="#Stage-II" class="headerlink" title="Stage II"></a>Stage II</h4><img src="https://p.ipic.vip/6y3qzh.png" alt="image-20230602172529020" style="zoom:67%;" />



<h4 id="Stage-III"><a href="#Stage-III" class="headerlink" title="Stage III"></a>Stage III</h4><p><img src="https://p.ipic.vip/vgjo4j.png" alt="image-20230602172708408"></p>
<p>ref: <a href="https://youtu.be/bW3gsz9AjPY" target="_blank" rel="noopener">AI videos series</a> on YT  </p>
<h3 id="General-Architecture"><a href="#General-Architecture" class="headerlink" title="General Architecture"></a>General Architecture</h3><p><img src="https://p.ipic.vip/gr6gg4.png" alt="image-20230602190537524"></p>
<p>From paper – <u><em>The Deep LearningCompiler: A Comprehensive Survey</em></u></p>
<ul>
<li><p>IR - </p>
<ol>
<li><p>High-level</p>
</li>
<li><p>Low-level</p>
</li>
</ol>
</li>
<li><p>FE Opti.</p>
<p>compose graph with python language</p>
<ol>
<li>Nodes level –  zero-dim-tensor elimination, Nop elimination</li>
<li>Block level – algebraic simplify, constant folding ,op fusion</li>
<li>Data Stream level –  Common sub-expression elimination, DCE(data communcation equip.)</li>
</ol>
</li>
<li><p>BE Opti.</p>
<ol>
<li>Spefific hardware<ul>
<li>low-level IR –&gt; LLVM IR –&gt; GPU/CPU codegen</li>
<li>Domain knowhow</li>
</ul>
</li>
<li>Auto-adjustment<ul>
<li>Halide/TVM allows the <strong>Separatino of Scheduleing and Compute</strong></li>
<li><u>Polyhedral model</u> for param adjustment</li>
</ul>
</li>
<li>Kernel libs<ul>
<li>from libs, e.g. NVidia’s lib</li>
</ul>
</li>
</ol>
</li>
</ul>
<p><img src="https://p.ipic.vip/3orvbk.png" alt="image-20230602191320979"></p>
<h1 id="Challenges-amp-Future"><a href="#Challenges-amp-Future" class="headerlink" title="Challenges &amp; Future"></a>Challenges &amp; Future</h1><ol>
<li><p>Dynamic Shape problems</p>
</li>
<li><p>Python Static<br><img src="https://p.ipic.vip/j07i81.png" alt="image-20230602192507040"></p>
<p><img src="https://p.ipic.vip/agcvp6.png" alt="image-20230602192610709"></p>
</li>
<li><p>Specific Optimization </p>
<ul>
<li>auto parallel<ul>
<li>Scale out </li>
<li>Scale up</li>
</ul>
</li>
<li>HPC for Jacobian matrix, for Hessian matrix</li>
</ul>
</li>
<li><p>Transparency </p>
</li>
<li><p>Compiling cost、Overhead</p>
</li>
</ol>
<ul>
<li>Umifying representation of graph?</li>
<li>Umifying optimization for compilation?</li>
</ul>
<p><img src="https://p.ipic.vip/ypwr0w.png" alt="image-20230602193127645"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/05/27/AI-System/1%20Traditional%20Compilers%20/">AI-System/1 Traditional Compilers </a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-05-27</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/AI-System/">AI-System</a></span><div class="content"><p>Interpreter VS Compiler</p>
<p>JIT vs AOT</p>
<p>Pass &amp; IR</p>
<h2 id="History-of-Compilers-–-GCC-VS-LLVM"><a href="#History-of-Compilers-–-GCC-VS-LLVM" class="headerlink" title="History of Compilers – GCC VS LLVM"></a>History of Compilers – GCC VS LLVM</h2><p><img src="https://p.ipic.vip/wjd955.png" alt="image-20230602161322366"></p>
<p>Compiler –  e.g. turn hello.c to hello.o(binary)</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Sourcecode --&gt; 		Compiler --&gt; 		exe binary</span><br><span class="line">​						(FE, IR Optimizer, BE)</span><br><span class="line">(to AST)												(MachineCode)</span><br><span class="line">Abstract Syntax Tree</span><br></pre></td></tr></table></figure>





<p>GCC 1.0 @ 1987</p>
<img src="https://p.ipic.vip/5y76rq.png" alt="image-20230602160844823" style="zoom:50%;" />

<p>​                        Free the Free!</p>
<p>(Richard Matthew Stallman)</p>
<p>Apple – Free! but OS kernel pretty closed</p>
<p><img src="https://p.ipic.vip/mxxzdg.png" alt="image-20230602161010238"></p>
<h3 id="Apple-met-LLVM"><a href="#Apple-met-LLVM" class="headerlink" title="Apple met LLVM"></a>Apple met LLVM</h3><img src="https://p.ipic.vip/lm33h3.png" alt="image-20230602161146709" style="zoom: 25%;" />





<h3 id="GCC"><a href="#GCC" class="headerlink" title="GCC"></a>GCC</h3><img src="https://p.ipic.vip/bcso75.png" alt="image-20230602161456787" style="zoom: 50%;" />

<img src="https://p.ipic.vip/eht8wd.png" alt="image-20230602161738949" style="zoom:67%;" />





<h3 id="LLVM"><a href="#LLVM" class="headerlink" title="LLVM"></a>LLVM</h3><p>low level VM</p>
<p>Compiler Toolchain</p>
<img src="https://p.ipic.vip/wwjwth.png" alt="image-20230602161604175" style="zoom: 67%;" />





<p>Introduced IR! bettern than GCC</p>
<img src="https://p.ipic.vip/4jgjjm.png" alt="image-20230602161815300" style="zoom:67%;" />





<h2 id="CLANG-VS-GCC"><a href="#CLANG-VS-GCC" class="headerlink" title="CLANG VS GCC"></a>CLANG VS GCC</h2><p><img src="https://p.ipic.vip/cqugk4.png" alt="image-20230602162331702"></p>
<p><img src="https://p.ipic.vip/304pgi.png" alt="image-20230602162406871"></p>
<p><img src="https://p.ipic.vip/n0rsd7.png" alt="image-20230602162448009"></p>
<p><img src="https://p.ipic.vip/rtj8ia.png" alt="image-20230602162529839"></p>
<p>​    - *.ll  – huan readable</p>
<ul>
<li><pre><code class="bash">&gt; clang -emit-llvm hello.i -c -o hello.bc
&gt; code hello.bc
&gt; od -b hello.bc

$ clang -ccc-print-phases hello.cpp
               +- 0: input, <span class="string">"hello.cpp"</span>, c++
            +- 1: preprocessor, {0}, c++-cpp-output
         +- 2: compiler, {1}, ir
      +- 3: backend, {2}, assembler
   +- 4: assembler, {3}, object
+- 5: linker, {4}, image
6: <span class="built_in">bind</span>-arch, <span class="string">"arm64"</span>, {5}, image

(base)
<span class="comment"># joe @ J-M1-Pro-16 in ~/exp [16:35:49]</span>
$ cat hello.s | less
    .cfi_endproc
                                        ; -- End <span class="keyword">function</span>
    .p2align    2                               ; -- Begin <span class="keyword">function</span> _ZNSt3__18ios_base8setstateEj
__ZNSt3__18ios_base8setstateEj:         ; @_ZNSt3__18ios_base8setstateEj
    .cfi_startproc
; %bb.0:
    sub    sp, sp, <span class="comment">#32</span>
    stp    x29, x30, [sp, <span class="comment">#16]             ; 16-byte Folded Spill</span>
        .section        __TEXT,__text,regular,pure_instructions
        .build_version macos, 12, 0     sdk_version 12, 3
        .globl  _main                           ; -- Begin <span class="keyword">function</span> main
        .p2align        2
_main:                                  ; @main
        .cfi_startproc
; %bb.0:
        stp     x29, x30, [sp, <span class="comment">#-16]!           ; 16-byte Folded Spill</span>
        mov     x29, sp
        .cfi_def_cfa w29, 16
        .cfi_offset w30, -8
        .cfi_offset w29, -16
        adrp    x0, l_.str@PAGE
        add     x0, x0, l_.str@PAGEOFF
        bl      _printf
        adrp    x0, __ZNSt3__14coutE@GOTPAGE
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### LLVM IR★</span><br><span class="line"></span><br><span class="line">![image-20230602163418928](https:&#x2F;&#x2F;p.ipic.vip&#x2F;e85fsn.png)</span><br><span class="line"></span><br><span class="line">- SSA - Static Single Assignment </span><br><span class="line">  - ~  RISC ISA</span><br><span class="line">  - 3-address-code</span><br><span class="line">    - &lt;img src&#x3D;&quot;https:&#x2F;&#x2F;p.ipic.vip&#x2F;jwvvo5.png&quot; alt&#x3D;&quot;image-20230602163826992&quot; style&#x3D;&quot;zoom:33%;&quot; &#x2F;&gt;</span><br><span class="line">  - inf registers</span><br><span class="line">- Structure</span><br><span class="line">  - Module -&gt; Function -&gt; Basicblock -&gt; Instruction</span><br><span class="line">- Concepts</span><br><span class="line">  - Value, Use, User, </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### LLVM FE</span><br><span class="line"></span><br><span class="line">&lt;img src&#x3D;&quot;https:&#x2F;&#x2F;p.ipic.vip&#x2F;qtr860.png&quot; alt&#x3D;&quot;image-20230602164519532&quot; style&#x3D;&quot;zoom: 50%;&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">- Lexical Analysis --&gt; Syntatical Analysis --&gt; Semantic Analysis</span><br><span class="line"></span><br><span class="line">  - &#96;&#96;&#96;&#96;bash</span><br><span class="line">    10018  clang -cc1 -dump-tokens hello.cpp</span><br><span class="line">    10019  clang -fsyntax-only -Xclang -ast-dump hello.cpp</span><br><span class="line">    10020  clang -c hello.cpp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### LLVM Optimizer</span><br><span class="line"></span><br><span class="line">- Finding PASS</span><br><span class="line"></span><br><span class="line">  - Analysis Pass</span><br><span class="line"></span><br><span class="line">  - Transform pass</span><br><span class="line"></span><br><span class="line">  - &#96;&#96;&#96;	bash</span><br><span class="line">    &gt; opt hello.bc -instcount -time-passes -domtree -o hello-tmp.bc -stats</span><br></pre></td></tr></table></figure>

- [LLVM’s Analysis and Transform Passes — LLVM 17.0.0git documentation](https://llvm.org/docs/Passes.html)

  - e.g. -adce: Aggressive Dead Code Elimination
  - e.g.  -constmerge: Merge Duplicate Global Constants

- ModulePass, FunctionPass, BasicBlockPass


</code></pre>
</li>
</ul>
<h3 id="LLVM-BE"><a href="#LLVM-BE" class="headerlink" title="LLVM BE"></a>LLVM BE</h3><img src="/Users/joe/Library/Application Support/typora-user-images/image-20230602165508513.png" alt="image-20230602165508513" style="zoom: 40%;" />



<h4 id="SelectionDAG-gt-Scheduling"><a href="#SelectionDAG-gt-Scheduling" class="headerlink" title="SelectionDAG -&gt; Scheduling"></a>SelectionDAG -&gt; Scheduling</h4><p><img src="https://p.ipic.vip/3r23t5.png" alt="image-20230602165708989"></p>
<p>Topological sort to know nodes that are able to run parallelly</p>
<h4 id="MCInst-gt-Code-Emission"><a href="#MCInst-gt-Code-Emission" class="headerlink" title="MCInst -&gt; Code Emission"></a>MCInst -&gt; Code Emission</h4><h4 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h4><p><img src="https://p.ipic.vip/gtnep5.png" alt="image-20230602165926323"></p>
<h2 id="OnGoing-History"><a href="#OnGoing-History" class="headerlink" title="OnGoing History"></a>OnGoing History</h2><p>Chris start his bizness at “Modular”</p>
<h2 id="LLVM-Related-AI-Compilers"><a href="#LLVM-Related-AI-Compilers" class="headerlink" title="LLVM Related AI Compilers"></a>LLVM Related AI Compilers</h2><p>built on LLVM, including</p>
<ul>
<li>XLA in TF,  by Google</li>
<li>JAX, autograd + XLA, by Google</li>
<li>TensorFlow, on XLA, then on LLVM</li>
<li>TVM for different hardwares</li>
<li>Julia, for HPC, using LLVM JIT</li>
</ul>
<p>ref to </p>
<ul>
<li>series of <a href="https://youtu.be/i5_BptwCBHA" target="_blank" rel="noopener">AI videos</a> on YT</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/05/25/Concurrency/2023-05-25%20HighConcurrency%20VS%20MultiThreading/">Concurrency/2023-05-25 HighConcurrency VS MultiThreading</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-05-25</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Concurrency/">Concurrency</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Concurrency/">Concurrency</a></span><div class="content"><h1 id="High-Concurrency"><a href="#High-Concurrency" class="headerlink" title="High Concurrency"></a>High Concurrency</h1><p>High concurrency refers to a situation where a system encounters a large number of operation requests in a short period of time, mainly occurring in web systems with concentrated access and receiving a large number of requests (e.g., ticket grabbing on 12306; Second-Kill event). This situation leads to the system performing a large number of operations during a pretty short time, such as requests on services, apps, and database operations.</p>
<h3 id="Performance-Metrics"><a href="#Performance-Metrics" class="headerlink" title="Performance Metrics"></a>Performance Metrics</h3><p>including: response time, throughput, queries per second (QPS), and concurrent user count.</p>
<ul>
<li><code>Response Time</code><br> The time it takes for the system to respond to a request. For example, if it takes 200ms for the system to process an HTTP request, that 200ms is the system’s response time. </li>
<li><code>Throughput</code><br> The number of requests processed per unit of time. </li>
<li><code>Queries Per Second (QPS)</code> The # of requests responded to per second. In the Internet domain, this metric is not as clearly distinguished from throughput. </li>
<li><code>Concurrent User Count</code> The number of users who can simultaneously use the system’s features normally. E.g., in an instant messaging system, the number of users online at the same time to some extent represents the system’s concurrent user count.</li>
</ul>
<h3 id="High-Concurrency-Solutions"><a href="#High-Concurrency-Solutions" class="headerlink" title="High Concurrency Solutions"></a>High Concurrency Solutions</h3><ul>
<li>Use CDN for static resources to handle image file access.</li>
<li>Distributed caching: Redis, Memcached, etc.</li>
<li>Message queue middleware: ActiveMQ, etc., to solve the asynchronous processing capability of a large number of messages.</li>
<li>Application splitting: A single project is split into multiple projects for deployment, using Dubbo to solve communication between multiple projects.</li>
<li>Vertical and horizontal database splitting (sharding).</li>
<li>Database read-write separation to solve large data query problems.</li>
<li>Use NoSQL, such as MongoDB, in combination with MySQL.</li>
<li>Establish service degradation and flow control mechanisms under high data access conditions.</li>
</ul>
<p>In sum, high concurrency refers to a system’s ability to handle a large number of concurrent requests or transactions simultaneously. It refers to the system’s capability to process multiple user requests or transactions at the same time. High concurrency performance is an important measure of a system’s load capacity and responsiveness. Multithreading is often used as a common technique for achieving high concurrency. By using multithreading, concurrent requests or transactions can be assigned to different threads for processing, thus enhancing the system’s concurrent processing capability.</p>
<h1 id="Multithreading"><a href="#Multithreading" class="headerlink" title="Multithreading"></a>Multithreading</h1><p>A program can have multiple threads running in parallel internally. The execution of a thread can be considered as a CPU executing the program. When a program runs with multiple threads, it’s as if multiple CPUs are executing the program simultaneously.</p>
<p>In summary, multithreading can be understood as follows: <u>Multithreading is a programming method for handling high concurrency, meaning that concurrency needs to be implemented using multiple threads,</u> e.g. 1) Stress-tested Aliyun’s audio generation API with C++’s multithread library<br>2) Adopted multithreading &amp; coroutine to build “Automatic Video Generation System” and “Async Web Service for Adobe Application”, from my experiences.</p>
<p>In sum, multi-threading refers to the execution of multiple threads simultaneously within a program, where each thread can run independently and perform different tasks. The main purpose of multithreading is to improve program performance and resource utilization. By dividing tasks into multiple threads, the parallel computing capabilities of multi-core processors can be fully utilized, enabling tasks to be executed in parallel. Multithreading is commonly used in scenarios involving simultaneous execution of multiple tasks, I/O-intensive operations, and parallel computing.</p>
<h1 id="Relationship-btw-The-2-Terms"><a href="#Relationship-btw-The-2-Terms" class="headerlink" title="Relationship btw The 2 Terms"></a>Relationship btw The 2 Terms</h1><p>Though they are usually mentioned together and are related, giving the impression that they are equal, but in fact, <code>high concurrency ≠ multithreading</code> ,</p>
<p>Therefore, it can be said that multithreading is one of the commonly used techniques for achieving high concurrency. <u>However</u>, high concurrency performance is also influenced by other factors such as system architecture, resource management, locking mechanisms, and algorithm design. Hence, multithreading and high concurrency are related but not exactly the same concepts..</p>
<h3 id="Scenarios"><a href="#Scenarios" class="headerlink" title="Scenarios"></a>Scenarios</h3><ol>
<li>High concurrency scenarios –  When we have a Java web project, and after it goes live, a large number of users log in to the system, which is considered high concurrency. For the system, there will be <u>a large number of requests coming in</u>, each request corresponding to a thread, and each thread is independent (Tomcat supports 200-300). Although it is the same code, it is executed in different threads without affecting each other.</li>
<li>Multithreading scenarios – Multithreading is used either for <u>asynchronous tasks</u> or for running <u>subtasks</u>. Each user thread is the main thread. Asynchronous tasks involve opening another thread. The purpose of running subtasks is to handle large data sets. Single-threaded processing would be slow, so the task is split into multiple subtasks, and multiple threads run them, making it faster.</li>
</ol>
<p>ref: </p>
<p><a href="https://cloud.tencent.com/developer/article/1477818" target="_blank" rel="noopener">怎么理解分布式、高并发、多线程？（含面试题和答案解析）-腾讯云开发者社区-腾讯云 (tencent.com)</a></p>
<p><a href="https://juejin.cn/post/6964748689382326280" target="_blank" rel="noopener">美团面试官：哟！你对高并发与多线程的解决思路了解的还挺深！ - 掘金 (juejin.cn)</a></p>
<p><a href="https://juejin.cn/post/6947966434748301326#_35" target="_blank" rel="noopener">【多线程与高并发】告诉你二者的区别 - 掘金 (juejin.cn)</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/05/22/ParallelProg/Parallel%20Acceleration%20--%20Laws%20&amp;%20PerfStat%20&amp;%20AVX/">ParallelProg/Parallel Acceleration -- Laws &amp; PerfStat &amp; AVX</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-05-22</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/SIMD/">SIMD</a></span><div class="content"><p>Numerical Algs –&gt; Optimizing for Performance –&gt; Writing Parallel Algs</p>
<h1 id="Law"><a href="#Law" class="headerlink" title="Law"></a>Law</h1><h2 id="1-Amdahl’s-Law"><a href="#1-Amdahl’s-Law" class="headerlink" title="1. Amdahl’s Law"></a>1. Amdahl’s Law</h2><p>   阿姆达尔定律是一个计算机科学界的经验法则，因IBM公司计算机架构师吉恩·阿姆达尔而得名。吉恩·阿姆达尔在1967年发表的论文中提出了这个重要定律。<br>   阿姆达尔定律主要用于发现仅仅系统的部分得到改进，整体系统可以得到的最大期望改进。它经常用于并行计算领域，用来预测适用多个处理器时理论上的最大加速比。在我们的性能调优领域，我们利用此定律有助于我们解决或者缓解性能瓶颈问题。<br>   阿姆达尔定律的模型阐释了我们现实生产中串行资源争用时候的现象。如下图模型，一个系统中，不可避免有一些资源必须串行访问，这限制了我们的加速比，即使我们增加了并发数（横轴），但取得效果并不理想，难以获得线性扩展能力(图中直线)。</p>
<h2 id="2-Gustafson’s-Law"><a href="#2-Gustafson’s-Law" class="headerlink" title="2. Gustafson’s Law"></a>2. Gustafson’s Law</h2><p>   Gustafson定律(Gustafson’s law)阐述了数据并行带来的影响。Gustafson 定律是由 John L. Gustafson 在1988年提出的。是并行计算领域除了 Amdahl 定律之后又一个重要定律。Gustafson定律看待加速比的角度会有所不同，其站在对于大量数据流处理过程中，针对重复工作的分布式运算带来的加速特性，而不仅仅局限在一个单一的程序进程&amp;单一的计算机上，串行的部分主要在于数据的分配预处理以及计算结果的收集汇总处理上。</p>
<p>compiler optimization </p>
<p>Options: -O1~ -O3, Ofast</p>
<p><img src="https://p.ipic.vip/qb9bbd.png" alt="image-20230606203406991"></p>
<p><img src="https://p.ipic.vip/8gn0if.png" alt="image-20230606203539104"></p>
<p><img src="https://p.ipic.vip/njwuzm.png" alt="Visual representation of latencies"></p>
<p>Pipeline and HW oriented Design</p>
<ul>
<li>sudo apt install linux-tools-generic</li>
</ul>
<h1 id="Perf-Stat"><a href="#Perf-Stat" class="headerlink" title="Perf Stat"></a>Perf Stat</h1><p>Branch prediction failed if unpredictable pattern in code would make the task-clock longer</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">(venv-py311) jo@fossa4gb:~/repo/V10793_C/Section 3/video2$ sudo perf <span class="built_in">stat</span> ./spec</span><br><span class="line"></span><br><span class="line"> Performance counter stats <span class="keyword">for</span> <span class="string">'./spec'</span>:</span><br><span class="line"></span><br><span class="line">            342.40 msec task-clock                <span class="comment">#    0.996 CPUs utilized          </span></span><br><span class="line">                16      context-switches          <span class="comment">#    0.047 K/sec                  </span></span><br><span class="line">                 0      cpu-migrations            <span class="comment">#    0.000 K/sec                  </span></span><br><span class="line">             19574      page-faults               <span class="comment">#    0.057 M/sec                  </span></span><br><span class="line">   &lt;not supported&gt;      cycles                                                      </span><br><span class="line">   &lt;not supported&gt;      instructions                                                </span><br><span class="line">   &lt;not supported&gt;      branches                                                    </span><br><span class="line">   &lt;not supported&gt;      branch-misses                                               </span><br><span class="line"></span><br><span class="line">       0.343925345 seconds time elapsed</span><br><span class="line"></span><br><span class="line">       0.243236000 seconds user</span><br><span class="line">       0.099686000 seconds sys</span><br><span class="line">       </span><br><span class="line">(venv-py311) jo@fossa4gb:~/repo/V10793_C/Section 3/video2$ sudo perf <span class="built_in">stat</span> ./spec2</span><br><span class="line"></span><br><span class="line"> Performance counter stats <span class="keyword">for</span> <span class="string">'./spec2'</span>:</span><br><span class="line"></span><br><span class="line">            465.56 msec task-clock                <span class="comment">#    0.986 CPUs utilized          </span></span><br><span class="line">                53      context-switches          <span class="comment">#    0.114 K/sec                  </span></span><br><span class="line">                 2      cpu-migrations            <span class="comment">#    0.004 K/sec                  </span></span><br><span class="line">             19574      page-faults               <span class="comment">#    0.042 M/sec                  </span></span><br><span class="line">   &lt;not supported&gt;      cycles                                                      </span><br><span class="line">   &lt;not supported&gt;      instructions                                                </span><br><span class="line">   &lt;not supported&gt;      branches                                                    </span><br><span class="line">   &lt;not supported&gt;      branch-misses                                               </span><br><span class="line"></span><br><span class="line">       0.472287268 seconds time elapsed</span><br><span class="line"></span><br><span class="line">       0.348851000 seconds user</span><br><span class="line">       0.117635000 seconds sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(j=0;j&lt;MAX;j++) &#123;</span><br><span class="line">        // i = rand() % 3;</span><br><span class="line">        i = j % 3;      //spec1</span><br><span class="line">        i = rand() % 3; //spec2</span><br><span class="line">        switch(i) &#123;</span><br></pre></td></tr></table></figure>



<ul>
<li>unroll also makes faster</li>
</ul>
<h1 id="AVX"><a href="#AVX" class="headerlink" title="AVX"></a>AVX</h1><p><a href="https://www.intel.com/content/www/us/en/docs/intrinsics-guide/index.html" target="_blank" rel="noopener">Intel® Intrinsics Guide</a></p>
<p>x86 SIMD History</p>
<ul>
<li>MMX-SSE4 (1997-2006)<br>O Early SIMD was integer-only, later extended to floating point</li>
<li>AVX (2008)<br>O 128 and 256 bit SIMD instructions with 16 new registers</li>
<li>AVX2 (2013)<br>O Introduced with Haswell, extends AVX to 256 bit, adds FMA</li>
<li>AVX-512 (2015)<br>O Originally in Xeon Phi KNL, extended to Skylake+: 512 bit extensions</li>
</ul>
<p><img src="https://p.ipic.vip/s60b9d.png" alt="image-20230606211435215"></p>
<p>Explore caches, branching, and memory speeds</p>
<p>Superscalar &amp; pipelining</p>
<p>Staying out of the compiler’s way</p>
<p>Vectorization code</p>
</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/79/">79</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2023 By Joe Huang</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>